const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-CjZXOTF7.js","assets/index-CETA75jK.js","assets/index-VzWzPFwL.css","assets/basic-BIioA4TD.js","assets/index-Bk9OT-PC.js","assets/w3m-modal-Bs-FceJR.js"])))=>i.map(i=>d[i]);
import{g as Du,a as ty,_ as Tl,b as ry,c as Nr}from"./index-CETA75jK.js";var $u={exports:{}},Gn=typeof Reflect=="object"?Reflect:null,Ph=Gn&&typeof Gn.apply=="function"?Gn.apply:function(e,r,s){return Function.prototype.apply.call(e,r,s)},Ra;Gn&&typeof Gn.ownKeys=="function"?Ra=Gn.ownKeys:Object.getOwnPropertySymbols?Ra=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ra=function(e){return Object.getOwnPropertyNames(e)};function sy(t){console&&console.warn&&console.warn(t)}var ug=Number.isNaN||function(e){return e!==e};function Pe(){Pe.init.call(this)}$u.exports=Pe;$u.exports.once=ay;Pe.EventEmitter=Pe;Pe.prototype._events=void 0;Pe.prototype._eventsCount=0;Pe.prototype._maxListeners=void 0;var Dh=10;function uc(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Pe,"defaultMaxListeners",{enumerable:!0,get:function(){return Dh},set:function(t){if(typeof t!="number"||t<0||ug(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Dh=t}});Pe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Pe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ug(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function hg(t){return t._maxListeners===void 0?Pe.defaultMaxListeners:t._maxListeners}Pe.prototype.getMaxListeners=function(){return hg(this)};Pe.prototype.emit=function(e){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var n=e==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(c===void 0)return!1;if(typeof c=="function")Ph(c,this,r);else for(var l=c.length,u=wg(c,l),s=0;s<l;++s)Ph(u[s],this,r);return!0};function dg(t,e,r,s){var n,i,o;if(uc(r),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),o=i[e]),o===void 0)o=i[e]=r,++t._eventsCount;else if(typeof o=="function"?o=i[e]=s?[r,o]:[o,r]:s?o.unshift(r):o.push(r),n=hg(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,sy(a)}return t}Pe.prototype.addListener=function(e,r){return dg(this,e,r,!1)};Pe.prototype.on=Pe.prototype.addListener;Pe.prototype.prependListener=function(e,r){return dg(this,e,r,!0)};function ny(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function fg(t,e,r){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=ny.bind(s);return n.listener=r,s.wrapFn=n,n}Pe.prototype.once=function(e,r){return uc(r),this.on(e,fg(this,e,r)),this};Pe.prototype.prependOnceListener=function(e,r){return uc(r),this.prependListener(e,fg(this,e,r)),this};Pe.prototype.removeListener=function(e,r){var s,n,i,o,a;if(uc(r),n=this._events,n===void 0)return this;if(s=n[e],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,s.listener||r));else if(typeof s!="function"){for(i=-1,o=s.length-1;o>=0;o--)if(s[o]===r||s[o].listener===r){a=s[o].listener,i=o;break}if(i<0)return this;i===0?s.shift():iy(s,i),s.length===1&&(n[e]=s[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this};Pe.prototype.off=Pe.prototype.removeListener;Pe.prototype.removeAllListeners=function(e){var r,s,n;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var i=Object.keys(s),o;for(n=0;n<i.length;++n)o=i[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function pg(t,e,r){var s=t._events;if(s===void 0)return[];var n=s[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?oy(n):wg(n,n.length)}Pe.prototype.listeners=function(e){return pg(this,e,!0)};Pe.prototype.rawListeners=function(e){return pg(this,e,!1)};Pe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):gg.call(t,e)};Pe.prototype.listenerCount=gg;function gg(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Pe.prototype.eventNames=function(){return this._eventsCount>0?Ra(this._events):[]};function wg(t,e){for(var r=new Array(e),s=0;s<e;++s)r[s]=t[s];return r}function iy(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function oy(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function ay(t,e){return new Promise(function(r,s){function n(o){t.removeListener(e,i),s(o)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}mg(t,e,i,{once:!0}),e!=="error"&&cy(t,n,{once:!0})})}function cy(t,e,r){typeof t.on=="function"&&mg(t,"error",e,r)}function mg(t,e,r,s){if(typeof t.on=="function")s.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(i){s.once&&t.removeEventListener(e,n),r(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var or=$u.exports;const Ru=Du(or);var W={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Pl=function(t,e){return Pl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var n in s)s.hasOwnProperty(n)&&(r[n]=s[n])},Pl(t,e)};function ly(t,e){Pl(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Dl=function(){return Dl=Object.assign||function(e){for(var r,s=1,n=arguments.length;s<n;s++){r=arguments[s];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Dl.apply(this,arguments)};function uy(t,e){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(r[s[n]]=t[s[n]]);return r}function hy(t,e,r,s){var n=arguments.length,i=n<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,r):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(i=(n<3?o(i):n>3?o(e,r,i):o(e,r))||i);return n>3&&i&&Object.defineProperty(e,r,i),i}function dy(t,e){return function(r,s){e(r,s,t)}}function fy(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function py(t,e,r,s){function n(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{l(s.next(u))}catch(h){o(h)}}function c(u){try{l(s.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):n(u.value).then(a,c)}l((s=s.apply(t,e||[])).next())})}function gy(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,n,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,n&&(i=l[0]&2?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],n=0}finally{s=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function wy(t,e,r,s){s===void 0&&(s=r),t[s]=e[r]}function my(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function $l(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],s=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function yg(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),n,i=[],o;try{for(;(e===void 0||e-- >0)&&!(n=s.next()).done;)i.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i}function yy(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(yg(arguments[e]));return t}function by(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var s=Array(t),n=0,e=0;e<r;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,n++)s[n]=i[o];return s}function io(t){return this instanceof io?(this.v=t,this):new io(t)}function vy(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(t,e||[]),n,i=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(d){s[d]&&(n[d]=function(f){return new Promise(function(p,g){i.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{c(s[d](f))}catch(p){h(i[0][3],p)}}function c(d){d.value instanceof io?Promise.resolve(d.value.v).then(l,u):h(i[0][2],d)}function l(d){a("next",d)}function u(d){a("throw",d)}function h(d,f){d(f),i.shift(),i.length&&a(i[0][0],i[0][1])}}function Ey(t){var e,r;return e={},s("next"),s("throw",function(n){throw n}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(n,i){e[n]=t[n]?function(o){return(r=!r)?{value:io(t[n](o)),done:n==="return"}:i?i(o):o}:i}}function Cy(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof $l=="function"?$l(t):t[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(i){r[i]=t[i]&&function(o){return new Promise(function(a,c){o=t[i](o),n(a,c,o.done,o.value)})}}function n(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}}function Ay(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Iy(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function _y(t){return t&&t.__esModule?t:{default:t}}function Sy(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Ny(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const xy=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Dl},__asyncDelegator:Ey,__asyncGenerator:vy,__asyncValues:Cy,__await:io,__awaiter:py,__classPrivateFieldGet:Sy,__classPrivateFieldSet:Ny,__createBinding:wy,__decorate:hy,__exportStar:my,__extends:ly,__generator:gy,__importDefault:_y,__importStar:Iy,__makeTemplateObject:Ay,__metadata:fy,__param:dy,__read:yg,__rest:uy,__spread:yy,__spreadArrays:by,__values:$l},Symbol.toStringTag,{value:"Module"})),jo=ty(xy);var kc={},wi={},$h;function Oy(){if($h)return wi;$h=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return wi.delay=t,wi}var Ps={},Uc={},Ds={},Rh;function Ty(){return Rh||(Rh=1,Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.ONE_THOUSAND=Ds.ONE_HUNDRED=void 0,Ds.ONE_HUNDRED=100,Ds.ONE_THOUSAND=1e3),Ds}var Bc={},kh;function Py(){return kh||(kh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Bc)),Bc}var Uh;function bg(){return Uh||(Uh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jo;e.__exportStar(Ty(),t),e.__exportStar(Py(),t)}(Uc)),Uc}var Bh;function Dy(){if(Bh)return Ps;Bh=1,Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.fromMiliseconds=Ps.toMiliseconds=void 0;const t=bg();function e(s){return s*t.ONE_THOUSAND}Ps.toMiliseconds=e;function r(s){return Math.floor(s/t.ONE_THOUSAND)}return Ps.fromMiliseconds=r,Ps}var Lh;function $y(){return Lh||(Lh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jo;e.__exportStar(Oy(),t),e.__exportStar(Dy(),t)}(kc)),kc}var bn={},Mh;function Ry(){if(Mh)return bn;Mh=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const s=this.get(r);if(typeof s.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-s.started;this.timestamps.set(r,{started:s.started,elapsed:n})}get(r){const s=this.timestamps.get(r);if(typeof s>"u")throw new Error(`No timestamp found for label: ${r}`);return s}elapsed(r){const s=this.get(r);return s.elapsed||Date.now()-s.started}}return bn.Watch=t,bn.default=t,bn}var Lc={},mi={},Fh;function ky(){if(Fh)return mi;Fh=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.IWatch=void 0;class t{}return mi.IWatch=t,mi}var jh;function Uy(){return jh||(jh=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),jo.__exportStar(ky(),t)}(Lc)),Lc}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jo;e.__exportStar($y(),t),e.__exportStar(Ry(),t),e.__exportStar(Uy(),t),e.__exportStar(bg(),t)})(W);class ln{}let By=class extends ln{constructor(e){super()}};const qh=W.FIVE_SECONDS,un={pulse:"heartbeat_pulse"};let Ly=class vg extends By{constructor(e){super(e),this.events=new or.EventEmitter,this.interval=qh,this.interval=(e==null?void 0:e.interval)||qh}static async init(e){const r=new vg(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),W.toMiliseconds(this.interval))}pulse(){this.events.emit(un.pulse)}};const My=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Fy=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,jy=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function qy(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){zy(t);return}return e}function zy(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function ia(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!jy.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(My.test(t)||Fy.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,qy)}return JSON.parse(t)}catch(s){if(e.strict)throw s;return t}}function Wy(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Xe(t,...e){try{return Wy(t(...e))}catch(r){return Promise.reject(r)}}function Hy(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Ky(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function ka(t){if(Hy(t))return String(t);if(Ky(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return ka(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Rl="base64:";function Vy(t){return typeof t=="string"?t:Rl+Jy(t)}function Gy(t){return typeof t!="string"||!t.startsWith(Rl)?t:Yy(t.slice(Rl.length))}function Yy(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Jy(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ot(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Xy(...t){return Ot(t.join(":"))}function oa(t){return t=Ot(t),t?t+":":""}function Zy(t,e){if(e===void 0)return!0;let r=0,s=t.indexOf(":");for(;s>-1;)r++,s=t.indexOf(":",s+1);return r<=e}function Qy(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const eb="memory",tb=()=>{const t=new Map;return{name:eb,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function rb(t={}){const e={mounts:{"":t.driver||tb()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},s=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),n=(l,u)=>{if(e.watching){u=Ot(u);for(const h of e.watchListeners)h(l,u)}},i=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await zh(e.mounts[l],n,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const d=new Map,f=p=>{let g=d.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},d.set(p.base,g)),g};for(const p of l){const g=typeof p=="string",w=Ot(g?p:p.key),E=g?void 0:p.value,v=g||!p.options?u:{...u,...p.options},C=r(w);f(C).items.push({key:w,value:E,relativeKey:C.relativeKey,options:v})}return Promise.all([...d.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(l,u={}){l=Ot(l);const{relativeKey:h,driver:d}=r(l);return Xe(d.hasItem,h,u)},getItem(l,u={}){l=Ot(l);const{relativeKey:h,driver:d}=r(l);return Xe(d.getItem,h,u).then(f=>ia(f))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?Xe(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(f=>({key:Xy(h.base,f.key),value:ia(f.value)}))):Promise.all(h.items.map(d=>Xe(h.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:ia(f)})))))},getItemRaw(l,u={}){l=Ot(l);const{relativeKey:h,driver:d}=r(l);return d.getItemRaw?Xe(d.getItemRaw,h,u):Xe(d.getItem,h,u).then(f=>Gy(f))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Ot(l);const{relativeKey:d,driver:f}=r(l);f.setItem&&(await Xe(f.setItem,d,ka(u),h),f.watch||n("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return Xe(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:ka(d.value),options:d.options})),u);h.driver.setItem&&await Promise.all(h.items.map(d=>Xe(h.driver.setItem,d.relativeKey,ka(d.value),d.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Ot(l);const{relativeKey:d,driver:f}=r(l);if(f.setItemRaw)await Xe(f.setItemRaw,d,u,h);else if(f.setItem)await Xe(f.setItem,d,Vy(u),h);else return;f.watch||n("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Ot(l);const{relativeKey:h,driver:d}=r(l);d.removeItem&&(await Xe(d.removeItem,h,u),(u.removeMeta||u.removeMata)&&await Xe(d.removeItem,h+"$",u),d.watch||n("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Ot(l);const{relativeKey:h,driver:d}=r(l),f=Object.create(null);if(d.getMeta&&Object.assign(f,await Xe(d.getMeta,h,u)),!u.nativeOnly){const p=await Xe(d.getItem,h+"$",u).then(g=>ia(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var w;l=oa(l);const h=s(l,!0);let d=[];const f=[];let p=!0;for(const E of h){(w=E.driver.flags)!=null&&w.maxDepth||(p=!1);const v=await Xe(E.driver.getKeys,E.relativeBase,u);for(const C of v){const _=E.mountpoint+Ot(C);d.some(S=>_.startsWith(S))||f.push(_)}d=[E.mountpoint,...d.filter(C=>!C.startsWith(E.mountpoint))]}const g=u.maxDepth!==void 0&&!p;return f.filter(E=>(!g||Zy(E,u.maxDepth))&&Qy(E,l))},async clear(l,u={}){l=oa(l),await Promise.all(s(l,!1).map(async h=>{if(h.driver.clear)return Xe(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(d.map(f=>h.driver.removeItem(f,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Wh(l)))},async watch(l){return await i(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=oa(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(zh(u,n,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,d;l=oa(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((d=(h=e.unwatch)[l])==null||d.call(h),delete e.unwatch[l]),u&&await Wh(e.mounts[l]),e.mountpoints=e.mountpoints.filter(f=>f!==l),delete e.mounts[l])},getMount(l=""){l=Ot(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Ot(l),s(l,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function zh(t,e,r){return t.watch?t.watch((s,n)=>e(s,r+n)):()=>{}}async function Wh(t){typeof t.dispose=="function"&&await Xe(t.dispose)}function hn(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Eg(t,e){let r;const s=()=>{if(r)return r;const n=indexedDB.open(t);return n.onupgradeneeded=()=>n.result.createObjectStore(e),r=hn(n),r.then(i=>{i.onclose=()=>r=void 0},()=>{}),r};return(n,i)=>s().then(o=>i(o.transaction(e,n).objectStore(e)))}let Mc;function qo(){return Mc||(Mc=Eg("keyval-store","keyval")),Mc}function Hh(t,e=qo()){return e("readonly",r=>hn(r.get(t)))}function sb(t,e,r=qo()){return r("readwrite",s=>(s.put(e,t),hn(s.transaction)))}function nb(t,e=qo()){return e("readwrite",r=>(r.delete(t),hn(r.transaction)))}function ib(t=qo()){return t("readwrite",e=>(e.clear(),hn(e.transaction)))}function ob(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},hn(t.transaction)}function ab(t=qo()){return t("readonly",e=>{if(e.getAllKeys)return hn(e.getAllKeys());const r=[];return ob(e,s=>r.push(s.key)).then(()=>r)})}const cb=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),lb=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(s,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function tn(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return lb(t)}catch{return t}}function Qr(t){return typeof t=="string"?t:cb(t)||""}const ub="idb-keyval";var hb=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let s;return t.dbName&&t.storeName&&(s=Eg(t.dbName,t.storeName)),{name:ub,options:t,async hasItem(n){return!(typeof await Hh(r(n),s)>"u")},async getItem(n){return await Hh(r(n),s)??null},setItem(n,i){return sb(r(n),i,s)},removeItem(n){return nb(r(n),s)},getKeys(){return ab(s)},clear(){return ib(s)}}};const db="WALLET_CONNECT_V2_INDEXED_DB",fb="keyvaluestorage";let pb=class{constructor(){this.indexedDb=rb({driver:hb({dbName:db,storeName:fb})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Qr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Fc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ua={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,s){this[r]=String(s)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Fc<"u"&&Fc.localStorage?Ua.exports=Fc.localStorage:typeof window<"u"&&window.localStorage?Ua.exports=window.localStorage:Ua.exports=new e})();function gb(t){var e;return[t[0],tn((e=t[1])!=null?e:"")]}let wb=class{constructor(){this.localStorage=Ua.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(gb)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return tn(r)}async setItem(e,r){this.localStorage.setItem(e,Qr(r))}async removeItem(e){this.localStorage.removeItem(e)}};const mb="wc_storage_version",Kh=1,yb=async(t,e,r)=>{const s=mb,n=await e.getItem(s);if(n&&n>=Kh){r(e);return}const i=await t.getKeys();if(!i.length){r(e);return}const o=[];for(;i.length;){const a=i.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(s,Kh),r(e),bb(t,o)},bb=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let vb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new wb;this.storage=e;try{const r=new pb;yb(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};function Eb(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Cb=Ab;function Ab(t,e,r){var s=r&&r.stringify||Eb,n=1;if(typeof t=="object"&&t!==null){var i=e.length+n;if(i===1)return t;var o=new Array(i);o[0]=s(t);for(var a=1;a<i;a++)o[a]=s(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-n,h=-1,d=t&&t.length||0,f=0;f<d;){if(t.charCodeAt(f)===37&&f+1<d){switch(h=h>-1?h:0,t.charCodeAt(f+1)){case 100:case 102:if(u>=c||e[u]==null)break;h<f&&(l+=t.slice(h,f)),l+=Number(e[u]),h=f+2,f++;break;case 105:if(u>=c||e[u]==null)break;h<f&&(l+=t.slice(h,f)),l+=Math.floor(Number(e[u])),h=f+2,f++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;h<f&&(l+=t.slice(h,f));var p=typeof e[u];if(p==="string"){l+="'"+e[u]+"'",h=f+2,f++;break}if(p==="function"){l+=e[u].name||"<anonymous>",h=f+2,f++;break}l+=s(e[u]),h=f+2,f++;break;case 115:if(u>=c)break;h<f&&(l+=t.slice(h,f)),l+=String(e[u]),h=f+2,f++;break;case 37:h<f&&(l+=t.slice(h,f)),l+="%",h=f+2,f++,u--;break}++u}++f}return h===-1?t:(h<d&&(l+=t.slice(h)),l)}const Vh=Cb;var jn=Dr;const oo=$b().console||{},Ib={mapHttpRequest:aa,mapHttpResponse:aa,wrapRequestSerializer:jc,wrapResponseSerializer:jc,wrapErrorSerializer:jc,req:aa,res:aa,err:Ob};function _b(t,e){return Array.isArray(t)?t.filter(function(s){return s!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function Dr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||oo;t.browser.write&&(t.browser.asObject=!0);const s=t.serializers||{},n=_b(t.browser.serialize,s);let i=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(i=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=ao),Object.defineProperty(c,"levelVal",{get:u}),Object.defineProperty(c,"level",{get:h,set:d});const l={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:Tb(t)};c.levels=Dr.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=ao,c.serializers=s,c._serialize=n,c._stdErrSerialize=i,c.child=f,e&&(c._logEvent=kl());function u(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function d(p){if(p!=="silent"&&!this.levels.values[p])throw Error("unknown level "+p);this._level=p,vn(l,c,"error","log"),vn(l,c,"fatal","error"),vn(l,c,"warn","error"),vn(l,c,"info","log"),vn(l,c,"debug","log"),vn(l,c,"trace","log")}function f(p,g){if(!p)throw new Error("missing bindings for child Pino");g=g||{},n&&p.serializers&&(g.serializers=p.serializers);const w=g.serializers;if(n&&w){var E=Object.assign({},s,w),v=t.browser.serialize===!0?Object.keys(E):n;delete p.serializers,hc([p],v,E,this._stdErrSerialize)}function C(_){this._childLevel=(_._childLevel|0)+1,this.error=En(_,p,"error"),this.fatal=En(_,p,"fatal"),this.warn=En(_,p,"warn"),this.info=En(_,p,"info"),this.debug=En(_,p,"debug"),this.trace=En(_,p,"trace"),E&&(this.serializers=E,this._serialize=v),e&&(this._logEvent=kl([].concat(_._logEvent.bindings,p)))}return C.prototype=this,new C(this)}return c}Dr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Dr.stdSerializers=Ib;Dr.stdTimeFunctions=Object.assign({},{nullTime:Cg,epochTime:Ag,unixTime:Pb,isoTime:Db});function vn(t,e,r,s){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?ao:n[r]?n[r]:oo[r]||oo[s]||ao,Sb(t,e,r)}function Sb(t,e,r){!t.transmit&&e[r]===ao||(e[r]=function(s){return function(){const i=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===oo?oo:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&hc(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?s.call(a,Nb(this,r,o,i)):s.apply(a,o),t.transmit){const l=t.transmit.level||e.level,u=Dr.levels.values[l],h=Dr.levels.values[r];if(h<u)return;xb(this,{ts:i,methodLevel:r,methodValue:h,transmitValue:Dr.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function Nb(t,e,r,s){t._serialize&&hc(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let i=n[0];const o={};s&&(o.time=s),o.level=Dr.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),i!==null&&typeof i=="object"){for(;a--&&typeof n[0]=="object";)Object.assign(o,n.shift());i=n.length?Vh(n.shift(),n):void 0}else typeof i=="string"&&(i=Vh(n.shift(),n));return i!==void 0&&(o.msg=i),o}function hc(t,e,r,s){for(const n in t)if(s&&t[n]instanceof Error)t[n]=Dr.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const i in t[n])e&&e.indexOf(i)>-1&&i in r&&(t[n][i]=r[i](t[n][i]))}function En(t,e,r){return function(){const s=new Array(1+arguments.length);s[0]=e;for(var n=1;n<s.length;n++)s[n]=arguments[n-1];return t[r].apply(this,s)}}function xb(t,e,r){const s=e.send,n=e.ts,i=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;hc(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(l){return c.indexOf(l)===-1}),t._logEvent.level.label=i,t._logEvent.level.value=o,s(i,t._logEvent,a),t._logEvent=kl(c)}function kl(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Ob(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Tb(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Cg:Ag}function aa(){return{}}function jc(t){return t}function ao(){}function Cg(){return!1}function Ag(){return Date.now()}function Pb(){return Math.round(Date.now()/1e3)}function Db(){return new Date(Date.now()).toISOString()}function $b(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const zo=Du(jn),Rb={level:"info"},Wo="custom_context",ku=1e3*1024;let kb=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Gh=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new kb(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},Ig=class{constructor(e,r=ku){this.level=e??"error",this.levelValue=jn.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Gh(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===jn.levels.values.error?console.error(e):r===jn.levels.values.warn?console.warn(e):r===jn.levels.values.debug?console.debug(e):r===jn.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Qr({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Gh(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Qr({extraMetadata:e})),new Blob(r,{type:"application/json"})}},Ub=class{constructor(e,r=ku){this.baseChunkLogger=new Ig(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),s=document.createElement("a");s.href=r,s.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}},Bb=class{constructor(e,r=ku){this.baseChunkLogger=new Ig(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Lb=Object.defineProperty,Mb=Object.defineProperties,Fb=Object.getOwnPropertyDescriptors,Yh=Object.getOwnPropertySymbols,jb=Object.prototype.hasOwnProperty,qb=Object.prototype.propertyIsEnumerable,Jh=(t,e,r)=>e in t?Lb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ga=(t,e)=>{for(var r in e||(e={}))jb.call(e,r)&&Jh(t,r,e[r]);if(Yh)for(var r of Yh(e))qb.call(e,r)&&Jh(t,r,e[r]);return t},Ya=(t,e)=>Mb(t,Fb(e));function Ho(t){return Ya(Ga({},t),{level:(t==null?void 0:t.level)||Rb.level})}function zb(t,e=Wo){return t[e]||""}function Wb(t,e,r=Wo){return t[r]=e,t}function kt(t,e=Wo){let r="";return typeof t.bindings>"u"?r=zb(t,e):r=t.bindings().context||"",r}function Hb(t,e,r=Wo){const s=kt(t,r);return s.trim()?`${s}/${e}`:e}function Et(t,e,r=Wo){const s=Hb(t,e,r),n=t.child({context:s});return Wb(n,s,r)}function Kb(t){var e,r;const s=new Ub((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:zo(Ya(Ga({},t.opts),{level:"trace",browser:Ya(Ga({},(r=t.opts)==null?void 0:r.browser),{write:n=>s.write(n)})})),chunkLoggerController:s}}function Vb(t){var e;const r=new Bb((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:zo(Ya(Ga({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function _g(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Kb(t):Vb(t)}var Gb=Object.defineProperty,Yb=(t,e,r)=>e in t?Gb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xh=(t,e,r)=>Yb(t,typeof e!="symbol"?e+"":e,r);let Jb=class extends ln{constructor(e){super(),this.opts=e,Xh(this,"protocol","wc"),Xh(this,"version",2)}};var Xb=Object.defineProperty,Zb=(t,e,r)=>e in t?Xb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qb=(t,e,r)=>Zb(t,e+"",r);let ev=class extends ln{constructor(e,r){super(),this.core=e,this.logger=r,Qb(this,"records",new Map)}},tv=class{constructor(e,r){this.logger=e,this.core=r}},rv=class extends ln{constructor(e,r){super(),this.relayer=e,this.logger=r}},sv=class extends ln{constructor(e){super()}},nv=class{constructor(e,r,s,n){this.core=e,this.logger=r,this.name=s}},iv=class extends ln{constructor(e,r){super(),this.relayer=e,this.logger=r}},ov=class extends ln{constructor(e,r){super(),this.core=e,this.logger=r}},av=class{constructor(e,r,s){this.core=e,this.logger=r,this.store=s}},cv=class{constructor(e,r){this.projectId=e,this.logger=r}},lv=class{constructor(e,r,s){this.core=e,this.logger=r,this.telemetryEnabled=s}};var uv=Object.defineProperty,hv=(t,e,r)=>e in t?uv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zh=(t,e,r)=>hv(t,typeof e!="symbol"?e+"":e,r);let dv=class{constructor(e){this.opts=e,Zh(this,"protocol","wc"),Zh(this,"version",2)}},fv=class{constructor(e){this.client=e}};function pv(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Sg(t,...e){if(!pv(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Qh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function gv(t,e){Sg(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Cn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const qc=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function wv(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Ng(t){return typeof t=="string"&&(t=wv(t)),Sg(t),t}let mv=class{clone(){return this._cloneInto()}};function yv(t){const e=s=>t().update(Ng(s)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function xg(t=32){if(Cn&&typeof Cn.getRandomValues=="function")return Cn.getRandomValues(new Uint8Array(t));if(Cn&&typeof Cn.randomBytes=="function")return Cn.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function bv(t,e,r,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,s);const n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),c=s?4:0,l=s?0:4;t.setUint32(e+c,o,s),t.setUint32(e+l,a,s)}let vv=class extends mv{constructor(e,r,s,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=s,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=qc(this.buffer)}update(e){Qh(this);const{view:r,buffer:s,blockLen:n}=this;e=Ng(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(n-this.pos,i-o);if(a===n){const c=qc(e);for(;n<=i-o;o+=n)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Qh(this),gv(e,this),this.finished=!0;const{buffer:r,view:s,blockLen:n,isLE:i}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(s,0),o=0);for(let h=o;h<n;h++)r[h]=0;bv(s,n-8,BigInt(this.length*8),i),this.process(s,0);const a=qc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:s,length:n,finished:i,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=i,e.destroyed=o,n%r&&e.buffer.set(s),e}};const ca=BigInt(2**32-1),Ul=BigInt(32);function Og(t,e=!1){return e?{h:Number(t&ca),l:Number(t>>Ul&ca)}:{h:Number(t>>Ul&ca)|0,l:Number(t&ca)|0}}function Ev(t,e=!1){let r=new Uint32Array(t.length),s=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:i,l:o}=Og(t[n],e);[r[n],s[n]]=[i,o]}return[r,s]}const Cv=(t,e)=>BigInt(t>>>0)<<Ul|BigInt(e>>>0),Av=(t,e,r)=>t>>>r,Iv=(t,e,r)=>t<<32-r|e>>>r,_v=(t,e,r)=>t>>>r|e<<32-r,Sv=(t,e,r)=>t<<32-r|e>>>r,Nv=(t,e,r)=>t<<64-r|e>>>r-32,xv=(t,e,r)=>t>>>r-32|e<<64-r,Ov=(t,e)=>e,Tv=(t,e)=>t,Pv=(t,e,r)=>t<<r|e>>>32-r,Dv=(t,e,r)=>e<<r|t>>>32-r,$v=(t,e,r)=>e<<r-32|t>>>64-r,Rv=(t,e,r)=>t<<r-32|e>>>64-r;function kv(t,e,r,s){const n=(e>>>0)+(s>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const Uv=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Bv=(t,e,r,s)=>e+r+s+(t/2**32|0)|0,Lv=(t,e,r,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0),Mv=(t,e,r,s,n)=>e+r+s+n+(t/2**32|0)|0,Fv=(t,e,r,s,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0)+(n>>>0),jv=(t,e,r,s,n,i)=>e+r+s+n+i+(t/2**32|0)|0,ue={fromBig:Og,split:Ev,toBig:Cv,shrSH:Av,shrSL:Iv,rotrSH:_v,rotrSL:Sv,rotrBH:Nv,rotrBL:xv,rotr32H:Ov,rotr32L:Tv,rotlSH:Pv,rotlSL:Dv,rotlBH:$v,rotlBL:Rv,add:kv,add3L:Uv,add3H:Bv,add4L:Lv,add4H:Mv,add5H:jv,add5L:Fv},[qv,zv]=ue.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ts=new Uint32Array(80),rs=new Uint32Array(80);let Wv=class extends vv{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:s,Bl:n,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:f,Gl:p,Hh:g,Hl:w}=this;return[e,r,s,n,i,o,a,c,l,u,h,d,f,p,g,w]}set(e,r,s,n,i,o,a,c,l,u,h,d,f,p,g,w){this.Ah=e|0,this.Al=r|0,this.Bh=s|0,this.Bl=n|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=w|0}process(e,r){for(let C=0;C<16;C++,r+=4)ts[C]=e.getUint32(r),rs[C]=e.getUint32(r+=4);for(let C=16;C<80;C++){const _=ts[C-15]|0,S=rs[C-15]|0,k=ue.rotrSH(_,S,1)^ue.rotrSH(_,S,8)^ue.shrSH(_,S,7),L=ue.rotrSL(_,S,1)^ue.rotrSL(_,S,8)^ue.shrSL(_,S,7),R=ts[C-2]|0,A=rs[C-2]|0,D=ue.rotrSH(R,A,19)^ue.rotrBH(R,A,61)^ue.shrSH(R,A,6),T=ue.rotrSL(R,A,19)^ue.rotrBL(R,A,61)^ue.shrSL(R,A,6),O=ue.add4L(L,T,rs[C-7],rs[C-16]),$=ue.add4H(O,k,D,ts[C-7],ts[C-16]);ts[C]=$|0,rs[C]=O|0}let{Ah:s,Al:n,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:f,Fl:p,Gh:g,Gl:w,Hh:E,Hl:v}=this;for(let C=0;C<80;C++){const _=ue.rotrSH(h,d,14)^ue.rotrSH(h,d,18)^ue.rotrBH(h,d,41),S=ue.rotrSL(h,d,14)^ue.rotrSL(h,d,18)^ue.rotrBL(h,d,41),k=h&f^~h&g,L=d&p^~d&w,R=ue.add5L(v,S,L,zv[C],rs[C]),A=ue.add5H(R,E,_,k,qv[C],ts[C]),D=R|0,T=ue.rotrSH(s,n,28)^ue.rotrBH(s,n,34)^ue.rotrBH(s,n,39),O=ue.rotrSL(s,n,28)^ue.rotrBL(s,n,34)^ue.rotrBL(s,n,39),$=s&i^s&a^i&a,j=n&o^n&c^o&c;E=g|0,v=w|0,g=f|0,w=p|0,f=h|0,p=d|0,{h,l:d}=ue.add(l|0,u|0,A|0,D|0),l=a|0,u=c|0,a=i|0,c=o|0,i=s|0,o=n|0;const m=ue.add3L(D,O,j);s=ue.add3H(m,A,T,$),n=m|0}({h:s,l:n}=ue.add(this.Ah|0,this.Al|0,s|0,n|0)),{h:i,l:o}=ue.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ue.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ue.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=ue.add(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=ue.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:w}=ue.add(this.Gh|0,this.Gl|0,g|0,w|0),{h:E,l:v}=ue.add(this.Hh|0,this.Hl|0,E|0,v|0),this.set(s,n,i,o,a,c,l,u,h,d,f,p,g,w,E,v)}roundClean(){ts.fill(0),rs.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Hv=yv(()=>new Wv);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Uu=BigInt(0),Tg=BigInt(1),Kv=BigInt(2);function Bu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Lu(t){if(!Bu(t))throw new Error("Uint8Array expected")}function zc(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Vv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Mu(t){Lu(t);let e="";for(let r=0;r<t.length;r++)e+=Vv[t[r]];return e}function Pg(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Uu:BigInt("0x"+t)}const Lr={_0:48,_9:57,A:65,F:70,a:97,f:102};function ed(t){if(t>=Lr._0&&t<=Lr._9)return t-Lr._0;if(t>=Lr.A&&t<=Lr.F)return t-(Lr.A-10);if(t>=Lr.a&&t<=Lr.f)return t-(Lr.a-10)}function Dg(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(r);for(let n=0,i=0;n<r;n++,i+=2){const o=ed(t.charCodeAt(i)),a=ed(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}s[n]=o*16+a}return s}function Gv(t){return Pg(Mu(t))}function Ba(t){return Lu(t),Pg(Mu(Uint8Array.from(t).reverse()))}function $g(t,e){return Dg(t.toString(16).padStart(e*2,"0"))}function Bl(t,e){return $g(t,e).reverse()}function Mr(t,e,r){let s;if(typeof e=="string")try{s=Dg(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Bu(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=s.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return s}function td(...t){let e=0;for(let s=0;s<t.length;s++){const n=t[s];Lu(n),e+=n.length}const r=new Uint8Array(e);for(let s=0,n=0;s<t.length;s++){const i=t[s];r.set(i,n),n+=i.length}return r}const Wc=t=>typeof t=="bigint"&&Uu<=t;function Yv(t,e,r){return Wc(t)&&Wc(e)&&Wc(r)&&e<=t&&t<r}function yi(t,e,r,s){if(!Yv(e,r,s))throw new Error("expected valid "+t+": "+r+" <= n < "+s+", got "+e)}function Jv(t){let e;for(e=0;t>Uu;t>>=Tg,e+=1);return e}const Xv=t=>(Kv<<BigInt(t-1))-Tg,Zv={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Bu(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Fu(t,e,r={}){const s=(n,i,o)=>{const a=Zv[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+i+", got "+c)};for(const[n,i]of Object.entries(e))s(n,i,!1);for(const[n,i]of Object.entries(r))s(n,i,!0);return t}function rd(t){const e=new WeakMap;return(r,...s)=>{const n=e.get(r);if(n!==void 0)return n;const i=t(r,...s);return e.set(r,i),i}}const et=BigInt(0),qe=BigInt(1),js=BigInt(2),Qv=BigInt(3),Ll=BigInt(4),sd=BigInt(5),nd=BigInt(8);function Ge(t,e){const r=t%e;return r>=et?r:e+r}function e1(t,e,r){if(e<et)throw new Error("invalid exponent, negatives unsupported");if(r<=et)throw new Error("invalid modulus");if(r===qe)return et;let s=qe;for(;e>et;)e&qe&&(s=s*t%r),t=t*t%r,e>>=qe;return s}function br(t,e,r){let s=t;for(;e-- >et;)s*=s,s%=r;return s}function id(t,e){if(t===et)throw new Error("invert: expected non-zero number");if(e<=et)throw new Error("invert: expected positive modulus, got "+e);let r=Ge(t,e),s=e,n=et,i=qe;for(;r!==et;){const o=s/r,a=s%r,c=n-i*o;s=r,r=a,n=i,i=c}if(s!==qe)throw new Error("invert: does not exist");return Ge(n,e)}function t1(t){const e=(t-qe)/js;let r,s,n;for(r=t-qe,s=0;r%js===et;r/=js,s++);for(n=js;n<t&&e1(n,e,t)!==t-qe;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(s===1){const o=(t+qe)/Ll;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const i=(r+qe)/js;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=s,l=o.pow(o.mul(o.ONE,n),r),u=o.pow(a,i),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(h);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(l,qe<<BigInt(c-d-1));l=o.sqr(f),u=o.mul(u,f),h=o.mul(h,l),c=d}return u}}function r1(t){if(t%Ll===Qv){const e=(t+qe)/Ll;return function(r,s){const n=r.pow(s,e);if(!r.eql(r.sqr(n),s))throw new Error("Cannot find square root");return n}}if(t%nd===sd){const e=(t-sd)/nd;return function(r,s){const n=r.mul(s,js),i=r.pow(n,e),o=r.mul(s,i),a=r.mul(r.mul(o,js),i),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),s))throw new Error("Cannot find square root");return c}}return t1(t)}const s1=(t,e)=>(Ge(t,e)&qe)===qe,n1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function i1(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=n1.reduce((s,n)=>(s[n]="function",s),e);return Fu(t,r)}function o1(t,e,r){if(r<et)throw new Error("invalid exponent, negatives unsupported");if(r===et)return t.ONE;if(r===qe)return e;let s=t.ONE,n=e;for(;r>et;)r&qe&&(s=t.mul(s,n)),n=t.sqr(n),r>>=qe;return s}function a1(t,e){const r=new Array(e.length),s=e.reduce((i,o,a)=>t.is0(o)?i:(r[a]=i,t.mul(i,o)),t.ONE),n=t.inv(s);return e.reduceRight((i,o,a)=>t.is0(o)?i:(r[a]=t.mul(i,r[a]),t.mul(i,o)),n),r}function Rg(t,e){const r=e!==void 0?e:t.toString(2).length,s=Math.ceil(r/8);return{nBitLength:r,nByteLength:s}}function kg(t,e,r=!1,s={}){if(t<=et)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:i}=Rg(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:i,MASK:Xv(n),ZERO:et,ONE:qe,create:c=>Ge(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return et<=c&&c<t},is0:c=>c===et,isOdd:c=>(c&qe)===qe,neg:c=>Ge(-c,t),eql:(c,l)=>c===l,sqr:c=>Ge(c*c,t),add:(c,l)=>Ge(c+l,t),sub:(c,l)=>Ge(c-l,t),mul:(c,l)=>Ge(c*l,t),pow:(c,l)=>o1(a,c,l),div:(c,l)=>Ge(c*id(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>id(c,t),sqrt:s.sqrt||(c=>(o||(o=r1(t)),o(a,c))),invertBatch:c=>a1(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?Bl(c,i):$g(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return r?Ba(c):Gv(c)}});return Object.freeze(a)}const od=BigInt(0),la=BigInt(1);function Hc(t,e){const r=e.negate();return t?r:e}function Ug(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Kc(t,e){Ug(t,e);const r=Math.ceil(e/t)+1,s=2**(t-1);return{windows:r,windowSize:s}}function c1(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,s)=>{if(!(r instanceof e))throw new Error("invalid point at index "+s)})}function l1(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,s)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+s)})}const Vc=new WeakMap,Bg=new WeakMap;function Gc(t){return Bg.get(t)||1}function u1(t,e){return{constTimeNegate:Hc,hasPrecomputes(r){return Gc(r)!==1},unsafeLadder(r,s,n=t.ZERO){let i=r;for(;s>od;)s&la&&(n=n.add(i)),i=i.double(),s>>=la;return n},precomputeWindow(r,s){const{windows:n,windowSize:i}=Kc(s,e),o=[];let a=r,c=a;for(let l=0;l<n;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,s,n){const{windows:i,windowSize:o}=Kc(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let d=0;d<i;d++){const f=d*o;let p=Number(n&l);n>>=h,p>o&&(p-=u,n+=la);const g=f,w=f+Math.abs(p)-1,E=d%2!==0,v=p<0;p===0?c=c.add(Hc(E,s[g])):a=a.add(Hc(v,s[w]))}return{p:a,f:c}},wNAFUnsafe(r,s,n,i=t.ZERO){const{windows:o,windowSize:a}=Kc(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(n===od)break;let f=Number(n&c);if(n>>=u,f>a&&(f-=l,n+=la),f===0)continue;let p=s[d+Math.abs(f)-1];f<0&&(p=p.negate()),i=i.add(p)}return i},getPrecomputes(r,s,n){let i=Vc.get(s);return i||(i=this.precomputeWindow(s,r),r!==1&&Vc.set(s,n(i))),i},wNAFCached(r,s,n){const i=Gc(r);return this.wNAF(i,this.getPrecomputes(i,r,n),s)},wNAFCachedUnsafe(r,s,n,i){const o=Gc(r);return o===1?this.unsafeLadder(r,s,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),s,i)},setWindowSize(r,s){Ug(s,e),Bg.set(r,s),Vc.delete(r)}}}function h1(t,e,r,s){if(c1(r,t),l1(s,e),r.length!==s.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,i=Jv(BigInt(r.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),l=Math.floor((e.BITS-1)/o)*o;let u=n;for(let h=l;h>=0;h-=o){c.fill(n);for(let f=0;f<s.length;f++){const p=s[f],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(r[f])}let d=n;for(let f=c.length-1,p=n;f>0;f--)p=p.add(c[f]),d=d.add(p);if(u=u.add(d),h!==0)for(let f=0;f<o;f++)u=u.double()}return u}function d1(t){return i1(t.Fp),Fu(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Rg(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const lr=BigInt(0),Ct=BigInt(1),ua=BigInt(2),f1=BigInt(8),p1={zip215:!0};function g1(t){const e=d1(t);return Fu(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function w1(t){const e=g1(t),{Fp:r,n:s,prehash:n,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=ua<<BigInt(a*8)-Ct,u=r.create,h=kg(e.n,e.nBitLength),d=e.uvRatio||((m,b)=>{try{return{isValid:!0,value:r.sqrt(m*r.inv(b))}}catch{return{isValid:!1,value:lr}}}),f=e.adjustScalarBytes||(m=>m),p=e.domain||((m,b,I)=>{if(zc("phflag",I),b.length||I)throw new Error("Contexts/pre-hash are not supported");return m});function g(m,b){yi("coordinate "+m,b,lr,l)}function w(m){if(!(m instanceof C))throw new Error("ExtendedPoint expected")}const E=rd((m,b)=>{const{ex:I,ey:x,ez:N}=m,P=m.is0();b==null&&(b=P?f1:r.inv(N));const M=u(I*b),G=u(x*b),X=u(N*b);if(P)return{x:lr,y:Ct};if(X!==Ct)throw new Error("invZ was invalid");return{x:M,y:G}}),v=rd(m=>{const{a:b,d:I}=e;if(m.is0())throw new Error("bad point: ZERO");const{ex:x,ey:N,ez:P,et:M}=m,G=u(x*x),X=u(N*N),K=u(P*P),Z=u(K*K),ae=u(G*b),Ie=u(K*u(ae+X)),Ce=u(Z+u(I*u(G*X)));if(Ie!==Ce)throw new Error("bad point: equation left != right (1)");const he=u(x*N),Fe=u(P*M);if(he!==Fe)throw new Error("bad point: equation left != right (2)");return!0});class C{constructor(b,I,x,N){this.ex=b,this.ey=I,this.ez=x,this.et=N,g("x",b),g("y",I),g("z",x),g("t",N),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(b){if(b instanceof C)throw new Error("extended point not allowed");const{x:I,y:x}=b||{};return g("x",I),g("y",x),new C(I,x,Ct,u(I*x))}static normalizeZ(b){const I=r.invertBatch(b.map(x=>x.ez));return b.map((x,N)=>x.toAffine(I[N])).map(C.fromAffine)}static msm(b,I){return h1(C,h,b,I)}_setWindowSize(b){k.setWindowSize(this,b)}assertValidity(){v(this)}equals(b){w(b);const{ex:I,ey:x,ez:N}=this,{ex:P,ey:M,ez:G}=b,X=u(I*G),K=u(P*N),Z=u(x*G),ae=u(M*N);return X===K&&Z===ae}is0(){return this.equals(C.ZERO)}negate(){return new C(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:b}=e,{ex:I,ey:x,ez:N}=this,P=u(I*I),M=u(x*x),G=u(ua*u(N*N)),X=u(b*P),K=I+x,Z=u(u(K*K)-P-M),ae=X+M,Ie=ae-G,Ce=X-M,he=u(Z*Ie),Fe=u(ae*Ce),tt=u(Z*Ce),Ts=u(Ie*ae);return new C(he,Fe,Ts,tt)}add(b){w(b);const{a:I,d:x}=e,{ex:N,ey:P,ez:M,et:G}=this,{ex:X,ey:K,ez:Z,et:ae}=b;if(I===BigInt(-1)){const Ih=u((P-N)*(K+X)),_h=u((P+N)*(K-X)),Rc=u(_h-Ih);if(Rc===lr)return this.double();const Sh=u(M*ua*ae),Nh=u(G*ua*Z),xh=Nh+Sh,Oh=_h+Ih,Th=Nh-Sh,X0=u(xh*Rc),Z0=u(Oh*Th),Q0=u(xh*Th),ey=u(Rc*Oh);return new C(X0,Z0,ey,Q0)}const Ie=u(N*X),Ce=u(P*K),he=u(G*x*ae),Fe=u(M*Z),tt=u((N+P)*(X+K)-Ie-Ce),Ts=Fe-he,na=Fe+he,yn=u(Ce-I*Ie),$c=u(tt*Ts),G0=u(na*yn),Y0=u(tt*yn),J0=u(Ts*na);return new C($c,G0,J0,Y0)}subtract(b){return this.add(b.negate())}wNAF(b){return k.wNAFCached(this,b,C.normalizeZ)}multiply(b){const I=b;yi("scalar",I,Ct,s);const{p:x,f:N}=this.wNAF(I);return C.normalizeZ([x,N])[0]}multiplyUnsafe(b,I=C.ZERO){const x=b;return yi("scalar",x,lr,s),x===lr?S:this.is0()||x===Ct?this:k.wNAFCachedUnsafe(this,x,C.normalizeZ,I)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return k.unsafeLadder(this,s).is0()}toAffine(b){return E(this,b)}clearCofactor(){const{h:b}=e;return b===Ct?this:this.multiplyUnsafe(b)}static fromHex(b,I=!1){const{d:x,a:N}=e,P=r.BYTES;b=Mr("pointHex",b,P),zc("zip215",I);const M=b.slice(),G=b[P-1];M[P-1]=G&-129;const X=Ba(M),K=I?l:r.ORDER;yi("pointHex.y",X,lr,K);const Z=u(X*X),ae=u(Z-Ct),Ie=u(x*Z-N);let{isValid:Ce,value:he}=d(ae,Ie);if(!Ce)throw new Error("Point.fromHex: invalid y coordinate");const Fe=(he&Ct)===Ct,tt=(G&128)!==0;if(!I&&he===lr&&tt)throw new Error("Point.fromHex: x=0 and x_0=1");return tt!==Fe&&(he=u(-he)),C.fromAffine({x:he,y:X})}static fromPrivateKey(b){return A(b).point}toRawBytes(){const{x:b,y:I}=this.toAffine(),x=Bl(I,r.BYTES);return x[x.length-1]|=b&Ct?128:0,x}toHex(){return Mu(this.toRawBytes())}}C.BASE=new C(e.Gx,e.Gy,Ct,u(e.Gx*e.Gy)),C.ZERO=new C(lr,Ct,Ct,lr);const{BASE:_,ZERO:S}=C,k=u1(C,a*8);function L(m){return Ge(m,s)}function R(m){return L(Ba(m))}function A(m){const b=r.BYTES;m=Mr("private key",m,b);const I=Mr("hashed private key",i(m),2*b),x=f(I.slice(0,b)),N=I.slice(b,2*b),P=R(x),M=_.multiply(P),G=M.toRawBytes();return{head:x,prefix:N,scalar:P,point:M,pointBytes:G}}function D(m){return A(m).pointBytes}function T(m=new Uint8Array,...b){const I=td(...b);return R(i(p(I,Mr("context",m),!!n)))}function O(m,b,I={}){m=Mr("message",m),n&&(m=n(m));const{prefix:x,scalar:N,pointBytes:P}=A(b),M=T(I.context,x,m),G=_.multiply(M).toRawBytes(),X=T(I.context,G,P,m),K=L(M+X*N);yi("signature.s",K,lr,s);const Z=td(G,Bl(K,r.BYTES));return Mr("result",Z,r.BYTES*2)}const $=p1;function j(m,b,I,x=$){const{context:N,zip215:P}=x,M=r.BYTES;m=Mr("signature",m,2*M),b=Mr("message",b),I=Mr("publicKey",I,M),P!==void 0&&zc("zip215",P),n&&(b=n(b));const G=Ba(m.slice(M,2*M));let X,K,Z;try{X=C.fromHex(I,P),K=C.fromHex(m.slice(0,M),P),Z=_.multiplyUnsafe(G)}catch{return!1}if(!P&&X.isSmallOrder())return!1;const ae=T(N,K.toRawBytes(),X.toRawBytes(),b);return K.add(X.multiplyUnsafe(ae)).subtract(Z).clearCofactor().equals(C.ZERO)}return _._setWindowSize(8),{CURVE:e,getPublicKey:D,sign:O,verify:j,ExtendedPoint:C,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(m=8,b=C.BASE){return b._setWindowSize(m),b.multiply(BigInt(3)),b}}}}BigInt(0),BigInt(1);const ju=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ad=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const m1=BigInt(1),cd=BigInt(2);BigInt(3);const y1=BigInt(5),b1=BigInt(8);function v1(t){const e=BigInt(10),r=BigInt(20),s=BigInt(40),n=BigInt(80),i=ju,o=t*t%i*t%i,a=br(o,cd,i)*o%i,c=br(a,m1,i)*t%i,l=br(c,y1,i)*c%i,u=br(l,e,i)*l%i,h=br(u,r,i)*u%i,d=br(h,s,i)*h%i,f=br(d,n,i)*d%i,p=br(f,n,i)*d%i,g=br(p,e,i)*l%i;return{pow_p_5_8:br(g,cd,i)*t%i,b2:o}}function E1(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function C1(t,e){const r=ju,s=Ge(e*e*e,r),n=Ge(s*s*e,r),i=v1(t*n).pow_p_5_8;let o=Ge(t*s*i,r);const a=Ge(e*o*o,r),c=o,l=Ge(o*ad,r),u=a===t,h=a===Ge(-t,r),d=a===Ge(-t*ad,r);return u&&(o=c),(h||d)&&(o=l),s1(o,r)&&(o=Ge(-o,r)),{isValid:u||h,value:o}}const A1=kg(ju,void 0,!0),I1={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:A1,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:b1,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Hv,randomBytes:xg,adjustScalarBytes:E1,uvRatio:C1},Lg=w1(I1),_1="EdDSA",S1="JWT",Ja=".",dc="base64url",Mg="utf8",Fg="utf8",N1=":",x1="did",O1="key",ld="base58btc",T1="z",P1="K36",D1=32;function qu(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function jg(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?qu(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function qg(t,e){e||(e=t.reduce((n,i)=>n+i.length,0));const r=jg(e);let s=0;for(const n of t)r.set(n,s),s+=n.length;return qu(r)}function $1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,E=0,v=p.length;E!==v&&p[E]===0;)E++,g++;for(var C=(v-E)*u+1>>>0,_=new Uint8Array(C);E!==v;){for(var S=p[E],k=0,L=C-1;(S!==0||k<w)&&L!==-1;L--,k++)S+=256*_[L]>>>0,_[L]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=k,E++}for(var R=C-w;R!==C&&_[R]===0;)R++;for(var A=c.repeat(g);R<C;++R)A+=t.charAt(_[R]);return A}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,E=0;p[g]===c;)w++,g++;for(var v=(p.length-g)*l+1>>>0,C=new Uint8Array(v);p[g];){var _=r[p.charCodeAt(g)];if(_===255)return;for(var S=0,k=v-1;(_!==0||S<E)&&k!==-1;k--,S++)_+=a*C[k]>>>0,C[k]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");E=S,g++}if(p[g]!==" "){for(var L=v-E;L!==v&&C[L]===0;)L++;for(var R=new Uint8Array(w+(v-L)),A=w;L!==v;)R[A++]=C[L++];return R}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var R1=$1,k1=R1;const zg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},U1=t=>new TextEncoder().encode(t),B1=t=>new TextDecoder().decode(t);let L1=class{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},M1=class{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wg(this,e)}},F1=class{constructor(e){this.decoders=e}or(e){return Wg(this,e)}decode(e){const r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Wg=(t,e)=>new F1({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let j1=class{constructor(e,r,s,n){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=n,this.encoder=new L1(e,r,s),this.decoder=new M1(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const fc=({name:t,prefix:e,encode:r,decode:s})=>new j1(t,e,r,s),Ko=({prefix:t,name:e,alphabet:r})=>{const{encode:s,decode:n}=k1(r,e);return fc({prefix:t,name:e,encode:s,decode:i=>zg(n(i))})},q1=(t,e,r,s)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},z1=(t,e,r)=>{const s=e[e.length-1]==="=",n=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[n&a>>o];if(o&&(i+=e[n&a<<r-o]),s)for(;i.length*r&7;)i+="=";return i},ct=({name:t,prefix:e,bitsPerChar:r,alphabet:s})=>fc({prefix:e,name:t,encode(n){return z1(n,s,r)},decode(n){return q1(n,s,r,t)}}),W1=fc({prefix:"\0",name:"identity",encode:t=>B1(t),decode:t=>U1(t)});var H1=Object.freeze({__proto__:null,identity:W1});const K1=ct({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var V1=Object.freeze({__proto__:null,base2:K1});const G1=ct({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Y1=Object.freeze({__proto__:null,base8:G1});const J1=Ko({prefix:"9",name:"base10",alphabet:"0123456789"});var X1=Object.freeze({__proto__:null,base10:J1});const Z1=ct({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Q1=ct({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var eE=Object.freeze({__proto__:null,base16:Z1,base16upper:Q1});const tE=ct({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rE=ct({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sE=ct({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),nE=ct({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),iE=ct({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oE=ct({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),aE=ct({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),cE=ct({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lE=ct({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var uE=Object.freeze({__proto__:null,base32:tE,base32upper:rE,base32pad:sE,base32padupper:nE,base32hex:iE,base32hexupper:oE,base32hexpad:aE,base32hexpadupper:cE,base32z:lE});const hE=Ko({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),dE=Ko({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var fE=Object.freeze({__proto__:null,base36:hE,base36upper:dE});const pE=Ko({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gE=Ko({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var wE=Object.freeze({__proto__:null,base58btc:pE,base58flickr:gE});const mE=ct({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yE=ct({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bE=ct({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vE=ct({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var EE=Object.freeze({__proto__:null,base64:mE,base64pad:yE,base64url:bE,base64urlpad:vE});const Hg=Array.from(""),CE=Hg.reduce((t,e,r)=>(t[r]=e,t),[]),AE=Hg.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function IE(t){return t.reduce((e,r)=>(e+=CE[r],e),"")}function _E(t){const e=[];for(const r of t){const s=AE[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}const SE=fc({prefix:"",name:"base256emoji",encode:IE,decode:_E});var NE=Object.freeze({__proto__:null,base256emoji:SE}),xE=Kg,ud=128,OE=-128,TE=Math.pow(2,31);function Kg(t,e,r){e=e||[],r=r||0;for(var s=r;t>=TE;)e[r++]=t&255|ud,t/=128;for(;t&OE;)e[r++]=t&255|ud,t>>>=7;return e[r]=t|0,Kg.bytes=r-s+1,e}var PE=Ml,DE=128,hd=127;function Ml(t,s){var r=0,s=s||0,n=0,i=s,o,a=t.length;do{if(i>=a)throw Ml.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=n<28?(o&hd)<<n:(o&hd)*Math.pow(2,n),n+=7}while(o>=DE);return Ml.bytes=i-s,r}var $E=Math.pow(2,7),RE=Math.pow(2,14),kE=Math.pow(2,21),UE=Math.pow(2,28),BE=Math.pow(2,35),LE=Math.pow(2,42),ME=Math.pow(2,49),FE=Math.pow(2,56),jE=Math.pow(2,63),qE=function(t){return t<$E?1:t<RE?2:t<kE?3:t<UE?4:t<BE?5:t<LE?6:t<ME?7:t<FE?8:t<jE?9:10},zE={encode:xE,decode:PE,encodingLength:qE},Vg=zE;const dd=(t,e,r=0)=>(Vg.encode(t,e,r),e),fd=t=>Vg.encodingLength(t),Fl=(t,e)=>{const r=e.byteLength,s=fd(t),n=s+fd(r),i=new Uint8Array(n+r);return dd(t,i,0),dd(r,i,s),i.set(e,n),new WE(t,r,e,i)};let WE=class{constructor(e,r,s,n){this.code=e,this.size=r,this.digest=s,this.bytes=n}};const Gg=({name:t,code:e,encode:r})=>new HE(t,e,r);let HE=class{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Fl(this.code,r):r.then(s=>Fl(this.code,s))}else throw Error("Unknown type, must be binary type")}};const Yg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),KE=Gg({name:"sha2-256",code:18,encode:Yg("SHA-256")}),VE=Gg({name:"sha2-512",code:19,encode:Yg("SHA-512")});var GE=Object.freeze({__proto__:null,sha256:KE,sha512:VE});const Jg=0,YE="identity",Xg=zg,JE=t=>Fl(Jg,Xg(t)),XE={code:Jg,name:YE,encode:Xg,digest:JE};var ZE=Object.freeze({__proto__:null,identity:XE});new TextEncoder,new TextDecoder;const pd={...H1,...V1,...Y1,...X1,...eE,...uE,...fE,...wE,...EE,...NE};({...GE,...ZE});function Zg(t,e,r,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:s}}}const gd=Zg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Yc=Zg("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=jg(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Qg={utf8:gd,"utf-8":gd,hex:pd.base16,latin1:Yc,ascii:Yc,binary:Yc,...pd};function pc(t,e="utf8"){const r=Qg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function ai(t,e="utf8"){const r=Qg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?qu(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function wd(t){return tn(pc(ai(t,dc),Mg))}function Xa(t){return pc(ai(Qr(t),Mg),dc)}function ew(t){const e=ai(P1,ld),r=T1+pc(qg([e,t]),ld);return[x1,O1,r].join(N1)}function QE(t){return pc(t,dc)}function eC(t){return ai(t,dc)}function tC(t){return ai([Xa(t.header),Xa(t.payload)].join(Ja),Fg)}function rC(t){return[Xa(t.header),Xa(t.payload),QE(t.signature)].join(Ja)}function jl(t){const e=t.split(Ja),r=wd(e[0]),s=wd(e[1]),n=eC(e[2]),i=ai(e.slice(0,2).join(Ja),Fg);return{header:r,payload:s,signature:n,data:i}}function md(t=xg(D1)){const e=Lg.getPublicKey(t);return{secretKey:qg([t,e]),publicKey:e}}async function sC(t,e,r,s,n=W.fromMiliseconds(Date.now())){const i={alg:_1,typ:S1},o=ew(s.publicKey),a=n+r,c={iss:o,sub:t,aud:e,iat:n,exp:a},l=tC({header:i,payload:c}),u=Lg.sign(l,s.secretKey.slice(0,32));return rC({header:i,payload:c,signature:u})}var yd=function(t,e,r){if(r||arguments.length===2)for(var s=0,n=e.length,i;s<n;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},nC=function(){function t(e,r,s){this.name=e,this.version=r,this.os=s,this.type="browser"}return t}(),iC=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),oC=function(){function t(e,r,s,n){this.name=e,this.version=r,this.os=s,this.bot=n,this.type="bot-device"}return t}(),aC=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),cC=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),lC=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,uC=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,bd=3,hC=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",lC]],vd=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function dC(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new cC:typeof navigator<"u"?pC(navigator.userAgent):wC()}function fC(t){return t!==""&&hC.reduce(function(e,r){var s=r[0],n=r[1];if(e)return e;var i=n.exec(t);return!!i&&[s,i]},!1)}function pC(t){var e=fC(t);if(!e)return null;var r=e[0],s=e[1];if(r==="searchbot")return new aC;var n=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);n?n.length<bd&&(n=yd(yd([],n,!0),mC(bd-n.length),!0)):n=[];var i=n.join("."),o=gC(t),a=uC.exec(t);return a&&a[1]?new oC(r,i,o,a[1]):new nC(r,i,o)}function gC(t){for(var e=0,r=vd.length;e<r;e++){var s=vd[e],n=s[0],i=s[1],o=i.exec(t);if(o)return n}return null}function wC(){var t=typeof process<"u"&&process.version;return t?new iC(process.version.slice(1)):null}function mC(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.getLocalStorage=Re.getLocalStorageOrThrow=Re.getCrypto=Re.getCryptoOrThrow=tw=Re.getLocation=Re.getLocationOrThrow=zu=Re.getNavigator=Re.getNavigatorOrThrow=rn=Re.getDocument=Re.getDocumentOrThrow=Re.getFromWindowOrThrow=Re.getFromWindow=void 0;function dn(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Re.getFromWindow=dn;function ci(t){const e=dn(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Re.getFromWindowOrThrow=ci;function yC(){return ci("document")}Re.getDocumentOrThrow=yC;function bC(){return dn("document")}var rn=Re.getDocument=bC;function vC(){return ci("navigator")}Re.getNavigatorOrThrow=vC;function EC(){return dn("navigator")}var zu=Re.getNavigator=EC;function CC(){return ci("location")}Re.getLocationOrThrow=CC;function AC(){return dn("location")}var tw=Re.getLocation=AC;function IC(){return ci("crypto")}Re.getCryptoOrThrow=IC;function _C(){return dn("crypto")}Re.getCrypto=_C;function SC(){return ci("localStorage")}Re.getLocalStorageOrThrow=SC;function NC(){return dn("localStorage")}Re.getLocalStorage=NC;var Wu={};Object.defineProperty(Wu,"__esModule",{value:!0});var rw=Wu.getWindowMetadata=void 0;const Ed=Re;function xC(){let t,e;try{t=Ed.getDocumentOrThrow(),e=Ed.getLocationOrThrow()}catch{return null}function r(){const h=t.getElementsByTagName("link"),d=[];for(let f=0;f<h.length;f++){const p=h[f],g=p.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){const w=p.getAttribute("href");if(w)if(w.toLowerCase().indexOf("https:")===-1&&w.toLowerCase().indexOf("http:")===-1&&w.indexOf("//")!==0){let E=e.protocol+"//"+e.host;if(w.indexOf("/")===0)E+=w;else{const v=e.pathname.split("/");v.pop();const C=v.join("/");E+=C+"/"+w}d.push(E)}else if(w.indexOf("//")===0){const E=e.protocol+w;d.push(E)}else d.push(w)}}return d}function s(...h){const d=t.getElementsByTagName("meta");for(let f=0;f<d.length;f++){const p=d[f],g=["itemprop","property","name"].map(w=>p.getAttribute(w)).filter(w=>w?h.includes(w):!1);if(g.length&&g){const w=p.getAttribute("content");if(w)return w}}return""}function n(){let h=s("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function i(){return s("description","og:description","twitter:description","keywords")}const o=n(),a=i(),c=e.origin,l=r();return{description:a,url:c,icons:l,name:o}}rw=Wu.getWindowMetadata=xC;function co(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function ql(t){return co(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const sw="2.31.0";let bi={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${sw}`},gc=class zl extends Error{constructor(e,r={}){var a;const s=(()=>{var c;return r.cause instanceof zl?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),n=r.cause instanceof zl&&r.cause.docsPath||r.docsPath,i=(a=bi.getDocsUrl)==null?void 0:a.call(bi,{...r,docsPath:n}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...s?[`Details: ${s}`]:[],...bi.version?[`Version: ${bi.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=n,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=sw}walk(e){return nw(this,e)}};function nw(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?nw(t.cause,e):e?null:t}let iw=class extends gc{constructor({size:e,targetSize:r,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}};function li(t,{dir:e,size:r=32}={}){return typeof t=="string"?OC(t,{dir:e,size:r}):TC(t,{dir:e,size:r})}function OC(t,{dir:e,size:r=32}={}){if(r===null)return t;const s=t.replace("0x","");if(s.length>r*2)throw new iw({size:Math.ceil(s.length/2),targetSize:r,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function TC(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new iw({size:t.length,targetSize:r,type:"bytes"});const s=new Uint8Array(r);for(let n=0;n<r;n++){const i=e==="right";s[i?n:r-n-1]=t[i?n:t.length-n-1]}return s}let PC=class extends gc{constructor({max:e,min:r,signed:s,size:n,value:i}){super(`Number "${i}" is not in safe ${n?`${n*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}},DC=class extends gc{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}};function ui(t,{size:e}){if(ql(t)>e)throw new DC({givenSize:ql(t),maxSize:e})}function Wl(t,e={}){const{signed:r}=e;e.size&&ui(t,{size:e.size});const s=BigInt(t);if(!r)return s;const n=(t.length-2)/2,i=(1n<<BigInt(n)*8n-1n)-1n;return s<=i?s:s-BigInt(`0x${"f".padStart(n*2,"f")}`)-1n}function $C(t,e={}){return Number(Wl(t,e))}const RC=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Hl(t,e={}){return typeof t=="number"||typeof t=="bigint"?aw(t,e):typeof t=="string"?BC(t,e):typeof t=="boolean"?kC(t,e):ow(t,e)}function kC(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(ui(r,{size:e.size}),li(r,{size:e.size})):r}function ow(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=RC[t[n]];const s=`0x${r}`;return typeof e.size=="number"?(ui(s,{size:e.size}),li(s,{dir:"right",size:e.size})):s}function aw(t,e={}){const{signed:r,size:s}=e,n=BigInt(t);let i;s?r?i=(1n<<BigInt(s)*8n-1n)-1n:i=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&r?-i-1n:0;if(i&&n>i||n<o){const c=typeof t=="bigint"?"n":"";throw new PC({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:r,size:s,value:`${t}${c}`})}const a=`0x${(r&&n<0?(1n<<BigInt(s*8))+BigInt(n):n).toString(16)}`;return s?li(a,{size:s}):a}const UC=new TextEncoder;function BC(t,e={}){const r=UC.encode(t);return ow(r,e)}const LC=new TextEncoder;function MC(t,e={}){return typeof t=="number"||typeof t=="bigint"?jC(t,e):typeof t=="boolean"?FC(t,e):co(t)?cw(t,e):lw(t,e)}function FC(t,e={}){const r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(ui(r,{size:e.size}),li(r,{size:e.size})):r}const Fr={zero:48,nine:57,A:65,F:70,a:97,f:102};function Cd(t){if(t>=Fr.zero&&t<=Fr.nine)return t-Fr.zero;if(t>=Fr.A&&t<=Fr.F)return t-(Fr.A-10);if(t>=Fr.a&&t<=Fr.f)return t-(Fr.a-10)}function cw(t,e={}){let r=t;e.size&&(ui(r,{size:e.size}),r=li(r,{dir:"right",size:e.size}));let s=r.slice(2);s.length%2&&(s=`0${s}`);const n=s.length/2,i=new Uint8Array(n);for(let o=0,a=0;o<n;o++){const c=Cd(s.charCodeAt(a++)),l=Cd(s.charCodeAt(a++));if(c===void 0||l===void 0)throw new gc(`Invalid byte sequence ("${s[a-2]}${s[a-1]}" in "${s}").`);i[o]=c*16+l}return i}function jC(t,e){const r=aw(t,e);return cw(r)}function lw(t,e={}){const r=LC.encode(t);return typeof e.size=="number"?(ui(r,{size:e.size}),li(r,{dir:"right",size:e.size})):r}const ha=BigInt(2**32-1),Ad=BigInt(32);function qC(t,e=!1){return e?{h:Number(t&ha),l:Number(t>>Ad&ha)}:{h:Number(t>>Ad&ha)|0,l:Number(t&ha)|0}}function zC(t,e=!1){const r=t.length;let s=new Uint32Array(r),n=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=qC(t[i],e);[s[i],n[i]]=[o,a]}return[s,n]}const WC=(t,e,r)=>t<<r|e>>>32-r,HC=(t,e,r)=>e<<r|t>>>32-r,KC=(t,e,r)=>e<<r-32|t>>>64-r,VC=(t,e,r)=>t<<r-32|e>>>64-r,An=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function GC(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Za(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function lo(t,...e){if(!GC(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function FR(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Za(t.outputLen),Za(t.blockLen)}function Id(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function YC(t,e){lo(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function JC(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function uw(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function jR(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function qR(t,e){return t<<32-e|t>>>e}const XC=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ZC(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function QC(t){for(let e=0;e<t.length;e++)t[e]=ZC(t[e]);return t}const _d=XC?t=>t:QC;function e2(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function hw(t){return typeof t=="string"&&(t=e2(t)),lo(t),t}function zR(...t){let e=0;for(let s=0;s<t.length;s++){const n=t[s];lo(n),e+=n.length}const r=new Uint8Array(e);for(let s=0,n=0;s<t.length;s++){const i=t[s];r.set(i,n),n+=i.length}return r}class t2{}function r2(t){const e=s=>t().update(hw(s)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function WR(t=32){if(An&&typeof An.getRandomValues=="function")return An.getRandomValues(new Uint8Array(t));if(An&&typeof An.randomBytes=="function")return Uint8Array.from(An.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const s2=BigInt(0),vi=BigInt(1),n2=BigInt(2),i2=BigInt(7),o2=BigInt(256),a2=BigInt(113),dw=[],fw=[],pw=[];for(let t=0,e=vi,r=1,s=0;t<24;t++){[r,s]=[s,(2*r+3*s)%5],dw.push(2*(5*s+r)),fw.push((t+1)*(t+2)/2%64);let n=s2;for(let i=0;i<7;i++)e=(e<<vi^(e>>i2)*a2)%o2,e&n2&&(n^=vi<<(vi<<BigInt(i))-vi);pw.push(n)}const gw=zC(pw,!0),c2=gw[0],l2=gw[1],Sd=(t,e,r)=>r>32?KC(t,e,r):WC(t,e,r),Nd=(t,e,r)=>r>32?VC(t,e,r):HC(t,e,r);function u2(t,e=24){const r=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=Sd(l,u,1)^r[a],d=Nd(l,u,1)^r[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let n=t[2],i=t[3];for(let o=0;o<24;o++){const a=fw[o],c=Sd(n,i,a),l=Nd(n,i,a),u=dw[o];n=t[u],i=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=c2[s],t[1]^=l2[s]}uw(r)}class Hu extends t2{constructor(e,r,s,n=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=s,this.enableXOF=n,this.rounds=i,Za(s),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=JC(this.state)}clone(){return this._cloneInto()}keccak(){_d(this.state32),u2(this.state32,this.rounds),_d(this.state32),this.posOut=0,this.pos=0}update(e){Id(this),e=hw(e),lo(e);const{blockLen:r,state:s}=this,n=e.length;for(let i=0;i<n;){const o=Math.min(r-this.pos,n-i);for(let a=0;a<o;a++)s[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:s,blockLen:n}=this;e[s]^=r,r&128&&s===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Id(this,!1),lo(e),this.finish();const r=this.state,{blockLen:s}=this;for(let n=0,i=e.length;n<i;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,i-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Za(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(YC(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,uw(this.state)}_cloneInto(e){const{blockLen:r,suffix:s,outputLen:n,rounds:i,enableXOF:o}=this;return e||(e=new Hu(r,s,n,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=s,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}const h2=(t,e,r)=>r2(()=>new Hu(e,t,r)),d2=h2(1,136,256/8);function ww(t,e){const r=e||"hex",s=d2(co(t,{strict:!1})?MC(t):t);return r==="bytes"?s:Hl(s)}let f2=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}};const Jc=new f2(8192);function p2(t,e){if(Jc.has(`${t}.${e}`))return Jc.get(`${t}.${e}`);const r=t.substring(2).toLowerCase(),s=ww(lw(r),"bytes"),n=r.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&n[o]&&(n[o]=n[o].toUpperCase()),(s[o>>1]&15)>=8&&n[o+1]&&(n[o+1]=n[o+1].toUpperCase());const i=`0x${n.join("")}`;return Jc.set(`${t}.${e}`,i),i}function g2(t){const e=ww(`0x${t.substring(4)}`).substring(26);return p2(`0x${e}`)}async function w2({hash:t,signature:e}){const r=co(t)?t:Hl(t),{secp256k1:s}=await Tl(async()=>{const{secp256k1:o}=await import("./secp256k1-CjZXOTF7.js");return{secp256k1:o}},__vite__mapDeps([0,1,2]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:d}=e,f=Number(d??h),p=xd(f);return new s.Signature(Wl(l),Wl(u)).addRecoveryBit(p)}const o=co(e)?e:Hl(e);if(ql(o)!==65)throw new Error("invalid signature length");const a=$C(`0x${o.slice(130)}`),c=xd(a);return s.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function xd(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function m2({hash:t,signature:e}){return g2(await w2({hash:t,signature:e}))}function y2(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const r=t.length,s=t.charAt(0),n=Math.log(r)/Math.log(256),i=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,d=0;const f=l.length;for(;d!==f&&l[d]===0;)d++,u++;const p=(f-d)*i+1>>>0,g=new Uint8Array(p);for(;d!==f;){let v=l[d],C=0;for(let _=p-1;(v!==0||C<h)&&_!==-1;_--,C++)v+=256*g[_]>>>0,g[_]=v%r>>>0,v=v/r>>>0;if(v!==0)throw new Error("Non-zero carry");h=C,d++}let w=p-h;for(;w!==p&&g[w]===0;)w++;let E=s.repeat(u);for(;w<p;++w)E+=t.charAt(g[w]);return E}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,d=0;for(;l[u]===s;)h++,u++;const f=(l.length-u)*n+1>>>0,p=new Uint8Array(f);for(;u<l.length;){const v=l.charCodeAt(u);if(v>255)return;let C=e[v];if(C===255)return;let _=0;for(let S=f-1;(C!==0||_<d)&&S!==-1;S--,_++)C+=r*p[S]>>>0,p[S]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");d=_,u++}let g=f-d;for(;g!==f&&p[g]===0;)g++;const w=new Uint8Array(h+(f-g));let E=h;for(;g!==f;)w[E++]=p[g++];return w}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var b2="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const hi=y2(b2);function v2(t){const e=t.length;let r=0,s=0;for(;s<e;){let n=t.charCodeAt(s++);if(n&4294967168)if(!(n&4294965248))r+=2;else{if(n>=55296&&n<=56319&&s<e){const i=t.charCodeAt(s);(i&64512)===56320&&(++s,n=((n&1023)<<10)+(i&1023)+65536)}n&4294901760?r+=4:r+=3}else{r++;continue}}return r}function E2(t,e,r){const s=t.length;let n=r,i=0;for(;i<s;){let o=t.charCodeAt(i++);if(o&4294967168)if(!(o&4294965248))e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<s){const a=t.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128):(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128)}else{e[n++]=o;continue}e[n++]=o&63|128}}const C2=new TextEncoder,A2=50;function I2(t,e,r){C2.encodeInto(t,e.subarray(r))}function _2(t,e,r){t.length>A2?I2(t,e,r):E2(t,e,r)}const S2=4096;function mw(t,e,r){let s=e;const n=s+r,i=[];let o="";for(;s<n;){const a=t[s++];if(!(a&128))i.push(a);else if((a&224)===192){const c=t[s++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){const c=t[s++]&63,l=t[s++]&63;i.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[s++]&63,l=t[s++]&63,u=t[s++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=S2&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}const N2=new TextDecoder,x2=200;function O2(t,e,r){const s=t.subarray(e,e+r);return N2.decode(s)}function T2(t,e,r){return r>x2?O2(t,e,r):mw(t,e,r)}class da{constructor(e,r){this.type=e,this.data=r}}class qt extends Error{constructor(e){super(e);const r=Object.create(qt.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:qt.name})}}const Ei=4294967295;function P2(t,e,r){const s=r/4294967296,n=r;t.setUint32(e,s),t.setUint32(e+4,n)}function yw(t,e,r){const s=Math.floor(r/4294967296),n=r;t.setUint32(e,s),t.setUint32(e+4,n)}function bw(t,e){const r=t.getInt32(e),s=t.getUint32(e+4);return r*4294967296+s}function D2(t,e){const r=t.getUint32(e),s=t.getUint32(e+4);return r*4294967296+s}const $2=-1,R2=4294967296-1,k2=17179869184-1;function U2({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=k2)if(e===0&&t<=R2){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,s=t&4294967295,n=new Uint8Array(8),i=new DataView(n.buffer);return i.setUint32(0,e<<2|r&3),i.setUint32(4,s),n}else{const r=new Uint8Array(12),s=new DataView(r.buffer);return s.setUint32(0,e),yw(s,4,t),r}}function B2(t){const e=t.getTime(),r=Math.floor(e/1e3),s=(e-r*1e3)*1e6,n=Math.floor(s/1e9);return{sec:r+n,nsec:s-n*1e9}}function L2(t){if(t instanceof Date){const e=B2(t);return U2(e)}else return null}function M2(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),s=e.getUint32(4),n=(r&3)*4294967296+s,i=r>>>2;return{sec:n,nsec:i}}case 12:{const r=bw(e,4),s=e.getUint32(0);return{sec:r,nsec:s}}default:throw new qt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function F2(t){const e=M2(t);return new Date(e.sec*1e3+e.nsec/1e6)}const j2={type:$2,encode:L2,decode:F2};class Qa{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(j2)}register({type:e,encode:r,decode:s}){if(e>=0)this.encoders[e]=r,this.decoders[e]=s;else{const n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=s}}tryToEncode(e,r){for(let s=0;s<this.builtInEncoders.length;s++){const n=this.builtInEncoders[s];if(n!=null){const i=n(e,r);if(i!=null){const o=-1-s;return new da(o,i)}}}for(let s=0;s<this.encoders.length;s++){const n=this.encoders[s];if(n!=null){const i=n(e,r);if(i!=null){const o=s;return new da(o,i)}}}return e instanceof da?e:null}decode(e,r,s){const n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,s):new da(r,e)}}Qa.defaultCodec=new Qa;function q2(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Kl(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):q2(t)?new Uint8Array(t):Uint8Array.from(t)}const z2=100,W2=2048;let H2=class vw{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Qa.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??z2,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??W2,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new vw({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),s=new Uint8Array(r),n=new DataView(r);s.set(this.bytes),this.view=n,this.bytes=s}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const s=v2(e);this.ensureBufferSizeToWrite(5+s),this.writeStringHeader(s),_2(e,this.bytes,this.pos),this.pos+=s}encodeObject(e,r){const s=this.extensionCodec.tryToEncode(e,this.context);if(s!=null)this.encodeExtension(s);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const s=Kl(e);this.writeU8a(s)}encodeArray(e,r){const s=e.length;if(s<16)this.writeU8(144+s);else if(s<65536)this.writeU8(220),this.writeU16(s);else if(s<4294967296)this.writeU8(221),this.writeU32(s);else throw new Error(`Too large array: ${s}`);for(const n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let s=0;for(const n of r)e[n]!==void 0&&s++;return s}encodeMap(e,r){const s=Object.keys(e);this.sortKeys&&s.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,s):s.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(const i of s){const o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const s=e.data(this.pos+6),n=s.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(s);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),P2(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),yw(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function K2(t,e){return new H2(e).encodeSharedRef(t)}function Xc(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const V2=16,G2=16;class Y2{constructor(e=V2,r=G2){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let s=0;s<this.maxKeyLength;s++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,s){const n=this.caches[s-1];e:for(const i of n){const o=i.bytes;for(let a=0;a<s;a++)if(o[a]!==e[r+a])continue e;return i.str}return null}store(e,r){const s=this.caches[e.length-1],n={bytes:e,str:r};s.length>=this.maxLengthPerKey?s[Math.random()*s.length|0]=n:s.push(n)}decode(e,r,s){const n=this.find(e,r,s);if(n!=null)return this.hit++,n;this.miss++;const i=mw(e,r,s),o=Uint8Array.prototype.slice.call(e,r,r+s);return this.store(o,i),i}}const Vl="array",Wi="map_key",Ew="map_value",J2=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new qt("The type of key must be string or number but "+typeof t)};class X2{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=Vl,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Wi,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Vl){const s=e;s.size=0,s.array=void 0,s.position=0,s.type=void 0}if(e.type===Wi||e.type===Ew){const s=e;s.size=0,s.map=void 0,s.readCount=0,s.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Ci=-1,Ku=new DataView(new ArrayBuffer(0)),Z2=new Uint8Array(Ku.buffer);try{Ku.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Od=new RangeError("Insufficient data"),Q2=new Y2;let eA=class Cw{constructor(e){this.totalPos=0,this.pos=0,this.view=Ku,this.bytes=Z2,this.headByte=Ci,this.stack=new X2,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Qa.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??Ei,this.maxBinLength=(e==null?void 0:e.maxBinLength)??Ei,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??Ei,this.maxMapLength=(e==null?void 0:e.maxMapLength)??Ei,this.maxExtLength=(e==null?void 0:e.maxExtLength)??Ei,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:Q2,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??J2}clone(){return new Cw({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Ci,this.stack.reset()}setBuffer(e){const r=Kl(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Ci&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),s=Kl(e),n=new Uint8Array(r.length+s.length);n.set(r),n.set(s,r.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:s}=this;return new RangeError(`Extra ${r.byteLength-s} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,s;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{s=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return s}const{headByte:n,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Xc(n)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let s=r,n=-1;for await(const i of e){if(r&&n===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),s&&(n=this.readArraySize(),s=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e<160){const n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else{const n=e-160;r=this.decodeString(n,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const n=this.lookU8();r=this.decodeString(n,1)}else if(e===218){const n=this.lookU16();r=this.decodeString(n,2)}else if(e===219){const n=this.lookU32();r=this.decodeString(n,4)}else if(e===220){const n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===221){const n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===222){const n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===223){const n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===196){const n=this.lookU8();r=this.decodeBinary(n,1)}else if(e===197){const n=this.lookU16();r=this.decodeBinary(n,2)}else if(e===198){const n=this.lookU32();r=this.decodeBinary(n,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const n=this.lookU8();r=this.decodeExtension(n,1)}else if(e===200){const n=this.lookU16();r=this.decodeExtension(n,2)}else if(e===201){const n=this.lookU32();r=this.decodeExtension(n,4)}else throw new qt(`Unrecognized type byte: ${Xc(e)}`);this.complete();const s=this.stack;for(;s.length>0;){const n=s.top();if(n.type===Vl)if(n.array[n.position]=r,n.position++,n.position===n.size)r=n.array,s.release(n);else continue e;else if(n.type===Wi){if(r==="__proto__")throw new qt("The key __proto__ is not allowed");n.key=this.mapKeyConverter(r),n.type=Ew;continue e}else if(n.map[n.key]=r,n.readCount++,n.readCount===n.size)r=n.map,s.release(n);else{n.key=null,n.type=Wi;continue e}}return r}}readHeadByte(){return this.headByte===Ci&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Ci}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new qt(`Unrecognized array type byte: ${Xc(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new qt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new qt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var i;if(e>this.maxStrLength)throw new qt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Od;const s=this.pos+r;let n;return this.stateIsMapKey()&&((i=this.keyDecoder)!=null&&i.canBeCached(e))?n=this.keyDecoder.decode(this.bytes,s,e):n=T2(this.bytes,s,e),this.pos+=r+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Wi:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new qt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Od;const s=this.pos+r,n=this.bytes.subarray(s,s+e);return this.pos+=r+e,n}decodeExtension(e,r){if(e>this.maxExtLength)throw new qt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const s=this.view.getInt8(this.pos+r),n=this.decodeBinary(e,r+1);return this.extensionCodec.decode(n,s,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=D2(this.view,this.pos);return this.pos+=8,e}readI64(){const e=bw(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function tA(t,e){return new eA(e).decode(t)}function Vu(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Aw(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Vu(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Hi(t,e){e||(e=t.reduce((n,i)=>n+i.length,0));const r=Aw(e);let s=0;for(const n of t)r.set(n,s),s+=n.length;return Vu(r)}function rA(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,E=0,v=p.length;E!==v&&p[E]===0;)E++,g++;for(var C=(v-E)*u+1>>>0,_=new Uint8Array(C);E!==v;){for(var S=p[E],k=0,L=C-1;(S!==0||k<w)&&L!==-1;L--,k++)S+=256*_[L]>>>0,_[L]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=k,E++}for(var R=C-w;R!==C&&_[R]===0;)R++;for(var A=c.repeat(g);R<C;++R)A+=t.charAt(_[R]);return A}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,E=0;p[g]===c;)w++,g++;for(var v=(p.length-g)*l+1>>>0,C=new Uint8Array(v);p[g];){var _=r[p.charCodeAt(g)];if(_===255)return;for(var S=0,k=v-1;(_!==0||S<E)&&k!==-1;k--,S++)_+=a*C[k]>>>0,C[k]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");E=S,g++}if(p[g]!==" "){for(var L=v-E;L!==v&&C[L]===0;)L++;for(var R=new Uint8Array(w+(v-L)),A=w;L!==v;)R[A++]=C[L++];return R}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var sA=rA,nA=sA;const iA=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},oA=t=>new TextEncoder().encode(t),aA=t=>new TextDecoder().decode(t);class cA{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class lA{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Iw(this,e)}}class uA{constructor(e){this.decoders=e}or(e){return Iw(this,e)}decode(e){const r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Iw=(t,e)=>new uA({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class hA{constructor(e,r,s,n){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=n,this.encoder=new cA(e,r,s),this.decoder=new lA(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const wc=({name:t,prefix:e,encode:r,decode:s})=>new hA(t,e,r,s),Vo=({prefix:t,name:e,alphabet:r})=>{const{encode:s,decode:n}=nA(r,e);return wc({prefix:t,name:e,encode:s,decode:i=>iA(n(i))})},dA=(t,e,r,s)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},fA=(t,e,r)=>{const s=e[e.length-1]==="=",n=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[n&a>>o];if(o&&(i+=e[n&a<<r-o]),s)for(;i.length*r&7;)i+="=";return i},lt=({name:t,prefix:e,bitsPerChar:r,alphabet:s})=>wc({prefix:e,name:t,encode(n){return fA(n,s,r)},decode(n){return dA(n,s,r,t)}}),pA=wc({prefix:"\0",name:"identity",encode:t=>aA(t),decode:t=>oA(t)}),gA=Object.freeze(Object.defineProperty({__proto__:null,identity:pA},Symbol.toStringTag,{value:"Module"})),wA=lt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),mA=Object.freeze(Object.defineProperty({__proto__:null,base2:wA},Symbol.toStringTag,{value:"Module"})),yA=lt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),bA=Object.freeze(Object.defineProperty({__proto__:null,base8:yA},Symbol.toStringTag,{value:"Module"})),vA=Vo({prefix:"9",name:"base10",alphabet:"0123456789"}),EA=Object.freeze(Object.defineProperty({__proto__:null,base10:vA},Symbol.toStringTag,{value:"Module"})),CA=lt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),AA=lt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),IA=Object.freeze(Object.defineProperty({__proto__:null,base16:CA,base16upper:AA},Symbol.toStringTag,{value:"Module"})),_A=lt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),SA=lt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),NA=lt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xA=lt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),OA=lt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),TA=lt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),PA=lt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),DA=lt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),$A=lt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),RA=Object.freeze(Object.defineProperty({__proto__:null,base32:_A,base32hex:OA,base32hexpad:PA,base32hexpadupper:DA,base32hexupper:TA,base32pad:NA,base32padupper:xA,base32upper:SA,base32z:$A},Symbol.toStringTag,{value:"Module"})),kA=Vo({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),UA=Vo({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),BA=Object.freeze(Object.defineProperty({__proto__:null,base36:kA,base36upper:UA},Symbol.toStringTag,{value:"Module"})),LA=Vo({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),MA=Vo({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),FA=Object.freeze(Object.defineProperty({__proto__:null,base58btc:LA,base58flickr:MA},Symbol.toStringTag,{value:"Module"})),jA=lt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),qA=lt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zA=lt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),WA=lt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),HA=Object.freeze(Object.defineProperty({__proto__:null,base64:jA,base64pad:qA,base64url:zA,base64urlpad:WA},Symbol.toStringTag,{value:"Module"})),_w=Array.from(""),KA=_w.reduce((t,e,r)=>(t[r]=e,t),[]),VA=_w.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function GA(t){return t.reduce((e,r)=>(e+=KA[r],e),"")}function YA(t){const e=[];for(const r of t){const s=VA[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}const JA=wc({prefix:"",name:"base256emoji",encode:GA,decode:YA}),XA=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:JA},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Td={...gA,...mA,...bA,...EA,...IA,...RA,...BA,...FA,...HA,...XA};function Sw(t,e,r,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:s}}}const Pd=Sw("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Zc=Sw("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Aw(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Nw={utf8:Pd,"utf-8":Pd,hex:Td.base16,latin1:Zc,ascii:Zc,binary:Zc,...Td};function sr(t,e="utf8"){const r=Nw[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Vu(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Rt(t,e="utf8"){const r=Nw[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const ZA={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},QA="Input must be an string, Buffer or Uint8Array";function eI(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(QA);return e}function tI(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function fa(t){return(4294967296+t).toString(16).substring(1)}function rI(t,e,r){let s=`
`+t+" = ";for(let n=0;n<e.length;n+=2){if(r===32)s+=fa(e[n]).toUpperCase(),s+=" ",s+=fa(e[n+1]).toUpperCase();else if(r===64)s+=fa(e[n+1]).toUpperCase(),s+=fa(e[n]).toUpperCase();else throw new Error("Invalid size "+r);n%6===4?s+=`
`+new Array(t.length+4).join(" "):n<e.length-2&&(s+=" ")}console.log(s)}function sI(t,e,r){let s=new Date().getTime();const n=new Uint8Array(e);for(let o=0;o<e;o++)n[o]=o%256;const i=new Date().getTime();console.log("Generated random input in "+(i-s)+"ms"),s=i;for(let o=0;o<r;o++){const a=t(n),c=new Date().getTime(),l=c-s;s=c,console.log("Hashed in "+l+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(l/1e3)*100)/100+" MB PER SECOND")}}var xw={normalizeInput:eI,toHex:tI,debugPrint:rI,testSpeed:sI};const La=xw;function pa(t,e,r){const s=t[e]+t[r];let n=t[e+1]+t[r+1];s>=4294967296&&n++,t[e]=s,t[e+1]=n}function Dd(t,e,r,s){let n=t[e]+r;r<0&&(n+=4294967296);let i=t[e+1]+s;n>=4294967296&&i++,t[e]=n,t[e+1]=i}function Ow(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function ss(t,e,r,s,n,i){const o=Bi[n],a=Bi[n+1],c=Bi[i],l=Bi[i+1];pa(le,t,e),Dd(le,t,o,a);let u=le[s]^le[t],h=le[s+1]^le[t+1];le[s]=h,le[s+1]=u,pa(le,r,s),u=le[e]^le[r],h=le[e+1]^le[r+1],le[e]=u>>>24^h<<8,le[e+1]=h>>>24^u<<8,pa(le,t,e),Dd(le,t,c,l),u=le[s]^le[t],h=le[s+1]^le[t+1],le[s]=u>>>16^h<<16,le[s+1]=h>>>16^u<<16,pa(le,r,s),u=le[e]^le[r],h=le[e+1]^le[r+1],le[e]=h>>>31^u<<1,le[e+1]=u>>>31^h<<1}const Tw=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),nI=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],ht=new Uint8Array(nI.map(function(t){return t*2})),le=new Uint32Array(32),Bi=new Uint32Array(32);function Pw(t,e){let r=0;for(r=0;r<16;r++)le[r]=t.h[r],le[r+16]=Tw[r];for(le[24]=le[24]^t.t,le[25]=le[25]^t.t/4294967296,e&&(le[28]=~le[28],le[29]=~le[29]),r=0;r<32;r++)Bi[r]=Ow(t.b,4*r);for(r=0;r<12;r++)ss(0,8,16,24,ht[r*16+0],ht[r*16+1]),ss(2,10,18,26,ht[r*16+2],ht[r*16+3]),ss(4,12,20,28,ht[r*16+4],ht[r*16+5]),ss(6,14,22,30,ht[r*16+6],ht[r*16+7]),ss(0,10,20,30,ht[r*16+8],ht[r*16+9]),ss(2,12,22,24,ht[r*16+10],ht[r*16+11]),ss(4,14,16,26,ht[r*16+12],ht[r*16+13]),ss(6,8,18,28,ht[r*16+14],ht[r*16+15]);for(r=0;r<16;r++)t.h[r]=t.h[r]^le[r]^le[r+16]}const ns=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Dw(t,e,r,s){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(r&&r.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(s&&s.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const n={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};ns.fill(0),ns[0]=t,e&&(ns[1]=e.length),ns[2]=1,ns[3]=1,r&&ns.set(r,32),s&&ns.set(s,48);for(let i=0;i<16;i++)n.h[i]=Tw[i]^Ow(ns,i*4);return e&&(Gu(n,e),n.c=128),n}function Gu(t,e){for(let r=0;r<e.length;r++)t.c===128&&(t.t+=t.c,Pw(t,!1),t.c=0),t.b[t.c++]=e[r]}function $w(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;Pw(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3);return e}function Rw(t,e,r,s,n){r=r||64,t=La.normalizeInput(t),s&&(s=La.normalizeInput(s)),n&&(n=La.normalizeInput(n));const i=Dw(r,e,s,n);return Gu(i,t),$w(i)}function iI(t,e,r,s,n){const i=Rw(t,e,r,s,n);return La.toHex(i)}var oI={blake2b:Rw,blake2bHex:iI,blake2bInit:Dw,blake2bUpdate:Gu,blake2bFinal:$w};const kw=xw;function aI(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function is(t,e,r,s,n,i){ve[t]=ve[t]+ve[e]+n,ve[s]=ga(ve[s]^ve[t],16),ve[r]=ve[r]+ve[s],ve[e]=ga(ve[e]^ve[r],12),ve[t]=ve[t]+ve[e]+i,ve[s]=ga(ve[s]^ve[t],8),ve[r]=ve[r]+ve[s],ve[e]=ga(ve[e]^ve[r],7)}function ga(t,e){return t>>>e^t<<32-e}const Uw=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),dt=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ve=new Uint32Array(16),rt=new Uint32Array(16);function Bw(t,e){let r=0;for(r=0;r<8;r++)ve[r]=t.h[r],ve[r+8]=Uw[r];for(ve[12]^=t.t,ve[13]^=t.t/4294967296,e&&(ve[14]=~ve[14]),r=0;r<16;r++)rt[r]=aI(t.b,4*r);for(r=0;r<10;r++)is(0,4,8,12,rt[dt[r*16+0]],rt[dt[r*16+1]]),is(1,5,9,13,rt[dt[r*16+2]],rt[dt[r*16+3]]),is(2,6,10,14,rt[dt[r*16+4]],rt[dt[r*16+5]]),is(3,7,11,15,rt[dt[r*16+6]],rt[dt[r*16+7]]),is(0,5,10,15,rt[dt[r*16+8]],rt[dt[r*16+9]]),is(1,6,11,12,rt[dt[r*16+10]],rt[dt[r*16+11]]),is(2,7,8,13,rt[dt[r*16+12]],rt[dt[r*16+13]]),is(3,4,9,14,rt[dt[r*16+14]],rt[dt[r*16+15]]);for(r=0;r<8;r++)t.h[r]^=ve[r]^ve[r+8]}function Lw(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const r=e?e.length:0;if(e&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");const s={h:new Uint32Array(Uw),b:new Uint8Array(64),c:0,t:0,outlen:t};return s.h[0]^=16842752^r<<8^t,r>0&&(Yu(s,e),s.c=64),s}function Yu(t,e){for(let r=0;r<e.length;r++)t.c===64&&(t.t+=t.c,Bw(t,!1),t.c=0),t.b[t.c++]=e[r]}function Mw(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;Bw(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3)&255;return e}function Fw(t,e,r){r=r||32,t=kw.normalizeInput(t);const s=Lw(r,e);return Yu(s,t),Mw(s)}function cI(t,e,r){const s=Fw(t,e,r);return kw.toHex(s)}var lI={blake2s:Fw,blake2sHex:cI,blake2sInit:Lw,blake2sUpdate:Yu,blake2sFinal:Mw};const Ai=oI,Ii=lI;var uI={blake2b:Ai.blake2b,blake2bHex:Ai.blake2bHex,blake2bInit:Ai.blake2bInit,blake2bUpdate:Ai.blake2bUpdate,blake2bFinal:Ai.blake2bFinal,blake2s:Ii.blake2s,blake2sHex:Ii.blake2sHex,blake2sInit:Ii.blake2sInit,blake2sUpdate:Ii.blake2sUpdate,blake2sFinal:Ii.blake2sFinal},hI={};const dI=":";function Yn(t){const[e,r]=t.split(dI);return{namespace:e,reference:r}}function jw(t,e){return t.includes(":")?[t]:e.chains||[]}var fI=Object.defineProperty,pI=Object.defineProperties,gI=Object.getOwnPropertyDescriptors,$d=Object.getOwnPropertySymbols,wI=Object.prototype.hasOwnProperty,mI=Object.prototype.propertyIsEnumerable,Gl=(t,e,r)=>e in t?fI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rd=(t,e)=>{for(var r in e||(e={}))wI.call(e,r)&&Gl(t,r,e[r]);if($d)for(var r of $d(e))mI.call(e,r)&&Gl(t,r,e[r]);return t},yI=(t,e)=>pI(t,gI(e)),kd=(t,e,r)=>Gl(t,typeof e!="symbol"?e+"":e,r);const bI="ReactNative",Ht={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},vI="js";function ec(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Os(){return!rn()&&!!zu()&&navigator.product===bI}function EI(){return Os()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function CI(){return Os()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function di(){return!ec()&&!!zu()&&!!rn()}function Go(){return Os()?Ht.reactNative:ec()?Ht.node:di()?Ht.browser:Ht.unknown}function Ud(){var t;try{return Os()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function AI(t,e){const r=new URLSearchParams(t);for(const s of Object.keys(e).sort())if(e.hasOwnProperty(s)){const n=e[s];n!==void 0&&r.set(s,n)}return r.toString()}function II(t){var e,r;const s=qw();try{return t!=null&&t.url&&s.url&&new URL(t.url).host!==new URL(s.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${s.url}. This is probably unintended and can lead to issues.`),t.url=s.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),yI(Rd(Rd({},s),t),{url:(t==null?void 0:t.url)||s.url,name:(t==null?void 0:t.name)||s.name,description:(t==null?void 0:t.description)||s.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:s.icons})}catch(n){return console.warn("Error populating app metadata",n),t||s}}function qw(){return rw()||{name:"",description:"",url:"",icons:[""]}}function _I(){if(Go()===Ht.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:s}=global.Platform;return[r,s].join("-")}const t=dC();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function SI(){var t;const e=Go();return e===Ht.browser?[e,((t=tw())==null?void 0:t.host)||"unknown"].join(":"):e}function zw(t,e,r){const s=_I(),n=SI();return[[t,e].join("-"),[vI,r].join("-"),s,n].join("/")}function NI({protocol:t,version:e,relayUrl:r,sdkVersion:s,auth:n,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=zw(t,e,s),h={auth:n,ua:u,projectId:i,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=AI(l[1]||"",h);return l[0]+"?"+d}function Ws(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Yl(t){return Object.fromEntries(t.entries())}function Jl(t){return new Map(Object.entries(t))}function Ls(t=W.FIVE_MINUTES,e){const r=W.toMiliseconds(t||W.FIVE_MINUTES);let s,n,i,o;return{resolve:a=>{i&&s&&(clearTimeout(i),s(a),o=Promise.resolve(a))},reject:a=>{i&&n&&(clearTimeout(i),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),s=a,n=c})}}function vs(t,e,r){return new Promise(async(s,n)=>{const i=setTimeout(()=>n(new Error(r)),e);try{const o=await t;s(o)}catch(o){n(o)}clearTimeout(i)})}function Ww(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function xI(t){return Ww("topic",t)}function OI(t){return Ww("id",t)}function Hw(t){const[e,r]=t.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")s.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return s}function Ve(t,e){return W.fromMiliseconds(Date.now()+W.toMiliseconds(t))}function ps(t){return Date.now()>=W.toMiliseconds(t)}function _e(t,e){return`${t}${e?`:${e}`:""}`}function $r(t=[],e=[]){return[...new Set([...t,...e])]}async function TI({id:t,topic:e,wcDeepLink:r}){var s;try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r,i=n==null?void 0:n.href;if(typeof i!="string")return;const o=PI(i,t,e),a=Go();if(a===Ht.browser){if(!((s=rn())!=null&&s.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}DI(o)}else a===Ht.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function PI(t,e,r){const s=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){const i=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${i}${UI(s,!0)}`}else n=`${n}/wc?${s}`;return n}function DI(t){let e="_self";kI()?e="_top":(RI()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function $I(t,e){let r="";try{if(di()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(s){console.error(s)}return r}function Bd(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),s=r.indexOf(e);return r[s+2]}function Ld(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ju(){return typeof process<"u"&&hI.IS_VITEST==="true"}function RI(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function kI(){try{return window.self!==window.top}catch{return!1}}function UI(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Kw(t){return Buffer.from(t,"base64").toString("utf-8")}function BI(t){return new Promise(e=>setTimeout(e,t))}let LI=class{constructor({limit:e}){kd(this,"limit"),kd(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const wa=BigInt(2**32-1),Md=BigInt(32);function Vw(t,e=!1){return e?{h:Number(t&wa),l:Number(t>>Md&wa)}:{h:Number(t>>Md&wa)|0,l:Number(t&wa)|0}}function Gw(t,e=!1){const r=t.length;let s=new Uint32Array(r),n=new Uint32Array(r);for(let i=0;i<r;i++){const{h:o,l:a}=Vw(t[i],e);[s[i],n[i]]=[o,a]}return[s,n]}const Fd=(t,e,r)=>t>>>r,jd=(t,e,r)=>t<<32-r|e>>>r,gs=(t,e,r)=>t>>>r|e<<32-r,ws=(t,e,r)=>t<<32-r|e>>>r,Li=(t,e,r)=>t<<64-r|e>>>r-32,Mi=(t,e,r)=>t>>>r-32|e<<64-r,MI=(t,e)=>e,FI=(t,e)=>t,jI=(t,e,r)=>t<<r|e>>>32-r,qI=(t,e,r)=>e<<r|t>>>32-r,zI=(t,e,r)=>e<<r-32|t>>>64-r,WI=(t,e,r)=>t<<r-32|e>>>64-r;function pr(t,e,r,s){const n=(e>>>0)+(s>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const Xu=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Zu=(t,e,r,s)=>e+r+s+(t/2**32|0)|0,HI=(t,e,r,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0),KI=(t,e,r,s,n)=>e+r+s+n+(t/2**32|0)|0,VI=(t,e,r,s,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(s>>>0)+(n>>>0),GI=(t,e,r,s,n,i)=>e+r+s+n+i+(t/2**32|0)|0,In=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Qu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function es(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function nr(t,...e){if(!Qu(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function eh(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");es(t.outputLen),es(t.blockLen)}function Ns(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function th(t,e){nr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function uo(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ir(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Qc(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function vr(t,e){return t<<32-e|t>>>e}const Yw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Jw(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Kr=Yw?t=>t:t=>Jw(t);function YI(t){for(let e=0;e<t.length;e++)t[e]=Jw(t[e]);return t}const ms=Yw?t=>t:YI,Xw=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",JI=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ho(t){if(nr(t),Xw)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=JI[t[r]];return e}const jr={_0:48,_9:57,A:65,F:70,a:97,f:102};function qd(t){if(t>=jr._0&&t<=jr._9)return t-jr._0;if(t>=jr.A&&t<=jr.F)return t-(jr.A-10);if(t>=jr.a&&t<=jr.f)return t-(jr.a-10)}function rh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Xw)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(r);for(let n=0,i=0;n<r;n++,i+=2){const o=qd(t.charCodeAt(i)),a=qd(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}s[n]=o*16+a}return s}function XI(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function mr(t){return typeof t=="string"&&(t=XI(t)),nr(t),t}function Hs(...t){let e=0;for(let s=0;s<t.length;s++){const n=t[s];nr(n),e+=n.length}const r=new Uint8Array(e);for(let s=0,n=0;s<t.length;s++){const i=t[s];r.set(i,n),n+=i.length}return r}let mc=class{};function Yo(t){const e=s=>t().update(mr(s)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function ZI(t){const e=(s,n)=>t(n).update(mr(s)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=s=>t(s),e}function fi(t=32){if(In&&typeof In.getRandomValues=="function")return In.getRandomValues(new Uint8Array(t));if(In&&typeof In.randomBytes=="function")return Uint8Array.from(In.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const QI=BigInt(0),_i=BigInt(1),e_=BigInt(2),t_=BigInt(7),r_=BigInt(256),s_=BigInt(113),Zw=[],Qw=[],em=[];for(let t=0,e=_i,r=1,s=0;t<24;t++){[r,s]=[s,(2*r+3*s)%5],Zw.push(2*(5*s+r)),Qw.push((t+1)*(t+2)/2%64);let n=QI;for(let i=0;i<7;i++)e=(e<<_i^(e>>t_)*s_)%r_,e&e_&&(n^=_i<<(_i<<BigInt(i))-_i);em.push(n)}const tm=Gw(em,!0),n_=tm[0],i_=tm[1],zd=(t,e,r)=>r>32?zI(t,e,r):jI(t,e,r),Wd=(t,e,r)=>r>32?WI(t,e,r):qI(t,e,r);function o_(t,e=24){const r=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=zd(l,u,1)^r[a],d=Wd(l,u,1)^r[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let n=t[2],i=t[3];for(let o=0;o<24;o++){const a=Qw[o],c=zd(n,i,a),l=Wd(n,i,a),u=Zw[o];n=t[u],i=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=n_[s],t[1]^=i_[s]}ir(r)}let a_=class rm extends mc{constructor(e,r,s,n=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=s,this.enableXOF=n,this.rounds=i,es(s),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=uo(this.state)}clone(){return this._cloneInto()}keccak(){ms(this.state32),o_(this.state32,this.rounds),ms(this.state32),this.posOut=0,this.pos=0}update(e){Ns(this),e=mr(e),nr(e);const{blockLen:r,state:s}=this,n=e.length;for(let i=0;i<n;){const o=Math.min(r-this.pos,n-i);for(let a=0;a<o;a++)s[this.pos++]^=e[i++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:s,blockLen:n}=this;e[s]^=r,r&128&&s===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Ns(this,!1),nr(e),this.finish();const r=this.state,{blockLen:s}=this;for(let n=0,i=e.length;n<i;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,i-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return es(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(th(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,ir(this.state)}_cloneInto(e){const{blockLen:r,suffix:s,outputLen:n,rounds:i,enableXOF:o}=this;return e||(e=new rm(r,s,n,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=s,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}};const c_=(t,e,r)=>Yo(()=>new a_(e,t,r)),l_=c_(1,136,256/8);function u_(t,e,r,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,s);const n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),c=s?4:0,l=s?0:4;t.setUint32(e+c,o,s),t.setUint32(e+l,a,s)}function h_(t,e,r){return t&e^~t&r}function d_(t,e,r){return t&e^t&r^e&r}let sm=class extends mc{constructor(e,r,s,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=s,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Qc(this.buffer)}update(e){Ns(this),e=mr(e),nr(e);const{view:r,buffer:s,blockLen:n}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(n-this.pos,i-o);if(a===n){const c=Qc(e);for(;n<=i-o;o+=n)this.process(c,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ns(this),th(e,this),this.finished=!0;const{buffer:r,view:s,blockLen:n,isLE:i}=this;let{pos:o}=this;r[o++]=128,ir(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(s,0),o=0);for(let h=o;h<n;h++)r[h]=0;u_(s,n-8,BigInt(this.length*8),i),this.process(s,0);const a=Qc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:s,length:n,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=n,e.pos=a,n%r&&e.buffer.set(s),e}clone(){return this._cloneInto()}};const os=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ft=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),pt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),f_=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),as=new Uint32Array(64);let p_=class extends sm{constructor(e=32){super(64,e,8,!1),this.A=os[0]|0,this.B=os[1]|0,this.C=os[2]|0,this.D=os[3]|0,this.E=os[4]|0,this.F=os[5]|0,this.G=os[6]|0,this.H=os[7]|0}get(){const{A:e,B:r,C:s,D:n,E:i,F:o,G:a,H:c}=this;return[e,r,s,n,i,o,a,c]}set(e,r,s,n,i,o,a,c){this.A=e|0,this.B=r|0,this.C=s|0,this.D=n|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)as[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=as[h-15],f=as[h-2],p=vr(d,7)^vr(d,18)^d>>>3,g=vr(f,17)^vr(f,19)^f>>>10;as[h]=g+as[h-7]+p+as[h-16]|0}let{A:s,B:n,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=vr(a,6)^vr(a,11)^vr(a,25),f=u+d+h_(a,c,l)+f_[h]+as[h]|0,p=(vr(s,2)^vr(s,13)^vr(s,22))+d_(s,n,i)|0;u=l,l=c,c=a,a=o+f|0,o=i,i=n,n=s,s=f+p|0}s=s+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(s,n,i,o,a,c,l,u)}roundClean(){ir(as)}destroy(){this.set(0,0,0,0,0,0,0,0),ir(this.buffer)}};const nm=Gw(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),g_=nm[0],w_=nm[1],cs=new Uint32Array(80),ls=new Uint32Array(80);let sh=class extends sm{constructor(e=64){super(128,e,16,!1),this.Ah=pt[0]|0,this.Al=pt[1]|0,this.Bh=pt[2]|0,this.Bl=pt[3]|0,this.Ch=pt[4]|0,this.Cl=pt[5]|0,this.Dh=pt[6]|0,this.Dl=pt[7]|0,this.Eh=pt[8]|0,this.El=pt[9]|0,this.Fh=pt[10]|0,this.Fl=pt[11]|0,this.Gh=pt[12]|0,this.Gl=pt[13]|0,this.Hh=pt[14]|0,this.Hl=pt[15]|0}get(){const{Ah:e,Al:r,Bh:s,Bl:n,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:f,Gl:p,Hh:g,Hl:w}=this;return[e,r,s,n,i,o,a,c,l,u,h,d,f,p,g,w]}set(e,r,s,n,i,o,a,c,l,u,h,d,f,p,g,w){this.Ah=e|0,this.Al=r|0,this.Bh=s|0,this.Bl=n|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=w|0}process(e,r){for(let C=0;C<16;C++,r+=4)cs[C]=e.getUint32(r),ls[C]=e.getUint32(r+=4);for(let C=16;C<80;C++){const _=cs[C-15]|0,S=ls[C-15]|0,k=gs(_,S,1)^gs(_,S,8)^Fd(_,S,7),L=ws(_,S,1)^ws(_,S,8)^jd(_,S,7),R=cs[C-2]|0,A=ls[C-2]|0,D=gs(R,A,19)^Li(R,A,61)^Fd(R,A,6),T=ws(R,A,19)^Mi(R,A,61)^jd(R,A,6),O=HI(L,T,ls[C-7],ls[C-16]),$=KI(O,k,D,cs[C-7],cs[C-16]);cs[C]=$|0,ls[C]=O|0}let{Ah:s,Al:n,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:f,Fl:p,Gh:g,Gl:w,Hh:E,Hl:v}=this;for(let C=0;C<80;C++){const _=gs(h,d,14)^gs(h,d,18)^Li(h,d,41),S=ws(h,d,14)^ws(h,d,18)^Mi(h,d,41),k=h&f^~h&g,L=d&p^~d&w,R=VI(v,S,L,w_[C],ls[C]),A=GI(R,E,_,k,g_[C],cs[C]),D=R|0,T=gs(s,n,28)^Li(s,n,34)^Li(s,n,39),O=ws(s,n,28)^Mi(s,n,34)^Mi(s,n,39),$=s&i^s&a^i&a,j=n&o^n&c^o&c;E=g|0,v=w|0,g=f|0,w=p|0,f=h|0,p=d|0,{h,l:d}=pr(l|0,u|0,A|0,D|0),l=a|0,u=c|0,a=i|0,c=o|0,i=s|0,o=n|0;const m=Xu(D,O,j);s=Zu(m,A,T,$),n=m|0}({h:s,l:n}=pr(this.Ah|0,this.Al|0,s|0,n|0)),{h:i,l:o}=pr(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=pr(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=pr(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=pr(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=pr(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:w}=pr(this.Gh|0,this.Gl|0,g|0,w|0),{h:E,l:v}=pr(this.Hh|0,this.Hl|0,E|0,v|0),this.set(s,n,i,o,a,c,l,u,h,d,f,p,g,w,E,v)}roundClean(){ir(cs,ls)}destroy(){ir(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},m_=class extends sh{constructor(){super(48),this.Ah=ft[0]|0,this.Al=ft[1]|0,this.Bh=ft[2]|0,this.Bl=ft[3]|0,this.Ch=ft[4]|0,this.Cl=ft[5]|0,this.Dh=ft[6]|0,this.Dl=ft[7]|0,this.Eh=ft[8]|0,this.El=ft[9]|0,this.Fh=ft[10]|0,this.Fl=ft[11]|0,this.Gh=ft[12]|0,this.Gl=ft[13]|0,this.Hh=ft[14]|0,this.Hl=ft[15]|0}};const gt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class y_ extends sh{constructor(){super(32),this.Ah=gt[0]|0,this.Al=gt[1]|0,this.Bh=gt[2]|0,this.Bl=gt[3]|0,this.Ch=gt[4]|0,this.Cl=gt[5]|0,this.Dh=gt[6]|0,this.Dl=gt[7]|0,this.Eh=gt[8]|0,this.El=gt[9]|0,this.Fh=gt[10]|0,this.Fl=gt[11]|0,this.Gh=gt[12]|0,this.Gl=gt[13]|0,this.Hh=gt[14]|0,this.Hl=gt[15]|0}}const yc=Yo(()=>new p_),b_=Yo(()=>new sh),v_=Yo(()=>new m_),E_=Yo(()=>new y_),C_=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),He=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),J=new Uint32Array(32);function us(t,e,r,s,n,i){const o=n[i],a=n[i+1];let c=J[2*t],l=J[2*t+1],u=J[2*e],h=J[2*e+1],d=J[2*r],f=J[2*r+1],p=J[2*s],g=J[2*s+1],w=Xu(c,u,o);l=Zu(w,l,h,a),c=w|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:MI(g,p),Dl:FI(g)},{h:f,l:d}=pr(f,d,g,p),{Bh:h,Bl:u}={Bh:h^f,Bl:u^d},{Bh:h,Bl:u}={Bh:gs(h,u,24),Bl:ws(h,u,24)},J[2*t]=c,J[2*t+1]=l,J[2*e]=u,J[2*e+1]=h,J[2*r]=d,J[2*r+1]=f,J[2*s]=p,J[2*s+1]=g}function hs(t,e,r,s,n,i){const o=n[i],a=n[i+1];let c=J[2*t],l=J[2*t+1],u=J[2*e],h=J[2*e+1],d=J[2*r],f=J[2*r+1],p=J[2*s],g=J[2*s+1],w=Xu(c,u,o);l=Zu(w,l,h,a),c=w|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:gs(g,p,16),Dl:ws(g,p,16)},{h:f,l:d}=pr(f,d,g,p),{Bh:h,Bl:u}={Bh:h^f,Bl:u^d},{Bh:h,Bl:u}={Bh:Li(h,u,63),Bl:Mi(h,u,63)},J[2*t]=c,J[2*t+1]=l,J[2*e]=u,J[2*e+1]=h,J[2*r]=d,J[2*r+1]=f,J[2*s]=p,J[2*s+1]=g}function A_(t,e={},r,s,n){if(es(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==s)throw new Error("salt must be undefined or "+s);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}class I_ extends mc{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,es(e),es(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=uo(this.buffer)}update(e){Ns(this),e=mr(e),nr(e);const{blockLen:r,buffer:s,buffer32:n}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===r&&(ms(n),this.compress(n,0,!1),ms(n),this.pos=0);const l=Math.min(r-this.pos,i-c),u=o+c;if(l===r&&!(u%4)&&c+l<i){const h=new Uint32Array(a,u,Math.floor((i-c)/4));ms(h);for(let d=0;c+r<i;d+=n.length,c+=r)this.length+=r,this.compress(h,d,!1);ms(h);continue}s.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Ns(this),th(e,this);const{pos:r,buffer32:s}=this;this.finished=!0,ir(this.buffer.subarray(r)),ms(s),this.compress(s,0,!0),ms(s);const n=uo(e);this.get().forEach((i,o)=>n[o]=Kr(i))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const s=e.slice(0,r);return this.destroy(),s}_cloneInto(e){const{buffer:r,length:s,finished:n,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=i,e.finished=n,e.length=s,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class __ extends I_{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=He[0]|0,this.v0h=He[1]|0,this.v1l=He[2]|0,this.v1h=He[3]|0,this.v2l=He[4]|0,this.v2h=He[5]|0,this.v3l=He[6]|0,this.v3h=He[7]|0,this.v4l=He[8]|0,this.v4h=He[9]|0,this.v5l=He[10]|0,this.v5h=He[11]|0,this.v6l=He[12]|0,this.v6h=He[13]|0,this.v7l=He[14]|0,this.v7h=He[15]|0,A_(r,e,64,16,16);let{key:s,personalization:n,salt:i}=e,o=0;if(s!==void 0&&(s=mr(s),o=s.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=mr(i);const a=uo(i);this.v4l^=Kr(a[0]),this.v4h^=Kr(a[1]),this.v5l^=Kr(a[2]),this.v5h^=Kr(a[3])}if(n!==void 0){n=mr(n);const a=uo(n);this.v6l^=Kr(a[0]),this.v6h^=Kr(a[1]),this.v7l^=Kr(a[2]),this.v7h^=Kr(a[3])}if(s!==void 0){const a=new Uint8Array(this.blockLen);a.set(s),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:s,v1h:n,v2l:i,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:d,v6l:f,v6h:p,v7l:g,v7h:w}=this;return[e,r,s,n,i,o,a,c,l,u,h,d,f,p,g,w]}set(e,r,s,n,i,o,a,c,l,u,h,d,f,p,g,w){this.v0l=e|0,this.v0h=r|0,this.v1l=s|0,this.v1h=n|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=d|0,this.v6l=f|0,this.v6h=p|0,this.v7l=g|0,this.v7h=w|0}compress(e,r,s){this.get().forEach((c,l)=>J[l]=c),J.set(He,16);let{h:n,l:i}=Vw(BigInt(this.length));J[24]=He[8]^i,J[25]=He[9]^n,s&&(J[28]=~J[28],J[29]=~J[29]);let o=0;const a=C_;for(let c=0;c<12;c++)us(0,4,8,12,e,r+2*a[o++]),hs(0,4,8,12,e,r+2*a[o++]),us(1,5,9,13,e,r+2*a[o++]),hs(1,5,9,13,e,r+2*a[o++]),us(2,6,10,14,e,r+2*a[o++]),hs(2,6,10,14,e,r+2*a[o++]),us(3,7,11,15,e,r+2*a[o++]),hs(3,7,11,15,e,r+2*a[o++]),us(0,5,10,15,e,r+2*a[o++]),hs(0,5,10,15,e,r+2*a[o++]),us(1,6,11,12,e,r+2*a[o++]),hs(1,6,11,12,e,r+2*a[o++]),us(2,7,8,13,e,r+2*a[o++]),hs(2,7,8,13,e,r+2*a[o++]),us(3,4,9,14,e,r+2*a[o++]),hs(3,4,9,14,e,r+2*a[o++]);this.v0l^=J[0]^J[16],this.v0h^=J[1]^J[17],this.v1l^=J[2]^J[18],this.v1h^=J[3]^J[19],this.v2l^=J[4]^J[20],this.v2h^=J[5]^J[21],this.v3l^=J[6]^J[22],this.v3h^=J[7]^J[23],this.v4l^=J[8]^J[24],this.v4h^=J[9]^J[25],this.v5l^=J[10]^J[26],this.v5h^=J[11]^J[27],this.v6l^=J[12]^J[28],this.v6h^=J[13]^J[29],this.v7l^=J[14]^J[30],this.v7h^=J[15]^J[31],ir(J)}destroy(){this.destroyed=!0,ir(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const S_=ZI(t=>new __(t)),N_="https://rpc.walletconnect.org/v1";function im(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(l_(r)).toString("hex")}async function x_(t,e,r,s,n,i){switch(r.t){case"eip191":return await O_(t,e,r.s);case"eip1271":return await T_(t,e,r.s,s,n,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function O_(t,e,r){return(await m2({hash:im(e),signature:r})).toLowerCase()===t.toLowerCase()}async function T_(t,e,r,s,n,i){const o=Yn(s);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${s}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:im(e)).substring(2),d=a+h+c+u+l,f=await fetch(`${i||N_}/?chainId=${s}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:P_(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function P_(){return Date.now()+Math.floor(Math.random()*1e3)}function D_(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const s=r[0];if(s===0)throw new Error("No signatures found");const n=1+s*64;if(r.length<n)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const i=Buffer.from(t,"base64").slice(1,65);return hi.encode(i)}function $_(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),s=new Uint8Array(r.length+e.length);s.set(r),s.set(e,r.length);const n=S_(s,{dkLen:32});return hi.encode(n)}function Hd(t){const e=new Uint8Array(yc(R_(t)));return hi.encode(e)}function R_(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Kd(t){const e=Buffer.from(t,"base64"),r=tA(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const s=K2(r),n=Buffer.from("TX"),i=Buffer.concat([n,Buffer.from(s)]),o=E_(i);return ry.encode(o).replace(/=+$/,"")}function el(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function k_(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),s=Buffer.from(t.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(el(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(el(r.length)),n.push(r),n.push(Buffer.from([26])),n.push(el(s.length)),n.push(s);const i=Buffer.concat(n),o=yc(i);return Buffer.from(o).toString("hex").toUpperCase()}var U_=Object.defineProperty,B_=Object.defineProperties,L_=Object.getOwnPropertyDescriptors,Vd=Object.getOwnPropertySymbols,M_=Object.prototype.hasOwnProperty,F_=Object.prototype.propertyIsEnumerable,Gd=(t,e,r)=>e in t?U_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,j_=(t,e)=>{for(var r in e||(e={}))M_.call(e,r)&&Gd(t,r,e[r]);if(Vd)for(var r of Vd(e))F_.call(e,r)&&Gd(t,r,e[r]);return t},q_=(t,e)=>B_(t,L_(e));const z_="did:pkh:",nh=t=>t==null?void 0:t.split(":"),W_=t=>{const e=t&&nh(t);if(e)return t.includes(z_)?e[3]:e[1]},Xl=t=>{const e=t&&nh(t);if(e)return e[2]+":"+e[3]},tc=t=>{const e=t&&nh(t);if(e)return e.pop()};async function Yd(t){const{cacao:e,projectId:r}=t,{s,p:n}=e,i=om(n,n.iss),o=tc(n.iss);return await x_(o,i,s,Xl(n.iss),r)}const om=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,s=tc(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=t.statement||void 0;const i=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${W_(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,f=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=Ma(t.resources);if(p){const g=fo(p);n=Q_(n,g)}return[r,s,"",n,"",i,o,a,c,l,u,h,d,f].filter(g=>g!=null).join(`
`)};function H_(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function K_(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function sn(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const s=t.att[r];if(Array.isArray(s))throw new Error(`Resource must be an object: ${r}`);if(typeof s!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(s).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(s).forEach(n=>{const i=s[n];if(!Array.isArray(i))throw new Error(`Ability limits ${n} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function V_(t,e,r,s={}){return r==null||r.sort((n,i)=>n.localeCompare(i)),{att:{[t]:G_(e,r,s)}}}function G_(t,e,r={}){e=e==null?void 0:e.sort((n,i)=>n.localeCompare(i));const s=e.map(n=>({[`${t}/${n}`]:[r]}));return Object.assign({},...s)}function am(t){return sn(t),`urn:recap:${H_(t).replace(/=/g,"")}`}function fo(t){const e=K_(t.replace("urn:recap:",""));return sn(e),e}function Y_(t,e,r){const s=V_(t,e,r);return am(s)}function J_(t){return t&&t.includes("urn:recap:")}function X_(t,e){const r=fo(t),s=fo(e),n=Z_(r,s);return am(n)}function Z_(t,e){sn(t),sn(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,i)=>n.localeCompare(i)),s={att:{}};return r.forEach(n=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;s.att[n]=q_(j_({},s.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((l=e.att[n])==null?void 0:l[a])})})}),s}function Q_(t="",e){sn(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const s=[];let n=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(n++,`(${n}) '${h}': '${l[h].join("', '")}' for '${a}'.`));s.push(u.join(", ").replace(".,","."))});const i=s.join(" "),o=`${r}${i}`;return`${t?t+" ":""}${o}`}function Jd(t){var e;const r=fo(t);sn(r);const s=(e=r.att)==null?void 0:e.eip155;return s?Object.keys(s).map(n=>n.split("/")[1]):[]}function Xd(t){const e=fo(t);sn(e);const r=[];return Object.values(e.att).forEach(s=>{Object.values(s).forEach(n=>{var i;(i=n==null?void 0:n[0])!=null&&i.chains&&r.push(n[0].chains)})}),[...new Set(r.flat())]}function Ma(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return J_(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function cm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Zl(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function tl(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Dt(t,...e){if(!cm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function eS(t,e){Dt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function As(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Zn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function tS(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const rS=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function sS(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ql(t){if(typeof t=="string")t=sS(t);else if(cm(t))t=eu(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function nS(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function iS(t,e){if(t.length!==e.length)return!1;let r=0;for(let s=0;s<t.length;s++)r|=t[s]^e[s];return r===0}const oS=(t,e)=>{function r(s,...n){if(Dt(s),!rS)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=n[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Dt(l):Dt(l,t.nonceLength)}const i=t.tagLength;i&&n[1]!==void 0&&Dt(n[1]);const o=e(s,...n),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Dt(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Dt(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Dt(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function Qd(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!cS(e))throw new Error("invalid output, must be aligned");return e}function ef(t,e,r,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,s);const n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i);t.setUint32(e+4,o,s),t.setUint32(e+0,a,s)}function aS(t,e,r){Zl(r);const s=new Uint8Array(16),n=tS(s);return ef(n,0,BigInt(e),r),ef(n,8,BigInt(t),r),s}function cS(t){return t.byteOffset%4===0}function eu(t){return Uint8Array.from(t)}const lm=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),lS=lm("expand 16-byte k"),uS=lm("expand 32-byte k"),hS=As(lS),dS=As(uS);function me(t,e){return t<<e|t>>>32-e}function tu(t){return t.byteOffset%4===0}const ma=64,fS=16,um=2**32-1,tf=new Uint32Array;function pS(t,e,r,s,n,i,o,a){const c=n.length,l=new Uint8Array(ma),u=As(l),h=tu(n)&&tu(i),d=h?As(n):tf,f=h?As(i):tf;for(let p=0;p<c;o++){if(t(e,r,s,u,o,a),o>=um)throw new Error("arx: counter overflow");const g=Math.min(ma,c-p);if(h&&g===ma){const w=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let E=0,v;E<fS;E++)v=w+E,f[v]=d[v]^u[E];p+=ma;continue}for(let w=0,E;w<g;w++)E=p+w,i[E]=n[E]^l[w];p+=g}}function gS(t,e){const{allowShortKeys:r,extendNonceFn:s,counterLength:n,counterRight:i,rounds:o}=nS({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return tl(n),tl(o),Zl(i),Zl(r),(a,c,l,u,h=0)=>{Dt(a),Dt(c),Dt(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Dt(u),tl(h),h<0||h>=um)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let p=a.length,g,w;if(p===32)f.push(g=eu(a)),w=dS;else if(p===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),w=hS,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);tu(c)||f.push(c=eu(c));const E=As(g);if(s){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(w,E,As(c.subarray(0,16)),E),c=c.subarray(16)}const v=16-n;if(v!==c.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){const _=new Uint8Array(12);_.set(c,i?0:12-c.length),c=_,f.push(c)}const C=As(c);return pS(t,w,E,C,l,u,h,o),Zn(...f),u}}const st=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class wS{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Ql(e),Dt(e,32);const r=st(e,0),s=st(e,2),n=st(e,4),i=st(e,6),o=st(e,8),a=st(e,10),c=st(e,12),l=st(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|s<<3)&8191,this.r[2]=(s>>>10|n<<6)&7939,this.r[3]=(n>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=st(e,16+2*u)}process(e,r,s=!1){const n=s?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=o[6],p=o[7],g=o[8],w=o[9],E=st(e,r+0),v=st(e,r+2),C=st(e,r+4),_=st(e,r+6),S=st(e,r+8),k=st(e,r+10),L=st(e,r+12),R=st(e,r+14);let A=i[0]+(E&8191),D=i[1]+((E>>>13|v<<3)&8191),T=i[2]+((v>>>10|C<<6)&8191),O=i[3]+((C>>>7|_<<9)&8191),$=i[4]+((_>>>4|S<<12)&8191),j=i[5]+(S>>>1&8191),m=i[6]+((S>>>14|k<<2)&8191),b=i[7]+((k>>>11|L<<5)&8191),I=i[8]+((L>>>8|R<<8)&8191),x=i[9]+(R>>>5|n),N=0,P=N+A*a+D*(5*w)+T*(5*g)+O*(5*p)+$*(5*f);N=P>>>13,P&=8191,P+=j*(5*d)+m*(5*h)+b*(5*u)+I*(5*l)+x*(5*c),N+=P>>>13,P&=8191;let M=N+A*c+D*a+T*(5*w)+O*(5*g)+$*(5*p);N=M>>>13,M&=8191,M+=j*(5*f)+m*(5*d)+b*(5*h)+I*(5*u)+x*(5*l),N+=M>>>13,M&=8191;let G=N+A*l+D*c+T*a+O*(5*w)+$*(5*g);N=G>>>13,G&=8191,G+=j*(5*p)+m*(5*f)+b*(5*d)+I*(5*h)+x*(5*u),N+=G>>>13,G&=8191;let X=N+A*u+D*l+T*c+O*a+$*(5*w);N=X>>>13,X&=8191,X+=j*(5*g)+m*(5*p)+b*(5*f)+I*(5*d)+x*(5*h),N+=X>>>13,X&=8191;let K=N+A*h+D*u+T*l+O*c+$*a;N=K>>>13,K&=8191,K+=j*(5*w)+m*(5*g)+b*(5*p)+I*(5*f)+x*(5*d),N+=K>>>13,K&=8191;let Z=N+A*d+D*h+T*u+O*l+$*c;N=Z>>>13,Z&=8191,Z+=j*a+m*(5*w)+b*(5*g)+I*(5*p)+x*(5*f),N+=Z>>>13,Z&=8191;let ae=N+A*f+D*d+T*h+O*u+$*l;N=ae>>>13,ae&=8191,ae+=j*c+m*a+b*(5*w)+I*(5*g)+x*(5*p),N+=ae>>>13,ae&=8191;let Ie=N+A*p+D*f+T*d+O*h+$*u;N=Ie>>>13,Ie&=8191,Ie+=j*l+m*c+b*a+I*(5*w)+x*(5*g),N+=Ie>>>13,Ie&=8191;let Ce=N+A*g+D*p+T*f+O*d+$*h;N=Ce>>>13,Ce&=8191,Ce+=j*u+m*l+b*c+I*a+x*(5*w),N+=Ce>>>13,Ce&=8191;let he=N+A*w+D*g+T*p+O*f+$*d;N=he>>>13,he&=8191,he+=j*h+m*u+b*l+I*c+x*a,N+=he>>>13,he&=8191,N=(N<<2)+N|0,N=N+P|0,P=N&8191,N=N>>>13,M+=N,i[0]=P,i[1]=M,i[2]=G,i[3]=X,i[4]=K,i[5]=Z,i[6]=ae,i[7]=Ie,i[8]=Ce,i[9]=he}finalize(){const{h:e,pad:r}=this,s=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,s[0]=e[0]+5,n=s[0]>>>13,s[0]&=8191;for(let a=1;a<10;a++)s[a]=e[a]+n,n=s[a]>>>13,s[a]&=8191;s[9]-=8192;let i=(n^1)-1;for(let a=0;a<10;a++)s[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|s[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Zn(s)}update(e){Zd(this),e=Ql(e),Dt(e);const{buffer:r,blockLen:s}=this,n=e.length;for(let i=0;i<n;){const o=Math.min(s-this.pos,n-i);if(o===s){for(;s<=n-i;i+=s)this.process(e,i);continue}r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===s&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Zn(this.h,this.r,this.buffer,this.pad)}digestInto(e){Zd(this),eS(e,this),this.finished=!0;const{buffer:r,h:s}=this;let{pos:n}=this;if(n){for(r[n++]=1;n<16;n++)r[n]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=s[o]>>>0,e[i++]=s[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const s=e.slice(0,r);return this.destroy(),s}}function mS(t){const e=(s,n)=>t(n).update(Ql(s)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=s=>t(s),e}const yS=mS(t=>new wS(t));function bS(t,e,r,s,n,i=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],f=e[3],p=e[4],g=e[5],w=e[6],E=e[7],v=n,C=r[0],_=r[1],S=r[2],k=o,L=a,R=c,A=l,D=u,T=h,O=d,$=f,j=p,m=g,b=w,I=E,x=v,N=C,P=_,M=S;for(let X=0;X<i;X+=2)k=k+D|0,x=me(x^k,16),j=j+x|0,D=me(D^j,12),k=k+D|0,x=me(x^k,8),j=j+x|0,D=me(D^j,7),L=L+T|0,N=me(N^L,16),m=m+N|0,T=me(T^m,12),L=L+T|0,N=me(N^L,8),m=m+N|0,T=me(T^m,7),R=R+O|0,P=me(P^R,16),b=b+P|0,O=me(O^b,12),R=R+O|0,P=me(P^R,8),b=b+P|0,O=me(O^b,7),A=A+$|0,M=me(M^A,16),I=I+M|0,$=me($^I,12),A=A+$|0,M=me(M^A,8),I=I+M|0,$=me($^I,7),k=k+T|0,M=me(M^k,16),b=b+M|0,T=me(T^b,12),k=k+T|0,M=me(M^k,8),b=b+M|0,T=me(T^b,7),L=L+O|0,x=me(x^L,16),I=I+x|0,O=me(O^I,12),L=L+O|0,x=me(x^L,8),I=I+x|0,O=me(O^I,7),R=R+$|0,N=me(N^R,16),j=j+N|0,$=me($^j,12),R=R+$|0,N=me(N^R,8),j=j+N|0,$=me($^j,7),A=A+D|0,P=me(P^A,16),m=m+P|0,D=me(D^m,12),A=A+D|0,P=me(P^A,8),m=m+P|0,D=me(D^m,7);let G=0;s[G++]=o+k|0,s[G++]=a+L|0,s[G++]=c+R|0,s[G++]=l+A|0,s[G++]=u+D|0,s[G++]=h+T|0,s[G++]=d+O|0,s[G++]=f+$|0,s[G++]=p+j|0,s[G++]=g+m|0,s[G++]=w+b|0,s[G++]=E+I|0,s[G++]=v+x|0,s[G++]=C+N|0,s[G++]=_+P|0,s[G++]=S+M|0}const vS=gS(bS,{counterRight:!1,counterLength:4,allowShortKeys:!1}),ES=new Uint8Array(16),rf=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(ES.subarray(r))},CS=new Uint8Array(32);function sf(t,e,r,s,n){const i=t(e,r,CS),o=yS.create(i);n&&rf(o,n),rf(o,s);const a=aS(s.length,n?n.length:0,!0);o.update(a);const c=o.digest();return Zn(i,a),c}const AS=t=>(e,r,s)=>({encrypt(n,i){const o=n.length;i=Qd(o+16,i,!1),i.set(n);const a=i.subarray(0,-16);t(e,r,a,a,1);const c=sf(t,e,r,a,s);return i.set(c,o),Zn(c),i},decrypt(n,i){i=Qd(n.length-16,i,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=sf(t,e,r,o,s);if(!iS(a,c))throw new Error("invalid tag");return i.set(n.subarray(0,-16)),t(e,r,i,i,1),Zn(c),i}}),hm=oS({blockSize:64,nonceLength:12,tagLength:16},AS(vS));let dm=class extends mc{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,eh(e);const s=mr(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,i=new Uint8Array(n);i.set(s.length>n?e.create().update(s).digest():s);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),ir(i)}update(e){return Ns(this),this.iHash.update(e),this}digestInto(e){Ns(this),nr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:s,finished:n,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=s._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const bc=(t,e,r)=>new dm(t,e).update(r).digest();bc.create=(t,e)=>new dm(t,e);function IS(t,e,r){return eh(t),r===void 0&&(r=new Uint8Array(t.outputLen)),bc(t,mr(r),mr(e))}const rl=Uint8Array.from([0]),nf=Uint8Array.of();function _S(t,e,r,s=32){eh(t),es(s);const n=t.outputLen;if(s>255*n)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(s/n);r===void 0&&(r=nf);const o=new Uint8Array(i*n),a=bc.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)rl[0]=u+1,c.update(u===0?nf:l).update(r).update(rl).digestInto(l),o.set(l,n*u),a._cloneInto(c);return a.destroy(),c.destroy(),ir(l,rl),o.slice(0,s)}const SS=(t,e,r,s,n)=>_S(t,IS(t,e,r),s,n),vc=yc,ih=BigInt(0),ru=BigInt(1);function rc(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function ya(t){const e=t.toString(16);return e.length&1?"0"+e:e}function fm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ih:BigInt("0x"+t)}function Ec(t){return fm(ho(t))}function sc(t){return nr(t),fm(ho(Uint8Array.from(t).reverse()))}function oh(t,e){return rh(t.toString(16).padStart(e*2,"0"))}function ah(t,e){return oh(t,e).reverse()}function Pt(t,e,r){let s;if(typeof e=="string")try{s=rh(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Qu(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=s.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return s}const sl=t=>typeof t=="bigint"&&ih<=t;function NS(t,e,r){return sl(t)&&sl(e)&&sl(r)&&e<=t&&t<r}function su(t,e,r,s){if(!NS(e,r,s))throw new Error("expected valid "+t+": "+r+" <= n < "+s+", got "+e)}function xS(t){let e;for(e=0;t>ih;t>>=ru,e+=1);return e}const Cc=t=>(ru<<BigInt(t))-ru;function OS(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const s=d=>new Uint8Array(d),n=d=>Uint8Array.of(d);let i=s(t),o=s(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},l=(...d)=>r(o,i,...d),u=(d=s(0))=>{o=l(n(0),d),i=l(),d.length!==0&&(o=l(n(1),d),i=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){i=l();const p=i.slice();f.push(p),d+=i.length}return Hs(...f)};return(d,f)=>{c(),u(d);let p;for(;!(p=f(h()));)u();return c(),p}}function Ac(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function s(n,i,o){const a=t[n];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${n}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([n,i])=>s(n,i,!1)),Object.entries(r).forEach(([n,i])=>s(n,i,!0))}function of(t){const e=new WeakMap;return(r,...s)=>{const n=e.get(r);if(n!==void 0)return n;const i=t(r,...s);return e.set(r,i),i}}const $t=BigInt(0),bt=BigInt(1),Ks=BigInt(2),TS=BigInt(3),pm=BigInt(4),gm=BigInt(5),wm=BigInt(8);function rr(t,e){const r=t%e;return r>=$t?r:e+r}function fr(t,e,r){let s=t;for(;e-- >$t;)s*=s,s%=r;return s}function af(t,e){if(t===$t)throw new Error("invert: expected non-zero number");if(e<=$t)throw new Error("invert: expected positive modulus, got "+e);let r=rr(t,e),s=e,n=$t,i=bt;for(;r!==$t;){const o=s/r,a=s%r,c=n-i*o;s=r,r=a,n=i,i=c}if(s!==bt)throw new Error("invert: does not exist");return rr(n,e)}function mm(t,e){const r=(t.ORDER+bt)/pm,s=t.pow(e,r);if(!t.eql(t.sqr(s),e))throw new Error("Cannot find square root");return s}function PS(t,e){const r=(t.ORDER-gm)/wm,s=t.mul(e,Ks),n=t.pow(s,r),i=t.mul(e,n),o=t.mul(t.mul(i,Ks),n),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function DS(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-bt,r=0;for(;e%Ks===$t;)e/=Ks,r++;let s=Ks;const n=pi(t);for(;cf(n,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return mm;let i=n.pow(s,e);const o=(e+bt)/Ks;return function(a,c){if(a.is0(c))return c;if(cf(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,i),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let f=1,p=a.sqr(h);for(;!a.eql(p,a.ONE);)if(f++,p=a.sqr(p),f===l)throw new Error("Cannot find square root");const g=bt<<BigInt(l-f-1),w=a.pow(u,g);l=f,u=a.sqr(w),h=a.mul(h,u),d=a.mul(d,w)}return d}}function $S(t){return t%pm===TS?mm:t%wm===gm?PS:DS(t)}const RS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kS(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=RS.reduce((s,n)=>(s[n]="function",s),e);return Ac(t,r),t}function US(t,e,r){if(r<$t)throw new Error("invalid exponent, negatives unsupported");if(r===$t)return t.ONE;if(r===bt)return e;let s=t.ONE,n=e;for(;r>$t;)r&bt&&(s=t.mul(s,n)),n=t.sqr(n),r>>=bt;return s}function ym(t,e,r=!1){const s=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(s[c]=o,t.mul(o,a)),t.ONE),i=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(s[c]=t.mul(o,s[c]),t.mul(o,a)),i),s}function cf(t,e){const r=(t.ORDER-bt)/Ks,s=t.pow(e,r),n=t.eql(s,t.ONE),i=t.eql(s,t.ZERO),o=t.eql(s,t.neg(t.ONE));if(!n&&!i&&!o)throw new Error("invalid Legendre symbol result");return n?1:i?0:-1}function BS(t,e){e!==void 0&&es(e);const r=e!==void 0?e:t.toString(2).length,s=Math.ceil(r/8);return{nBitLength:r,nByteLength:s}}function pi(t,e,r=!1,s={}){if(t<=$t)throw new Error("invalid field: expected ORDER > 0, got "+t);let n,i;if(typeof e=="object"&&e!=null){if(s.sqrt||r)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(n=u.BITS),u.sqrt&&(i=u.sqrt),typeof u.isLE=="boolean"&&(r=u.isLE)}else typeof e=="number"&&(n=e),s.sqrt&&(i=s.sqrt);const{nBitLength:o,nByteLength:a}=BS(t,n);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const l=Object.freeze({ORDER:t,isLE:r,BITS:o,BYTES:a,MASK:Cc(o),ZERO:$t,ONE:bt,create:u=>rr(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return $t<=u&&u<t},is0:u=>u===$t,isValidNot0:u=>!l.is0(u)&&l.isValid(u),isOdd:u=>(u&bt)===bt,neg:u=>rr(-u,t),eql:(u,h)=>u===h,sqr:u=>rr(u*u,t),add:(u,h)=>rr(u+h,t),sub:(u,h)=>rr(u-h,t),mul:(u,h)=>rr(u*h,t),pow:(u,h)=>US(l,u,h),div:(u,h)=>rr(u*af(h,t),t),sqrN:u=>u*u,addN:(u,h)=>u+h,subN:(u,h)=>u-h,mulN:(u,h)=>u*h,inv:u=>af(u,t),sqrt:i||(u=>(c||(c=$S(t)),c(l,u))),toBytes:u=>r?ah(u,a):oh(u,a),fromBytes:u=>{if(u.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);return r?sc(u):Ec(u)},invertBatch:u=>ym(l,u),cmov:(u,h,d)=>d?h:u});return Object.freeze(l)}function bm(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function vm(t){const e=bm(t);return e+Math.ceil(e/2)}function LS(t,e,r=!1){const s=t.length,n=bm(e),i=vm(e);if(s<16||s<i||s>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+s);const o=r?sc(t):Ec(t),a=rr(o,e-bt)+bt;return r?ah(a,n):oh(a,n)}const Qn=BigInt(0),Vs=BigInt(1);function Ki(t,e){const r=e.negate();return t?r:e}function MS(t,e,r){const s=i=>i.pz,n=ym(t.Fp,r.map(s));return r.map((i,o)=>i.toAffine(n[o])).map(t.fromAffine)}function Em(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function nl(t,e){Em(t,e);const r=Math.ceil(e/t)+1,s=2**(t-1),n=2**t,i=Cc(t),o=BigInt(t);return{windows:r,windowSize:s,mask:i,maxNumber:n,shiftBy:o}}function lf(t,e,r){const{windowSize:s,mask:n,maxNumber:i,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>s&&(a-=i,c+=Vs);const l=e*s,u=l+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:f,offsetF:l}}function FS(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,s)=>{if(!(r instanceof e))throw new Error("invalid point at index "+s)})}function jS(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,s)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+s)})}const il=new WeakMap,Cm=new WeakMap;function ol(t){return Cm.get(t)||1}function uf(t){if(t!==Qn)throw new Error("invalid wNAF")}function qS(t,e){return{constTimeNegate:Ki,hasPrecomputes(r){return ol(r)!==1},unsafeLadder(r,s,n=t.ZERO){let i=r;for(;s>Qn;)s&Vs&&(n=n.add(i)),i=i.double(),s>>=Vs;return n},precomputeWindow(r,s){const{windows:n,windowSize:i}=nl(s,e),o=[];let a=r,c=a;for(let l=0;l<n;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,s,n){let i=t.ZERO,o=t.BASE;const a=nl(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:d,isNegF:f,offsetF:p}=lf(n,c,a);n=l,h?o=o.add(Ki(f,s[p])):i=i.add(Ki(d,s[u]))}return uf(n),{p:i,f:o}},wNAFUnsafe(r,s,n,i=t.ZERO){const o=nl(r,e);for(let a=0;a<o.windows&&n!==Qn;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=lf(n,a,o);if(n=c,!u){const d=s[l];i=i.add(h?d.negate():d)}}return uf(n),i},getPrecomputes(r,s,n){let i=il.get(s);return i||(i=this.precomputeWindow(s,r),r!==1&&(typeof n=="function"&&(i=n(i)),il.set(s,i))),i},wNAFCached(r,s,n){const i=ol(r);return this.wNAF(i,this.getPrecomputes(i,r,n),s)},wNAFCachedUnsafe(r,s,n,i){const o=ol(r);return o===1?this.unsafeLadder(r,s,i):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),s,i)},setWindowSize(r,s){Em(s,e),Cm.set(r,s),il.delete(r)}}}function zS(t,e,r,s){let n=e,i=t.ZERO,o=t.ZERO;for(;r>Qn||s>Qn;)r&Vs&&(i=i.add(n)),s&Vs&&(o=o.add(n)),n=n.double(),r>>=Vs,s>>=Vs;return{p1:i,p2:o}}function WS(t,e,r,s){FS(r,t),jS(s,e);const n=r.length,i=s.length;if(n!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=xS(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Cc(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let f=h;f>=0;f-=c){u.fill(o);for(let g=0;g<i;g++){const w=s[g],E=Number(w>>BigInt(f)&l);u[E]=u[E].add(r[g])}let p=o;for(let g=u.length-1,w=o;g>0;g--)w=w.add(u[g]),p=p.add(w);if(d=d.add(p),f!==0)for(let g=0;g<c;g++)d=d.double()}return d}function hf(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return kS(e),e}else return pi(t)}function HS(t,e,r={}){if(!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const o of["p","n","h"]){const a=e[o];if(!(typeof a=="bigint"&&a>Qn))throw new Error(`CURVE.${o} must be positive bigint`)}const s=hf(e.p,r.Fp),n=hf(e.n,r.Fn),i=["Gx","Gy","a","b"];for(const o of i)if(!s.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:s,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Si=BigInt(0),_n=BigInt(1),ba=BigInt(2);function KS(t){return Ac(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function VS(t){const e=KS(t),{P:r,type:s,adjustScalarBytes:n,powPminus2:i,randomBytes:o}=e,a=s==="x25519";if(!a&&s!=="x448")throw new Error("invalid type");const c=o||fi,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),f=a?ba**BigInt(254):ba**BigInt(447),p=a?BigInt(8)*ba**BigInt(251)-_n:BigInt(4)*ba**BigInt(445)-_n,g=f+p+_n,w=A=>rr(A,r),E=v(h);function v(A){return ah(w(A),u)}function C(A){const D=Pt("u coordinate",A,u);return a&&(D[31]&=127),w(sc(D))}function _(A){return sc(n(Pt("scalar",A,u)))}function S(A,D){const T=R(C(D),_(A));if(T===Si)throw new Error("invalid private or public key received");return v(T)}function k(A){return S(A,E)}function L(A,D,T){const O=w(A*(D-T));return D=w(D-O),T=w(T+O),{x_2:D,x_3:T}}function R(A,D){su("u",A,Si,r),su("scalar",D,f,g);const T=D,O=A;let $=_n,j=Si,m=A,b=_n,I=Si;for(let N=BigInt(l-1);N>=Si;N--){const P=T>>N&_n;I^=P,{x_2:$,x_3:m}=L(I,$,m),{x_2:j,x_3:b}=L(I,j,b),I=P;const M=$+j,G=w(M*M),X=$-j,K=w(X*X),Z=G-K,ae=m+b,Ie=m-b,Ce=w(Ie*M),he=w(ae*X),Fe=Ce+he,tt=Ce-he;m=w(Fe*Fe),b=w(O*w(tt*tt)),$=w(G*K),j=w(Z*(G+w(d*Z)))}({x_2:$,x_3:m}=L(I,$,m)),{x_2:j,x_3:b}=L(I,j,b);const x=i(j);return w($*x)}return{scalarMult:S,scalarMultBase:k,getSharedSecret:(A,D)=>S(A,D),getPublicKey:A=>k(A),utils:{randomPrivateKey:()=>c(u)},GuBytes:E.slice()}}BigInt(0);const GS=BigInt(1),df=BigInt(2),YS=BigInt(3),JS=BigInt(5);BigInt(8);const Am={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function XS(t){const e=BigInt(10),r=BigInt(20),s=BigInt(40),n=BigInt(80),i=Am.p,o=t*t%i*t%i,a=fr(o,df,i)*o%i,c=fr(a,GS,i)*t%i,l=fr(c,JS,i)*c%i,u=fr(l,e,i)*l%i,h=fr(u,r,i)*u%i,d=fr(h,s,i)*h%i,f=fr(d,n,i)*d%i,p=fr(f,n,i)*d%i,g=fr(p,e,i)*l%i;return{pow_p_5_8:fr(g,df,i)*t%i,b2:o}}function ZS(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const nu=(()=>{const t=Am.p;return VS({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:s}=XS(e);return rr(fr(r,YS,t)*s,t)},adjustScalarBytes:ZS})})();function ff(t){t.lowS!==void 0&&rc("lowS",t.lowS),t.prehash!==void 0&&rc("prehash",t.prehash)}class QS extends Error{constructor(e=""){super(e)}}const Gr={Err:QS,_tlv:{encode:(t,e)=>{const{Err:r}=Gr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const s=e.length/2,n=ya(s);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const i=s>127?ya(n.length/2|128):"";return ya(t)+i+n+e},decode(t,e){const{Err:r}=Gr;let s=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[s++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[s++],i=!!(n&128);let o=0;if(!i)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(s,s+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(s+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(s,s+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(s+o)}}},_int:{encode(t){const{Err:e}=Gr;if(t<Vi)throw new e("integer: negative integers are not allowed");let r=ya(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Gr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ec(t)}},toSig(t){const{Err:e,_int:r,_tlv:s}=Gr,n=Pt("signature",t),{v:i,l:o}=s.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=s.decode(2,i),{v:l,l:u}=s.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Gr,s=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),i=s+n;return e.encode(48,i)}},Vi=BigInt(0),Gi=BigInt(1),eN=BigInt(2),va=BigInt(3),tN=BigInt(4);function rN(t,e,r){function s(n){const i=t.sqr(n),o=t.mul(i,n);return t.add(t.add(o,t.mul(n,e)),r)}return s}function Im(t,e,r){const{BYTES:s}=t;function n(i){let o;if(typeof i=="bigint")o=i;else{let a=Pt("private key",i);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");const c=new Uint8Array(s);c.set(a,c.length-a.length),a=c}try{o=t.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${s}, got ${typeof i}`)}}if(r&&(o=t.create(o)),!t.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return n}function sN(t,e={}){const{Fp:r,Fn:s}=HS("weierstrass",t,e),{h:n,n:i}=t;Ac(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=e;if(o&&(!r.is0(t.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(R,A,D){const{x:T,y:O}=A.toAffine(),$=r.toBytes(T);if(rc("isCompressed",D),D){a();const j=!r.isOdd(O);return Hs(_m(j),$)}else return Hs(Uint8Array.of(4),$,r.toBytes(O))}function l(R){nr(R);const A=r.BYTES,D=A+1,T=2*A+1,O=R.length,$=R[0],j=R.subarray(1);if(O===D&&($===2||$===3)){const m=r.fromBytes(j);if(!r.isValid(m))throw new Error("bad point: is not on curve, wrong x");const b=d(m);let I;try{I=r.sqrt(b)}catch(N){const P=N instanceof Error?": "+N.message:"";throw new Error("bad point: is not on curve, sqrt error"+P)}a();const x=r.isOdd(I);return($&1)===1!==x&&(I=r.neg(I)),{x:m,y:I}}else if(O===T&&$===4){const m=r.fromBytes(j.subarray(A*0,A*1)),b=r.fromBytes(j.subarray(A*1,A*2));if(!f(m,b))throw new Error("bad point: is not on curve");return{x:m,y:b}}else throw new Error(`bad point: got length ${O}, expected compressed=${D} or uncompressed=${T}`)}const u=e.toBytes||c,h=e.fromBytes||l,d=rN(r,t.a,t.b);function f(R,A){const D=r.sqr(A),T=d(R);return r.eql(D,T)}if(!f(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const p=r.mul(r.pow(t.a,va),tN),g=r.mul(r.sqr(t.b),BigInt(27));if(r.is0(r.add(p,g)))throw new Error("bad curve params: a or b");function w(R,A,D=!1){if(!r.isValid(A)||D&&r.is0(A))throw new Error(`bad point coordinate ${R}`);return A}function E(R){if(!(R instanceof S))throw new Error("ProjectivePoint expected")}const v=of((R,A)=>{const{px:D,py:T,pz:O}=R;if(r.eql(O,r.ONE))return{x:D,y:T};const $=R.is0();A==null&&(A=$?r.ONE:r.inv(O));const j=r.mul(D,A),m=r.mul(T,A),b=r.mul(O,A);if($)return{x:r.ZERO,y:r.ZERO};if(!r.eql(b,r.ONE))throw new Error("invZ was invalid");return{x:j,y:m}}),C=of(R=>{if(R.is0()){if(e.allowInfinityPoint&&!r.is0(R.py))return;throw new Error("bad point: ZERO")}const{x:A,y:D}=R.toAffine();if(!r.isValid(A)||!r.isValid(D))throw new Error("bad point: x or y not field elements");if(!f(A,D))throw new Error("bad point: equation left != right");if(!R.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function _(R,A,D,T,O){return D=new S(r.mul(D.px,R),D.py,D.pz),A=Ki(T,A),D=Ki(O,D),A.add(D)}class S{constructor(A,D,T){this.px=w("x",A),this.py=w("y",D,!0),this.pz=w("z",T),Object.freeze(this)}static fromAffine(A){const{x:D,y:T}=A||{};if(!A||!r.isValid(D)||!r.isValid(T))throw new Error("invalid affine point");if(A instanceof S)throw new Error("projective point not allowed");return r.is0(D)&&r.is0(T)?S.ZERO:new S(D,T,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(A){return MS(S,"pz",A)}static fromBytes(A){return nr(A),S.fromHex(A)}static fromHex(A){const D=S.fromAffine(h(Pt("pointHex",A)));return D.assertValidity(),D}static fromPrivateKey(A){const D=Im(s,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return S.BASE.multiply(D(A))}static msm(A,D){return WS(S,s,A,D)}precompute(A=8,D=!0){return L.setWindowSize(this,A),D||this.multiply(va),this}_setWindowSize(A){this.precompute(A)}assertValidity(){C(this)}hasEvenY(){const{y:A}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(A)}equals(A){E(A);const{px:D,py:T,pz:O}=this,{px:$,py:j,pz:m}=A,b=r.eql(r.mul(D,m),r.mul($,O)),I=r.eql(r.mul(T,m),r.mul(j,O));return b&&I}negate(){return new S(this.px,r.neg(this.py),this.pz)}double(){const{a:A,b:D}=t,T=r.mul(D,va),{px:O,py:$,pz:j}=this;let m=r.ZERO,b=r.ZERO,I=r.ZERO,x=r.mul(O,O),N=r.mul($,$),P=r.mul(j,j),M=r.mul(O,$);return M=r.add(M,M),I=r.mul(O,j),I=r.add(I,I),m=r.mul(A,I),b=r.mul(T,P),b=r.add(m,b),m=r.sub(N,b),b=r.add(N,b),b=r.mul(m,b),m=r.mul(M,m),I=r.mul(T,I),P=r.mul(A,P),M=r.sub(x,P),M=r.mul(A,M),M=r.add(M,I),I=r.add(x,x),x=r.add(I,x),x=r.add(x,P),x=r.mul(x,M),b=r.add(b,x),P=r.mul($,j),P=r.add(P,P),x=r.mul(P,M),m=r.sub(m,x),I=r.mul(P,N),I=r.add(I,I),I=r.add(I,I),new S(m,b,I)}add(A){E(A);const{px:D,py:T,pz:O}=this,{px:$,py:j,pz:m}=A;let b=r.ZERO,I=r.ZERO,x=r.ZERO;const N=t.a,P=r.mul(t.b,va);let M=r.mul(D,$),G=r.mul(T,j),X=r.mul(O,m),K=r.add(D,T),Z=r.add($,j);K=r.mul(K,Z),Z=r.add(M,G),K=r.sub(K,Z),Z=r.add(D,O);let ae=r.add($,m);return Z=r.mul(Z,ae),ae=r.add(M,X),Z=r.sub(Z,ae),ae=r.add(T,O),b=r.add(j,m),ae=r.mul(ae,b),b=r.add(G,X),ae=r.sub(ae,b),x=r.mul(N,Z),b=r.mul(P,X),x=r.add(b,x),b=r.sub(G,x),x=r.add(G,x),I=r.mul(b,x),G=r.add(M,M),G=r.add(G,M),X=r.mul(N,X),Z=r.mul(P,Z),G=r.add(G,X),X=r.sub(M,X),X=r.mul(N,X),Z=r.add(Z,X),M=r.mul(G,Z),I=r.add(I,M),M=r.mul(ae,Z),b=r.mul(K,b),b=r.sub(b,M),M=r.mul(K,G),x=r.mul(ae,x),x=r.add(x,M),new S(b,I,x)}subtract(A){return this.add(A.negate())}is0(){return this.equals(S.ZERO)}multiply(A){const{endo:D}=e;if(!s.isValidNot0(A))throw new Error("invalid scalar: out of range");let T,O;const $=j=>L.wNAFCached(this,j,S.normalizeZ);if(D){const{k1neg:j,k1:m,k2neg:b,k2:I}=D.splitScalar(A),{p:x,f:N}=$(m),{p:P,f:M}=$(I);O=N.add(M),T=_(D.beta,x,P,j,b)}else{const{p:j,f:m}=$(A);T=j,O=m}return S.normalizeZ([T,O])[0]}multiplyUnsafe(A){const{endo:D}=e,T=this;if(!s.isValid(A))throw new Error("invalid scalar: out of range");if(A===Vi||T.is0())return S.ZERO;if(A===Gi)return T;if(L.hasPrecomputes(this))return this.multiply(A);if(D){const{k1neg:O,k1:$,k2neg:j,k2:m}=D.splitScalar(A),{p1:b,p2:I}=zS(S,T,$,m);return _(D.beta,b,I,O,j)}else return L.wNAFCachedUnsafe(T,A)}multiplyAndAddUnsafe(A,D,T){const O=this.multiplyUnsafe(D).add(A.multiplyUnsafe(T));return O.is0()?void 0:O}toAffine(A){return v(this,A)}isTorsionFree(){const{isTorsionFree:A}=e;return n===Gi?!0:A?A(S,this):L.wNAFCachedUnsafe(this,i).is0()}clearCofactor(){const{clearCofactor:A}=e;return n===Gi?this:A?A(S,this):this.multiplyUnsafe(n)}toBytes(A=!0){return rc("isCompressed",A),this.assertValidity(),u(S,this,A)}toRawBytes(A=!0){return this.toBytes(A)}toHex(A=!0){return ho(this.toBytes(A))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}S.BASE=new S(t.Gx,t.Gy,r.ONE),S.ZERO=new S(r.ZERO,r.ONE,r.ZERO),S.Fp=r,S.Fn=s;const k=s.BITS,L=qS(S,e.endo?Math.ceil(k/2):k);return S}function _m(t){return Uint8Array.of(t?2:3)}function nN(t,e,r={}){Ac(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const s=e.randomBytes||fi,n=e.hmac||((T,...O)=>bc(e.hash,T,Hs(...O))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o;function l(T){const O=a>>Gi;return T>O}function u(T){return l(T)?o.neg(T):T}function h(T,O){if(!o.isValidNot0(O))throw new Error(`invalid signature ${T}: out of range 1..CURVE.n`)}class d{constructor(O,$,j){h("r",O),h("s",$),this.r=O,this.s=$,j!=null&&(this.recovery=j),Object.freeze(this)}static fromCompact(O){const $=o.BYTES,j=Pt("compactSignature",O,$*2);return new d(o.fromBytes(j.subarray(0,$)),o.fromBytes(j.subarray($,$*2)))}static fromDER(O){const{r:$,s:j}=Gr.toSig(Pt("DER",O));return new d($,j)}assertValidity(){}addRecoveryBit(O){return new d(this.r,this.s,O)}recoverPublicKey(O){const $=i.ORDER,{r:j,s:m,recovery:b}=this;if(b==null||![0,1,2,3].includes(b))throw new Error("recovery id invalid");if(a*eN<$&&b>1)throw new Error("recovery id is ambiguous for h>1 curve");const I=b===2||b===3?j+a:j;if(!i.isValid(I))throw new Error("recovery id 2 or 3 invalid");const x=i.toBytes(I),N=t.fromHex(Hs(_m((b&1)===0),x)),P=o.inv(I),M=C(Pt("msgHash",O)),G=o.create(-M*P),X=o.create(m*P),K=t.BASE.multiplyUnsafe(G).add(N.multiplyUnsafe(X));if(K.is0())throw new Error("point at infinify");return K.assertValidity(),K}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,o.neg(this.s),this.recovery):this}toBytes(O){if(O==="compact")return Hs(o.toBytes(this.r),o.toBytes(this.s));if(O==="der")return rh(Gr.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return ho(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return ho(this.toBytes("compact"))}}const f=Im(o,r.allowedPrivateKeyLengths,r.wrapPrivateKey),p={isValidPrivateKey(T){try{return f(T),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const T=a;return LS(s(vm(T)),T)},precompute(T=8,O=t.BASE){return O.precompute(T,!1)}};function g(T,O=!0){return t.fromPrivateKey(T).toBytes(O)}function w(T){if(typeof T=="bigint")return!1;if(T instanceof t)return!0;const O=Pt("key",T).length,$=i.BYTES,j=$+1,m=2*$+1;if(!(r.allowedPrivateKeyLengths||o.BYTES===j))return O===j||O===m}function E(T,O,$=!0){if(w(T)===!0)throw new Error("first arg must be private key");if(w(O)===!1)throw new Error("second arg must be public key");return t.fromHex(O).multiply(f(T)).toBytes($)}const v=e.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const O=Ec(T),$=T.length*8-c;return $>0?O>>BigInt($):O},C=e.bits2int_modN||function(T){return o.create(v(T))},_=Cc(c);function S(T){return su("num < 2^"+c,T,Vi,_),o.toBytes(T)}function k(T,O,$=L){if(["recovered","canonical"].some(K=>K in $))throw new Error("sign() legacy options not supported");const{hash:j}=e;let{lowS:m,prehash:b,extraEntropy:I}=$;m==null&&(m=!0),T=Pt("msgHash",T),ff($),b&&(T=Pt("prehashed msgHash",j(T)));const x=C(T),N=f(O),P=[S(N),S(x)];if(I!=null&&I!==!1){const K=I===!0?s(i.BYTES):I;P.push(Pt("extraEntropy",K))}const M=Hs(...P),G=x;function X(K){const Z=v(K);if(!o.isValidNot0(Z))return;const ae=o.inv(Z),Ie=t.BASE.multiply(Z).toAffine(),Ce=o.create(Ie.x);if(Ce===Vi)return;const he=o.create(ae*o.create(G+Ce*N));if(he===Vi)return;let Fe=(Ie.x===Ce?0:2)|Number(Ie.y&Gi),tt=he;return m&&l(he)&&(tt=u(he),Fe^=1),new d(Ce,tt,Fe)}return{seed:M,k2sig:X}}const L={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function A(T,O,$=L){const{seed:j,k2sig:m}=k(T,O,$);return OS(e.hash.outputLen,o.BYTES,n)(j,m)}t.BASE.precompute(8);function D(T,O,$,j=R){const m=T;O=Pt("msgHash",O),$=Pt("publicKey",$),ff(j);const{lowS:b,prehash:I,format:x}=j;if("strict"in j)throw new Error("options.strict was renamed to lowS");if(x!==void 0&&!["compact","der","js"].includes(x))throw new Error('format must be "compact", "der" or "js"');const N=typeof m=="string"||Qu(m),P=!N&&!x&&typeof m=="object"&&m!==null&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!N&&!P)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let M,G;try{if(P)if(x===void 0||x==="js")M=new d(m.r,m.s);else throw new Error("invalid format");if(N){try{x!=="compact"&&(M=d.fromDER(m))}catch(Fe){if(!(Fe instanceof Gr.Err))throw Fe}!M&&x!=="der"&&(M=d.fromCompact(m))}G=t.fromHex($)}catch{return!1}if(!M||b&&M.hasHighS())return!1;I&&(O=e.hash(O));const{r:X,s:K}=M,Z=C(O),ae=o.inv(K),Ie=o.create(Z*ae),Ce=o.create(X*ae),he=t.BASE.multiplyUnsafe(Ie).add(G.multiplyUnsafe(Ce));return he.is0()?!1:o.create(he.x)===X}return Object.freeze({getPublicKey:g,getSharedSecret:E,sign:A,verify:D,utils:p,Point:t,Signature:d})}function iN(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,s=pi(e.n,t.nBitLength),n={Fp:r,Fn:s,allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:n}}function oN(t){const{CURVE:e,curveOpts:r}=iN(t),s={hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,ecdsaOpts:s}}function aN(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}function cN(t){const{CURVE:e,curveOpts:r,ecdsaOpts:s}=oN(t),n=sN(e,r),i=nN(n,s,r);return aN(t,i)}function iu(t,e){const r=s=>cN({...t,hash:s});return{...r(e),create:r}}const Sm={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Nm={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},xm={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},lN=pi(Sm.p),uN=pi(Nm.p),hN=pi(xm.p),dN=iu({...Sm,Fp:lN,lowS:!1},yc);iu({...Nm,Fp:uN,lowS:!1},v_),iu({...xm,Fp:hN,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},b_);const fN=dN,Om="base10",vt="base16",wr="base64pad",ys="base64url",Jo="utf8",Tm=0,Jr=1,Xo=2,pN=0,pf=1,Yi=12,ch=32;function gN(){const t=nu.utils.randomPrivateKey(),e=nu.getPublicKey(t);return{privateKey:Rt(t,vt),publicKey:Rt(e,vt)}}function ou(){const t=fi(ch);return Rt(t,vt)}function wN(t,e){const r=nu.getSharedSecret(sr(t,vt),sr(e,vt)),s=SS(vc,r,void 0,void 0,ch);return Rt(s,vt)}function Fa(t){const e=vc(sr(t,vt));return Rt(e,vt)}function xr(t){const e=vc(sr(t,Jo));return Rt(e,vt)}function Pm(t){return sr(`${t}`,Om)}function nn(t){return Number(Rt(t,Om))}function Dm(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function $m(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function mN(t){const e=Pm(typeof t.type<"u"?t.type:Tm);if(nn(e)===Jr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?sr(t.senderPublicKey,vt):void 0,s=typeof t.iv<"u"?sr(t.iv,vt):fi(Yi),n=sr(t.symKey,vt),i=hm(n,s).encrypt(sr(t.message,Jo)),o=Rm({type:e,sealed:i,iv:s,senderPublicKey:r});return t.encoding===ys?Dm(o):o}function yN(t){const e=sr(t.symKey,vt),{sealed:r,iv:s}=po({encoded:t.encoded,encoding:t.encoding}),n=hm(e,s).decrypt(r);if(n===null)throw new Error("Failed to decrypt");return Rt(n,Jo)}function bN(t,e){const r=Pm(Xo),s=fi(Yi),n=sr(t,Jo),i=Rm({type:r,sealed:n,iv:s});return e===ys?Dm(i):i}function vN(t,e){const{sealed:r}=po({encoded:t,encoding:e});return Rt(r,Jo)}function Rm(t){if(nn(t.type)===Xo)return Rt(Hi([t.type,t.sealed]),wr);if(nn(t.type)===Jr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Rt(Hi([t.type,t.senderPublicKey,t.iv,t.sealed]),wr)}return Rt(Hi([t.type,t.iv,t.sealed]),wr)}function po(t){const e=(t.encoding||wr)===ys?$m(t.encoded):t.encoded,r=sr(e,wr),s=r.slice(pN,pf),n=pf;if(nn(s)===Jr){const c=n+ch,l=c+Yi,u=r.slice(n,c),h=r.slice(c,l),d=r.slice(l);return{type:s,sealed:d,iv:h,senderPublicKey:u}}if(nn(s)===Xo){const c=r.slice(n),l=fi(Yi);return{type:s,sealed:c,iv:l}}const i=n+Yi,o=r.slice(n,i),a=r.slice(i);return{type:s,sealed:a,iv:o}}function EN(t,e){const r=po({encoded:t,encoding:e==null?void 0:e.encoding});return km({type:nn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Rt(r.senderPublicKey,vt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function km(t){const e=(t==null?void 0:t.type)||Tm;if(e===Jr){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function gf(t){return t.type===Jr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function wf(t){return t.type===Xo}function CN(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Hi([new Uint8Array([4]),e,r])}function AN(t,e){const[r,s,n]=t.split("."),i=Buffer.from($m(n),"base64");if(i.length!==64)throw new Error("Invalid signature length");const o=i.slice(0,32),a=i.slice(32,64),c=`${r}.${s}`,l=vc(c),u=CN(e);if(!fN.verify(Hi([o,a]),l,u))throw new Error("Invalid signature");return jl(t).payload}const IN="irn";function nc(t){return(t==null?void 0:t.relay)||{protocol:IN}}function Fi(t){const e=ZA[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function _N(t,e="-"){const r={},s="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(s)){const i=n.replace(s,""),o=t[n];r[i]=o}}),r}function mf(t){if(!t.includes("wc:")){const l=Kw(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,s=t.substring(0,e),n=t.substring(e+1,r).split("@"),i=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(i),a={};o.forEach((l,u)=>{a[u]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:s,topic:SN(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:_N(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function SN(t){return t.startsWith("//")?t.substring(2):t}function NN(t,e="-"){const r="relay",s={};return Object.keys(t).forEach(n=>{const i=n,o=r+e+i;t[i]&&(s[o]=t[i])}),s}function yf(t){const e=new URLSearchParams,r=NN(t.relay);Object.keys(r).sort().forEach(n=>{e.set(n,r[n])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const s=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${s}`}function Ea(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var xN=Object.defineProperty,ON=Object.defineProperties,TN=Object.getOwnPropertyDescriptors,bf=Object.getOwnPropertySymbols,PN=Object.prototype.hasOwnProperty,DN=Object.prototype.propertyIsEnumerable,vf=(t,e,r)=>e in t?xN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$N=(t,e)=>{for(var r in e||(e={}))PN.call(e,r)&&vf(t,r,e[r]);if(bf)for(var r of bf(e))DN.call(e,r)&&vf(t,r,e[r]);return t},RN=(t,e)=>ON(t,TN(e));function gi(t){const e=[];return t.forEach(r=>{const[s,n]=r.split(":");e.push(`${s}:${n}`)}),e}function kN(t){const e=[];return Object.values(t).forEach(r=>{e.push(...gi(r.accounts))}),e}function UN(t,e){const r=[];return Object.values(t).forEach(s=>{gi(s.accounts).includes(e)&&r.push(...s.methods)}),r}function BN(t,e){const r=[];return Object.values(t).forEach(s=>{gi(s.accounts).includes(e)&&r.push(...s.events)}),r}function Ic(t){return t.includes(":")}function Hn(t){return Ic(t)?t.split(":")[0]:t}function Ef(t){var e,r,s;const n={};if(!Rr(t))return n;for(const[i,o]of Object.entries(t)){const a=Ic(i)?[i]:o.chains,c=o.methods||[],l=o.events||[],u=Hn(i);n[u]=RN($N({},n[u]),{chains:$r(a,(e=n[u])==null?void 0:e.chains),methods:$r(c,(r=n[u])==null?void 0:r.methods),events:$r(l,(s=n[u])==null?void 0:s.events)})}return n}function LN(t){const e={};return t==null||t.forEach(r=>{var s;const[n,i]=r.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(r),(s=e[n].chains)==null||s.push(`${n}:${i}`)}),e}function Cf(t,e){e=e.map(s=>s.replace("did:pkh:",""));const r=LN(e);for(const[s,n]of Object.entries(r))n.methods?n.methods=$r(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return r}function MN(t,e){var r,s,n,i,o,a;const c=Ef(t),l=Ef(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const d of h)u[d]={chains:$r((r=c[d])==null?void 0:r.chains,(s=l[d])==null?void 0:s.chains),methods:$r((n=c[d])==null?void 0:n.methods,(i=l[d])==null?void 0:i.methods),events:$r((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}const FN={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},jN={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(t,e){const{message:r,code:s}=jN[t];return{message:e?`${r} ${e}`:r,code:s}}function Me(t,e){const{message:r,code:s}=FN[t];return{message:e?`${r} ${e}`:r,code:s}}function Xr(t,e){return!!Array.isArray(t)}function Rr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function ot(t){return typeof t>"u"}function We(t,e){return e&&ot(t)?!0:typeof t=="string"&&!!t.trim().length}function lh(t,e){return e&&ot(t)?!0:typeof t=="number"&&!isNaN(t)}function qN(t,e){const{requiredNamespaces:r}=e,s=Object.keys(t.namespaces),n=Object.keys(r);let i=!0;return Ws(n,s)?(s.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=gi(a),h=r[o];(!Ws(jw(o,h),u)||!Ws(h.methods,c)||!Ws(h.events,l))&&(i=!1)}),i):!1}function ic(t){return We(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function zN(t){if(We(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&ic(r)}}return!1}function WN(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(We(t,!1)){if(e(t))return!0;const r=Kw(t);return e(r)}}catch{}return!1}function HN(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function KN(t){return t==null?void 0:t.topic}function VN(t,e){let r=null;return We(t==null?void 0:t.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Af(t){let e=!0;return Xr(t)?t.length&&(e=t.every(r=>We(r,!1))):e=!1,e}function GN(t,e,r){let s=null;return Xr(e)&&e.length?e.forEach(n=>{s||ic(n)||(s=Me("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):ic(t)||(s=Me("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function YN(t,e,r){let s=null;return Object.entries(t).forEach(([n,i])=>{if(s)return;const o=GN(n,jw(n,i),`${e} ${r}`);o&&(s=o)}),s}function JN(t,e){let r=null;return Xr(t)?t.forEach(s=>{r||zN(s)||(r=Me("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=Me("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function XN(t,e){let r=null;return Object.values(t).forEach(s=>{if(r)return;const n=JN(s==null?void 0:s.accounts,`${e} namespace`);n&&(r=n)}),r}function ZN(t,e){let r=null;return Af(t==null?void 0:t.methods)?Af(t==null?void 0:t.events)||(r=Me("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Me("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Um(t,e){let r=null;return Object.values(t).forEach(s=>{if(r)return;const n=ZN(s,`${e}, namespace`);n&&(r=n)}),r}function QN(t,e,r){let s=null;if(t&&Rr(t)){const n=Um(t,e);n&&(s=n);const i=YN(t,e,r);i&&(s=i)}else s=z("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return s}function al(t,e){let r=null;if(t&&Rr(t)){const s=Um(t,e);s&&(r=s);const n=XN(t,e);n&&(r=n)}else r=z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Bm(t){return We(t.protocol,!0)}function ex(t,e){let r=!1;return t?t&&Xr(t)&&t.length&&t.forEach(s=>{r=Bm(s)}):r=!0,r}function tx(t){return typeof t=="number"}function Tt(t){return typeof t<"u"&&typeof t!==null}function rx(t){return!(!t||typeof t!="object"||!t.code||!lh(t.code,!1)||!t.message||!We(t.message,!1))}function sx(t){return!(ot(t)||!We(t.method,!1))}function nx(t){return!(ot(t)||ot(t.result)&&ot(t.error)||!lh(t.id,!1)||!We(t.jsonrpc,!1))}function ix(t){return!(ot(t)||!We(t.name,!1))}function If(t,e){return!(!ic(e)||!kN(t).includes(e))}function ox(t,e,r){return We(r,!1)?UN(t,e).includes(r):!1}function ax(t,e,r){return We(r,!1)?BN(t,e).includes(r):!1}function _f(t,e,r){let s=null;const n=cx(t),i=lx(e),o=Object.keys(n),a=Object.keys(i),c=Sf(Object.keys(t)),l=Sf(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Ws(o,a)||(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||s)return;const d=gi(e[h].accounts);d.includes(h)||(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{s||(Ws(n[h].methods,i[h].methods)?Ws(n[h].events,i[h].events)||(s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):s=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),s}function cx(t){const e={};return Object.keys(t).forEach(r=>{var s;r.includes(":")?e[r]=t[r]:(s=t[r].chains)==null||s.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Sf(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function lx(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const s=gi(t[r].accounts);s==null||s.forEach(n=>{e[n]={accounts:t[r].accounts.filter(i=>i.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function ux(t,e){return lh(t,!1)&&t<=e.max&&t>=e.min}function Nf(){const t=Go();return new Promise(e=>{switch(t){case Ht.browser:e(hx());break;case Ht.reactNative:e(dx());break;case Ht.node:e(fx());break;default:e(!0)}})}function hx(){return di()&&(navigator==null?void 0:navigator.onLine)}async function dx(){if(Os()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function fx(){return!0}function px(t){switch(Go()){case Ht.browser:gx(t);break;case Ht.reactNative:wx(t);break}}function gx(t){!Os()&&di()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function wx(t){Os()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function mx(){var t;return di()&&rn()?((t=rn())==null?void 0:t.visibilityState)==="visible":!0}const cl={};class Ni{static get(e){return cl[e]}static set(e,r){cl[e]=r}static delete(e){delete cl[e]}}function yx(t){const e=hi.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function bx({publicKey:t,signature:e,payload:r}){var s;const n=au(r.method),i=128|parseInt(((s=r.version)==null?void 0:s.toString())||"4"),o=Cx(r.address),a=r.era==="00"?new Uint8Array([0]):au(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${Ex(r.tip)}`),h=Ix(u),d=new Uint8Array([0,...t,o,...e,...a,...l,...h,...n]),f=Ax(d.length+1);return new Uint8Array([...f,i,...d])}function vx(t){const e=au(t),r=uI.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function au(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Ex(t){return t.startsWith("0x")?t.slice(2):t}function Cx(t){const e=hi.decode(t)[0];return e===42?0:e===60?2:1}function Ax(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function Ix(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function _x(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=yx(t.transaction.address),s=bx({publicKey:r,signature:e,payload:t.transaction}),n=Buffer.from(s).toString("hex");return vx(n)}const Sx="PARSE_ERROR",Nx="INVALID_REQUEST",xx="METHOD_NOT_FOUND",Ox="INVALID_PARAMS",Lm="INTERNAL_ERROR",uh="SERVER_ERROR",Tx=[-32700,-32600,-32601,-32602,-32603],Ji={[Sx]:{code:-32700,message:"Parse error"},[Nx]:{code:-32600,message:"Invalid Request"},[xx]:{code:-32601,message:"Method not found"},[Ox]:{code:-32602,message:"Invalid params"},[Lm]:{code:-32603,message:"Internal error"},[uh]:{code:-32e3,message:"Server error"}},Mm=uh;function Px(t){return Tx.includes(t)}function xf(t){return Object.keys(Ji).includes(t)?Ji[t]:Ji[Mm]}function Dx(t){const e=Object.values(Ji).find(r=>r.code===t);return e||Ji[Mm]}function Fm(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var jm={},qr={},Of;function $x(){if(Of)return qr;Of=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.isBrowserCryptoAvailable=qr.getSubtleCrypto=qr.getBrowerCrypto=void 0;function t(){return(Nr===null||Nr===void 0?void 0:Nr.crypto)||(Nr===null||Nr===void 0?void 0:Nr.msCrypto)||{}}qr.getBrowerCrypto=t;function e(){const s=t();return s.subtle||s.webkitSubtle}qr.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return qr.isBrowserCryptoAvailable=r,qr}var zr={},Tf;function Rx(){if(Tf)return zr;Tf=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.isBrowser=zr.isNode=zr.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}zr.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}zr.isNode=e;function r(){return!t()&&!e()}return zr.isBrowser=r,zr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jo;e.__exportStar($x(),t),e.__exportStar(Rx(),t)})(jm);function _r(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Gs(t=6){return BigInt(_r(t))}function Es(t,e,r){return{id:r||_r(),jsonrpc:"2.0",method:t,params:e}}function _c(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Sc(t,e,r){return{id:t,jsonrpc:"2.0",error:kx(e)}}function kx(t,e){return typeof t>"u"?xf(Lm):(typeof t=="string"&&(t=Object.assign(Object.assign({},xf(uh)),{message:t})),Px(t.code)&&(t=Dx(t.code)),t)}let Ux=class{},Bx=class extends Ux{constructor(){super()}},Lx=class extends Bx{constructor(e){super()}};const Mx="^https?:",Fx="^wss?:";function jx(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function qm(t,e){const r=jx(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Pf(t){return qm(t,Mx)}function Df(t){return qm(t,Fx)}function qx(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function zm(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function hh(t){return zm(t)&&"method"in t}function Nc(t){return zm(t)&&(Sr(t)||tr(t))}function Sr(t){return"result"in t}function tr(t){return"error"in t}let ar=class extends Lx{constructor(e){super(e),this.events=new or.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Es(e.method,e.params||[],e.id||Gs().toString()),r)}async requestStrict(e,r){return new Promise(async(s,n)=>{if(!this.connection.connected)try{await this.open()}catch(i){n(i)}this.events.on(`${e.id}`,i=>{tr(i)?n(i.error):s(i.result)});try{await this.connection.send(e,r)}catch(i){n(i)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Nc(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const zx=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Wx=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",$f=t=>t.split("?")[0],Rf=10,Hx=zx();let Kx=class{constructor(e){if(this.url=e,this.events=new or.EventEmitter,this.registering=!1,!Df(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Qr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Df(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,n)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),n(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,s)=>{const n=jm.isReactNative()?void 0:{rejectUnauthorized:!qx(e)},i=new Hx(e,[],n);Wx()?i.onerror=o=>{const a=o;s(this.emitError(a.error))}:i.on("error",o=>{s(this.emitError(o))}),i.onopen=()=>{this.onOpen(i),r(i)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?tn(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const s=this.parseError(r),n=s.message||s.toString(),i=Sc(e,n);this.events.emit("payload",i)}parseError(e,r=this.url){return Fm(e,$f(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Rf&&this.events.setMaxListeners(Rf)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${$f(this.url)}`));return this.events.emit("register_error",r),r}};var Vx={};const Wm="wc",Hm=2,cu="core",Ur=`${Wm}@2:${cu}:`,Gx={logger:"error"},Yx={database:":memory:"},Jx="crypto",kf="client_ed25519_seed",Xx=W.ONE_DAY,Zx="keychain",Qx="0.3",e3="messages",t3="0.3",Uf=W.SIX_HOURS,r3="publisher",Km="irn",s3="error",Vm="wss://relay.walletconnect.org",n3="relayer",Ze={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},i3="_subscription",Yt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},o3=.1,lu="2.21.5",Be={link_mode:"link_mode",relay:"relay"},ja={inbound:"inbound",outbound:"outbound"},a3="0.3",c3="WALLETCONNECT_CLIENT_ID",Bf="WALLETCONNECT_LINK_MODE_APPS",Ft={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},l3="subscription",u3="0.3",h3="pairing",d3="0.3",xi={wc_pairingDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:W.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:W.ONE_DAY,prompt:!1,tag:0},res:{ttl:W.ONE_DAY,prompt:!1,tag:0}}},qs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ur={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},f3="history",p3="0.3",g3="expirer",er={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},w3="0.3",m3="verify-api",y3="https://verify.walletconnect.com",Gm="https://verify.walletconnect.org",Xi=Gm,b3=`${Xi}/v3`,v3=[y3,Gm],E3="echo",C3="https://echo.walletconnect.com",Ir={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Vr={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},hr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},$s={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Rs={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Oi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},A3=.1,I3="event-client",_3=86400,S3="https://pulse.walletconnect.org/batch";function N3(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,E=0,v=p.length;E!==v&&p[E]===0;)E++,g++;for(var C=(v-E)*u+1>>>0,_=new Uint8Array(C);E!==v;){for(var S=p[E],k=0,L=C-1;(S!==0||k<w)&&L!==-1;L--,k++)S+=256*_[L]>>>0,_[L]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=k,E++}for(var R=C-w;R!==C&&_[R]===0;)R++;for(var A=c.repeat(g);R<C;++R)A+=t.charAt(_[R]);return A}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,E=0;p[g]===c;)w++,g++;for(var v=(p.length-g)*l+1>>>0,C=new Uint8Array(v);p[g];){var _=r[p.charCodeAt(g)];if(_===255)return;for(var S=0,k=v-1;(_!==0||S<E)&&k!==-1;k--,S++)_+=a*C[k]>>>0,C[k]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");E=S,g++}if(p[g]!==" "){for(var L=v-E;L!==v&&C[L]===0;)L++;for(var R=new Uint8Array(w+(v-L)),A=w;L!==v;)R[A++]=C[L++];return R}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var x3=N3,O3=x3;const Ym=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},T3=t=>new TextEncoder().encode(t),P3=t=>new TextDecoder().decode(t);class D3{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class $3{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Jm(this,e)}}class R3{constructor(e){this.decoders=e}or(e){return Jm(this,e)}decode(e){const r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Jm=(t,e)=>new R3({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class k3{constructor(e,r,s,n){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=n,this.encoder=new D3(e,r,s),this.decoder=new $3(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const xc=({name:t,prefix:e,encode:r,decode:s})=>new k3(t,e,r,s),Zo=({prefix:t,name:e,alphabet:r})=>{const{encode:s,decode:n}=O3(r,e);return xc({prefix:t,name:e,encode:s,decode:i=>Ym(n(i))})},U3=(t,e,r,s)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*r/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},B3=(t,e,r)=>{const s=e[e.length-1]==="=",n=(1<<r)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,i+=e[n&a>>o];if(o&&(i+=e[n&a<<r-o]),s)for(;i.length*r&7;)i+="=";return i},ut=({name:t,prefix:e,bitsPerChar:r,alphabet:s})=>xc({prefix:e,name:t,encode(n){return B3(n,s,r)},decode(n){return U3(n,s,r,t)}}),L3=xc({prefix:"\0",name:"identity",encode:t=>P3(t),decode:t=>T3(t)});var M3=Object.freeze({__proto__:null,identity:L3});const F3=ut({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var j3=Object.freeze({__proto__:null,base2:F3});const q3=ut({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var z3=Object.freeze({__proto__:null,base8:q3});const W3=Zo({prefix:"9",name:"base10",alphabet:"0123456789"});var H3=Object.freeze({__proto__:null,base10:W3});const K3=ut({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),V3=ut({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var G3=Object.freeze({__proto__:null,base16:K3,base16upper:V3});const Y3=ut({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),J3=ut({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),X3=ut({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Z3=ut({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Q3=ut({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eO=ut({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),tO=ut({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rO=ut({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),sO=ut({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var nO=Object.freeze({__proto__:null,base32:Y3,base32upper:J3,base32pad:X3,base32padupper:Z3,base32hex:Q3,base32hexupper:eO,base32hexpad:tO,base32hexpadupper:rO,base32z:sO});const iO=Zo({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),oO=Zo({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var aO=Object.freeze({__proto__:null,base36:iO,base36upper:oO});const cO=Zo({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),lO=Zo({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var uO=Object.freeze({__proto__:null,base58btc:cO,base58flickr:lO});const hO=ut({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),dO=ut({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),fO=ut({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),pO=ut({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var gO=Object.freeze({__proto__:null,base64:hO,base64pad:dO,base64url:fO,base64urlpad:pO});const Xm=Array.from(""),wO=Xm.reduce((t,e,r)=>(t[r]=e,t),[]),mO=Xm.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function yO(t){return t.reduce((e,r)=>(e+=wO[r],e),"")}function bO(t){const e=[];for(const r of t){const s=mO[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}const vO=xc({prefix:"",name:"base256emoji",encode:yO,decode:bO});var EO=Object.freeze({__proto__:null,base256emoji:vO}),CO=Zm,Lf=128,AO=-128,IO=Math.pow(2,31);function Zm(t,e,r){e=e||[],r=r||0;for(var s=r;t>=IO;)e[r++]=t&255|Lf,t/=128;for(;t&AO;)e[r++]=t&255|Lf,t>>>=7;return e[r]=t|0,Zm.bytes=r-s+1,e}var _O=uu,SO=128,Mf=127;function uu(t,s){var r=0,s=s||0,n=0,i=s,o,a=t.length;do{if(i>=a)throw uu.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=n<28?(o&Mf)<<n:(o&Mf)*Math.pow(2,n),n+=7}while(o>=SO);return uu.bytes=i-s,r}var NO=Math.pow(2,7),xO=Math.pow(2,14),OO=Math.pow(2,21),TO=Math.pow(2,28),PO=Math.pow(2,35),DO=Math.pow(2,42),$O=Math.pow(2,49),RO=Math.pow(2,56),kO=Math.pow(2,63),UO=function(t){return t<NO?1:t<xO?2:t<OO?3:t<TO?4:t<PO?5:t<DO?6:t<$O?7:t<RO?8:t<kO?9:10},BO={encode:CO,decode:_O,encodingLength:UO},Qm=BO;const Ff=(t,e,r=0)=>(Qm.encode(t,e,r),e),jf=t=>Qm.encodingLength(t),hu=(t,e)=>{const r=e.byteLength,s=jf(t),n=s+jf(r),i=new Uint8Array(n+r);return Ff(t,i,0),Ff(r,i,s),i.set(e,n),new LO(t,r,e,i)};class LO{constructor(e,r,s,n){this.code=e,this.size=r,this.digest=s,this.bytes=n}}const e0=({name:t,code:e,encode:r})=>new MO(t,e,r);class MO{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?hu(this.code,r):r.then(s=>hu(this.code,s))}else throw Error("Unknown type, must be binary type")}}const t0=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),FO=e0({name:"sha2-256",code:18,encode:t0("SHA-256")}),jO=e0({name:"sha2-512",code:19,encode:t0("SHA-512")});var qO=Object.freeze({__proto__:null,sha256:FO,sha512:jO});const r0=0,zO="identity",s0=Ym,WO=t=>hu(r0,s0(t)),HO={code:r0,name:zO,encode:s0,digest:WO};var KO=Object.freeze({__proto__:null,identity:HO});new TextEncoder,new TextDecoder;const qf={...M3,...j3,...z3,...H3,...G3,...nO,...aO,...uO,...gO,...EO};({...qO,...KO});function n0(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function VO(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?n0(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function i0(t,e,r,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:s}}}const zf=i0("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ll=i0("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=VO(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),GO={utf8:zf,"utf-8":zf,hex:qf.base16,latin1:ll,ascii:ll,binary:ll,...qf};function YO(t,e="utf8"){const r=GO[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?n0(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var JO=Object.defineProperty,XO=(t,e,r)=>e in t?JO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Er=(t,e,r)=>XO(t,typeof e!="symbol"?e+"":e,r);let ZO=class{constructor(e,r){this.core=e,this.logger=r,Er(this,"keychain",new Map),Er(this,"name",Zx),Er(this,"version",Qx),Er(this,"initialized",!1),Er(this,"storagePrefix",Ur),Er(this,"init",async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}}),Er(this,"has",s=>(this.isInitialized(),this.keychain.has(s))),Er(this,"set",async(s,n)=>{this.isInitialized(),this.keychain.set(s,n),await this.persist()}),Er(this,"get",s=>{this.isInitialized();const n=this.keychain.get(s);if(typeof n>"u"){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(i)}return n}),Er(this,"del",async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()}),this.core=e,this.logger=Et(r,this.name)}get context(){return kt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Yl(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Jl(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}};var QO=Object.defineProperty,eT=(t,e,r)=>e in t?QO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nt=(t,e,r)=>eT(t,typeof e!="symbol"?e+"":e,r);class tT{constructor(e,r,s){this.core=e,this.logger=r,nt(this,"name",Jx),nt(this,"keychain"),nt(this,"randomSessionIdentifier",ou()),nt(this,"initialized",!1),nt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),nt(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),nt(this,"getClientId",async()=>{this.isInitialized();const n=await this.getClientSeed(),i=md(n);return ew(i.publicKey)}),nt(this,"generateKeyPair",()=>{this.isInitialized();const n=gN();return this.setPrivateKey(n.publicKey,n.privateKey)}),nt(this,"signJWT",async n=>{this.isInitialized();const i=await this.getClientSeed(),o=md(i),a=this.randomSessionIdentifier;return await sC(a,n,Xx,o)}),nt(this,"generateSharedKey",(n,i,o)=>{this.isInitialized();const a=this.getPrivateKey(n),c=wN(a,i);return this.setSymKey(c,o)}),nt(this,"setSymKey",async(n,i)=>{this.isInitialized();const o=i||Fa(n);return await this.keychain.set(o,n),o}),nt(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),nt(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),nt(this,"encode",async(n,i,o)=>{this.isInitialized();const a=km(o),c=Qr(i);if(wf(a))return bN(c,o==null?void 0:o.encoding);if(gf(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;n=await this.generateSharedKey(d,f)}const l=this.getSymKey(n),{type:u,senderPublicKey:h}=a;return mN({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),nt(this,"decode",async(n,i,o)=>{this.isInitialized();const a=EN(i,o);if(wf(a)){const c=vN(i,o==null?void 0:o.encoding);return tn(c)}if(gf(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;n=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(n),l=yN({symKey:c,encoded:i,encoding:o==null?void 0:o.encoding});return tn(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),nt(this,"getPayloadType",(n,i=wr)=>{const o=po({encoded:n,encoding:i});return nn(o.type)}),nt(this,"getPayloadSenderPublicKey",(n,i=wr)=>{const o=po({encoded:n,encoding:i});return o.senderPublicKey?Rt(o.senderPublicKey,vt):void 0}),this.core=e,this.logger=Et(r,this.name),this.keychain=s||new ZO(this.core,this.logger)}get context(){return kt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(kf)}catch{e=ou(),await this.keychain.set(kf,e)}return YO(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var rT=Object.defineProperty,sT=Object.defineProperties,nT=Object.getOwnPropertyDescriptors,Wf=Object.getOwnPropertySymbols,iT=Object.prototype.hasOwnProperty,oT=Object.prototype.propertyIsEnumerable,du=(t,e,r)=>e in t?rT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,aT=(t,e)=>{for(var r in e||(e={}))iT.call(e,r)&&du(t,r,e[r]);if(Wf)for(var r of Wf(e))oT.call(e,r)&&du(t,r,e[r]);return t},cT=(t,e)=>sT(t,nT(e)),Lt=(t,e,r)=>du(t,typeof e!="symbol"?e+"":e,r);class lT extends tv{constructor(e,r){super(e,r),this.logger=e,this.core=r,Lt(this,"messages",new Map),Lt(this,"messagesWithoutClientAck",new Map),Lt(this,"name",e3),Lt(this,"version",t3),Lt(this,"initialized",!1),Lt(this,"storagePrefix",Ur),Lt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s);const n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}}),Lt(this,"set",async(s,n,i)=>{this.isInitialized();const o=xr(n);let a=this.messages.get(s);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(s,a),i===ja.inbound){const c=this.messagesWithoutClientAck.get(s)||{};this.messagesWithoutClientAck.set(s,cT(aT({},c),{[o]:n}))}return await this.persist(),o}),Lt(this,"get",s=>{this.isInitialized();let n=this.messages.get(s);return typeof n>"u"&&(n={}),n}),Lt(this,"getWithoutAck",s=>{this.isInitialized();const n={};for(const i of s){const o=this.messagesWithoutClientAck.get(i)||{};n[i]=Object.values(o)}return n}),Lt(this,"has",(s,n)=>{this.isInitialized();const i=this.get(s),o=xr(n);return typeof i[o]<"u"}),Lt(this,"ack",async(s,n)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(s);if(typeof i>"u")return;const o=xr(n);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(s):this.messagesWithoutClientAck.set(s,i),await this.persist()}),Lt(this,"del",async s=>{this.isInitialized(),this.messages.delete(s),this.messagesWithoutClientAck.delete(s),await this.persist()}),this.logger=Et(e,this.name),this.core=r}get context(){return kt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Yl(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Yl(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Jl(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Jl(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var uT=Object.defineProperty,hT=Object.defineProperties,dT=Object.getOwnPropertyDescriptors,Hf=Object.getOwnPropertySymbols,fT=Object.prototype.hasOwnProperty,pT=Object.prototype.propertyIsEnumerable,fu=(t,e,r)=>e in t?uT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ca=(t,e)=>{for(var r in e||(e={}))fT.call(e,r)&&fu(t,r,e[r]);if(Hf)for(var r of Hf(e))pT.call(e,r)&&fu(t,r,e[r]);return t},ul=(t,e)=>hT(t,dT(e)),dr=(t,e,r)=>fu(t,typeof e!="symbol"?e+"":e,r);class gT extends rv{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,dr(this,"events",new or.EventEmitter),dr(this,"name",r3),dr(this,"queue",new Map),dr(this,"publishTimeout",W.toMiliseconds(W.ONE_MINUTE)),dr(this,"initialPublishTimeout",W.toMiliseconds(W.ONE_SECOND*15)),dr(this,"needsTransportRestart",!1),dr(this,"publish",async(s,n,i)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:n,opts:i}});const a=(i==null?void 0:i.ttl)||Uf,c=nc(i),l=(i==null?void 0:i.prompt)||!1,u=(i==null?void 0:i.tag)||0,h=(i==null?void 0:i.id)||Gs().toString(),d={topic:s,message:n,opts:{ttl:a,relay:c,prompt:l,tag:u,id:h,attestation:i==null?void 0:i.attestation,tvf:i==null?void 0:i.tvf}},f=`Failed to publish payload, please try again. id:${h} tag:${u}`;try{const p=new Promise(async g=>{const w=({id:v})=>{d.opts.id===v&&(this.removeRequestFromQueue(v),this.relayer.events.removeListener(Ze.publish,w),g(d))};this.relayer.events.on(Ze.publish,w);const E=vs(new Promise((v,C)=>{this.rpcPublish({topic:s,message:n,ttl:a,prompt:l,tag:u,id:h,attestation:i==null?void 0:i.attestation,tvf:i==null?void 0:i.tvf}).then(v).catch(_=>{this.logger.warn(_,_==null?void 0:_.message),C(_)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${u}`);try{await E,this.events.removeListener(Ze.publish,w)}catch(v){this.queue.set(h,ul(Ca({},d),{attempt:1})),this.logger.warn(v,v==null?void 0:v.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:s,message:n,opts:i}}),await vs(p,this.publishTimeout,f)}catch(p){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(p),(o=i==null?void 0:i.internal)!=null&&o.throwOnFailedPublish)throw p}finally{this.queue.delete(h)}}),dr(this,"on",(s,n)=>{this.events.on(s,n)}),dr(this,"once",(s,n)=>{this.events.once(s,n)}),dr(this,"off",(s,n)=>{this.events.off(s,n)}),dr(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),this.relayer=e,this.logger=Et(r,this.name),this.registerEventListeners()}get context(){return kt(this.logger)}async rpcPublish(e){var r,s,n,i;const{topic:o,message:a,ttl:c=Uf,prompt:l,tag:u,id:h,attestation:d,tvf:f}=e,p={method:Fi(nc().protocol).publish,params:Ca({topic:o,message:a,ttl:c,prompt:l,tag:u,attestation:d},f),id:h};ot((r=p.params)==null?void 0:r.prompt)&&((s=p.params)==null||delete s.prompt),ot((n=p.params)==null?void 0:n.tag)&&((i=p.params)==null||delete i.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(Ze.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const s=e.attempt+1;this.queue.set(r,ul(Ca({},e),{attempt:s}));const{topic:n,message:i,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${s}`),await this.rpcPublish(ul(Ca({},e),{topic:n,message:i,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(un.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ze.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ze.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var wT=Object.defineProperty,mT=(t,e,r)=>e in t?wT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sn=(t,e,r)=>mT(t,typeof e!="symbol"?e+"":e,r);class yT{constructor(){Sn(this,"map",new Map),Sn(this,"set",(e,r)=>{const s=this.get(e);this.exists(e,r)||this.map.set(e,[...s,r])}),Sn(this,"get",e=>this.map.get(e)||[]),Sn(this,"exists",(e,r)=>this.get(e).includes(r)),Sn(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,r))return;const n=s.filter(i=>i!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),Sn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var bT=Object.defineProperty,vT=Object.defineProperties,ET=Object.getOwnPropertyDescriptors,Kf=Object.getOwnPropertySymbols,CT=Object.prototype.hasOwnProperty,AT=Object.prototype.propertyIsEnumerable,pu=(t,e,r)=>e in t?bT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ti=(t,e)=>{for(var r in e||(e={}))CT.call(e,r)&&pu(t,r,e[r]);if(Kf)for(var r of Kf(e))AT.call(e,r)&&pu(t,r,e[r]);return t},hl=(t,e)=>vT(t,ET(e)),De=(t,e,r)=>pu(t,typeof e!="symbol"?e+"":e,r);class IT extends iv{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,De(this,"subscriptions",new Map),De(this,"topicMap",new yT),De(this,"events",new or.EventEmitter),De(this,"name",l3),De(this,"version",u3),De(this,"pending",new Map),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",Ur),De(this,"subscribeTimeout",W.toMiliseconds(W.ONE_MINUTE)),De(this,"initialSubscribeTimeout",W.toMiliseconds(W.ONE_SECOND*15)),De(this,"clientId"),De(this,"batchSubscribeTopicsLimit",500),De(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),De(this,"subscribe",async(s,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:n}});try{const i=nc(n),o={topic:s,relay:i,transportType:n==null?void 0:n.transportType};this.pending.set(s,o);const a=await this.rpcSubscribe(s,i,n);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:n}})),a}catch(i){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(i),i}}),De(this,"unsubscribe",async(s,n)=>{this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(s,n.id,n):await this.unsubscribeByTopic(s,n)}),De(this,"isSubscribed",s=>new Promise(n=>{n(this.topicMap.topics.includes(s))})),De(this,"isKnownTopic",s=>new Promise(n=>{n(this.topicMap.topics.includes(s)||this.pending.has(s)||this.cached.some(i=>i.topic===s))})),De(this,"on",(s,n)=>{this.events.on(s,n)}),De(this,"once",(s,n)=>{this.events.once(s,n)}),De(this,"off",(s,n)=>{this.events.off(s,n)}),De(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),De(this,"start",async()=>{await this.onConnect()}),De(this,"stop",async()=>{await this.onDisconnect()}),De(this,"restart",async()=>{await this.restore(),await this.onRestart()}),De(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const s=[];this.pending.forEach(n=>{s.push(n)}),await this.batchSubscribe(s)}),De(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(un.pulse,async()=>{await this.checkPending()}),this.events.on(Ft.created,async s=>{const n=Ft.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:s}),await this.persist()}),this.events.on(Ft.deleted,async s=>{const n=Ft.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:s}),await this.persist()})}),this.relayer=e,this.logger=Et(r,this.name),this.clientId=""}get context(){return kt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let s=!1;try{s=this.getSubscription(e).topic===r}catch{}return s}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const s=this.topicMap.get(e);await Promise.all(s.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}});try{const n=nc(s);await this.restartToComplete({topic:e,id:r,relay:n}),await this.rpcUnsubscribe(e,r,n);const i=Me("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r,s){var n;(!s||(s==null?void 0:s.transportType)===Be.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const i={method:Fi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});const o=(n=s==null?void 0:s.internal)==null?void 0:n.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((s==null?void 0:s.transportType)===Be.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(i).catch(u=>this.logger.warn(u))},W.toMiliseconds(W.ONE_SECOND)),a;const c=new Promise(async u=>{const h=d=>{d.topic===e&&(this.events.removeListener(Ft.created,h),u(d.id))};this.events.on(Ft.created,h);try{const d=await vs(new Promise((f,p)=>{this.relayer.request(i).catch(g=>{this.logger.warn(g,g==null?void 0:g.message),p(g)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ft.created,h),u(d)}catch{}}),l=await vs(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ze.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,s={method:Fi(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await vs(new Promise(n=>{this.relayer.request(s).catch(i=>this.logger.warn(i)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Ze.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,s={method:Fi(r.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});let n;try{n=await await vs(new Promise((i,o)=>{this.relayer.request(s).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Ze.connection_stalled)}return n}rpcUnsubscribe(e,r,s){const n={method:Fi(s.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,hl(Ti({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ti({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Ti({},r)),this.topicMap.set(r.topic,e),this.events.emit(Ft.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(Ft.deleted,hl(Ti({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ft.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<r;s++){const n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Ft.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>hl(Ti({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await BI(W.toMiliseconds(W.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return xr(e+await this.getClientId())}}var _T=Object.defineProperty,Vf=Object.getOwnPropertySymbols,ST=Object.prototype.hasOwnProperty,NT=Object.prototype.propertyIsEnumerable,gu=(t,e,r)=>e in t?_T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gf=(t,e)=>{for(var r in e||(e={}))ST.call(e,r)&&gu(t,r,e[r]);if(Vf)for(var r of Vf(e))NT.call(e,r)&&gu(t,r,e[r]);return t},ye=(t,e,r)=>gu(t,typeof e!="symbol"?e+"":e,r);class xT extends sv{constructor(e){super(e),ye(this,"protocol","wc"),ye(this,"version",2),ye(this,"core"),ye(this,"logger"),ye(this,"events",new or.EventEmitter),ye(this,"provider"),ye(this,"messages"),ye(this,"subscriber"),ye(this,"publisher"),ye(this,"name",n3),ye(this,"transportExplicitlyClosed",!1),ye(this,"initialized",!1),ye(this,"connectionAttemptInProgress",!1),ye(this,"relayUrl"),ye(this,"projectId"),ye(this,"packageName"),ye(this,"bundleId"),ye(this,"hasExperiencedNetworkDisruption",!1),ye(this,"pingTimeout"),ye(this,"heartBeatTimeout",W.toMiliseconds(W.THIRTY_SECONDS+W.FIVE_SECONDS)),ye(this,"reconnectTimeout"),ye(this,"connectPromise"),ye(this,"reconnectInProgress",!1),ye(this,"requestsInFlight",[]),ye(this,"connectTimeout",W.toMiliseconds(W.ONE_SECOND*15)),ye(this,"request",async r=>{var s,n;this.logger.debug("Publishing Request Payload");const i=r.id||Gs().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:r.method,topic:(s=r.params)==null?void 0:s.topic},"relayer.request - publishing...");const o=`${i}:${((n=r.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${i}`),o}}),ye(this,"resetPingTimeout",()=>{ec()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,s,n,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(i=(n=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null?void 0:n.terminate)==null||i.call(n)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),ye(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),ye(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(Ze.connect)}),ye(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),ye(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(Ze.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ye(this,"registerProviderListeners",()=>{this.provider.on(Yt.payload,this.onPayloadHandler),this.provider.on(Yt.connect,this.onConnectHandler),this.provider.on(Yt.disconnect,this.onDisconnectHandler),this.provider.on(Yt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Et(e.logger,this.name):zo(Ho({level:e.logger||s3})),this.messages=new lT(this.logger,e.core),this.subscriber=new IT(this,this.logger),this.publisher=new gT(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Vm,this.projectId=e.projectId,EI()?this.packageName=Ud():CI()&&(this.bundleId=Ud()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return kt(this.logger)}get connected(){var e,r,s;return((s=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:s.readyState)===1||!1}get connecting(){var e,r,s;return((s=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:s.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,s){this.isInitialized(),await this.publisher.publish(e,r,s),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:Be.relay},ja.outbound)}async subscribe(e,r){var s,n,i;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((s=r==null?void 0:r.internal)==null?void 0:s.throwOnFailedPublish)>"u"?!0:(n=r==null?void 0:r.internal)==null?void 0:n.throwOnFailedPublish;let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(Ft.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Ft.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,Gf({internal:{throwOnFailedPublish:o}},r)).catch(d=>{o&&h(d)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await vs(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,s)=>{await this.connect(e).then(r).catch(s).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Nf())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((s,n)=>s.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const s of r)try{await this.onMessageEvent(s)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+(n==null?void 0:n.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:s}=e;if(!r.sessionExists){const n=Ve(W.FIVE_MINUTES),i={topic:s,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(s,i)}this.events.emit(Ze.message,e),await this.recordMessageEvent(e,ja.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(s,n)=>{const i=()=>{n(new Error("Connection interrupted while trying to connect"))};this.provider.once(Yt.disconnect,i),await vs(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(Yt.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Yt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Yt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,s()})}catch(s){await this.subscriber.stop();const n=s;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(s=>setTimeout(s,W.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,s,n,i;if(ec())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((i=(n=(s=this.provider)==null?void 0:s.connection)==null?void 0:n.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ar(new Kx(NI({sdkVersion:lu,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:s,message:n}=e;await this.messages.set(s,n,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:s}=e;if(!s||s.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const n=this.messages.has(r,s);return n&&this.logger.warn(`Ignoring duplicate message: ${s}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),hh(e)){if(!e.method.endsWith(i3))return;const r=e.params,{topic:s,message:n,publishedAt:i,attestation:o}=r.data,a={topic:s,message:n,publishedAt:i,transportType:Be.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Gf({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Nc(e)&&this.events.emit(Ze.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,ja.inbound),this.events.emit(Ze.message,e))}async acknowledgePayload(e){const r=_c(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Yt.payload,this.onPayloadHandler),this.provider.off(Yt.connect,this.onConnectHandler),this.provider.off(Yt.disconnect,this.onDisconnectHandler),this.provider.off(Yt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Nf();px(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(s=>this.logger.error(s,s==null?void 0:s.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(un.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&mx())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Ze.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},W.toMiliseconds(o3)))))}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function OT(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Yf(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Jf(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const TT="[object RegExp]",PT="[object String]",DT="[object Number]",$T="[object Boolean]",Xf="[object Arguments]",RT="[object Symbol]",kT="[object Date]",UT="[object Map]",BT="[object Set]",LT="[object Array]",MT="[object Function]",FT="[object ArrayBuffer]",dl="[object Object]",jT="[object Error]",qT="[object DataView]",zT="[object Uint8Array]",WT="[object Uint8ClampedArray]",HT="[object Uint16Array]",KT="[object Uint32Array]",VT="[object BigUint64Array]",GT="[object Int8Array]",YT="[object Int16Array]",JT="[object Int32Array]",XT="[object BigInt64Array]",ZT="[object Float32Array]",QT="[object Float64Array]";function eP(){}function Zf(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function tP(t,e,r){return ji(t,e,void 0,void 0,void 0,void 0,r)}function ji(t,e,r,s,n,i,o){const a=o(t,e,r,s,n,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Zi(t,e,i,o)}return Zi(t,e,i,o)}function Zi(t,e,r,s){if(Object.is(t,e))return!0;let n=Jf(t),i=Jf(e);if(n===Xf&&(n=dl),i===Xf&&(i=dl),n!==i)return!1;switch(n){case PT:return t.toString()===e.toString();case DT:{const c=t.valueOf(),l=e.valueOf();return OT(c,l)}case $T:case kT:case RT:return Object.is(t.valueOf(),e.valueOf());case TT:return t.source===e.source&&t.flags===e.flags;case MT:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(n){case UT:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!ji(l,e.get(c),c,t,e,r,s))return!1;return!0}case BT:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],d=l.findIndex(f=>ji(h,f,void 0,t,e,r,s));if(d===-1)return!1;l.splice(d,1)}return!0}case LT:case zT:case WT:case HT:case KT:case VT:case GT:case YT:case JT:case XT:case ZT:case QT:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!ji(t[c],e[c],c,t,e,r,s))return!1;return!0}case FT:return t.byteLength!==e.byteLength?!1:Zi(new Uint8Array(t),new Uint8Array(e),r,s);case qT:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Zi(new Uint8Array(t),new Uint8Array(e),r,s);case jT:return t.name===e.name&&t.message===e.message;case dl:{if(!(Zi(t.constructor,e.constructor,r,s)||Zf(t)&&Zf(e)))return!1;const c=[...Object.keys(t),...Yf(t)],l=[...Object.keys(e),...Yf(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;const f=e[h];if(!ji(d,f,h,t,e,r,s))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function rP(t,e){return tP(t,e,eP)}var sP=Object.defineProperty,Qf=Object.getOwnPropertySymbols,nP=Object.prototype.hasOwnProperty,iP=Object.prototype.propertyIsEnumerable,wu=(t,e,r)=>e in t?sP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ep=(t,e)=>{for(var r in e||(e={}))nP.call(e,r)&&wu(t,r,e[r]);if(Qf)for(var r of Qf(e))iP.call(e,r)&&wu(t,r,e[r]);return t},At=(t,e,r)=>wu(t,typeof e!="symbol"?e+"":e,r);class fn extends nv{constructor(e,r,s,n=Ur,i=void 0){super(e,r,s,n),this.core=e,this.logger=r,this.name=s,At(this,"map",new Map),At(this,"version",a3),At(this,"cached",[]),At(this,"initialized",!1),At(this,"getKey"),At(this,"storagePrefix",Ur),At(this,"recentlyDeleted",[]),At(this,"recentlyDeletedLimit",200),At(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!ot(o)?this.map.set(this.getKey(o),o):HN(o)?this.map.set(o.id,o):KN(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),At(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),At(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),At(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>rP(a[c],o[c]))):this.values)),At(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=ep(ep({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),At(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Et(r,this.name),this.storagePrefix=n,this.getKey=i}get context(){return kt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=z("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var oP=Object.defineProperty,aP=(t,e,r)=>e in t?oP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,de=(t,e,r)=>aP(t,typeof e!="symbol"?e+"":e,r);class cP{constructor(e,r){this.core=e,this.logger=r,de(this,"name",h3),de(this,"version",d3),de(this,"events",new Ru),de(this,"pairings"),de(this,"initialized",!1),de(this,"storagePrefix",Ur),de(this,"ignoredPayloadTypes",[Jr]),de(this,"registeredMethods",[]),de(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),de(this,"register",({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]}),de(this,"create",async s=>{this.isInitialized();const n=ou(),i=await this.core.crypto.setSymKey(n),o=Ve(W.FIVE_MINUTES),a={protocol:Km},c={topic:i,expiry:o,relay:a,active:!1,methods:s==null?void 0:s.methods},l=yf({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:n,relay:a,expiryTimestamp:o,methods:s==null?void 0:s.methods});return this.events.emit(qs.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:s==null?void 0:s.transportType}),{topic:i,uri:l}}),de(this,"pair",async s=>{this.isInitialized();const n=this.core.eventClient.createEvent({properties:{topic:s==null?void 0:s.uri,trace:[Ir.pairing_started]}});this.isValidPair(s,n);const{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:l}=mf(s.uri);n.props.properties.topic=i,n.addTrace(Ir.pairing_uri_validation_success),n.addTrace(Ir.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(i)){if(u=this.pairings.get(i),n.addTrace(Ir.existing_pairing),u.active)throw n.setError(Vr.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);n.addTrace(Ir.pairing_not_expired)}const h=c||Ve(W.FIVE_MINUTES),d={topic:i,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(i,h),await this.pairings.set(i,d),n.addTrace(Ir.store_new_pairing),s.activatePairing&&await this.activate({topic:i}),this.events.emit(qs.create,d),n.addTrace(Ir.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),n.addTrace(Ir.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(Vr.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(f){throw n.setError(Vr.subscribe_pairing_topic_failure),f}return n.addTrace(Ir.subscribe_pairing_topic_success),d}),de(this,"activate",async({topic:s})=>{this.isInitialized();const n=Ve(W.FIVE_MINUTES);this.core.expirer.set(s,n),await this.pairings.update(s,{active:!0,expiry:n})}),de(this,"ping",async s=>{this.isInitialized(),await this.isValidPing(s),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:n}=s;if(this.pairings.keys.includes(n)){const i=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Ls();this.events.once(_e("pairing_ping",i),({error:l})=>{l?c(l):a()}),await o()}}),de(this,"updateExpiry",async({topic:s,expiry:n})=>{this.isInitialized(),await this.pairings.update(s,{expiry:n})}),de(this,"updateMetadata",async({topic:s,metadata:n})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:n})}),de(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),de(this,"disconnect",async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:n}=s;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",Me("USER_DISCONNECTED")),await this.deletePairing(n))}),de(this,"formatUriFromPairing",s=>{this.isInitialized();const{topic:n,relay:i,expiry:o,methods:a}=s,c=this.core.crypto.keychain.get(n);return yf({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),de(this,"sendRequest",async(s,n,i)=>{const o=Es(n,i),a=await this.core.crypto.encode(s,o),c=xi[n].req;return this.core.history.set(s,o),this.core.relayer.publish(s,a,c),o.id}),de(this,"sendResult",async(s,n,i)=>{const o=_c(s,i),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,s)).request.method,l=xi[c].res;await this.core.relayer.publish(n,a,l),await this.core.history.resolve(o)}),de(this,"sendError",async(s,n,i)=>{const o=Sc(s,i),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,s)).request.method,l=xi[c]?xi[c].res:xi.unregistered_method.res;await this.core.relayer.publish(n,a,l),await this.core.history.resolve(o)}),de(this,"deletePairing",async(s,n)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Me("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),n?Promise.resolve():this.core.expirer.del(s)])}),de(this,"cleanup",async()=>{const s=this.pairings.getAll().filter(n=>ps(n.expiry));await Promise.all(s.map(n=>this.deletePairing(n.topic)))}),de(this,"onRelayEventRequest",async s=>{const{topic:n,payload:i}=s;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,i);default:return await this.onUnknownRpcMethodRequest(n,i)}}),de(this,"onRelayEventResponse",async s=>{const{topic:n,payload:i}=s,o=(await this.core.history.get(n,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,i);default:return this.onUnknownRpcMethodResponse(o)}}),de(this,"onPairingPingRequest",async(s,n)=>{const{id:i}=n;try{this.isValidPing({topic:s}),await this.sendResult(i,s,!0),this.events.emit(qs.ping,{id:i,topic:s})}catch(o){await this.sendError(i,s,o),this.logger.error(o)}}),de(this,"onPairingPingResponse",(s,n)=>{const{id:i}=n;setTimeout(()=>{Sr(n)?this.events.emit(_e("pairing_ping",i),{}):tr(n)&&this.events.emit(_e("pairing_ping",i),{error:n.error})},500)}),de(this,"onPairingDeleteRequest",async(s,n)=>{const{id:i}=n;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(qs.delete,{id:i,topic:s})}catch(o){await this.sendError(i,s,o),this.logger.error(o)}}),de(this,"onUnknownRpcMethodRequest",async(s,n)=>{const{id:i,method:o}=n;try{if(this.registeredMethods.includes(o))return;const a=Me("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,s,a),this.logger.error(a)}catch(a){await this.sendError(i,s,a),this.logger.error(a)}}),de(this,"onUnknownRpcMethodResponse",s=>{this.registeredMethods.includes(s)||this.logger.error(Me("WC_METHOD_UNSUPPORTED",s))}),de(this,"isValidPair",(s,n)=>{var i;if(!Tt(s)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${s}`);throw n.setError(Vr.malformed_pairing_uri),new Error(a)}if(!WN(s.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw n.setError(Vr.malformed_pairing_uri),new Error(a)}const o=mf(s==null?void 0:s.uri);if(!((i=o==null?void 0:o.relay)!=null&&i.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(Vr.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(Vr.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&W.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){n.setError(Vr.pairing_expired);const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),de(this,"isValidPing",async s=>{if(!Tt(s)){const{message:i}=z("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(i)}const{topic:n}=s;await this.isValidPairingTopic(n)}),de(this,"isValidDisconnect",async s=>{if(!Tt(s)){const{message:i}=z("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(i)}const{topic:n}=s;await this.isValidPairingTopic(n)}),de(this,"isValidPairingTopic",async s=>{if(!We(s,!1)){const{message:n}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(n)}if(!this.pairings.keys.includes(s)){const{message:n}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(n)}if(ps(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:n}=z("EXPIRED",`pairing topic: ${s}`);throw new Error(n)}}),this.core=e,this.logger=Et(r,this.name),this.pairings=new fn(this.core,this.logger,this.name,this.storagePrefix)}get context(){return kt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ze.message,async e=>{const{topic:r,message:s,transportType:n}=e;if(this.pairings.keys.includes(r)&&n!==Be.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))try{const i=await this.core.crypto.decode(r,s);hh(i)?(this.core.history.set(r,i),await this.onRelayEventRequest({topic:r,payload:i})):Nc(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:r,payload:i}),this.core.history.delete(r,i.id)),await this.core.relayer.messages.ack(r,s)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(er.expired,async e=>{const{topic:r}=Hw(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(qs.expire,{topic:r}))})}}var lP=Object.defineProperty,uP=(t,e,r)=>e in t?lP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,it=(t,e,r)=>uP(t,typeof e!="symbol"?e+"":e,r);class hP extends ev{constructor(e,r){super(e,r),this.core=e,this.logger=r,it(this,"records",new Map),it(this,"events",new or.EventEmitter),it(this,"name",f3),it(this,"version",p3),it(this,"cached",[]),it(this,"initialized",!1),it(this,"storagePrefix",Ur),it(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),it(this,"set",(s,n,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:n,chainId:i}),this.records.has(n.id))return;const o={id:n.id,topic:s,request:{method:n.method,params:n.params||null},chainId:i,expiry:Ve(W.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ur.created,o)}),it(this,"resolve",async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const n=await this.getRecord(s.id);typeof n.response>"u"&&(n.response=tr(s)?{error:s.error}:{result:s.result},this.records.set(n.id,n),this.persist(),this.events.emit(ur.updated,n))}),it(this,"get",async(s,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:n}),await this.getRecord(n))),it(this,"delete",(s,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(i=>{if(i.topic===s){if(typeof n<"u"&&i.id!==n)return;this.records.delete(i.id),this.events.emit(ur.deleted,i)}}),this.persist()}),it(this,"exists",async(s,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===s:!1)),it(this,"on",(s,n)=>{this.events.on(s,n)}),it(this,"once",(s,n)=>{this.events.once(s,n)}),it(this,"off",(s,n)=>{this.events.off(s,n)}),it(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),this.logger=Et(r,this.name)}get context(){return kt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Es(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ur.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ur.created,e=>{const r=ur.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(ur.updated,e=>{const r=ur.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(ur.deleted,e=>{const r=ur.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(un.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{W.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(ur.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var dP=Object.defineProperty,fP=(t,e,r)=>e in t?dP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wt=(t,e,r)=>fP(t,typeof e!="symbol"?e+"":e,r);class pP extends ov{constructor(e,r){super(e,r),this.core=e,this.logger=r,wt(this,"expirations",new Map),wt(this,"events",new or.EventEmitter),wt(this,"name",g3),wt(this,"version",w3),wt(this,"cached",[]),wt(this,"initialized",!1),wt(this,"storagePrefix",Ur),wt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),wt(this,"has",s=>{try{const n=this.formatTarget(s);return typeof this.getExpiration(n)<"u"}catch{return!1}}),wt(this,"set",(s,n)=>{this.isInitialized();const i=this.formatTarget(s),o={target:i,expiry:n};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(er.created,{target:i,expiration:o})}),wt(this,"get",s=>{this.isInitialized();const n=this.formatTarget(s);return this.getExpiration(n)}),wt(this,"del",s=>{if(this.isInitialized(),this.has(s)){const n=this.formatTarget(s),i=this.getExpiration(n);this.expirations.delete(n),this.events.emit(er.deleted,{target:n,expiration:i})}}),wt(this,"on",(s,n)=>{this.events.on(s,n)}),wt(this,"once",(s,n)=>{this.events.once(s,n)}),wt(this,"off",(s,n)=>{this.events.off(s,n)}),wt(this,"removeListener",(s,n)=>{this.events.removeListener(s,n)}),this.logger=Et(r,this.name)}get context(){return kt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return xI(e);if(typeof e=="number")return OI(e);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(er.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(s),new Error(s)}return r}checkExpiry(e,r){const{expiry:s}=r;W.toMiliseconds(s)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(er.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(un.pulse,()=>this.checkExpirations()),this.events.on(er.created,e=>{const r=er.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(er.expired,e=>{const r=er.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(er.deleted,e=>{const r=er.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var gP=Object.defineProperty,wP=(t,e,r)=>e in t?gP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ze=(t,e,r)=>wP(t,typeof e!="symbol"?e+"":e,r);class mP extends av{constructor(e,r,s){super(e,r,s),this.core=e,this.logger=r,this.store=s,ze(this,"name",m3),ze(this,"abortController"),ze(this,"isDevEnv"),ze(this,"verifyUrlV3",b3),ze(this,"storagePrefix",Ur),ze(this,"version",Hm),ze(this,"publicKey"),ze(this,"fetchPromise"),ze(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&W.toMiliseconds((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ze(this,"register",async n=>{if(!di()||this.isDevEnv)return;const i=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{const l=rn(),u=this.startAbortTimer(W.ONE_SECOND*5),h=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",w),l.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const w=E=>{if(E.data&&typeof E.data=="string")try{const v=JSON.parse(E.data);if(v.type==="verify_attestation"){if(jl(v.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",w),d(v.attestation===null?"":v.attestation)}}catch(v){this.logger.warn(v)}};l.body.appendChild(g),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),ze(this,"resolve",async n=>{if(this.isDevEnv)return"";const{attestationId:i,hash:o,encryptedId:a}=n;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(jl(i).payload.id!==a)return;const l=await this.isValidJwtAttestation(i);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(n==null?void 0:n.verifyUrl);return this.fetchAttestation(o,c)}),ze(this,"fetchAttestation",async(n,i)=>{this.logger.debug(`resolving attestation: ${n} from url: ${i}`);const o=this.startAbortTimer(W.ONE_SECOND*5),a=await fetch(`${i}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ze(this,"getVerifyUrl",n=>{let i=n||Xi;return v3.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${Xi}`),i=Xi),i}),ze(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const n=this.startAbortTimer(W.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await i.json()}catch(n){this.logger.warn(n)}}),ze(this,"persistPublicKey",async n=>{this.logger.debug("persisting public key to local storage",n),await this.store.setItem(this.storeKey,n),this.publicKey=n}),ze(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ze(this,"isValidJwtAttestation",async n=>{const i=await this.getPublicKey();try{if(i)return this.validateAttestation(n,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ze(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ze(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});const n=await this.fetchPromise;return this.fetchPromise=void 0,n}),ze(this,"validateAttestation",(n,i)=>{const o=AN(n,i.publicKey),a={hasExpired:W.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Et(r,this.name),this.abortController=new AbortController,this.isDevEnv=Ju(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return kt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),W.toMiliseconds(e))}}var yP=Object.defineProperty,bP=(t,e,r)=>e in t?yP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tp=(t,e,r)=>bP(t,typeof e!="symbol"?e+"":e,r);class vP extends cv{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,tp(this,"context",E3),tp(this,"registerDeviceToken",async s=>{const{clientId:n,token:i,notificationType:o,enableEncrypted:a=!1}=s,c=`${C3}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:i,always_raw:a})})}),this.logger=Et(r,this.context)}}var EP=Object.defineProperty,rp=Object.getOwnPropertySymbols,CP=Object.prototype.hasOwnProperty,AP=Object.prototype.propertyIsEnumerable,mu=(t,e,r)=>e in t?EP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pi=(t,e)=>{for(var r in e||(e={}))CP.call(e,r)&&mu(t,r,e[r]);if(rp)for(var r of rp(e))AP.call(e,r)&&mu(t,r,e[r]);return t},Ye=(t,e,r)=>mu(t,typeof e!="symbol"?e+"":e,r);class IP extends lv{constructor(e,r,s=!0){super(e,r,s),this.core=e,this.logger=r,Ye(this,"context",I3),Ye(this,"storagePrefix",Ur),Ye(this,"storageVersion",A3),Ye(this,"events",new Map),Ye(this,"shouldPersist",!1),Ye(this,"init",async()=>{if(!Ju())try{const n={eventId:Ld(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:zw(this.core.relayer.protocol,this.core.relayer.version,lu)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),Ye(this,"createEvent",n=>{const{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=n,l=Ld(),u=this.core.projectId||"",h=Date.now(),d=Pi({eventId:l,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),Ye(this,"getEvent",n=>{const{eventId:i,topic:o}=n;if(i)return this.events.get(i);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Pi(Pi({},a),this.setMethods(a.eventId))}),Ye(this,"deleteEvent",n=>{const{eventId:i}=n;this.events.delete(i),this.shouldPersist=!0}),Ye(this,"setEventListeners",()=>{this.core.heartbeat.on(un.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{W.fromMiliseconds(Date.now())-W.fromMiliseconds(n.timestamp)>_3&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),Ye(this,"setMethods",n=>({addTrace:i=>this.addTrace(n,i),setError:i=>this.setError(n,i)})),Ye(this,"addTrace",(n,i)=>{const o=this.events.get(n);o&&(o.props.properties.trace.push(i),this.events.set(n,o),this.shouldPersist=!0)}),Ye(this,"setError",(n,i)=>{const o=this.events.get(n);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Ye(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ye(this,"restore",async()=>{try{const n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(i=>{this.events.set(i.eventId,Pi(Pi({},i),this.setMethods(i.eventId)))})}catch(n){this.logger.warn(n)}}),Ye(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const n=[];for(const[i,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(const i of n)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),Ye(this,"sendEvent",async n=>{const i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${S3}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${lu}${i}`,{method:"POST",body:JSON.stringify(n)})}),Ye(this,"getAppDomain",()=>qw().url),this.logger=Et(r,this.context),this.telemetryEnabled=s,s?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var _P=Object.defineProperty,sp=Object.getOwnPropertySymbols,SP=Object.prototype.hasOwnProperty,NP=Object.prototype.propertyIsEnumerable,yu=(t,e,r)=>e in t?_P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,np=(t,e)=>{for(var r in e||(e={}))SP.call(e,r)&&yu(t,r,e[r]);if(sp)for(var r of sp(e))NP.call(e,r)&&yu(t,r,e[r]);return t},$e=(t,e,r)=>yu(t,typeof e!="symbol"?e+"":e,r);let xP=class o0 extends Jb{constructor(e){var r;super(e),$e(this,"protocol",Wm),$e(this,"version",Hm),$e(this,"name",cu),$e(this,"relayUrl"),$e(this,"projectId"),$e(this,"customStoragePrefix"),$e(this,"events",new or.EventEmitter),$e(this,"logger"),$e(this,"heartbeat"),$e(this,"relayer"),$e(this,"crypto"),$e(this,"storage"),$e(this,"history"),$e(this,"expirer"),$e(this,"pairing"),$e(this,"verify"),$e(this,"echoClient"),$e(this,"linkModeSupportedApps"),$e(this,"eventClient"),$e(this,"initialized",!1),$e(this,"logChunkController"),$e(this,"on",(a,c)=>this.events.on(a,c)),$e(this,"once",(a,c)=>this.events.once(a,c)),$e(this,"off",(a,c)=>this.events.off(a,c)),$e(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),$e(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:Be.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const s=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(s)try{return this.customStoragePrefix=s.customStoragePrefix,this.logger=s.logger,this.heartbeat=s.heartbeat,this.crypto=s.crypto,this.history=s.history,this.expirer=s.expirer,this.storage=s.storage,this.relayer=s.relayer,this.pairing=s.pairing,this.verify=s.verify,this.echoClient=s.echoClient,this.linkModeSupportedApps=s.linkModeSupportedApps,this.eventClient=s.eventClient,this.initialized=s.initialized,this.logChunkController=s.logChunkController,s}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Vm,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const n=Ho({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:Gx.logger,name:cu}),{logger:i,chunkLoggerController:o}=_g({opts:n,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Et(i,this.name),this.heartbeat=new Ly,this.crypto=new tT(this,this.logger,e==null?void 0:e.keychain),this.history=new hP(this,this.logger),this.expirer=new pP(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new vb(np(np({},Yx),e==null?void 0:e.storageOptions)),this.relayer=new xT({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new cP(this,this.logger),this.verify=new mP(this,this.logger,this.storage),this.echoClient=new vP(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new IP(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new o0(e);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(c3,s),r}get context(){return kt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Bf,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Bf)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,s=`${r}_count`;return globalThis[s]=(globalThis[s]||0)+1,globalThis[s]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[s]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const s=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[s]=e}catch(s){console.warn("Failed to set global WalletConnect core",s)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&Vx.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const OP=xP,a0="wc",c0=2,l0="client",dh=`${a0}@${c0}:${l0}:`,fl={name:l0,logger:"error"},ip="WALLETCONNECT_DEEPLINK_CHOICE",TP="proposal",op="Proposal expired",PP="session",Nn=W.SEVEN_DAYS,DP="engine",Je={wc_sessionPropose:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1104},res:{ttl:W.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1106},res:{ttl:W.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1112},res:{ttl:W.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1114},res:{ttl:W.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:W.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:W.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1119}}},pl={min:W.FIVE_MINUTES,max:W.SEVEN_DAYS},Cr={idle:"IDLE",active:"ACTIVE"},$P={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},RP="request",kP=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],UP="wc",BP="auth",LP="authKeys",MP="pairingTopics",FP="requests",Oc=`${UP}@${1.5}:${BP}:`,qa=`${Oc}:PUB_KEY`;var jP=Object.defineProperty,qP=Object.defineProperties,zP=Object.getOwnPropertyDescriptors,ap=Object.getOwnPropertySymbols,WP=Object.prototype.hasOwnProperty,HP=Object.prototype.propertyIsEnumerable,bu=(t,e,r)=>e in t?jP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ue=(t,e)=>{for(var r in e||(e={}))WP.call(e,r)&&bu(t,r,e[r]);if(ap)for(var r of ap(e))HP.call(e,r)&&bu(t,r,e[r]);return t},It=(t,e)=>qP(t,zP(e)),F=(t,e,r)=>bu(t,typeof e!="symbol"?e+"":e,r);class KP extends fv{constructor(e){super(e),F(this,"name",DP),F(this,"events",new Ru),F(this,"initialized",!1),F(this,"requestQueue",{state:Cr.idle,queue:[]}),F(this,"sessionRequestQueue",{state:Cr.idle,queue:[]}),F(this,"emittedSessionRequests",new LI({limit:500})),F(this,"requestQueueDelay",W.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Je)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},W.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const s=It(Ue({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s),s.optionalNamespaces=MN(s.requiredNamespaces,s.optionalNamespaces),s.requiredNamespaces={};const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=s;let u=n,h,d=!1;try{if(u){const k=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=k.active}}catch(k){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),k}if(!u||!d){const{topic:k,uri:L}=await this.client.core.pairing.create();u=k,h=L}if(!u){const{message:k}=z("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(k)}const f=await this.client.core.crypto.generateKeyPair(),p=Je.wc_sessionPropose.req.ttl||W.FIVE_MINUTES,g=Ve(p),w=It(Ue(Ue({requiredNamespaces:i,optionalNamespaces:o,relays:l??[{protocol:Km}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:_r()}),E=_e("session_connect",w.id),{reject:v,resolve:C,done:_}=Ls(p,op),S=({id:k})=>{k===w.id&&(this.client.events.off("proposal_expire",S),this.pendingSessions.delete(w.id),this.events.emit(E,{error:{message:op,code:0}}))};return this.client.events.on("proposal_expire",S),this.events.once(E,({error:k,session:L})=>{this.client.events.off("proposal_expire",S),k?v(k):L&&C(L)}),await this.sendRequest({topic:u,method:"wc_sessionPropose",params:w,throwOnFailedPublish:!0,clientRpcId:w.id}),await this.setProposal(w.id,w),{uri:h,approval:_}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(s){throw this.client.logger.error("pair() failed"),s}}),F(this,"approve",async r=>{var s,n,i;const o=this.client.core.eventClient.createEvent({properties:{topic:(s=r==null?void 0:r.id)==null?void 0:s.toString(),trace:[hr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(A){throw o.setError($s.no_internet_connection),A}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(A){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError($s.proposal_not_found),A}try{await this.isValidApprove(r)}catch(A){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError($s.session_approve_namespace_validation_failure),A}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=r,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:w,optionalNamespaces:E}=f;let v=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:p});v||(v=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:hr.session_approve_started,properties:{topic:p,trace:[hr.session_approve_started,hr.session_namespaces_validation_success]}}));const C=await this.client.core.crypto.generateKeyPair(),_=g.publicKey,S=await this.client.core.crypto.generateSharedKey(C,_),k=Ue(Ue(Ue({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:C,metadata:this.client.metadata},expiry:Ve(Nn)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),L=Be.relay;v.addTrace(hr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(S,{transportType:L})}catch(A){throw v.setError($s.subscribe_session_topic_failure),A}v.addTrace(hr.subscribe_session_topic_success);const R=It(Ue({},k),{topic:S,requiredNamespaces:w,optionalNamespaces:E,pairingTopic:p,acknowledged:!1,self:k.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:C,transportType:Be.relay});await this.client.session.set(S,R),v.addTrace(hr.store_session);try{v.addTrace(hr.publishing_session_settle),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:k,throwOnFailedPublish:!0}).catch(A=>{throw v==null||v.setError($s.session_settle_publish_failure),A}),v.addTrace(hr.session_settle_publish_success),v.addTrace(hr.publishing_session_approve),await this.sendResult({id:a,topic:p,result:{relay:{protocol:c??"irn"},responderPublicKey:C},throwOnFailedPublish:!0}).catch(A=>{throw v==null||v.setError($s.session_approve_publish_failure),A}),v.addTrace(hr.session_approve_publish_success)}catch(A){throw this.client.logger.error(A),this.client.session.delete(S,Me("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(S),A}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(S,Ve(Nn)),{topic:S,acknowledged:()=>Promise.resolve(this.client.session.get(S))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:s,reason:n}=r;let i;try{i=this.client.proposal.get(s).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${s}) failed`),o}i&&await this.sendError({id:s,topic:i,error:n,rpcOpts:Je.wc_sessionPropose.reject}),await this.deleteProposal(s)}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:s,namespaces:n}=r,{done:i,resolve:o,reject:a}=Ls(),c=_r(),l=Gs().toString(),u=this.client.session.get(s).namespaces;return this.events.once(_e("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(s,{namespaces:n}),await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(s,{namespaces:u}),a(h)}),{acknowledged:i}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:s}=r,n=_r(),{done:i,resolve:o,reject:a}=Ls();return this.events.once(_e("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(s,Ve(Nn)),this.sendRequest({topic:s,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:s,request:n,topic:i,expiry:o=Je.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(i);(a==null?void 0:a.transportType)===Be.relay&&await this.confirmOnlineStateOrThrow();const c=_r(),l=Gs().toString(),{done:u,resolve:h,reject:d}=Ls(o,"Request expired. Please try again.");this.events.once(_e("session_request",c),({error:w,result:E})=>{w?d(w):h(E)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:f,params:{request:It(Ue({},n),{expiryTimestamp:Ve(o)}),chainId:s},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:s,id:c}),await u();const g={request:It(Ue({},n),{expiryTimestamp:Ve(o)}),chainId:s};return await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:f,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(E=>d(E)),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:s,id:c}),w()}),new Promise(async w=>{var E;if(!((E=a.sessionConfig)!=null&&E.disableDeepLink)){const v=await $I(this.client.core.storage,ip);await TI({id:c,topic:i,wcDeepLink:v})}w()}),u()]).then(w=>w[2])}),F(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:n}=r,{id:i}=n,o=this.client.session.get(s);o.transportType===Be.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Sr(n)?await this.sendResult({id:i,topic:s,result:n.result,throwOnFailedPublish:!0,appLink:a}):tr(n)&&await this.sendError({id:i,topic:s,error:n.error,appLink:a}),this.cleanupAfterResponse(r)}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:s}=r;if(this.client.session.keys.includes(s)){const n=_r(),i=Gs().toString(),{done:o,resolve:a,reject:c}=Ls();this.events.once(_e("session_ping",n),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:s,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(s)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:s}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:s,event:n,chainId:i}=r,o=Gs().toString(),a=_r();await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:n,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:s}=r;if(this.client.session.keys.includes(s))await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Me("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:s,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(s))await this.client.core.pairing.disconnect({topic:s});else{const{message:n}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${s}`);throw new Error(n)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(s=>qN(s,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,s)=>{var n;this.isInitialized(),this.isValidAuthenticate(r);const i=s&&this.client.core.linkModeSupportedApps.includes(s)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=i?Be.link_mode:Be.relay;o===Be.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:f,nbf:p,methods:g=[],expiry:w}=r,E=[...r.resources||[]],{topic:v,uri:C}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:v,uri:C}});const _=await this.client.core.crypto.generateKeyPair(),S=Fa(_);if(await Promise.all([this.client.auth.authKeys.set(qa,{responseTopic:S,publicKey:_}),this.client.auth.pairingTopics.set(S,{topic:S,pairingTopic:v})]),await this.client.core.relayer.subscribe(S,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${v}`),g.length>0){const{namespace:N}=Yn(a[0]);let P=Y_(N,"request",g);Ma(E)&&(P=X_(P,E.pop())),E.push(P)}const k=w&&w>Je.wc_sessionAuthenticate.req.ttl?w:Je.wc_sessionAuthenticate.req.ttl,L={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:f,nbf:p,resources:E},requester:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:Ve(k)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},A={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:v,proposer:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:Ve(Je.wc_sessionPropose.req.ttl),id:_r()},{done:D,resolve:T,reject:O}=Ls(k,"Request expired"),$=_r(),j=_e("session_connect",A.id),m=_e("session_request",$),b=async({error:N,session:P})=>{this.events.off(m,I),N?O(N):P&&T({session:P})},I=async N=>{var P,M,G;if(await this.deletePendingAuthRequest($,{message:"fulfilled",code:0}),N.error){const he=Me("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return N.error.code===he.code?void 0:(this.events.off(j,b),O(N.error.message))}await this.deleteProposal(A.id),this.events.off(j,b);const{cacaos:X,responder:K}=N.result,Z=[],ae=[];for(const he of X){await Yd({cacao:he,projectId:this.client.core.projectId})||(this.client.logger.error(he,"Signature verification failed"),O(Me("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Fe}=he,tt=Ma(Fe.resources),Ts=[Xl(Fe.iss)],na=tc(Fe.iss);if(tt){const yn=Jd(tt),$c=Xd(tt);Z.push(...yn),Ts.push(...$c)}for(const yn of Ts)ae.push(`${yn}:${na}`)}const Ie=await this.client.core.crypto.generateSharedKey(_,K.publicKey);let Ce;Z.length>0&&(Ce={topic:Ie,acknowledged:!0,self:{publicKey:_,metadata:this.client.metadata},peer:K,controller:K.publicKey,expiry:Ve(Nn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:v,namespaces:Cf([...new Set(Z)],[...new Set(ae)]),transportType:o},await this.client.core.relayer.subscribe(Ie,{transportType:o}),await this.client.session.set(Ie,Ce),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:K.metadata}),Ce=this.client.session.get(Ie)),(P=this.client.metadata.redirect)!=null&&P.linkMode&&(M=K.metadata.redirect)!=null&&M.linkMode&&(G=K.metadata.redirect)!=null&&G.universal&&s&&(this.client.core.addLinkModeSupportedApp(K.metadata.redirect.universal),this.client.session.update(Ie,{transportType:Be.link_mode})),T({auths:X,session:Ce})};this.events.once(j,b),this.events.once(m,I);let x;try{if(i){const N=Es("wc_sessionAuthenticate",L,$);this.client.core.history.set(v,N);const P=await this.client.core.crypto.encode("",N,{type:Xo,encoding:ys});x=Ea(s,v,P)}else await Promise.all([this.sendRequest({topic:v,method:"wc_sessionAuthenticate",params:L,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:$}),this.sendRequest({topic:v,method:"wc_sessionPropose",params:A,expiry:Je.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:A.id})])}catch(N){throw this.events.off(j,b),this.events.off(m,I),N}return await this.setProposal(A.id,A),await this.setAuthRequest($,{request:It(Ue({},L),{verifyContext:{}}),pairingTopic:v,transportType:o}),{uri:x??C,response:D}}),F(this,"approveSessionAuthenticate",async r=>{const{id:s,auths:n}=r,i=this.client.core.eventClient.createEvent({properties:{topic:s.toString(),trace:[Rs.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw i.setError(Oi.no_internet_connection),w}const o=this.getPendingAuthRequest(s);if(!o)throw i.setError(Oi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${s}`);const a=o.transportType||Be.relay;a===Be.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Fa(c),h={type:Jr,receiverPublicKey:c,senderPublicKey:l},d=[],f=[];for(const w of n){if(!await Yd({cacao:w,projectId:this.client.core.projectId})){i.setError(Oi.invalid_cacao);const S=Me("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:s,topic:u,error:S,encodeOpts:h}),new Error(S.message)}i.addTrace(Rs.cacaos_verified);const{p:E}=w,v=Ma(E.resources),C=[Xl(E.iss)],_=tc(E.iss);if(v){const S=Jd(v),k=Xd(v);d.push(...S),C.push(...k)}for(const S of C)f.push(`${S}:${_}`)}const p=await this.client.core.crypto.generateSharedKey(l,c);i.addTrace(Rs.create_authenticated_session_topic);let g;if((d==null?void 0:d.length)>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ve(Nn),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Cf([...new Set(d)],[...new Set(f)]),transportType:a},i.addTrace(Rs.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(w){throw i.setError(Oi.subscribe_authenticated_session_topic_failure),w}i.addTrace(Rs.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),i.addTrace(Rs.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(Rs.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:s,result:{cacaos:n,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw i.setError(Oi.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(s,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:g}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:s,reason:n}=r,i=this.getPendingAuthRequest(s);if(!i)throw new Error(`Could not find pending auth request with id ${s}`);i.transportType===Be.relay&&await this.confirmOnlineStateOrThrow();const o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Fa(o),l={type:Jr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:s,topic:c,error:n,encodeOpts:l,rpcOpts:Je.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(s,{message:"rejected",code:0}),await this.deleteProposal(s)}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:s,iss:n}=r;return om(s,n)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&i.topic&&i.topic!==s.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}}),F(this,"deleteSession",async r=>{var s;const{topic:n,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,Me("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),i||this.client.core.expirer.del(n),this.client.core.storage.removeItem(ip).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===n&&this.deletePendingSessionRequest(l.id,Me("USER_DISCONNECTED"))}),n===((s=this.sessionRequestQueue.queue[0])==null?void 0:s.topic)&&(this.sessionRequestQueue.state=Cr.idle),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),F(this,"deleteProposal",async(r,s)=>{if(s)try{const n=this.client.proposal.get(r),i=this.client.core.eventClient.getEvent({topic:n.pairingTopic});i==null||i.setError($s.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,Me("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,s,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==r),n&&(this.sessionRequestQueue.state=Cr.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,s,n=!1)=>{await Promise.all([this.client.auth.requests.delete(r,s),n?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,s)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,s),await this.client.session.update(r,{expiry:s}))}),F(this,"setProposal",async(r,s)=>{this.client.core.expirer.set(r,Ve(Je.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,s)}),F(this,"setAuthRequest",async(r,s)=>{const{request:n,pairingTopic:i,transportType:o=Be.relay}=s;this.client.core.expirer.set(r,n.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:r,pairingTopic:i,verifyContext:n.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:s,topic:n,params:i,verifyContext:o}=r,a=i.request.expiryTimestamp||Ve(Je.wc_sessionRequest.req.ttl);this.client.core.expirer.set(s,a),await this.client.pendingRequest.set(s,{id:s,topic:n,params:i,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:s,method:n,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h}=r,d=Es(n,i,c);let f;const p=!!u;try{const E=p?ys:wr;f=await this.client.core.crypto.encode(s,d,{encoding:E})}catch(E){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${s} failed`),E}let g;if(kP.includes(n)){const E=xr(JSON.stringify(d)),v=xr(f);g=await this.client.core.verify.register({id:v,decryptedId:E})}const w=Je[n].req;if(w.attestation=g,o&&(w.ttl=o),a&&(w.id=a),this.client.core.history.set(s,d),p){const E=Ea(u,s,f);await global.Linking.openURL(E,this.client.name)}else{const E=Je[n].req;o&&(E.ttl=o),a&&(E.id=a),E.tvf=It(Ue({},h),{correlationId:d.id}),l?(E.internal=It(Ue({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,f,E)):this.client.core.relayer.publish(s,f,E).catch(v=>this.client.logger.error(v))}return d.id}),F(this,"sendResult",async r=>{const{id:s,topic:n,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=_c(s,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?ys:wr;u=await this.client.core.crypto.encode(n,l,It(Ue({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),p}let d,f;try{d=await this.client.core.history.get(n,s);const p=d.request;try{f=this.getTVFParams(s,p.params,i)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${s}) failed`),p}if(h){const p=Ea(c,n,u);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=Je[p].res;g.tvf=It(Ue({},f),{correlationId:s}),o?(g.internal=It(Ue({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,u,g)):this.client.core.relayer.publish(n,u,g).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),F(this,"sendError",async r=>{const{id:s,topic:n,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=Sc(s,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=h?ys:wr;u=await this.client.core.crypto.encode(n,l,It(Ue({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),f}let d;try{d=await this.client.core.history.get(n,s)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${n}, ${s}) failed`),f}if(h){const f=Ea(c,n,u);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||Je[f].res;this.client.core.relayer.publish(n,u,p)}await this.client.core.history.resolve(l)}),F(this,"cleanup",async()=>{const r=[],s=[];this.client.session.getAll().forEach(n=>{let i=!1;ps(n.expiry)&&(i=!0),this.client.core.crypto.keychain.has(n.topic)||(i=!0),i&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{ps(n.expiryTimestamp)&&s.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...s.map(n=>this.deleteProposal(n))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Cr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Cr.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=Cr.idle}),F(this,"processRequest",async r=>{const{topic:s,payload:n,attestation:i,transportType:o,encryptedId:a}=r,c=n.method;if(!this.shouldIgnorePairingRequest({topic:s,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:s,payload:n,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(s,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(s,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(s,n);case"wc_sessionPing":return await this.onSessionPingRequest(s,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(s,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:s,payload:n,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(s,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:s,payload:n,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:s,payload:n,transportType:i}=r,o=(await this.client.core.history.get(s,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(s,n,i);case"wc_sessionSettle":return this.onSessionSettleResponse(s,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,n);case"wc_sessionExtend":return this.onSessionExtendResponse(s,n);case"wc_sessionPing":return this.onSessionPingResponse(s,n);case"wc_sessionRequest":return this.onSessionRequestResponse(s,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(s,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:s}=r,{message:n}=z("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:s,requestMethod:n}=r,i=this.expectedPairingMethodMap.get(s);return!i||i.includes(n)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:s,payload:n,attestation:i,encryptedId:o}=r,{params:a,id:c}=n;try{const l=this.client.core.eventClient.getEvent({topic:s});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(Vr.proposal_listener_not_found)),this.isValidConnect(Ue({},n.params));const u=a.expiryTimestamp||Ve(Je.wc_sessionPropose.req.ttl),h=Ue({id:c,pairingTopic:s,expiryTimestamp:u,attestation:i,encryptedId:o},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:i,hash:xr(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(Ir.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){await this.sendError({id:c,topic:s,error:l,rpcOpts:Je.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),F(this,"onSessionProposeResponse",async(r,s,n)=>{const{id:i}=s;if(Sr(s)){const{result:o}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(i,{sessionTopic:u,pairingTopic:r,proposalId:i,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(tr(s)){await this.deleteProposal(i);const o=_e("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:s.error})}}),F(this,"onSessionSettleRequest",async(r,s)=>{const{id:n,params:i}=s;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=s.params,f=[...this.pendingSessions.values()].find(w=>w.sessionTopic===r);if(!f)return this.client.logger.error(`Pending session not found for topic ${r}`);const p=this.client.proposal.get(f.proposalId),g=It(Ue(Ue(Ue({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:Be.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(_e("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:s.id,topic:r,result:!0})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,s)=>{const{id:n}=s;Sr(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(_e("session_approve",n),{})):tr(s)&&(await this.client.session.delete(r,Me("USER_DISCONNECTED")),this.events.emit(_e("session_approve",n),{error:s.error}))}),F(this,"onSessionUpdateRequest",async(r,s)=>{const{params:n,id:i}=s;try{const o=`${r}_session_update`,a=Ni.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:r,error:Me("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Ue({topic:r},n));try{Ni.set(o,i),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:i,topic:r,result:!0})}catch(c){throw Ni.delete(o),c}this.client.events.emit("session_update",{id:i,topic:r,params:n})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,s)=>s.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,s)=>{const{id:n}=s,i=_e("session_update",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Sr(s)?this.events.emit(_e("session_update",n),{}):tr(s)&&this.events.emit(_e("session_update",n),{error:s.error})}),F(this,"onSessionExtendRequest",async(r,s)=>{const{id:n}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ve(Nn)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(i){await this.sendError({id:n,topic:r,error:i}),this.client.logger.error(i)}}),F(this,"onSessionExtendResponse",(r,s)=>{const{id:n}=s,i=_e("session_extend",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Sr(s)?this.events.emit(_e("session_extend",n),{}):tr(s)&&this.events.emit(_e("session_extend",n),{error:s.error})}),F(this,"onSessionPingRequest",async(r,s)=>{const{id:n}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(i){await this.sendError({id:n,topic:r,error:i}),this.client.logger.error(i)}}),F(this,"onSessionPingResponse",(r,s)=>{const{id:n}=s,i=_e("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Sr(s)?this.events.emit(_e("session_ping",n),{}):tr(s)&&this.events.emit(_e("session_ping",n),{error:s.error})},500)}),F(this,"onSessionDeleteRequest",async(r,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),Promise.all([new Promise(i=>{this.client.core.relayer.once(Ze.publish,async()=>{i(await this.deleteSession({topic:r,id:n}))})}),this.sendResult({id:n,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:Me("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),F(this,"onSessionRequest",async r=>{var s,n,i;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:d}=a;try{await this.isValidRequest(Ue({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:xr(JSON.stringify(Es("wc_sessionRequest",d,h))),encryptedId:l,metadata:f.peer.metadata,transportType:u}),g={id:h,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(g),u===Be.link_mode&&(s=f.peer.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp((n=f.peer.metadata.redirect)==null?void 0:n.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:h,topic:o,error:f}),this.client.logger.error(f)}}),F(this,"onSessionRequestResponse",(r,s)=>{const{id:n}=s,i=_e("session_request",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Sr(s)?this.events.emit(_e("session_request",n),{result:s.result}):tr(s)&&this.events.emit(_e("session_request",n),{error:s.error})}),F(this,"onSessionEventRequest",async(r,s)=>{const{id:n,params:i}=s;try{const o=`${r}_session_event_${i.event.name}`,a=Ni.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(Ue({topic:r},i)),this.client.events.emit("session_event",{id:n,topic:r,params:i}),Ni.set(o,n)}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,s)=>{const{id:n}=s;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:s}),Sr(s)?this.events.emit(_e("session_request",n),{result:s.result}):tr(s)&&this.events.emit(_e("session_request",n),{error:s.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var s;const{topic:n,payload:i,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=i.params,d=await this.getVerifyContext({attestationId:o,hash:xr(JSON.stringify(i)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:n,id:i.id,authPayload:u,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:f,pairingTopic:n,transportType:c}),c===Be.link_mode&&(s=l.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:i.params,id:i.id,verifyContext:d})}catch(l){this.client.logger.error(l);const u=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(i.params.requester.metadata,c),f={type:Jr,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:i.id,topic:n,error:l,encodeOpts:f,rpcOpts:Je.wc_sessionAuthenticate.autoReject,appLink:d})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Cr.idle,this.processSessionRequestQueue()},W.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:s})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(i=>i.topic===r&&i.request.method==="wc_sessionRequest").forEach(i=>{const o=i.request.id,a=_e("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(_e("session_request",i.request.id),{error:s})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Cr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(s){this.client.logger.error(s)}}),F(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Cr.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const s=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);s&&this.onSessionProposeRequest({topic:r.topic,payload:Es("wc_sessionPropose",It(Ue({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties,scopedProperties:s.scopedProperties}),s.id),attestation:s.attestation,encryptedId:s.encryptedId})}),F(this,"isValidConnect",async r=>{if(!Tt(r)){const{message:l}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=r;if(ot(s)||await this.isValidPairingTopic(s),!ex(c)){const{message:l}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!ot(n)&&Rr(n)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(n,"requiredNamespaces")}if(!ot(i)&&Rr(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),ot(o)||this.validateSessionProps(o,"sessionProperties"),!ot(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(n||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),F(this,"validateNamespaces",(r,s)=>{const n=QN(r,"connect()",s);if(n)throw new Error(n.message)}),F(this,"isValidApprove",async r=>{if(!Tt(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:n,relayProtocol:i,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(s),await this.isValidProposalId(s);const c=this.client.proposal.get(s),l=al(n,"approve()");if(l)throw new Error(l.message);const u=_f(c.requiredNamespaces,n,"approve()");if(u)throw new Error(u.message);if(!We(i,!0)){const{message:h}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(ot(o)||this.validateSessionProps(o,"sessionProperties"),!ot(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(n));if(!Object.keys(a).every(d=>h.has(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Tt(r)){const{message:i}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(i)}const{id:s,reason:n}=r;if(this.checkRecentlyDeleted(s),await this.isValidProposalId(s),!rx(n)){const{message:i}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(i)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Tt(r)){const{message:l}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:s,controller:n,namespaces:i,expiry:o}=r;if(!Bm(s)){const{message:l}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=VN(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=al(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(ps(o)){const{message:l}=z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),F(this,"isValidUpdate",async r=>{if(!Tt(r)){const{message:c}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:s,namespaces:n}=r;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);const i=this.client.session.get(s),o=al(n,"update()");if(o)throw new Error(o.message);const a=_f(i.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Tt(r)){const{message:n}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:s}=r;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s)}),F(this,"isValidRequest",async r=>{if(!Tt(r)){const{message:c}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:s,request:n,chainId:i,expiry:o}=r;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);const{namespaces:a}=this.client.session.get(s);if(!If(a,i)){const{message:c}=z("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!sx(n)){const{message:c}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!ox(a,i,n.method)){const{message:c}=z("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}if(o&&!ux(o,pl)){const{message:c}=z("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${pl.min} and ${pl.max}`);throw new Error(c)}}),F(this,"isValidRespond",async r=>{var s;if(!Tt(r)){const{message:o}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:n,response:i}=r;try{await this.isValidSessionTopic(n)}catch(o){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),o}if(!nx(i)){const{message:o}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(o)}}),F(this,"isValidPing",async r=>{if(!Tt(r)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)}),F(this,"isValidEmit",async r=>{if(!Tt(r)){const{message:a}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:s,event:n,chainId:i}=r;await this.isValidSessionTopic(s);const{namespaces:o}=this.client.session.get(s);if(!If(o,i)){const{message:a}=z("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!ix(n)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!ax(o,i,n.name)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Tt(r)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)}),F(this,"isValidAuthenticate",r=>{const{chains:s,uri:n,domain:i,nonce:o}=r;if(!Array.isArray(s)||s.length===0)throw new Error("chains is required and must be a non-empty array");if(!We(n,!1))throw new Error("uri is required parameter");if(!We(i,!1))throw new Error("domain is required parameter");if(!We(o,!1))throw new Error("nonce is required parameter");if([...new Set(s.map(c=>Yn(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Yn(s[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:s,hash:n,encryptedId:i,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Xi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===Be.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:s,hash:n,encryptedId:i,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,s)=>{Object.values(r).forEach((n,i)=>{if(n==null){const{message:o}=z("MISSING_OR_INVALID",`${s} must contain an existing value for each key. Received: ${n} for key ${Object.keys(r)[i]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const s=this.client.auth.requests.get(r);return typeof s=="object"?s:void 0}),F(this,"addToRecentlyDeleted",(r,s)=>{if(this.recentlyDeletedMap.set(r,s),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const i=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(n++>=i)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const s=this.recentlyDeletedMap.get(r);if(s){const{message:n}=z("MISSING_OR_INVALID",`Record was recently deleted - ${s}: ${r}`);throw new Error(n)}}),F(this,"isLinkModeEnabled",(r,s)=>{var n,i,o,a,c,l,u,h,d;return!r||s!==Be.link_mode?!1:((i=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r==null?void 0:r.redirect)==null?void 0:u.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((d=r==null?void 0:r.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,s)=>{var n;return this.isLinkModeEnabled(r,s)?(n=r==null?void 0:r.redirect)==null?void 0:n.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const s=Bd(r,"topic")||"",n=decodeURIComponent(Bd(r,"wc_ev")||""),i=this.client.session.keys.includes(s);i&&this.client.session.update(s,{transportType:Be.link_mode}),this.client.core.dispatchEnvelope({topic:s,message:n,sessionExists:i})}),F(this,"registerLinkModeListeners",async()=>{var r;if(Ju()||Os()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const s=global==null?void 0:global.Linking;if(typeof s<"u"){s.addEventListener("url",this.handleLinkModeMessage,this.client.name);const n=await s.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),F(this,"getTVFParams",(r,s,n)=>{var i,o,a;if(!((i=s.request)!=null&&i.method))return{};const c={correlationId:r,rpcMethods:[s.request.method],chainId:s.chainId};try{const l=this.extractTxHashesFromResult(s.request,n);c.txHashes=l,c.contractAddresses=this.isValidContractData(s.request.params)?[(a=(o=s.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return c}),F(this,"isValidContractData",r=>{var s;if(!r)return!1;try{const n=(r==null?void 0:r.data)||((s=r==null?void 0:r[0])==null?void 0:s.data);if(!n.startsWith("0x"))return!1;const i=n.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,s)=>{var n;try{if(!s)return[];const i=r.method,o=$P[i];if(i==="sui_signTransaction")return[$_(s.transactionBytes)];if(i==="near_signTransaction")return[Hd(s)];if(i==="near_signTransactions")return s.map(c=>Hd(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(n=s.tx_json)==null?void 0:n.hash];if(i==="polkadot_signTransaction")return[_x({transaction:r.params.transactionPayload,signature:s.signature})];if(i==="algo_signTxn")return Xr(s)?s.map(c=>Kd(c)):[Kd(s)];if(i==="cosmos_signDirect")return[k_(s)];if(typeof s=="string")return[s];const a=s[o.key];if(Xr(a))return i==="solana_signAllTransactions"?a.map(c=>D_(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[s,n]of Object.entries(r))for(const i of n)try{await this.onProviderMessageEvent({topic:s,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${s}, message: ${i}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ze.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:s,attestation:n,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(qa)?this.client.auth.authKeys.get(qa):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,s,{receiverPublicKey:o,encoding:i===Be.link_mode?ys:wr});hh(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:n,transportType:i,encryptedId:xr(s)})):Nc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:i}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:i}),await this.client.core.relayer.messages.ack(r,s)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(er.expired,async e=>{const{topic:r,id:s}=Hw(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,z("EXPIRED"),!0);if(s&&this.client.auth.requests.keys.includes(s))return await this.deletePendingAuthRequest(s,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(qs.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(qs.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!We(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(ps(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!We(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(ps(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=z("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(We(e,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!tx(e)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(ps(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=z("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class VP extends fn{constructor(e,r){super(e,r,TP,dh),this.core=e,this.logger=r}}let GP=class extends fn{constructor(e,r){super(e,r,PP,dh),this.core=e,this.logger=r}};class YP extends fn{constructor(e,r){super(e,r,RP,dh,s=>s.id),this.core=e,this.logger=r}}class JP extends fn{constructor(e,r){super(e,r,LP,Oc,()=>qa),this.core=e,this.logger=r}}class XP extends fn{constructor(e,r){super(e,r,MP,Oc),this.core=e,this.logger=r}}class ZP extends fn{constructor(e,r){super(e,r,FP,Oc,s=>s.id),this.core=e,this.logger=r}}var QP=Object.defineProperty,eD=(t,e,r)=>e in t?QP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gl=(t,e,r)=>eD(t,typeof e!="symbol"?e+"":e,r);class tD{constructor(e,r){this.core=e,this.logger=r,gl(this,"authKeys"),gl(this,"pairingTopics"),gl(this,"requests"),this.authKeys=new JP(this.core,this.logger),this.pairingTopics=new XP(this.core,this.logger),this.requests=new ZP(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var rD=Object.defineProperty,sD=(t,e,r)=>e in t?rD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fe=(t,e,r)=>sD(t,typeof e!="symbol"?e+"":e,r);let nD=class u0 extends dv{constructor(e){super(e),fe(this,"protocol",a0),fe(this,"version",c0),fe(this,"name",fl.name),fe(this,"metadata"),fe(this,"core"),fe(this,"logger"),fe(this,"events",new or.EventEmitter),fe(this,"engine"),fe(this,"session"),fe(this,"proposal"),fe(this,"pendingRequest"),fe(this,"auth"),fe(this,"signConfig"),fe(this,"on",(s,n)=>this.events.on(s,n)),fe(this,"once",(s,n)=>this.events.once(s,n)),fe(this,"off",(s,n)=>this.events.off(s,n)),fe(this,"removeListener",(s,n)=>this.events.removeListener(s,n)),fe(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),fe(this,"connect",async s=>{try{return await this.engine.connect(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"pair",async s=>{try{return await this.engine.pair(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"approve",async s=>{try{return await this.engine.approve(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"reject",async s=>{try{return await this.engine.reject(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"update",async s=>{try{return await this.engine.update(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"extend",async s=>{try{return await this.engine.extend(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"request",async s=>{try{return await this.engine.request(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"respond",async s=>{try{return await this.engine.respond(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"ping",async s=>{try{return await this.engine.ping(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"emit",async s=>{try{return await this.engine.emit(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"disconnect",async s=>{try{return await this.engine.disconnect(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"find",s=>{try{return this.engine.find(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),fe(this,"authenticate",async(s,n)=>{try{return await this.engine.authenticate(s,n)}catch(i){throw this.logger.error(i.message),i}}),fe(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"approveSessionAuthenticate",async s=>{try{return await this.engine.approveSessionAuthenticate(s)}catch(n){throw this.logger.error(n.message),n}}),fe(this,"rejectSessionAuthenticate",async s=>{try{return await this.engine.rejectSessionAuthenticate(s)}catch(n){throw this.logger.error(n.message),n}}),this.name=(e==null?void 0:e.name)||fl.name,this.metadata=II(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:zo(Ho({level:(e==null?void 0:e.logger)||fl.logger}));this.core=(e==null?void 0:e.core)||new OP(e),this.logger=Et(r,this.name),this.session=new GP(this.core,this.logger),this.proposal=new VP(this.core,this.logger),this.pendingRequest=new YP(this.core,this.logger),this.engine=new KP(this),this.auth=new tD(this.core,this.logger)}static async init(e){const r=new u0(e);return await r.initialize(),r}get context(){return kt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var vu={exports:{}};(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Nr<"u"&&Nr,s=function(){function i(){this.fetch=!1,this.DOMException=r.DOMException}return i.prototype=r,new i}();(function(i){(function(o){var a=typeof i<"u"&&i||typeof self<"u"&&self||typeof Nr<"u"&&Nr||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(m){return m&&DataView.prototype.isPrototypeOf(m)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(m){return m&&u.indexOf(Object.prototype.toString.call(m))>-1};function d(m){if(typeof m!="string"&&(m=String(m)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(m)||m==="")throw new TypeError('Invalid character in header field name: "'+m+'"');return m.toLowerCase()}function f(m){return typeof m!="string"&&(m=String(m)),m}function p(m){var b={next:function(){var I=m.shift();return{done:I===void 0,value:I}}};return c.iterable&&(b[Symbol.iterator]=function(){return b}),b}function g(m){this.map={},m instanceof g?m.forEach(function(b,I){this.append(I,b)},this):Array.isArray(m)?m.forEach(function(b){if(b.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+b.length);this.append(b[0],b[1])},this):m&&Object.getOwnPropertyNames(m).forEach(function(b){this.append(b,m[b])},this)}g.prototype.append=function(m,b){m=d(m),b=f(b);var I=this.map[m];this.map[m]=I?I+", "+b:b},g.prototype.delete=function(m){delete this.map[d(m)]},g.prototype.get=function(m){return m=d(m),this.has(m)?this.map[m]:null},g.prototype.has=function(m){return this.map.hasOwnProperty(d(m))},g.prototype.set=function(m,b){this.map[d(m)]=f(b)},g.prototype.forEach=function(m,b){for(var I in this.map)this.map.hasOwnProperty(I)&&m.call(b,this.map[I],I,this)},g.prototype.keys=function(){var m=[];return this.forEach(function(b,I){m.push(I)}),p(m)},g.prototype.values=function(){var m=[];return this.forEach(function(b){m.push(b)}),p(m)},g.prototype.entries=function(){var m=[];return this.forEach(function(b,I){m.push([I,b])}),p(m)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function w(m){if(!m._noBody){if(m.bodyUsed)return Promise.reject(new TypeError("Already read"));m.bodyUsed=!0}}function E(m){return new Promise(function(b,I){m.onload=function(){b(m.result)},m.onerror=function(){I(m.error)}})}function v(m){var b=new FileReader,I=E(b);return b.readAsArrayBuffer(m),I}function C(m){var b=new FileReader,I=E(b),x=/charset=([A-Za-z0-9_-]+)/.exec(m.type),N=x?x[1]:"utf-8";return b.readAsText(m,N),I}function _(m){for(var b=new Uint8Array(m),I=new Array(b.length),x=0;x<b.length;x++)I[x]=String.fromCharCode(b[x]);return I.join("")}function S(m){if(m.slice)return m.slice(0);var b=new Uint8Array(m.byteLength);return b.set(new Uint8Array(m)),b.buffer}function k(){return this.bodyUsed=!1,this._initBody=function(m){this.bodyUsed=this.bodyUsed,this._bodyInit=m,m?typeof m=="string"?this._bodyText=m:c.blob&&Blob.prototype.isPrototypeOf(m)?this._bodyBlob=m:c.formData&&FormData.prototype.isPrototypeOf(m)?this._bodyFormData=m:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)?this._bodyText=m.toString():c.arrayBuffer&&c.blob&&l(m)?(this._bodyArrayBuffer=S(m.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(m)||h(m))?this._bodyArrayBuffer=S(m):this._bodyText=m=Object.prototype.toString.call(m):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof m=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(m)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var m=w(this);if(m)return m;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var m=w(this);return m||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(v);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var m=w(this);if(m)return m;if(this._bodyBlob)return C(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(_(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(D)}),this.json=function(){return this.text().then(JSON.parse)},this}var L=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function R(m){var b=m.toUpperCase();return L.indexOf(b)>-1?b:m}function A(m,b){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');b=b||{};var I=b.body;if(m instanceof A){if(m.bodyUsed)throw new TypeError("Already read");this.url=m.url,this.credentials=m.credentials,b.headers||(this.headers=new g(m.headers)),this.method=m.method,this.mode=m.mode,this.signal=m.signal,!I&&m._bodyInit!=null&&(I=m._bodyInit,m.bodyUsed=!0)}else this.url=String(m);if(this.credentials=b.credentials||this.credentials||"same-origin",(b.headers||!this.headers)&&(this.headers=new g(b.headers)),this.method=R(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.signal=b.signal||this.signal||function(){if("AbortController"in a){var P=new AbortController;return P.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&I)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(I),(this.method==="GET"||this.method==="HEAD")&&(b.cache==="no-store"||b.cache==="no-cache")){var x=/([?&])_=[^&]*/;if(x.test(this.url))this.url=this.url.replace(x,"$1_="+new Date().getTime());else{var N=/\?/;this.url+=(N.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function D(m){var b=new FormData;return m.trim().split("&").forEach(function(I){if(I){var x=I.split("="),N=x.shift().replace(/\+/g," "),P=x.join("=").replace(/\+/g," ");b.append(decodeURIComponent(N),decodeURIComponent(P))}}),b}function T(m){var b=new g,I=m.replace(/\r?\n[\t ]+/g," ");return I.split("\r").map(function(x){return x.indexOf(`
`)===0?x.substr(1,x.length):x}).forEach(function(x){var N=x.split(":"),P=N.shift().trim();if(P){var M=N.join(":").trim();try{b.append(P,M)}catch(G){console.warn("Response "+G.message)}}}),b}k.call(A.prototype);function O(m,b){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(b||(b={}),this.type="default",this.status=b.status===void 0?200:b.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=b.statusText===void 0?"":""+b.statusText,this.headers=new g(b.headers),this.url=b.url||"",this._initBody(m)}k.call(O.prototype),O.prototype.clone=function(){return new O(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},O.error=function(){var m=new O(null,{status:200,statusText:""});return m.ok=!1,m.status=0,m.type="error",m};var $=[301,302,303,307,308];O.redirect=function(m,b){if($.indexOf(b)===-1)throw new RangeError("Invalid status code");return new O(null,{status:b,headers:{location:m}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(b,I){this.message=b,this.name=I;var x=Error(b);this.stack=x.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function j(m,b){return new Promise(function(I,x){var N=new A(m,b);if(N.signal&&N.signal.aborted)return x(new o.DOMException("Aborted","AbortError"));var P=new XMLHttpRequest;function M(){P.abort()}P.onload=function(){var K={statusText:P.statusText,headers:T(P.getAllResponseHeaders()||"")};N.url.indexOf("file://")===0&&(P.status<200||P.status>599)?K.status=200:K.status=P.status,K.url="responseURL"in P?P.responseURL:K.headers.get("X-Request-URL");var Z="response"in P?P.response:P.responseText;setTimeout(function(){I(new O(Z,K))},0)},P.onerror=function(){setTimeout(function(){x(new TypeError("Network request failed"))},0)},P.ontimeout=function(){setTimeout(function(){x(new TypeError("Network request timed out"))},0)},P.onabort=function(){setTimeout(function(){x(new o.DOMException("Aborted","AbortError"))},0)};function G(K){try{return K===""&&a.location.href?a.location.href:K}catch{return K}}if(P.open(N.method,G(N.url),!0),N.credentials==="include"?P.withCredentials=!0:N.credentials==="omit"&&(P.withCredentials=!1),"responseType"in P&&(c.blob?P.responseType="blob":c.arrayBuffer&&(P.responseType="arraybuffer")),b&&typeof b.headers=="object"&&!(b.headers instanceof g||a.Headers&&b.headers instanceof a.Headers)){var X=[];Object.getOwnPropertyNames(b.headers).forEach(function(K){X.push(d(K)),P.setRequestHeader(K,f(b.headers[K]))}),N.headers.forEach(function(K,Z){X.indexOf(Z)===-1&&P.setRequestHeader(Z,K)})}else N.headers.forEach(function(K,Z){P.setRequestHeader(Z,K)});N.signal&&(N.signal.addEventListener("abort",M),P.onreadystatechange=function(){P.readyState===4&&N.signal.removeEventListener("abort",M)}),P.send(typeof N._bodyInit>"u"?null:N._bodyInit)})}return j.polyfill=!0,a.fetch||(a.fetch=j,a.Headers=g,a.Request=A,a.Response=O),o.Headers=g,o.Request=A,o.Response=O,o.fetch=j,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var n=r.fetch?r:s;e=n.fetch,e.default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e})(vu,vu.exports);var iD=vu.exports;const cp=Du(iD);var oD=Object.defineProperty,aD=Object.defineProperties,cD=Object.getOwnPropertyDescriptors,lp=Object.getOwnPropertySymbols,lD=Object.prototype.hasOwnProperty,uD=Object.prototype.propertyIsEnumerable,up=(t,e,r)=>e in t?oD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hp=(t,e)=>{for(var r in e||(e={}))lD.call(e,r)&&up(t,r,e[r]);if(lp)for(var r of lp(e))uD.call(e,r)&&up(t,r,e[r]);return t},dp=(t,e)=>aD(t,cD(e));const hD={Accept:"application/json","Content-Type":"application/json"},dD="POST",fp={headers:hD,method:dD},pp=10;let yr=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new or.EventEmitter,this.isAvailable=!1,this.registering=!1,!Pf(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Qr(e),s=await(await cp(this.url,dp(hp({},fp),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!Pf(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,n)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),n(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return n(new Error("HTTP connection is missing or invalid"));s()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Qr({id:1,jsonrpc:"2.0",method:"test",params:[]});await cp(e,dp(hp({},fp),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?tn(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const s=this.parseError(r),n=s.message||s.toString(),i=Sc(e,n);this.events.emit("payload",i)}parseError(e,r=this.url){return Fm(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>pp&&this.events.setMaxListeners(pp)}};const gp="error",fD="wss://relay.walletconnect.org",pD="wc",gD="universal_provider",Aa=`${pD}@2:${gD}:`,h0="https://rpc.walletconnect.org/v1/",qn="generic",wD=`${h0}bundler`,cr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function fh(t){return t==null||typeof t!="object"&&typeof t!="function"}function d0(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function f0(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const mD="[object RegExp]",p0="[object String]",g0="[object Number]",w0="[object Boolean]",m0="[object Arguments]",yD="[object Symbol]",bD="[object Date]",vD="[object Map]",ED="[object Set]",CD="[object Array]",AD="[object ArrayBuffer]",ID="[object Object]",_D="[object DataView]",SD="[object Uint8Array]",ND="[object Uint8ClampedArray]",xD="[object Uint16Array]",OD="[object Uint32Array]",TD="[object Int8Array]",PD="[object Int16Array]",DD="[object Int32Array]",$D="[object Float32Array]",RD="[object Float64Array]";function ph(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function kD(t,e){return Kn(t,void 0,t,new Map,e)}function Kn(t,e,r,s=new Map,n=void 0){const i=n==null?void 0:n(t,e,r,s);if(i!=null)return i;if(fh(t))return t;if(s.has(t))return s.get(t);if(Array.isArray(t)){const o=new Array(t.length);s.set(t,o);for(let a=0;a<t.length;a++)o[a]=Kn(t[a],a,r,s,n);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;s.set(t,o);for(const[a,c]of t)o.set(a,Kn(c,a,r,s,n));return o}if(t instanceof Set){const o=new Set;s.set(t,o);for(const a of t)o.add(Kn(a,void 0,r,s,n));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(ph(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);s.set(t,o);for(let a=0;a<t.length;a++)o[a]=Kn(t[a],a,r,s,n);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return s.set(t,o),zs(o,t,r,s,n),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return s.set(t,o),zs(o,t,r,s,n),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return s.set(t,o),zs(o,t,r,s,n),o}if(t instanceof Error){const o=new t.constructor;return s.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,zs(o,t,r,s,n),o}if(typeof t=="object"&&UD(t)){const o=Object.create(Object.getPrototypeOf(t));return s.set(t,o),zs(o,t,r,s,n),o}return t}function zs(t,e,r=t,s,n){const i=[...Object.keys(e),...d0(e)];for(let o=0;o<i.length;o++){const a=i[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=Kn(e[a],a,r,s,n))}}function UD(t){switch(f0(t)){case m0:case CD:case AD:case _D:case w0:case bD:case $D:case RD:case TD:case PD:case DD:case vD:case g0:case ID:case mD:case ED:case p0:case yD:case SD:case ND:case xD:case OD:return!0;default:return!1}}function BD(t,e){return kD(t,(r,s,n,i)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case g0:case p0:case w0:{const o=new t.constructor(t==null?void 0:t.valueOf());return zs(o,t),o}case m0:{const o={};return zs(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function wp(t){return BD(t)}function mp(t){return t!==null&&typeof t=="object"&&f0(t)==="[object Arguments]"}function yp(t){return typeof t=="object"&&t!==null}function LD(){}function MD(t){return ph(t)}function FD(t){var r;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const s=t[Symbol.toStringTag];return s==null||!((r=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&r.writable)?!1:t.toString()===`[object ${s}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function jD(t){if(fh(t))return t;if(Array.isArray(t)||ph(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const s=new r(t);return s.lastIndex=t.lastIndex,s}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const s=new r(t.message);return s.stack=t.stack,s.name=t.name,s.cause=t.cause,s}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const s=Object.create(e);return Object.assign(s,t)}return t}function qD(t,...e){const r=e.slice(0,-1),s=e[e.length-1];let n=t;for(let i=0;i<r.length;i++){const o=r[i];n=Eu(n,o,s,new Map)}return n}function Eu(t,e,r,s){if(fh(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(s.has(e))return jD(s.get(e));if(s.set(e,t),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}const n=[...Object.keys(e),...d0(e)];for(let i=0;i<n.length;i++){const o=n[i];let a=e[o],c=t[o];if(mp(a)&&(a={...a}),mp(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=wp(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let d=0;d<h.length;d++){const f=h[d];u[f]=c[f]}c=u}else c=[];const l=r(c,a,o,t,e,s);l!=null?t[o]=l:Array.isArray(a)||yp(c)&&yp(a)?t[o]=Eu(c,a,r,s):c==null&&FD(a)?t[o]=Eu({},a,r,s):c==null&&MD(a)?t[o]=wp(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function zD(t,...e){return qD(t,...e,LD)}var WD=Object.defineProperty,HD=Object.defineProperties,KD=Object.getOwnPropertyDescriptors,bp=Object.getOwnPropertySymbols,VD=Object.prototype.hasOwnProperty,GD=Object.prototype.propertyIsEnumerable,vp=(t,e,r)=>e in t?WD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ia=(t,e)=>{for(var r in e||(e={}))VD.call(e,r)&&vp(t,r,e[r]);if(bp)for(var r of bp(e))GD.call(e,r)&&vp(t,r,e[r]);return t},YD=(t,e)=>HD(t,KD(e));function Kt(t,e,r){var s;const n=Yn(t);return((s=e.rpcMap)==null?void 0:s[n.reference])||`${h0}?chainId=${n.namespace}:${n.reference}&projectId=${r}`}function pn(t){return t.includes(":")?t.split(":")[1]:t}function y0(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function JD(t,e){const r=Object.keys(e.namespaces).filter(n=>n.includes(t));if(!r.length)return[];const s=[];return r.forEach(n=>{const i=e.namespaces[n].accounts;s.push(...i)}),s}function Ep(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var s,n;return((s=r==null?void 0:r.chains)==null?void 0:s.length)&&((n=r==null?void 0:r.chains)==null?void 0:n.length)>0}))}function _a(t={},e={}){const r=Ep(Cp(t)),s=Ep(Cp(e));return zD(r,s)}function Cp(t){var e,r,s,n,i;const o={};if(!Rr(t))return o;for(const[a,c]of Object.entries(t)){const l=Ic(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],d=c.rpcMap||{},f=Hn(a);o[f]=YD(Ia(Ia({},o[f]),c),{chains:$r(l,(e=o[f])==null?void 0:e.chains),methods:$r(u,(r=o[f])==null?void 0:r.methods),events:$r(h,(s=o[f])==null?void 0:s.events)}),(Rr(d)||Rr(((n=o[f])==null?void 0:n.rpcMap)||{}))&&(o[f].rpcMap=Ia(Ia({},d),(i=o[f])==null?void 0:i.rpcMap))}return o}function Ap(t){return t.includes(":")?t.split(":")[2]:t}function Ip(t){const e={};for(const[r,s]of Object.entries(t)){const n=s.methods||[],i=s.events||[],o=s.accounts||[],a=Ic(r)?[r]:s.chains?s.chains:y0(s.accounts);e[r]={chains:a,methods:n,events:i,accounts:o}}return e}function wl(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const b0={},Ee=t=>b0[t],ml=(t,e)=>{b0[t]=e};var XD=Object.defineProperty,_p=Object.getOwnPropertySymbols,ZD=Object.prototype.hasOwnProperty,QD=Object.prototype.propertyIsEnumerable,Sp=(t,e,r)=>e in t?XD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Np=(t,e)=>{for(var r in e||(e={}))ZD.call(e,r)&&Sp(t,r,e[r]);if(_p)for(var r of _p(e))QD.call(e,r)&&Sp(t,r,e[r]);return t};const xp="eip155",e$=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],t$=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,yl=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,Op=t=>Object.keys(t).filter(e=>e$.includes(e)).reduce((e,r)=>(e[r]=t[r],e),{}),r$=(t,e,r)=>{const{sessionProperties:s={},scopedProperties:n={}}=t,i={};if(!Rr(n)&&!Rr(s))return;const o=Op(s);for(const a of r){const c=t$(a);if(!c)continue;i[yl(c)]=o;const l=n==null?void 0:n[`${xp}:${c}`];if(l){const u=l==null?void 0:l[`${xp}:${c}:${e}`];i[yl(c)]=Np(Np({},i[yl(c)]),Op(u||l))}}for(const[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0};var s$=Object.defineProperty,n$=(t,e,r)=>e in t?s$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xn=(t,e,r)=>n$(t,typeof e!="symbol"?e+"":e,r);class i${constructor(e){xn(this,"name","polkadot"),xn(this,"client"),xn(this,"httpProviders"),xn(this,"events"),xn(this,"namespace"),xn(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const n=pn(r);e[n]=this.createHttpProvider(n,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}}var o$=Object.defineProperty,a$=Object.defineProperties,c$=Object.getOwnPropertyDescriptors,Tp=Object.getOwnPropertySymbols,l$=Object.prototype.hasOwnProperty,u$=Object.prototype.propertyIsEnumerable,Cu=(t,e,r)=>e in t?o$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pp=(t,e)=>{for(var r in e||(e={}))l$.call(e,r)&&Cu(t,r,e[r]);if(Tp)for(var r of Tp(e))u$.call(e,r)&&Cu(t,r,e[r]);return t},Dp=(t,e)=>a$(t,c$(e)),On=(t,e,r)=>Cu(t,typeof e!="symbol"?e+"":e,r);class h${constructor(e){On(this,"name","eip155"),On(this,"client"),On(this,"chainId"),On(this,"namespace"),On(this,"httpProviders"),On(this,"events"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const s=r||Kt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const n=parseInt(pn(r));e[n]=this.createHttpProvider(n,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,s;let n=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;const i=parseInt(n,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:n}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,s,n,i,o;const a=(s=(r=e.request)==null?void 0:r.params)==null?void 0:s[0],c=((i=(n=e.request)==null?void 0:n.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,d=u==null?void 0:u[h];if(d)return d;let f;try{f=r$(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(f)return f;const p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Dp(Pp({},l.sessionProperties||{}),{capabilities:Dp(Pp({},u||{}),{[h]:p})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return p}async getCallStatus(e){var r,s;const n=this.client.session.get(e.topic),i=(r=n.sessionProperties)==null?void 0:r.bundler_name;if(i){const a=this.getBundlerUrl(e.chainId,i);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(s=n.sessionProperties)==null?void 0:s.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var s;const n=new URL(e),i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Es("eth_getUserOperationReceipt",[(s=r.request.params)==null?void 0:s[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return await i.json()}getBundlerUrl(e,r){return`${wD}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}}var d$=Object.defineProperty,f$=(t,e,r)=>e in t?d$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tn=(t,e,r)=>f$(t,typeof e!="symbol"?e+"":e,r);class p${constructor(e){Tn(this,"name","solana"),Tn(this,"client"),Tn(this,"httpProviders"),Tn(this,"events"),Tn(this,"namespace"),Tn(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const n=pn(r);e[n]=this.createHttpProvider(n,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}}var g$=Object.defineProperty,w$=(t,e,r)=>e in t?g$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pn=(t,e,r)=>w$(t,typeof e!="symbol"?e+"":e,r);class m${constructor(e){Pn(this,"name","cosmos"),Pn(this,"client"),Pn(this,"httpProviders"),Pn(this,"events"),Pn(this,"namespace"),Pn(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const n=pn(r);e[n]=this.createHttpProvider(n,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}}var y$=Object.defineProperty,b$=(t,e,r)=>e in t?y$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dn=(t,e,r)=>b$(t,typeof e!="symbol"?e+"":e,r);class v${constructor(e){Dn(this,"name","algorand"),Dn(this,"client"),Dn(this,"httpProviders"),Dn(this,"events"),Dn(this,"namespace"),Dn(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(!this.httpProviders[e]){const s=r||Kt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new ar(new yr(s,Ee("disableProviderPing")))}}var E$=Object.defineProperty,C$=(t,e,r)=>e in t?E$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$n=(t,e,r)=>C$(t,typeof e!="symbol"?e+"":e,r);class A${constructor(e){$n(this,"name","cip34"),$n(this,"client"),$n(this,"httpProviders"),$n(this,"events"),$n(this,"namespace"),$n(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),n=pn(r);e[n]=this.createHttpProvider(n,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}}var I$=Object.defineProperty,_$=(t,e,r)=>e in t?I$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rn=(t,e,r)=>_$(t,typeof e!="symbol"?e+"":e,r);class S${constructor(e){Rn(this,"name","elrond"),Rn(this,"client"),Rn(this,"httpProviders"),Rn(this,"events"),Rn(this,"namespace"),Rn(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const n=pn(r);e[n]=this.createHttpProvider(n,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}}var N$=Object.defineProperty,x$=(t,e,r)=>e in t?N$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kn=(t,e,r)=>x$(t,typeof e!="symbol"?e+"":e,r);class O${constructor(e){kn(this,"name","multiversx"),kn(this,"client"),kn(this,"httpProviders"),kn(this,"events"),kn(this,"namespace"),kn(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const n=pn(r);e[n]=this.createHttpProvider(n,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}}var T$=Object.defineProperty,P$=(t,e,r)=>e in t?T$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Un=(t,e,r)=>P$(t,typeof e!="symbol"?e+"":e,r);class D${constructor(e){Un(this,"name","near"),Un(this,"client"),Un(this,"httpProviders"),Un(this,"events"),Un(this,"namespace"),Un(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const s=r||Kt(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace);return typeof s>"u"?void 0:new ar(new yr(s,Ee("disableProviderPing")))}}var $$=Object.defineProperty,R$=(t,e,r)=>e in t?$$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bn=(t,e,r)=>R$(t,typeof e!="symbol"?e+"":e,r);class k${constructor(e){Bn(this,"name","tezos"),Bn(this,"client"),Bn(this,"httpProviders"),Bn(this,"events"),Bn(this,"namespace"),Bn(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const s=r||Kt(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace);return typeof s>"u"?void 0:new ar(new yr(s))}}var U$=Object.defineProperty,B$=(t,e,r)=>e in t?U$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ln=(t,e,r)=>B$(t,typeof e!="symbol"?e+"":e,r);class L${constructor(e){Ln(this,"name",qn),Ln(this,"client"),Ln(this,"httpProviders"),Ln(this,"events"),Ln(this,"namespace"),Ln(this,"chainId"),this.namespace=e.namespace,this.events=Ee("events"),this.client=Ee("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(cr.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const s={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(n=>{const i=Yn(n);s[`${i.namespace}:${i.reference}`]=this.createHttpProvider(n)}),s}getHttpProvider(e){const r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Kt(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new ar(new yr(s,Ee("disableProviderPing")))}}var M$=Object.defineProperty,F$=Object.defineProperties,j$=Object.getOwnPropertyDescriptors,$p=Object.getOwnPropertySymbols,q$=Object.prototype.hasOwnProperty,z$=Object.prototype.propertyIsEnumerable,Au=(t,e,r)=>e in t?M$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sa=(t,e)=>{for(var r in e||(e={}))q$.call(e,r)&&Au(t,r,e[r]);if($p)for(var r of $p(e))z$.call(e,r)&&Au(t,r,e[r]);return t},bl=(t,e)=>F$(t,j$(e)),Jt=(t,e,r)=>Au(t,typeof e!="symbol"?e+"":e,r);class Tc{constructor(e){Jt(this,"client"),Jt(this,"namespaces"),Jt(this,"optionalNamespaces"),Jt(this,"sessionProperties"),Jt(this,"scopedProperties"),Jt(this,"events",new Ru),Jt(this,"rpcProviders",{}),Jt(this,"session"),Jt(this,"providerOpts"),Jt(this,"logger"),Jt(this,"uri"),Jt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:zo(Ho({level:(e==null?void 0:e.logger)||gp})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new Tc(e);return await r.initialize(),r}async request(e,r,s){const[n,i]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Sa({},e),chainId:`${n}:${i}`,topic:this.session.topic,expiry:s})}sendAsync(e,r,s,n){const i=new Date().getTime();this.request(e,s,n).then(o=>r(null,_c(i,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Me("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:s,response:n}=await this.client.authenticate(e,r);s&&(this.uri=s,this.events.emit("display_uri",s));const i=await n();if(this.session=i.session,this.session){const o=Ip(this.session.namespaces);this.namespaces=_a(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return i}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const n=await s();this.session=n;const i=Ip(n.namespaces);return this.namespaces=_a(this.namespaces,i),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[s,n]=this.validateChain(e),i=this.getProvider(s);i.name===qn?i.setDefaultChain(`${s}:${n}`,r):i.setDefaultChain(n,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Xr(r)){for(const s of r)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await nD.init({core:this.providerOpts.core,logger:this.providerOpts.logger||gp,relayUrl:this.providerOpts.relayUrl||fD,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(s){throw this.logger.error("Failed to get session",s),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const s=this.client.session.getAll();this.session=s[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>Hn(r)))];ml("client",this.client),ml("events",this.events),ml("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const s=JD(r,this.session);if((s==null?void 0:s.length)===0)return;const n=y0(s),i=_a(this.namespaces,this.optionalNamespaces),o=bl(Sa({},i[r]),{accounts:s,chains:n});switch(r){case"eip155":this.rpcProviders[r]=new h$({namespace:o});break;case"algorand":this.rpcProviders[r]=new v$({namespace:o});break;case"solana":this.rpcProviders[r]=new p$({namespace:o});break;case"cosmos":this.rpcProviders[r]=new m$({namespace:o});break;case"polkadot":this.rpcProviders[r]=new i$({namespace:o});break;case"cip34":this.rpcProviders[r]=new A$({namespace:o});break;case"elrond":this.rpcProviders[r]=new S$({namespace:o});break;case"multiversx":this.rpcProviders[r]=new O$({namespace:o});break;case"near":this.rpcProviders[r]=new D$({namespace:o});break;case"tezos":this.rpcProviders[r]=new k$({namespace:o});break;default:this.rpcProviders[qn]?this.rpcProviders[qn].updateNamespace(o):this.rpcProviders[qn]=new L$({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:s}=e;s===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:s,topic:n}=e;if(n!==((r=this.session)==null?void 0:r.topic))return;const{event:i}=s;if(i.name==="accountsChanged"){const o=i.data;o&&Xr(o)&&this.events.emit("accountsChanged",o.map(Ap))}else if(i.name==="chainChanged"){const o=s.chainId,a=s.event.data,c=Hn(o),l=wl(o)!==wl(a)?`${c}:${wl(a)}`:o;this.onChainChanged(l)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var s,n;if(e!==((s=this.session)==null?void 0:s.topic))return;const{namespaces:i}=r,o=(n=this.client)==null?void 0:n.session.get(e);this.session=bl(Sa({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",bl(Sa({},Me("USER_DISCONNECTED")),{data:e.topic})))}),this.on(cr.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[qn]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:s={},sessionProperties:n,scopedProperties:i}=e;this.optionalNamespaces=_a(r,s),this.sessionProperties=n,this.scopedProperties=i}validateChain(e){const[r,s]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(o=>Hn(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const n=Hn(Object.keys(this.namespaces)[0]),i=this.rpcProviders[n].getDefaultChain();return[n,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,r=!1){if(!this.namespaces)return;const[s,n]=this.validateChain(e);if(!n)return;this.updateNamespaceChain(s,n),this.events.emit("chainChanged",n);const i=this.getProvider(s).getDefaultChain();r||this.getProvider(s).setDefaultChain(n),this.emitAccountsChangedOnChainChange({namespace:s,previousChainId:i,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:r,newChainId:s}){var n,i;try{if(r===s)return;const o=(i=(n=this.session)==null?void 0:n.namespaces[e])==null?void 0:i.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${s}:`)).map(Ap);if(!Xr(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,r){if(!this.namespaces)return;const s=this.namespaces[e]?e:`${e}:${r}`,n={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[s]?this.namespaces[s]&&(this.namespaces[s].defaultChain=r):this.namespaces[s]=n}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var s;const n=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.setItem(`${Aa}/${e}${n}`,r)}async getFromStore(e){var r;const s=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Aa}/${e}${s}`)}async deleteFromStore(e){var r;const s=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Aa}/${e}${s}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const s of r)s.startsWith(Aa)&&await this.client.core.storage.removeItem(s)}catch(r){this.logger.warn("Failed to cleanup storage",r)}}}const W$=Tc;var Rp={};const B={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"ID_AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos",sui:"Sui",stacks:"Stacks"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],HTTP_STATUS_CODES:{SERVER_ERROR:500,TOO_MANY_REQUESTS:429,SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof process<"u"&&typeof Rp<"u"?Rp.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",REMOTE_FEATURES_ALERTS:{MULTI_WALLET_NOT_ENABLED:{DEFAULT:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com."},CONNECTIONS_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnections hook."},CONNECTION_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnection hook."}}}},v0={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return(t==null?void 0:t.filter(r=>r.chainNamespace===e))||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]},getNetworkNameByCaipNetworkId(t,e){var n;if(!e)return;const r=t.find(i=>i.caipNetworkId===e);if(r)return r.name;const[s]=e.split(":");return((n=B.CHAIN_NAME_MAP)==null?void 0:n[s])||void 0}},E0=["eip155","solana","polkadot","bip122","cosmos","sui","stacks"];var H$=20,K$=1,on=1e6,kp=1e6,V$=-7,G$=21,Y$=!1,Qo="[big.js] ",gn=Qo+"Invalid ",Pc=gn+"decimal places",J$=gn+"rounding mode",C0=Qo+"Division by zero",xe={},kr=void 0,X$=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function A0(){function t(e){var r=this;if(!(r instanceof t))return e===kr?A0():new t(e);if(e instanceof t)r.s=e.s,r.e=e.e,r.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(gn+"value");e=e===0&&1/e<0?"-0":String(e)}Z$(r,e)}r.constructor=t}return t.prototype=xe,t.DP=H$,t.RM=K$,t.NE=V$,t.PE=G$,t.strict=Y$,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function Z$(t,e){var r,s,n;if(!X$.test(e))throw Error(gn+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(r=e.indexOf("."))>-1&&(e=e.replace(".","")),(s=e.search(/e/i))>0?(r<0&&(r=s),r+=+e.slice(s+1),e=e.substring(0,s)):r<0&&(r=e.length),n=e.length,s=0;s<n&&e.charAt(s)=="0";)++s;if(s==n)t.c=[t.e=0];else{for(;n>0&&e.charAt(--n)=="0";);for(t.e=r-s-1,t.c=[],r=0;s<=n;)t.c[r++]=+e.charAt(s++)}return t}function wn(t,e,r,s){var n=t.c;if(r===kr&&(r=t.constructor.RM),r!==0&&r!==1&&r!==2&&r!==3)throw Error(J$);if(e<1)s=r===3&&(s||!!n[0])||e===0&&(r===1&&n[0]>=5||r===2&&(n[0]>5||n[0]===5&&(s||n[1]!==kr))),n.length=1,s?(t.e=t.e-e+1,n[0]=1):n[0]=t.e=0;else if(e<n.length){if(s=r===1&&n[e]>=5||r===2&&(n[e]>5||n[e]===5&&(s||n[e+1]!==kr||n[e-1]&1))||r===3&&(s||!!n[0]),n.length=e,s){for(;++n[--e]>9;)if(n[e]=0,e===0){++t.e,n.unshift(1);break}}for(e=n.length;!n[--e];)n.pop()}return t}function mn(t,e,r){var s=t.e,n=t.c.join(""),i=n.length;if(e)n=n.charAt(0)+(i>1?"."+n.slice(1):"")+(s<0?"e":"e+")+s;else if(s<0){for(;++s;)n="0"+n;n="0."+n}else if(s>0)if(++s>i)for(s-=i;s--;)n+="0";else s<i&&(n=n.slice(0,s)+"."+n.slice(s));else i>1&&(n=n.charAt(0)+"."+n.slice(1));return t.s<0&&r?"-"+n:n}xe.abs=function(){var t=new this.constructor(this);return t.s=1,t};xe.cmp=function(t){var e,r=this,s=r.c,n=(t=new r.constructor(t)).c,i=r.s,o=t.s,a=r.e,c=t.e;if(!s[0]||!n[0])return s[0]?i:n[0]?-o:0;if(i!=o)return i;if(e=i<0,a!=c)return a>c^e?1:-1;for(o=(a=s.length)<(c=n.length)?a:c,i=-1;++i<o;)if(s[i]!=n[i])return s[i]>n[i]^e?1:-1;return a==c?0:a>c^e?1:-1};xe.div=function(t){var e=this,r=e.constructor,s=e.c,n=(t=new r(t)).c,i=e.s==t.s?1:-1,o=r.DP;if(o!==~~o||o<0||o>on)throw Error(Pc);if(!n[0])throw Error(C0);if(!s[0])return t.s=i,t.c=[t.e=0],t;var a,c,l,u,h,d=n.slice(),f=a=n.length,p=s.length,g=s.slice(0,a),w=g.length,E=t,v=E.c=[],C=0,_=o+(E.e=e.e-t.e)+1;for(E.s=i,i=_<0?0:_,d.unshift(0);w++<a;)g.push(0);do{for(l=0;l<10;l++){if(a!=(w=g.length))u=a>w?1:-1;else for(h=-1,u=0;++h<a;)if(n[h]!=g[h]){u=n[h]>g[h]?1:-1;break}if(u<0){for(c=w==a?n:d;w;){if(g[--w]<c[w]){for(h=w;h&&!g[--h];)g[h]=9;--g[h],g[w]+=10}g[w]-=c[w]}for(;!g[0];)g.shift()}else break}v[C++]=u?l:++l,g[0]&&u?g[w]=s[f]||0:g=[s[f]]}while((f++<p||g[0]!==kr)&&i--);return!v[0]&&C!=1&&(v.shift(),E.e--,_--),C>_&&wn(E,_,r.RM,g[0]!==kr),E};xe.eq=function(t){return this.cmp(t)===0};xe.gt=function(t){return this.cmp(t)>0};xe.gte=function(t){return this.cmp(t)>-1};xe.lt=function(t){return this.cmp(t)<0};xe.lte=function(t){return this.cmp(t)<1};xe.minus=xe.sub=function(t){var e,r,s,n,i=this,o=i.constructor,a=i.s,c=(t=new o(t)).s;if(a!=c)return t.s=-c,i.plus(t);var l=i.c.slice(),u=i.e,h=t.c,d=t.e;if(!l[0]||!h[0])return h[0]?t.s=-c:l[0]?t=new o(i):t.s=1,t;if(a=u-d){for((n=a<0)?(a=-a,s=l):(d=u,s=h),s.reverse(),c=a;c--;)s.push(0);s.reverse()}else for(r=((n=l.length<h.length)?l:h).length,a=c=0;c<r;c++)if(l[c]!=h[c]){n=l[c]<h[c];break}if(n&&(s=l,l=h,h=s,t.s=-t.s),(c=(r=h.length)-(e=l.length))>0)for(;c--;)l[e++]=0;for(c=e;r>a;){if(l[--r]<h[r]){for(e=r;e&&!l[--e];)l[e]=9;--l[e],l[r]+=10}l[r]-=h[r]}for(;l[--c]===0;)l.pop();for(;l[0]===0;)l.shift(),--d;return l[0]||(t.s=1,l=[d=0]),t.c=l,t.e=d,t};xe.mod=function(t){var e,r=this,s=r.constructor,n=r.s,i=(t=new s(t)).s;if(!t.c[0])throw Error(C0);return r.s=t.s=1,e=t.cmp(r)==1,r.s=n,t.s=i,e?new s(r):(n=s.DP,i=s.RM,s.DP=s.RM=0,r=r.div(t),s.DP=n,s.RM=i,this.minus(r.times(t)))};xe.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};xe.plus=xe.add=function(t){var e,r,s,n=this,i=n.constructor;if(t=new i(t),n.s!=t.s)return t.s=-t.s,n.minus(t);var o=n.e,a=n.c,c=t.e,l=t.c;if(!a[0]||!l[0])return l[0]||(a[0]?t=new i(n):t.s=n.s),t;if(a=a.slice(),e=o-c){for(e>0?(c=o,s=l):(e=-e,s=a),s.reverse();e--;)s.push(0);s.reverse()}for(a.length-l.length<0&&(s=l,l=a,a=s),e=l.length,r=0;e;a[e]%=10)r=(a[--e]=a[e]+l[e]+r)/10|0;for(r&&(a.unshift(r),++c),e=a.length;a[--e]===0;)a.pop();return t.c=a,t.e=c,t};xe.pow=function(t){var e=this,r=new e.constructor("1"),s=r,n=t<0;if(t!==~~t||t<-kp||t>kp)throw Error(gn+"exponent");for(n&&(t=-t);t&1&&(s=s.times(e)),t>>=1,!!t;)e=e.times(e);return n?r.div(s):s};xe.prec=function(t,e){if(t!==~~t||t<1||t>on)throw Error(gn+"precision");return wn(new this.constructor(this),t,e)};xe.round=function(t,e){if(t===kr)t=0;else if(t!==~~t||t<-on||t>on)throw Error(Pc);return wn(new this.constructor(this),t+this.e+1,e)};xe.sqrt=function(){var t,e,r,s=this,n=s.constructor,i=s.s,o=s.e,a=new n("0.5");if(!s.c[0])return new n(s);if(i<0)throw Error(Qo+"No square root");i=Math.sqrt(+mn(s,!0,!0)),i===0||i===1/0?(e=s.c.join(""),e.length+o&1||(e+="0"),i=Math.sqrt(e),o=((o+1)/2|0)-(o<0||o&1),t=new n((i==1/0?"5e":(i=i.toExponential()).slice(0,i.indexOf("e")+1))+o)):t=new n(i+""),o=t.e+(n.DP+=4);do r=t,t=a.times(r.plus(s.div(r)));while(r.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return wn(t,(n.DP-=4)+t.e+1,n.RM)};xe.times=xe.mul=function(t){var e,r=this,s=r.constructor,n=r.c,i=(t=new s(t)).c,o=n.length,a=i.length,c=r.e,l=t.e;if(t.s=r.s==t.s?1:-1,!n[0]||!i[0])return t.c=[t.e=0],t;for(t.e=c+l,o<a&&(e=n,n=i,i=e,l=o,o=a,a=l),e=new Array(l=o+a);l--;)e[l]=0;for(c=a;c--;){for(a=0,l=o+c;l>c;)a=e[l]+i[c]*n[l-c-1]+a,e[l--]=a%10,a=a/10|0;e[l]=a}for(a?++t.e:e.shift(),c=e.length;!e[--c];)e.pop();return t.c=e,t};xe.toExponential=function(t,e){var r=this,s=r.c[0];if(t!==kr){if(t!==~~t||t<0||t>on)throw Error(Pc);for(r=wn(new r.constructor(r),++t,e);r.c.length<t;)r.c.push(0)}return mn(r,!0,!!s)};xe.toFixed=function(t,e){var r=this,s=r.c[0];if(t!==kr){if(t!==~~t||t<0||t>on)throw Error(Pc);for(r=wn(new r.constructor(r),t+r.e+1,e),t=t+r.e+1;r.c.length<t;)r.c.push(0)}return mn(r,!1,!!s)};xe[Symbol.for("nodejs.util.inspect.custom")]=xe.toJSON=xe.toString=function(){var t=this,e=t.constructor;return mn(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};xe.toNumber=function(){var t=+mn(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(Qo+"Imprecise conversion");return t};xe.toPrecision=function(t,e){var r=this,s=r.constructor,n=r.c[0];if(t!==kr){if(t!==~~t||t<1||t>on)throw Error(gn+"precision");for(r=wn(new s(r),t,e);r.c.length<t;)r.c.push(0)}return mn(r,t<=r.e||r.e<=s.NE||r.e>=s.PE,!!n)};xe.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(Qo+"valueOf disallowed");return mn(t,t.e<=e.NE||t.e>=e.PE,!0)};var Di=A0();const Q$={bigNumber(t){return t?new Di(t):new Di(0)},multiply(t,e){if(t===void 0||e===void 0)return new Di(0);const r=new Di(t),s=new Di(e);return r.times(s)},formatNumberToLocalString(t,e=2){return t===void 0?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e})},parseLocalStringToNumber(t){return t===void 0?0:parseFloat(t.replace(/,/gu,""))}},e8=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],t8=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],r8=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],s8={getERC20Abi:t=>B.USDT_CONTRACT_ADDRESSES.includes(t)?r8:e8,getSwapAbi:()=>t8},zt={validateCaipAddress(t){var e;if(((e=t.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[r,s,n]=e;if(!r||!s||!n)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:r,chainId:s,address:n}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[r,s]=e;if(!r||!s)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:r,chainId:s}}},se={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types",CONNECTIONS:"@appkit/connections",DISCONNECTED_CONNECTOR_IDS:"@appkit/disconnected_connector_ids",HISTORY_TRANSACTIONS_CACHE:"@appkit/history_transactions_cache",TOKEN_PRICE_CACHE:"@appkit/token_price_cache",RECENT_EMAILS:"@appkit/recent_emails"};function vl(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const re={setItem(t,e){Vn()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(Vn())return localStorage.getItem(t)||void 0},removeItem(t){Vn()&&localStorage.removeItem(t)},clear(){Vn()&&localStorage.clear()}};function Vn(){return typeof window<"u"&&typeof localStorage<"u"}function Cs(t,e){return e==="light"?{"--w3m-accent":(t==null?void 0:t["--w3m-accent"])||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":(t==null?void 0:t["--w3m-accent"])||"hsla(230, 100%, 67%, 1)","--w3m-background":"#121313"}}const n8=Symbol(),Up=Object.getPrototypeOf,Iu=new WeakMap,i8=t=>t&&(Iu.has(t)?Iu.get(t):Up(t)===Object.prototype||Up(t)===Array.prototype),o8=t=>i8(t)&&t[n8]||null,Bp=(t,e=!0)=>{Iu.set(t,e)},oc={},gh=t=>typeof t=="object"&&t!==null,a8=t=>gh(t)&&!ea.has(t)&&(Array.isArray(t)||!(Symbol.iterator in t))&&!(t instanceof WeakMap)&&!(t instanceof WeakSet)&&!(t instanceof Error)&&!(t instanceof Number)&&!(t instanceof Date)&&!(t instanceof String)&&!(t instanceof RegExp)&&!(t instanceof ArrayBuffer)&&!(t instanceof Promise),I0=(t,e)=>{const r=_u.get(t);if((r==null?void 0:r[0])===e)return r[1];const s=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));return Bp(s,!0),_u.set(t,[e,s]),Reflect.ownKeys(t).forEach(n=>{if(Object.getOwnPropertyDescriptor(s,n))return;const i=Reflect.get(t,n),{enumerable:o}=Reflect.getOwnPropertyDescriptor(t,n),a={value:i,enumerable:o,configurable:!0};if(ea.has(i))Bp(i,!1);else if(xs.has(i)){const[c,l]=xs.get(i);a.value=I0(c,l())}Object.defineProperty(s,n,a)}),Object.preventExtensions(s)},c8=(t,e,r,s)=>({deleteProperty(n,i){const o=Reflect.get(n,i);r(i);const a=Reflect.deleteProperty(n,i);return a&&s(["delete",[i],o]),a},set(n,i,o,a){const c=!t()&&Reflect.has(n,i),l=Reflect.get(n,i,a);if(c&&(Lp(l,o)||go.has(o)&&Lp(l,go.get(o))))return!0;r(i),gh(o)&&(o=o8(o)||o);const u=!xs.has(o)&&u8(o)?ke(o):o;return e(i,u),Reflect.set(n,i,u,a),s(["set",[i],o,l]),!0}}),xs=new WeakMap,ea=new WeakSet,_u=new WeakMap,qi=[1,1],go=new WeakMap;let Lp=Object.is,l8=(t,e)=>new Proxy(t,e),u8=a8,h8=I0,d8=c8;function ke(t={}){if(!gh(t))throw new Error("object required");const e=go.get(t);if(e)return e;let r=qi[0];const s=new Set,n=(w,E=++qi[0])=>{r!==E&&(r=E,s.forEach(v=>v(w,E)))};let i=qi[1];const o=(w=++qi[1])=>(i!==w&&!s.size&&(i=w,c.forEach(([E])=>{const v=E[1](w);v>r&&(r=v)})),r),a=w=>(E,v)=>{const C=[...E];C[1]=[w,...C[1]],n(C,v)},c=new Map,l=(w,E)=>{const v=!ea.has(E)&&xs.get(E);if(v){if((oc?"production":void 0)!=="production"&&c.has(w))throw new Error("prop listener already exists");if(s.size){const C=v[2](a(w));c.set(w,[v,C])}else c.set(w,[v])}},u=w=>{var E;const v=c.get(w);v&&(c.delete(w),(E=v[1])==null||E.call(v))},h=w=>(s.add(w),s.size===1&&c.forEach(([v,C],_)=>{if((oc?"production":void 0)!=="production"&&C)throw new Error("remove already exists");const S=v[2](a(_));c.set(_,[v,S])}),()=>{s.delete(w),s.size===0&&c.forEach(([v,C],_)=>{C&&(C(),c.set(_,[v]))})});let d=!0;const f=d8(()=>d,l,u,n),p=l8(t,f);go.set(t,p);const g=[t,o,h];return xs.set(p,g),Reflect.ownKeys(t).forEach(w=>{const E=Object.getOwnPropertyDescriptor(t,w);"value"in E&&E.writable&&(p[w]=t[w])}),d=!1,p}function at(t,e,r){const s=xs.get(t);(oc?"production":void 0)!=="production"&&!s&&console.warn("Please use proxy object");let n;const i=[],o=s[2];let a=!1;const l=o(u=>{i.push(u),n||(n=Promise.resolve().then(()=>{n=void 0,a&&e(i.splice(0))}))});return a=!0,()=>{a=!1,l()}}function wo(t){const e=xs.get(t);(oc?"production":void 0)!=="production"&&!e&&console.warn("Please use proxy object");const[r,s]=e;return h8(r,s())}function an(t){return ea.add(t),t}function f8(){return{proxyStateMap:xs,refSet:ea,snapCache:_u,versionHolder:qi,proxyCache:go}}function yt(t,e,r,s){let n=t[e];return at(t,()=>{const i=t[e];Object.is(n,i)||r(n=i)})}const{proxyStateMap:p8,snapCache:g8}=f8(),Na=t=>p8.has(t);function w8(t){const e=[];let r=0;const s=new Map,n=new WeakMap,i=()=>{const l=g8.get(a),u=l==null?void 0:l[1];if(u&&!n.has(u)){const h=new Map(s);n.set(u,h)}},o=l=>n.get(l)||s,a={data:e,index:r,epoch:0,get size(){return Na(this)||i(),o(this).size},get(l){const h=o(this).get(l);if(h===void 0){this.epoch;return}return this.data[h]},has(l){const u=o(this);return this.epoch,u.has(l)},set(l,u){if(!Na(this))throw new Error("Cannot perform mutations on a snapshot");const h=s.get(l);return h===void 0?(s.set(l,this.index),this.data[this.index++]=u):this.data[h]=u,this.epoch++,this},delete(l){if(!Na(this))throw new Error("Cannot perform mutations on a snapshot");const u=s.get(l);return u===void 0?!1:(delete this.data[u],s.delete(l),this.epoch++,!0)},clear(){if(!Na(this))throw new Error("Cannot perform mutations on a snapshot");this.data.length=0,this.index=0,this.epoch++,s.clear()},forEach(l){this.epoch,o(this).forEach((h,d)=>{l(this.data[h],d,this)})},*entries(){this.epoch;const l=o(this);for(const[u,h]of l)yield[u,this.data[h]]},*keys(){this.epoch;const l=o(this);for(const u of l.keys())yield u},*values(){this.epoch;const l=o(this);for(const u of l.values())yield this.data[u]},[Symbol.iterator](){return this.entries()},get[Symbol.toStringTag](){return"Map"},toJSON(){return new Map(this.entries())}},c=ke(a);return Object.defineProperties(c,{size:{enumerable:!1},index:{enumerable:!1},epoch:{enumerable:!1},data:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(c),c}const _0=[{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],m8="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",Se={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,ONE_SEC_MS:1e3,BALANCE_SUPPORTED_CHAINS:[B.CHAIN.EVM,B.CHAIN.SOLANA],NAMES_SUPPORTED_CHAIN_NAMESPACES:[B.CHAIN.EVM],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x",sui:"0x",stacks:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in the wallet app"},SEND_SUPPORTED_NAMESPACES:[B.CHAIN.EVM,B.CHAIN.SOLANA],DEFAULT_REMOTE_FEATURES:{swaps:["1inch"],onramp:["meld"],email:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],activity:!0,reownBranding:!0,multiWallet:!1,emailCapture:!1},DEFAULT_REMOTE_FEATURES_DISABLED:{email:!1,socials:!1,swaps:!1,onramp:!1,activity:!1,reownBranding:!1,emailCapture:!1},DEFAULT_FEATURES:{receive:!0,send:!0,emailShowWallets:!0,connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1},DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal"},SIWX_DEFAULTS:{signOutOnDisconnect:!0}},q={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5,transactionsHistory:15e3,tokenPrice:15e3},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=q.getActiveNamespace(),e=q.getActiveCaipNetworkId(),r=e?e.split(":")[1]:void 0,s=r?isNaN(Number(r))?r:Number(r):void 0;return{namespace:t,caipNetworkId:e,chainId:s}},setWalletConnectDeepLink({name:t,href:e}){try{re.setItem(se.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=re.getItem(se.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{re.removeItem(se.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{re.setItem(se.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{re.setItem(se.ACTIVE_CAIP_NETWORK_ID,t),q.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return re.getItem(se.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{re.removeItem(se.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=vl(t);re.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=q.getRecentWallets();e.find(s=>s.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),re.setItem(se.RECENT_WALLETS,JSON.stringify(e)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=re.getItem(se.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},setConnectedConnectorId(t,e){try{const r=vl(t);re.setItem(r,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return re.getItem(se.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=vl(t);return re.getItem(e)}catch{console.info("Unable to get connected connector id in namespace",t)}},setConnectedSocialProvider(t){try{re.setItem(se.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return re.getItem(se.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{re.removeItem(se.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return re.getItem(se.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var r;const t=re.getItem(se.ACTIVE_CAIP_NETWORK_ID);return(r=t==null?void 0:t.split(":"))==null?void 0:r[1]},setConnectionStatus(t){try{re.setItem(se.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return re.getItem(se.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=re.getItem(se.CONNECTED_NAMESPACES);return t!=null&&t.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));re.setItem(se.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=q.getConnectedNamespaces();e.includes(t)||(e.push(t),q.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=q.getConnectedNamespaces(),r=e.indexOf(t);r>-1&&(e.splice(r,1),q.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return re.getItem(se.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{re.setItem(se.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{re.removeItem(se.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=re.getItem(se.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=q.getBalanceCache();re.setItem(se.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const r=q.getBalanceCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.portfolio))return r.balance;q.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=q.getBalanceCache();e[t.caipAddress]=t,re.setItem(se.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=re.getItem(se.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=q.getBalanceCache();re.setItem(se.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const r=q.getNativeBalanceCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.nativeBalance))return r;console.info("Discarding cache for address",t),q.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=q.getNativeBalanceCache();e[t.caipAddress]=t,re.setItem(se.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=re.getItem(se.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const r=q.getEnsCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.ens))return r.ens;q.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=q.getEnsCache();e[t.address]=t,re.setItem(se.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=q.getEnsCache();re.setItem(se.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=re.getItem(se.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const r=q.getIdentityCache()[t];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.identity))return r.identity;q.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=q.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},re.setItem(se.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=q.getIdentityCache();re.setItem(se.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},clearAddressCache(){try{re.removeItem(se.PORTFOLIO_CACHE),re.removeItem(se.NATIVE_BALANCE_CACHE),re.removeItem(se.ENS_CACHE),re.removeItem(se.IDENTITY_CACHE),re.removeItem(se.HISTORY_TRANSACTIONS_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(t){try{re.setItem(se.PREFERRED_ACCOUNT_TYPES,JSON.stringify(t))}catch{console.info("Unable to set preferred account types",t)}},getPreferredAccountTypes(){try{const t=re.getItem(se.PREFERRED_ACCOUNT_TYPES);return t?JSON.parse(t):{}}catch{console.info("Unable to get preferred account types")}return{}},setConnections(t,e){try{const r=q.getConnections(),s=r[e]??[],n=new Map;for(const o of s)n.set(o.connectorId,{...o});for(const o of t){const a=n.get(o.connectorId),c=o.connectorId===B.CONNECTOR_ID.AUTH;if(a&&!c){const l=new Set(a.accounts.map(h=>h.address.toLowerCase())),u=o.accounts.filter(h=>!l.has(h.address.toLowerCase()));a.accounts.push(...u)}else n.set(o.connectorId,{...o})}const i={...r,[e]:Array.from(n.values())};re.setItem(se.CONNECTIONS,JSON.stringify(i))}catch(r){console.error("Unable to sync connections to storage",r)}},getConnections(){try{const t=re.getItem(se.CONNECTIONS);return t?JSON.parse(t):{}}catch(t){return console.error("Unable to get connections from storage",t),{}}},deleteAddressFromConnection({connectorId:t,address:e,namespace:r}){try{const s=q.getConnections(),n=s[r]??[],i=new Map(n.map(a=>[a.connectorId,a])),o=i.get(t);o&&(o.accounts.filter(c=>c.address.toLowerCase()!==e.toLowerCase()).length===0?i.delete(t):i.set(t,{...o,accounts:o.accounts.filter(c=>c.address.toLowerCase()!==e.toLowerCase())})),re.setItem(se.CONNECTIONS,JSON.stringify({...s,[r]:Array.from(i.values())}))}catch{console.error(`Unable to remove address "${e}" from connector "${t}" in namespace "${r}"`)}},getDisconnectedConnectorIds(){try{const t=re.getItem(se.DISCONNECTED_CONNECTOR_IDS);return t?JSON.parse(t):{}}catch{console.info("Unable to get disconnected connector ids")}return{}},addDisconnectedConnectorId(t,e){try{const r=q.getDisconnectedConnectorIds(),s=r[e]??[];s.push(t),re.setItem(se.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...r,[e]:Array.from(new Set(s))}))}catch{console.error(`Unable to set disconnected connector id "${t}" for namespace "${e}"`)}},removeDisconnectedConnectorId(t,e){try{const r=q.getDisconnectedConnectorIds();let s=r[e]??[];s=s.filter(n=>n.toLowerCase()!==t.toLowerCase()),re.setItem(se.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...r,[e]:Array.from(new Set(s))}))}catch{console.error(`Unable to remove disconnected connector id "${t}" for namespace "${e}"`)}},isConnectorDisconnected(t,e){try{return(q.getDisconnectedConnectorIds()[e]??[]).some(n=>n.toLowerCase()===t.toLowerCase())}catch{console.info(`Unable to get disconnected connector id "${t}" for namespace "${e}"`)}return!1},getTransactionsCache(){try{const t=re.getItem(se.HISTORY_TRANSACTIONS_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get transactions cache")}return{}},getTransactionsCacheForAddress({address:t,chainId:e=""}){var r;try{const n=(r=q.getTransactionsCache()[t])==null?void 0:r[e];if(n&&!this.isCacheExpired(n.timestamp,this.cacheExpiry.transactionsHistory))return n.transactions;q.removeTransactionsCache({address:t,chainId:e})}catch{console.info("Unable to get transactions cache")}},updateTransactionsCache({address:t,chainId:e="",timestamp:r,transactions:s}){try{const n=q.getTransactionsCache();n[t]={...n[t],[e]:{timestamp:r,transactions:s}},re.setItem(se.HISTORY_TRANSACTIONS_CACHE,JSON.stringify(n))}catch{console.info("Unable to update transactions cache",{address:t,chainId:e,timestamp:r,transactions:s})}},removeTransactionsCache({address:t,chainId:e}){try{const r=q.getTransactionsCache(),s=(r==null?void 0:r[t])||{},{[e]:n,...i}=s;re.setItem(se.HISTORY_TRANSACTIONS_CACHE,JSON.stringify({...r,[t]:i}))}catch{console.info("Unable to remove transactions cache",{address:t,chainId:e})}},getTokenPriceCache(){try{const t=re.getItem(se.TOKEN_PRICE_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get token price cache")}return{}},getTokenPriceCacheForAddresses(t){try{const r=q.getTokenPriceCache()[t.join(",")];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.tokenPrice))return r.tokenPrice;q.removeTokenPriceCache(t)}catch{console.info("Unable to get token price cache for addresses",t)}},updateTokenPriceCache(t){try{const e=q.getTokenPriceCache();e[t.addresses.join(",")]={timestamp:t.timestamp,tokenPrice:t.tokenPrice},re.setItem(se.TOKEN_PRICE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update token price cache",t)}},removeTokenPriceCache(t){try{const e=q.getTokenPriceCache();re.setItem(se.TOKEN_PRICE_CACHE,JSON.stringify({...e,[t.join(",")]:void 0}))}catch{console.info("Unable to remove token price cache",t)}}},te={isMobile(){var t;return this.isClient()?!!(window!=null&&window.matchMedia&&typeof window.matchMedia=="function"&&((t=window.matchMedia("(pointer:coarse)"))!=null&&t.matches)||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t==null?void 0:t.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return te.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window==null?void 0:window.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=Se.TEN_SEC_MS:!0},isAllowedRetry(t,e=Se.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return(window==null?void 0:window.self)!==(window==null?void 0:window.top)}catch{return!1}},isSafeApp(){var t,e;if(te.isClient()&&window.self!==window.top)try{const r=(e=(t=window==null?void 0:window.location)==null?void 0:t.ancestorOrigins)==null?void 0:e[0],s="https://app.safe.global";if(r){const n=new URL(r),i=new URL(s);return n.hostname===i.hostname}}catch{return!1}return!1},getPairingExpiry(){return Date.now()+Se.FOUR_MINUTES_MS},getNetworkId(t){return t==null?void 0:t.split(":")[1]},getPlainAddress(t){return t==null?void 0:t.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let r;return(...s)=>{function n(){t(...s)}r&&clearTimeout(r),r=setTimeout(n,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e,r=null){if(te.isHttpUrl(t))return this.formatUniversalUrl(t,e);let s=t,n=r;s.includes("://")||(s=t.replaceAll("/","").replaceAll(":",""),s=`${s}://`),s.endsWith("/")||(s=`${s}/`),n&&!(n!=null&&n.endsWith("/"))&&(n=`${n}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const i=encodeURIComponent(e);return{redirect:`${s}wc?uri=${i}`,redirectUniversalLink:n?`${n}wc?uri=${i}`:void 0,href:s}},formatUniversalUrl(t,e){if(!te.isHttpUrl(t))return this.formatNativeUrl(t,e);let r=t;r.endsWith("/")||(r=`${r}/`);const s=encodeURIComponent(e);return{redirect:`${r}wc?uri=${s}`,href:r}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?q.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,r){window==null||window.open(t,this.getOpenTargetForPlatform(e),r||"noreferrer noopener")},returnOpenHref(t,e,r){return window==null?void 0:window.open(t,this.getOpenTargetForPlatform(e),r||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){var r,s;if(typeof window>"u")return!1;const t=window!=null&&window.matchMedia&&typeof window.matchMedia=="function"?(r=window.matchMedia("(display-mode: standalone)"))==null?void 0:r.matches:!1,e=(s=window==null?void 0:window.navigator)==null?void 0:s.standalone;return!!(t||e)},async preloadImage(t){const e=new Promise((r,s)=>{const n=new Image;n.onload=r,n.onerror=s,n.crossOrigin="anonymous",n.src=t});return Promise.race([e,te.wait(2e3)])},formatBalance(t,e){let r="0.000";if(typeof t=="string"){const s=Number(t);if(s){const n=Math.floor(s*1e3)/1e3;n&&(r=n.toString())}}return`${r}${e?` ${e}`:""}`},formatBalance2(t,e){var s;let r;if(t==="0")r="0";else if(typeof t=="string"){const n=Number(t);n&&(r=(s=n.toString().match(/^-?\d+(?:\.\d{0,3})?/u))==null?void 0:s[0])}return{value:r??"0",rest:r==="0"?"000":"",symbol:e}},getApiUrl(){return B.W3M_API_URL},getBlockchainApiUrl(){return B.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return B.PULSE_API_URL},getUUID(){return crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){var e,r;return typeof t=="string"?t:typeof((r=(e=t==null?void 0:t.issues)==null?void 0:e[0])==null?void 0:r.message)=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const r={};return e&&t&&(t.forEach((s,n)=>{r[s]=n}),e.sort((s,n)=>{const i=r[s.id],o=r[n.id];return i!==void 0&&o!==void 0?i-o:i!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(t){let e=0;for(const r of t)e+=r.value??0;return e},formatTokenBalance(t){const e=t.toFixed(2),[r,s]=e.split(".");return{dollars:r,pennies:s}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);default:return!1}},uniqueBy(t,e){const r=new Set;return t.filter(s=>{const n=s[e];return r.has(n)?!1:(r.add(n),!0)})},generateSdkVersion(t,e,r){const n=t.length===0?Se.ADAPTER_TYPES.UNIVERSAL:t.map(i=>i.adapterType).join(",");return`${e}-${n}-${r}`},createAccount(t,e,r,s,n){return{namespace:t,address:e,type:r,publicKey:s,path:n}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),r=e[0];return e.filter(Boolean).length===3&&r in B.CHAIN_NAME_MAP},getAccount(t){return t?typeof t=="string"?{address:t,chainId:void 0}:{address:t.address,chainId:t.chainId}:{address:void 0,chainId:void 0}},isMac(){const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window==null?void 0:window.location.href)}`,r="state=";if(new URL(t).host==="auth.magic.link"){const n="provider_authorization_url=",i=t.substring(t.indexOf(n)+n.length),o=this.injectIntoUrl(decodeURIComponent(i),r,e);return t.replace(i,encodeURIComponent(o))}return this.injectIntoUrl(t,r,e)},injectIntoUrl(t,e,r){const s=t.indexOf(e);if(s===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const n=t.indexOf("&",s),i=e.length,o=n!==-1?n:t.length,a=t.substring(0,s+i),c=t.substring(s+i,o),l=t.substring(n),u=c+r;return a+u+l}};async function $i(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class ta{constructor({baseUrl:e,clientId:r}){this.baseUrl=e,this.clientId=r}async get({headers:e,signal:r,cache:s,...n}){const i=this.createUrl(n);return(await $i(i,{method:"GET",headers:e,signal:r,cache:s})).json()}async getBlob({headers:e,signal:r,...s}){const n=this.createUrl(s);return(await $i(n,{method:"GET",headers:e,signal:r})).blob()}async post({body:e,headers:r,signal:s,...n}){const i=this.createUrl(n);return(await $i(i,{method:"POST",headers:r,body:e?JSON.stringify(e):void 0,signal:s})).json()}async put({body:e,headers:r,signal:s,...n}){const i=this.createUrl(n);return(await $i(i,{method:"PUT",headers:r,body:e?JSON.stringify(e):void 0,signal:s})).json()}async delete({body:e,headers:r,signal:s,...n}){const i=this.createUrl(n);return(await $i(i,{method:"DELETE",headers:r,body:e?JSON.stringify(e):void 0,signal:s})).json()}createUrl({path:e,params:r}){const s=new URL(e,this.baseUrl);return r&&Object.entries(r).forEach(([n,i])=>{i&&s.searchParams.append(n,i)}),this.clientId&&s.searchParams.append("clientId",this.clientId),s}}const y8={getFeatureValue(t,e){const r=e==null?void 0:e[t];return r===void 0?Se.DEFAULT_FEATURES[t]:r},filterSocialsByPlatform(t){if(!t||!t.length)return t;if(te.isTelegram()){if(te.isIos())return t.filter(e=>e!=="google");if(te.isMac())return t.filter(e=>e!=="x");if(te.isAndroid())return t.filter(e=>!["facebook","x"].includes(e))}return t}},Q=ke({features:Se.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:Se.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0,experimental_preferUniversalLinks:!1,remoteFeatures:{}}),U={state:Q,subscribeKey(t,e){return yt(Q,t,e)},setOptions(t){Object.assign(Q,t)},setRemoteFeatures(t){var r,s;if(!t)return;const e={...Q.remoteFeatures,...t};Q.remoteFeatures=e,(r=Q.remoteFeatures)!=null&&r.socials&&(Q.remoteFeatures.socials=y8.filterSocialsByPlatform(Q.remoteFeatures.socials)),(s=Q.features)!=null&&s.pay&&(Q.remoteFeatures.email=!1,Q.remoteFeatures.socials=!1)},setFeatures(t){var r;if(!t)return;Q.features||(Q.features=Se.DEFAULT_FEATURES);const e={...Q.features,...t};Q.features=e,(r=Q.features)!=null&&r.pay&&Q.remoteFeatures&&(Q.remoteFeatures.email=!1,Q.remoteFeatures.socials=!1)},setProjectId(t){Q.projectId=t},setCustomRpcUrls(t){Q.customRpcUrls=t},setAllWallets(t){Q.allWallets=t},setIncludeWalletIds(t){Q.includeWalletIds=t},setExcludeWalletIds(t){Q.excludeWalletIds=t},setFeaturedWalletIds(t){Q.featuredWalletIds=t},setTokens(t){Q.tokens=t},setTermsConditionsUrl(t){Q.termsConditionsUrl=t},setPrivacyPolicyUrl(t){Q.privacyPolicyUrl=t},setCustomWallets(t){Q.customWallets=t},setIsSiweEnabled(t){Q.isSiweEnabled=t},setIsUniversalProvider(t){Q.isUniversalProvider=t},setSdkVersion(t){Q.sdkVersion=t},setMetadata(t){Q.metadata=t},setDisableAppend(t){Q.disableAppend=t},setEIP6963Enabled(t){Q.enableEIP6963=t},setDebug(t){Q.debug=t},setEnableWalletConnect(t){Q.enableWalletConnect=t},setEnableWalletGuide(t){Q.enableWalletGuide=t},setEnableAuthLogger(t){Q.enableAuthLogger=t},setEnableWallets(t){Q.enableWallets=t},setPreferUniversalLinks(t){Q.experimental_preferUniversalLinks=t},setSIWX(t){if(t)for(const[e,r]of Object.entries(Se.SIWX_DEFAULTS))t[e]??(t[e]=r);Q.siwx=t},setConnectMethodsOrder(t){Q.features={...Q.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){Q.features={...Q.features,walletFeaturesOrder:t}},setSocialsOrder(t){Q.remoteFeatures={...Q.remoteFeatures,socials:t}},setCollapseWallets(t){Q.features={...Q.features,collapseWallets:t}},setEnableEmbedded(t){Q.enableEmbedded=t},setAllowUnsupportedChain(t){Q.allowUnsupportedChain=t},setManualWCControl(t){Q.manualWCControl=t},setEnableNetworkSwitch(t){Q.enableNetworkSwitch=t},setEnableReconnect(t){Q.enableReconnect=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,r])=>{r&&(Q.defaultAccountTypes[e]=r)})},setUniversalProviderConfigOverride(t){Q.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return Q.universalProviderConfigOverride},getSnapshot(){return wo(Q)}},b8=Object.freeze({enabled:!0,events:[]}),v8=new ta({baseUrl:te.getAnalyticsUrl(),clientId:null}),E8=5,C8=60*1e3,ds=ke({...b8}),A8={state:ds,subscribeKey(t,e){return yt(ds,t,e)},async sendError(t,e){if(!ds.enabled)return;const r=Date.now();if(ds.events.filter(i=>{const o=new Date(i.properties.timestamp||"").getTime();return r-o<C8}).length>=E8)return;const n={type:"error",event:e,properties:{errorType:t.name,errorMessage:t.message,stackTrace:t.stack,timestamp:new Date().toISOString()}};ds.events.push(n);try{if(typeof window>"u")return;const{projectId:i,sdkType:o,sdkVersion:a}=U.state;await v8.post({path:"/e",params:{projectId:i,st:o,sv:a||"html-wagmi-4.2.2"},body:{eventId:te.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:new Date().toISOString(),props:{type:"error",event:e,errorType:t.name,errorMessage:t.message,stackTrace:t.stack}}})}catch{}},enable(){ds.enabled=!0},disable(){ds.enabled=!1},clearEvents(){ds.events=[]}};class ei extends Error{constructor(e,r,s){super(e),this.name="AppKitError",this.category=r,this.originalError=s,Object.setPrototypeOf(this,ei.prototype);let n=!1;if(s instanceof Error&&typeof s.stack=="string"&&s.stack){const i=s.stack,o=i.indexOf(`
`);if(o>-1){const a=i.substring(o+1);this.stack=`${this.name}: ${this.message}
${a}`,n=!0}}n||(Error.captureStackTrace?Error.captureStackTrace(this,ei):this.stack||(this.stack=`${this.name}: ${this.message}`))}}function Mp(t,e){const r=t instanceof ei?t:new ei(t instanceof Error?t.message:String(t),e,t);throw A8.sendError(r,r.category),r}function Gt(t,e="INTERNAL_SDK_ERROR"){const r={};return Object.keys(t).forEach(s=>{const n=t[s];if(typeof n=="function"){let i=n;n.constructor.name==="AsyncFunction"?i=async(...o)=>{try{return await n(...o)}catch(a){return Mp(a,e)}}:i=(...o)=>{try{return n(...o)}catch(a){return Mp(a,e)}},r[s]=i}else r[s]=n}),r}const Xs={ACCOUNT_TYPES:{EOA:"eoa",SMART_ACCOUNT:"smartAccount"}},Or={PHANTOM:{id:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",url:"https://phantom.app"},SOLFLARE:{id:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",url:"https://solflare.com"},COINBASE:{id:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",url:"https://go.cb-w.com"}},I8={handleMobileDeeplinkRedirect(t,e){const r=window.location.href,s=encodeURIComponent(r);if(t===Or.PHANTOM.id&&!("phantom"in window)){const n=r.startsWith("https")?"https":"http",i=r.split("/")[2],o=encodeURIComponent(`${n}://${i}`);window.location.href=`${Or.PHANTOM.url}/ul/browse/${s}?ref=${o}`}t===Or.SOLFLARE.id&&!("solflare"in window)&&(window.location.href=`${Or.SOLFLARE.url}/ul/v1/browse/${s}?ref=${s}`),e===B.CHAIN.SOLANA&&t===Or.COINBASE.id&&!("coinbaseSolana"in window)&&(window.location.href=`${Or.COINBASE.url}/dapp?cb_url=${s}`)}},Mt=ke({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),_8={state:Mt,subscribeNetworkImages(t){return at(Mt.networkImages,()=>t(Mt.networkImages))},subscribeKey(t,e){return yt(Mt,t,e)},subscribe(t){return at(Mt,()=>t(Mt))},setWalletImage(t,e){Mt.walletImages[t]=e},setNetworkImage(t,e){Mt.networkImages[t]=e},setChainImage(t,e){Mt.chainImages[t]=e},setConnectorImage(t,e){Mt.connectorImages={...Mt.connectorImages,[t]:e}},setTokenImage(t,e){Mt.tokenImages[t]=e},setCurrencyImage(t,e){Mt.currencyImages[t]=e}},gr=Gt(_8),S8={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:"",sui:"",stacks:""},El=ke({networkImagePromises:{}}),S0={async fetchWalletImage(t){if(t)return await ne._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){if(!t)return;const e=this.getNetworkImageById(t);return e||(El.networkImagePromises[t]||(El.networkImagePromises[t]=ne._fetchNetworkImage(t)),await El.networkImagePromises[t],this.getNetworkImageById(t))},getWalletImageById(t){if(t)return gr.state.walletImages[t]},getWalletImage(t){if(t!=null&&t.image_url)return t==null?void 0:t.image_url;if(t!=null&&t.image_id)return gr.state.walletImages[t.image_id]},getNetworkImage(t){var e,r,s;if((e=t==null?void 0:t.assets)!=null&&e.imageUrl)return(r=t==null?void 0:t.assets)==null?void 0:r.imageUrl;if((s=t==null?void 0:t.assets)!=null&&s.imageId)return gr.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return gr.state.networkImages[t]},getConnectorImage(t){var e;if(t!=null&&t.imageUrl)return t.imageUrl;if((e=t==null?void 0:t.info)!=null&&e.icon)return t.info.icon;if(t!=null&&t.imageId)return gr.state.connectorImages[t.imageId]},getChainImage(t){return gr.state.networkImages[S8[t]]}},fs=ke({message:"",variant:"info",open:!1}),N8={state:fs,subscribeKey(t,e){return yt(fs,t,e)},open(t,e){const{debug:r}=U.state,{code:s,displayMessage:n,debugMessage:i}=t;n&&r&&(fs.message=n,fs.variant=e,fs.open=!0),i&&console.error(typeof i=="function"?i():i,s?{code:s}:void 0)},close(){fs.open=!1,fs.message="",fs.variant="info"}},mt=Gt(N8),x8=te.getAnalyticsUrl(),O8=new ta({baseUrl:x8,clientId:null}),T8=["MODAL_CREATED"],Wr=ke({timestamp:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"}}),Te={state:Wr,subscribe(t){return at(Wr,()=>t(Wr))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:r}=U.state;return{projectId:t,st:e,sv:r||"html-wagmi-4.2.2"}},async _sendAnalyticsEvent(t){try{const e=ee.state.address;if(T8.includes(t.data.event)||typeof window>"u")return;await O8.post({path:"/e",params:Te.getSdkProperties(),body:{eventId:te.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:e}}}),Wr.reportedErrors.FORBIDDEN=!1}catch(e){e instanceof Error&&e.cause instanceof Response&&e.cause.status===B.HTTP_STATUS_CODES.FORBIDDEN&&!Wr.reportedErrors.FORBIDDEN&&(mt.open({displayMessage:"Invalid App Configuration",debugMessage:`Origin ${Vn()?window.origin:"uknown"} not found on Allowlist - update configuration on cloud.reown.com`},"error"),Wr.reportedErrors.FORBIDDEN=!0)}},sendEvent(t){var e;Wr.timestamp=Date.now(),Wr.data=t,((e=U.state.features)!=null&&e.analytics||t.event==="INITIALIZE")&&Te._sendAnalyticsEvent(Wr)}},P8=te.getApiUrl(),_t=new ta({baseUrl:P8,clientId:null}),D8=40,Fp=4,$8=20,ce=ke({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1}),ne={state:ce,subscribeKey(t,e){return yt(ce,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:r}=U.state;return{projectId:t,st:e||"appkit",sv:r||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return U.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${_t.baseUrl}/getWalletImage/${t}`,r=await _t.getBlob({path:e,params:ne._getSdkProperties()});gr.setWalletImage(t,URL.createObjectURL(r))},async _fetchNetworkImage(t){const e=`${_t.baseUrl}/public/getAssetImage/${t}`,r=await _t.getBlob({path:e,params:ne._getSdkProperties()});gr.setNetworkImage(t,URL.createObjectURL(r))},async _fetchConnectorImage(t){const e=`${_t.baseUrl}/public/getAssetImage/${t}`,r=await _t.getBlob({path:e,params:ne._getSdkProperties()});gr.setConnectorImage(t,URL.createObjectURL(r))},async _fetchCurrencyImage(t){const e=`${_t.baseUrl}/public/getCurrencyImage/${t}`,r=await _t.getBlob({path:e,params:ne._getSdkProperties()});gr.setCurrencyImage(t,URL.createObjectURL(r))},async _fetchTokenImage(t){const e=`${_t.baseUrl}/public/getTokenImage/${t}`,r=await _t.getBlob({path:e,params:ne._getSdkProperties()});gr.setTokenImage(t,URL.createObjectURL(r))},_filterWalletsByPlatform(t){return te.isMobile()?t==null?void 0:t.filter(r=>r.mobile_link||r.id===Or.COINBASE.id?!0:y.state.activeChain==="solana"&&(r.id===Or.SOLFLARE.id||r.id===Or.PHANTOM.id)):t},async fetchProjectConfig(){return(await _t.get({path:"/appkit/v1/config",params:ne._getSdkProperties()})).features},async fetchAllowedOrigins(){try{const{allowedOrigins:t}=await _t.get({path:"/projects/v1/origins",params:ne._getSdkProperties()});return t}catch(t){if(t instanceof Error&&t.cause instanceof Response){const e=t.cause.status;if(e===B.HTTP_STATUS_CODES.TOO_MANY_REQUESTS)throw new Error("RATE_LIMITED",{cause:t});if(e>=B.HTTP_STATUS_CODES.SERVER_ERROR&&e<600)throw new Error("SERVER_ERROR",{cause:t});return[]}return[]}},async fetchNetworkImages(){const t=y.getAllRequestedCaipNetworks(),e=t==null?void 0:t.map(({assets:r})=>r==null?void 0:r.imageId).filter(Boolean).filter(r=>!S0.getNetworkImageById(r));e&&await Promise.allSettled(e.map(r=>ne._fetchNetworkImage(r)))},async fetchConnectorImages(){const{connectors:t}=H.state,e=t.map(({imageId:r})=>r).filter(Boolean);await Promise.allSettled(e.map(r=>ne._fetchConnectorImage(r)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>ne._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>ne._fetchTokenImage(e)))},async fetchWallets(t){var i;const e=t.exclude??[];ne._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Object.values(Or).map(o=>o.id));const s=await _t.get({path:"/getWallets",params:{...ne._getSdkProperties(),...t,page:String(t.page),entries:String(t.entries),include:(i=t.include)==null?void 0:i.join(","),exclude:e.join(",")}});return{data:ne._filterWalletsByPlatform(s==null?void 0:s.data)||[],count:s==null?void 0:s.count}},async fetchFeaturedWallets(){const{featuredWalletIds:t}=U.state;if(t!=null&&t.length){const e={...ne._getSdkProperties(),page:1,entries:(t==null?void 0:t.length)??Fp,include:t},{data:r}=await ne.fetchWallets(e),s=[...r].sort((i,o)=>t.indexOf(i.id)-t.indexOf(o.id)),n=s.map(i=>i.image_id).filter(Boolean);await Promise.allSettled(n.map(i=>ne._fetchWalletImage(i))),ce.featured=s,ce.allFeatured=s}},async fetchRecommendedWallets(){try{ce.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:r}=U.state,s=[...e??[],...r??[]].filter(Boolean),n=y.getRequestedCaipNetworkIds().join(","),i={page:1,entries:Fp,include:t,exclude:s,chains:n},{data:o,count:a}=await ne.fetchWallets(i),c=q.getRecentWallets(),l=o.map(h=>h.image_id).filter(Boolean),u=c.map(h=>h.image_id).filter(Boolean);await Promise.allSettled([...l,...u].map(h=>ne._fetchWalletImage(h))),ce.recommended=o,ce.allRecommended=o,ce.count=a??0}catch{}finally{ce.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:t}){const{includeWalletIds:e,excludeWalletIds:r,featuredWalletIds:s}=U.state,n=y.getRequestedCaipNetworkIds().join(","),i=[...ce.recommended.map(({id:u})=>u),...r??[],...s??[]].filter(Boolean),o={page:t,entries:D8,include:e,exclude:i,chains:n},{data:a,count:c}=await ne.fetchWallets(o),l=a.slice(0,$8).map(u=>u.image_id).filter(Boolean);await Promise.allSettled(l.map(u=>ne._fetchWalletImage(u))),ce.wallets=te.uniqueBy([...ce.wallets,...ne._filterOutExtensions(a)],"id").filter(u=>{var h;return(h=u.chains)==null?void 0:h.some(d=>n.includes(d))}),ce.count=c>ce.count?c:ce.count,ce.page=t},async initializeExcludedWallets({ids:t}){const e={page:1,entries:t.length,include:t},{data:r}=await ne.fetchWallets(e);r&&r.forEach(s=>{ce.excludedWallets.push({rdns:s.rdns,name:s.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:r,excludeWalletIds:s}=U.state,n=y.getRequestedCaipNetworkIds().join(",");ce.search=[];const i={page:1,entries:100,search:t==null?void 0:t.trim(),badge_type:e,include:r,exclude:s,chains:n},{data:o}=await ne.fetchWallets(i);Te.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:t??""}});const a=o.map(c=>c.image_id).filter(Boolean);await Promise.allSettled([...a.map(c=>ne._fetchWalletImage(c)),te.wait(300)]),ce.search=ne._filterOutExtensions(o)},initPromise(t,e){const r=ce.promises[t];return r||(ce.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:r=!0,fetchNetworkImages:s=!0}={}){const n=[t&&ne.initPromise("connectorImages",ne.fetchConnectorImages),e&&ne.initPromise("featuredWallets",ne.fetchFeaturedWallets),r&&ne.initPromise("recommendedWallets",ne.fetchRecommendedWallets),s&&ne.initPromise("networkImages",ne.fetchNetworkImages)].filter(Boolean);return Promise.allSettled(n)},prefetchAnalyticsConfig(){var t;(t=U.state.features)!=null&&t.analytics&&ne.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await _t.get({path:"/getAnalyticsConfig",params:ne._getSdkProperties()});U.setFeatures({analytics:t})}catch{U.setFeatures({analytics:!1})}},filterByNamespaces(t){if(!(t!=null&&t.length)){ce.featured=ce.allFeatured,ce.recommended=ce.allRecommended;return}const e=y.getRequestedCaipNetworkIds().join(",");ce.featured=ce.allFeatured.filter(r=>{var s;return(s=r.chains)==null?void 0:s.some(n=>e.includes(n))}),ce.recommended=ce.allRecommended.filter(r=>{var s;return(s=r.chains)==null?void 0:s.some(n=>e.includes(n))}),ce.filteredWallets=ce.wallets.filter(r=>{var s;return(s=r.chains)==null?void 0:s.some(n=>e.includes(n))})},clearFilterByNamespaces(){ce.filteredWallets=[]},setFilterByNamespace(t){if(!t){ce.featured=ce.allFeatured,ce.recommended=ce.allRecommended;return}const e=y.getRequestedCaipNetworkIds().join(",");ce.featured=ce.allFeatured.filter(r=>{var s;return(s=r.chains)==null?void 0:s.some(n=>e.includes(n))}),ce.recommended=ce.allRecommended.filter(r=>{var s;return(s=r.chains)==null?void 0:s.some(n=>e.includes(n))}),ce.filteredWallets=ce.wallets.filter(r=>{var s;return(s=r.chains)==null?void 0:s.some(n=>e.includes(n))})}},Oe=ke({view:"Connect",history:["Connect"],transactionStack:[]}),R8={state:Oe,subscribeKey(t,e){return yt(Oe,t,e)},pushTransactionStack(t){Oe.transactionStack.push(t)},popTransactionStack(t){const e=Oe.transactionStack.pop();if(!e)return;const{onSuccess:r,onError:s,onCancel:n}=e;switch(t){case"success":r==null||r();break;case"error":s==null||s(),oe.goBack();break;case"cancel":n==null||n(),oe.goBack();break}},push(t,e){t!==Oe.view&&(Oe.view=t,Oe.history.push(t),Oe.data=e)},reset(t,e){Oe.view=t,Oe.history=[t],Oe.data=e},replace(t,e){Oe.history.at(-1)===t||(Oe.view=t,Oe.history[Oe.history.length-1]=t,Oe.data=e)},goBack(){var s;const t=y.state.activeCaipAddress,e=oe.state.view==="ConnectingFarcaster",r=!t&&e;if(Oe.history.length>1){Oe.history.pop();const[n]=Oe.history.slice(-1);n&&(t&&n==="Connect"?Oe.view="Account":Oe.view=n)}else ge.close();(s=Oe.data)!=null&&s.wallet&&(Oe.data.wallet=void 0),setTimeout(()=>{var n,i,o;if(r){ee.setFarcasterUrl(void 0,y.state.activeChain);const a=H.getAuthConnector();(n=a==null?void 0:a.provider)==null||n.reload();const c=wo(U.state);(o=(i=a==null?void 0:a.provider)==null?void 0:i.syncDappData)==null||o.call(i,{metadata:c.metadata,sdkVersion:c.sdkVersion,projectId:c.projectId,sdkType:c.sdkType})}},100)},goBackToIndex(t){if(Oe.history.length>1){Oe.history=Oe.history.slice(0,t+1);const[e]=Oe.history.slice(-1);e&&(Oe.view=e)}},goBackOrCloseModal(){oe.state.history.length>1?oe.goBack():ge.close()}},oe=Gt(R8),Hr=ke({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),Su={state:Hr,subscribe(t){return at(Hr,()=>t(Hr))},setThemeMode(t){Hr.themeMode=t;try{const e=H.getAuthConnector();if(e){const r=Su.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:r,w3mThemeVariables:Cs(r,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){Hr.themeVariables={...Hr.themeVariables,...t};try{const e=H.getAuthConnector();if(e){const r=Su.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:r,w3mThemeVariables:Cs(Hr.themeVariables,Hr.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return wo(Hr)}},jt=Gt(Su),N0=Object.fromEntries(E0.map(t=>[t,void 0])),k8=Object.fromEntries(E0.map(t=>[t,!0])),be=ke({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:N0,filterByNamespaceMap:k8}),U8={state:be,subscribe(t){return at(be,()=>{t(be)})},subscribeKey(t,e){return yt(be,t,e)},initialize(t){t.forEach(e=>{const r=q.getConnectedConnectorId(e);r&&H.setConnectorId(r,e)})},setActiveConnector(t){t&&(be.activeConnector=an(t))},setConnectors(t){t.filter(n=>!be.allConnectors.some(i=>i.id===n.id&&H.getConnectorName(i.name)===H.getConnectorName(n.name)&&i.chain===n.chain)).forEach(n=>{n.type!=="MULTI_CHAIN"&&be.allConnectors.push(an(n))});const r=H.getEnabledNamespaces(),s=H.getEnabledConnectors(r);be.connectors=H.mergeMultiChainConnectors(s)},filterByNamespaces(t){Object.keys(be.filterByNamespaceMap).forEach(e=>{be.filterByNamespaceMap[e]=!1}),t.forEach(e=>{be.filterByNamespaceMap[e]=!0}),H.updateConnectorsForEnabledNamespaces()},filterByNamespace(t,e){be.filterByNamespaceMap[t]=e,H.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const t=H.getEnabledNamespaces(),e=H.getEnabledConnectors(t),r=H.areAllNamespacesEnabled();be.connectors=H.mergeMultiChainConnectors(e),r?ne.clearFilterByNamespaces():ne.filterByNamespaces(t)},getEnabledNamespaces(){return Object.entries(be.filterByNamespaceMap).filter(([t,e])=>e).map(([t])=>t)},getEnabledConnectors(t){return be.allConnectors.filter(e=>t.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(be.filterByNamespaceMap).every(t=>t)},mergeMultiChainConnectors(t){const e=H.generateConnectorMapByName(t),r=[];return e.forEach(s=>{const n=s[0],i=(n==null?void 0:n.id)===B.CONNECTOR_ID.AUTH;s.length>1&&n?r.push({name:n.name,imageUrl:n.imageUrl,imageId:n.imageId,connectors:[...s],type:i?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(n==null?void 0:n.id)||""}):n&&r.push(n)}),r},generateConnectorMapByName(t){const e=new Map;return t.forEach(r=>{const{name:s}=r,n=H.getConnectorName(s);if(!n)return;const i=e.get(n)||[];i.find(a=>a.chain===r.chain)||i.push(r),e.set(n,i)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(r=>{e.find(s=>s.chain===r.chain)||e.push(r)}),e},addConnector(t){var e,r,s;if(t.id===B.CONNECTOR_ID.AUTH){const n=t,i=wo(U.state),o=jt.getSnapshot().themeMode,a=jt.getSnapshot().themeVariables;(r=(e=n==null?void 0:n.provider)==null?void 0:e.syncDappData)==null||r.call(e,{metadata:i.metadata,sdkVersion:i.sdkVersion,projectId:i.projectId,sdkType:i.sdkType}),(s=n==null?void 0:n.provider)==null||s.syncTheme({themeMode:o,themeVariables:a,w3mThemeVariables:Cs(a,o)}),H.setConnectors([t])}else H.setConnectors([t])},getAuthConnector(t){var s;const e=t||y.state.activeChain,r=be.connectors.find(n=>n.id===B.CONNECTOR_ID.AUTH);if(r)return(s=r==null?void 0:r.connectors)!=null&&s.length?r.connectors.find(i=>i.chain===e):r},getAnnouncedConnectorRdns(){return be.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>{var e;return(e=t.info)==null?void 0:e.rdns})},getConnectorById(t){return be.allConnectors.find(e=>e.id===t)},getConnector({id:t,rdns:e,namespace:r}){const s=r||y.state.activeChain;return be.allConnectors.filter(i=>i.chain===s).find(i=>{var o;return i.explorerId===t||((o=i.info)==null?void 0:o.rdns)===e})},syncIfAuthConnector(t){var i,o;if(t.id!=="ID_AUTH")return;const e=t,r=wo(U.state),s=jt.getSnapshot().themeMode,n=jt.getSnapshot().themeVariables;(o=(i=e==null?void 0:e.provider)==null?void 0:i.syncDappData)==null||o.call(i,{metadata:r.metadata,sdkVersion:r.sdkVersion,sdkType:r.sdkType,projectId:r.projectId}),e.provider.syncTheme({themeMode:s,themeVariables:n,w3mThemeVariables:Cs(n,s)})},getConnectorsByNamespace(t){const e=be.allConnectors.filter(r=>r.chain===t);return H.mergeMultiChainConnectors(e)},canSwitchToSmartAccount(t){return y.checkIfSmartAccountEnabled()&&Br(t)===Xs.ACCOUNT_TYPES.EOA},selectWalletConnector(t){const e=H.getConnector({id:t.id,rdns:t.rdns});I8.handleMobileDeeplinkRedirect((e==null?void 0:e.explorerId)||t.id,y.state.activeChain),e?oe.push("ConnectingExternal",{connector:e,wallet:t}):oe.push("ConnectingWalletConnect",{wallet:t})},getConnectors(t){return t?H.getConnectorsByNamespace(t):H.mergeMultiChainConnectors(be.allConnectors)},setFilterByNamespace(t){be.filterByNamespace=t,be.connectors=H.getConnectors(t),ne.setFilterByNamespace(t)},setConnectorId(t,e){t&&(be.activeConnectorIds={...be.activeConnectorIds,[e]:t},q.setConnectedConnectorId(e,t))},removeConnectorId(t){be.activeConnectorIds={...be.activeConnectorIds,[t]:void 0},q.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return be.activeConnectorIds[t]},isConnected(t){return t?!!be.activeConnectorIds[t]:Object.values(be.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){be.activeConnectorIds={...N0}}},H=Gt(U8),B8=1e3,Ri={checkNamespaceConnectorId(t,e){return H.getConnectorId(t)===e},isSocialProvider(t){return Se.DEFAULT_REMOTE_FEATURES.socials.includes(t)},connectWalletConnect({walletConnect:t,connector:e,closeModalOnConnect:r=!0,redirectViewOnModalClose:s="Connect",onOpen:n,onConnect:i}){return new Promise((o,a)=>{if(t&&H.setActiveConnector(e),n==null||n(te.isMobile()&&t),s){const l=ge.subscribeKey("open",u=>{u||(oe.state.view!==s&&oe.replace(s),l(),a(new Error("Modal closed")))})}const c=y.subscribeKey("activeCaipAddress",l=>{l&&(i==null||i(),r&&ge.close(),c(),o(zt.parseCaipAddress(l)))})})},connectExternal(t){return new Promise((e,r)=>{const s=y.subscribeKey("activeCaipAddress",n=>{n&&(ge.close(),s(),e(zt.parseCaipAddress(n)))});V.connectExternal(t,t.chain).catch(()=>{s(),r(new Error("Connection rejected"))})})},connectSocial({social:t,namespace:e,closeModalOnConnect:r=!0,onOpenFarcaster:s,onConnect:n}){let i=ee.state.socialWindow,o=ee.state.socialProvider,a=!1,c=null;const l=e||y.state.activeChain,u=y.subscribeKey("activeCaipAddress",h=>{h&&(r&&ge.close(),u())});return new Promise((h,d)=>{async function f(g){var w,E;if((w=g.data)!=null&&w.resultUri)if(g.origin===B.SECURE_SITE_SDK_ORIGIN){window.removeEventListener("message",f,!1);try{const v=H.getAuthConnector(l);if(v&&!a){i&&(i.close(),ee.setSocialWindow(void 0,l),i=ee.state.socialWindow),a=!0;const C=g.data.resultUri;if(o&&Te.sendEvent({type:"track",event:"SOCIAL_LOGIN_REQUEST_USER_DATA",properties:{provider:o}}),o){q.setConnectedSocialProvider(o),await V.connectExternal({id:v.id,type:v.type,socialUri:C},v.chain);const _=y.state.activeCaipAddress;if(!_){d(new Error("Failed to connect"));return}h(zt.parseCaipAddress(_)),Te.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:o,caipNetworkId:(E=y.getActiveCaipNetwork())==null?void 0:E.caipNetworkId}})}}}catch{o&&Te.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:o}}),d(new Error("Failed to connect"))}}else o&&Te.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:o}})}async function p(){if(t&&(ee.setSocialProvider(t,l),o=ee.state.socialProvider,Te.sendEvent({type:"track",event:"SOCIAL_LOGIN_STARTED",properties:{provider:o}})),o==="farcaster"){s==null||s();const g=ge.subscribeKey("open",E=>{!E&&t==="farcaster"&&(d(new Error("Popup closed")),n==null||n(),g())}),w=H.getAuthConnector();if(w&&!ee.state.farcasterUrl)try{const{url:E}=await w.provider.getFarcasterUri();ee.setFarcasterUrl(E,l)}catch{d(new Error("Failed to connect to farcaster"))}}else{const g=H.getAuthConnector();c=te.returnOpenHref(`${B.SECURE_SITE_SDK_ORIGIN}/loading`,"popupWindow","width=600,height=800,scrollbars=yes");try{if(g&&o){const{uri:w}=await g.provider.getSocialRedirectUri({provider:o});if(c&&w){ee.setSocialWindow(c,l),i=ee.state.socialWindow,c.location.href=w;const E=setInterval(()=>{i!=null&&i.closed&&!a&&(d(new Error("Popup closed")),clearInterval(E))},1e3);window.addEventListener("message",f,!1)}else c==null||c.close(),d(new Error("Failed to initiate social connection"))}}catch{d(new Error("Failed to initiate social connection")),c==null||c.close()}}}p()})},connectEmail({closeModalOnConnect:t=!0,redirectViewOnModalClose:e="Connect",onOpen:r,onConnect:s}){return new Promise((n,i)=>{if(r==null||r(),e){const a=ge.subscribeKey("open",c=>{c||(oe.state.view!==e&&oe.replace(e),a(),i(new Error("Modal closed")))})}const o=y.subscribeKey("activeCaipAddress",a=>{a&&(s==null||s(),t&&ge.close(),o(),n(zt.parseCaipAddress(a)))})})},async updateEmail(){const t=q.getConnectedConnectorId(y.state.activeChain),e=H.getAuthConnector();if(!e)throw new Error("No auth connector found");if(t!==B.CONNECTOR_ID.AUTH)throw new Error("Not connected to email or social");const r=e.provider.getEmail()??"";return await ge.open({view:"UpdateEmailWallet",data:{email:r,redirectView:void 0}}),new Promise((s,n)=>{const i=setInterval(()=>{const a=e.provider.getEmail()??"";a!==r&&(ge.close(),clearInterval(i),o(),s({email:a}))},B8),o=ge.subscribeKey("open",a=>{a||(oe.state.view!=="Connect"&&oe.push("Connect"),clearInterval(i),o(),n(new Error("Modal closed")))})})},canSwitchToSmartAccount(t){return y.checkIfSmartAccountEnabled()&&Br(t)===Xs.ACCOUNT_TYPES.EOA}};function x0(){var s,n;const t=((s=y.state.activeCaipNetwork)==null?void 0:s.chainNamespace)||"eip155",e=((n=y.state.activeCaipNetwork)==null?void 0:n.id)||1,r=Se.NATIVE_TOKEN_ADDRESS[t];return`${t}:${e}:${r}`}function Br(t){var r;return(r=y.getAccountData(t))==null?void 0:r.preferredAccountType}function jp(t){return y.state.activeCaipNetwork}const ac={getConnectionStatus(t,e){const r=H.state.activeConnectorIds[e],s=V.getConnections(e);return!!r&&t.connectorId===r?"connected":s.some(o=>o.connectorId.toLowerCase()===t.connectorId.toLowerCase())?"active":"disconnected"},excludeConnectorAddressFromConnections({connections:t,connectorId:e,addresses:r}){return t.map(s=>{if((e?s.connectorId.toLowerCase()===e.toLowerCase():!1)&&r){const i=s.accounts.filter(o=>!r.some(c=>c.toLowerCase()===o.address.toLowerCase()));return{...s,accounts:i}}return s})},excludeExistingConnections(t,e){const r=new Set(t);return e.filter(s=>!r.has(s.connectorId))},getConnectionsByConnectorId(t,e){return t.filter(r=>r.connectorId.toLowerCase()===e.toLowerCase())},getConnectionsData(t){var a;const e=!!((a=U.state.remoteFeatures)!=null&&a.multiWallet),r=H.state.activeConnectorIds[t],s=V.getConnections(t),i=(V.state.recentConnections.get(t)??[]).filter(c=>H.getConnectorById(c.connectorId)),o=ac.excludeExistingConnections([...s.map(c=>c.connectorId),...r?[r]:[]],i);return e?{connections:s,recentConnections:o}:{connections:s.filter(c=>c.connectorId.toLowerCase()===(r==null?void 0:r.toLowerCase())),recentConnections:[]}}},Ms=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),Ke=ke({...Ms}),L8={state:Ke,subscribeKey(t,e){return yt(Ke,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=te.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){Ke.message=Ms.message,Ke.variant=Ms.variant,Ke.svg=Ms.svg,Ke.open=Ms.open,Ke.autoClose=Ms.autoClose},_showMessage({message:t,svg:e,variant:r="success",autoClose:s=Ms.autoClose}){Ke.open?(Ke.open=!1,setTimeout(()=>{Ke.message=t,Ke.variant=r,Ke.svg=e,Ke.open=!0,Ke.autoClose=s},150)):(Ke.message=t,Ke.variant=r,Ke.svg=e,Ke.open=!0,Ke.autoClose=s)}},Pr=L8,Le=ke({transactions:[],transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),M8={state:Le,subscribe(t){return at(Le,()=>t(Le))},setLastNetworkInView(t){Le.lastNetworkInView=t},async fetchTransactions(t){var e;if(!t)throw new Error("Transactions can't be fetched without an accountAddress");Le.loading=!0;try{const r=await ie.fetchTransactions({account:t,cursor:Le.next,chainId:(e=y.state.activeCaipNetwork)==null?void 0:e.caipNetworkId}),s=za.filterSpamTransactions(r.data),n=za.filterByConnectedChain(s),i=[...Le.transactions,...n];Le.loading=!1,Le.transactions=i,Le.transactionsByYear=za.groupTransactionsByYearAndMonth(Le.transactionsByYear,n),Le.empty=i.length===0,Le.next=r.next?r.next:void 0}catch{const s=y.state.activeChain;Te.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:U.state.projectId,cursor:Le.next,isSmartAccount:Br(s)===Xs.ACCOUNT_TYPES.SMART_ACCOUNT}}),Pr.showError("Failed to fetch transactions"),Le.loading=!1,Le.empty=!0,Le.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const r=t;return e.forEach(s=>{const n=new Date(s.metadata.minedAt).getFullYear(),i=new Date(s.metadata.minedAt).getMonth(),o=r[n]??{},c=(o[i]??[]).filter(l=>l.id!==s.id);r[n]={...o,[i]:[...c,s].sort((l,u)=>new Date(u.metadata.minedAt).getTime()-new Date(l.metadata.minedAt).getTime())}}),r},filterSpamTransactions(t){return t.filter(e=>!e.transfers.every(s=>{var n;return((n=s.nft_info)==null?void 0:n.flags.is_spam)===!0}))},filterByConnectedChain(t){var s;const e=(s=y.state.activeCaipNetwork)==null?void 0:s.caipNetworkId;return t.filter(n=>n.metadata.chain===e)},clearCursor(){Le.next=void 0},resetTransactions(){Le.transactions=[],Le.transactionsByYear={},Le.lastNetworkInView=void 0,Le.loading=!1,Le.empty=!1,Le.next=void 0}},za=Gt(M8,"API_ERROR"),pe=ke({connections:new Map,recentConnections:new Map,isSwitchingConnection:!1,wcError:!1,buffering:!1,status:"disconnected"});let ks;const F8={state:pe,subscribe(t){return at(pe,()=>t(pe))},subscribeKey(t,e){return yt(pe,t,e)},_getClient(){return pe._client},setClient(t){pe._client=an(t)},initialize(t){const e=t.filter(r=>!!r.namespace).map(r=>r.namespace);V.syncStorageConnections(e)},syncStorageConnections(t){const e=q.getConnections(),r=t??Array.from(y.state.chains.keys());for(const s of r){const n=e[s]??[],i=new Map(pe.recentConnections);i.set(s,n),pe.recentConnections=i}},getConnections(t){return t?pe.connections.get(t)??[]:[]},hasAnyConnection(t){const e=V.state.connections;return Array.from(e.values()).flatMap(r=>r).some(({connectorId:r})=>r===t)},async connectWalletConnect(){var t,e,r,s;if(te.isTelegram()||te.isSafari()&&te.isIos()){if(ks){await ks,ks=void 0;return}if(!te.isPairingExpired(pe==null?void 0:pe.wcPairingExpiry)){const n=pe.wcUri;pe.wcUri=n;return}ks=(e=(t=V._getClient())==null?void 0:t.connectWalletConnect)==null?void 0:e.call(t).catch(()=>{}),V.state.status="connecting",await ks,ks=void 0,pe.wcPairingExpiry=void 0,V.state.status="connected"}else await((s=(r=V._getClient())==null?void 0:r.connectWalletConnect)==null?void 0:s.call(r))},async connectExternal(t,e,r=!0){var n,i;const s=await((i=(n=V._getClient())==null?void 0:n.connectExternal)==null?void 0:i.call(n,t));return r&&y.setActiveNamespace(e),s},async reconnectExternal(t){var r,s;await((s=(r=V._getClient())==null?void 0:r.reconnectExternal)==null?void 0:s.call(r,t));const e=t.chain||y.state.activeChain;e&&H.setConnectorId(t.id,e)},async setPreferredAccountType(t,e){var s;if(!e)return;ge.setLoading(!0,y.state.activeChain);const r=H.getAuthConnector();r&&(ee.setPreferredAccountType(t,e),await r.provider.setPreferredAccount(t),q.setPreferredAccountTypes(Object.entries(y.state.chains).reduce((n,[i,o])=>{const a=i,c=Br(a);return c!==void 0&&(n[a]=c),n},{})),await V.reconnectExternal(r),ge.setLoading(!1,y.state.activeChain),Te.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:((s=y.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)||""}}))},async signMessage(t){var e;return(e=V._getClient())==null?void 0:e.signMessage(t)},parseUnits(t,e){var r;return(r=V._getClient())==null?void 0:r.parseUnits(t,e)},formatUnits(t,e){var r;return(r=V._getClient())==null?void 0:r.formatUnits(t,e)},async sendTransaction(t){var e;return(e=V._getClient())==null?void 0:e.sendTransaction(t)},async getCapabilities(t){var e;return(e=V._getClient())==null?void 0:e.getCapabilities(t)},async grantPermissions(t){var e;return(e=V._getClient())==null?void 0:e.grantPermissions(t)},async walletGetAssets(t){var e;return((e=V._getClient())==null?void 0:e.walletGetAssets(t))??{}},async estimateGas(t){var e;return(e=V._getClient())==null?void 0:e.estimateGas(t)},async writeContract(t){var e;return(e=V._getClient())==null?void 0:e.writeContract(t)},async getEnsAddress(t){var e;return(e=V._getClient())==null?void 0:e.getEnsAddress(t)},async getEnsAvatar(t){var e;return(e=V._getClient())==null?void 0:e.getEnsAvatar(t)},checkInstalled(t){var e,r;return((r=(e=V._getClient())==null?void 0:e.checkInstalled)==null?void 0:r.call(e,t))||!1},resetWcConnection(){pe.wcUri=void 0,pe.wcPairingExpiry=void 0,pe.wcLinking=void 0,pe.recentWallet=void 0,pe.status="disconnected",za.resetTransactions(),q.deleteWalletConnectDeepLink()},resetUri(){pe.wcUri=void 0,pe.wcPairingExpiry=void 0,ks=void 0},finalizeWcConnection(){var r,s,n;const{wcLinking:t,recentWallet:e}=V.state;t&&q.setWalletConnectDeepLink(t),e&&q.setAppKitRecent(e),Te.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:t?"mobile":"qrcode",name:((s=(r=oe.state.data)==null?void 0:r.wallet)==null?void 0:s.name)||"Unknown",caipNetworkId:(n=y.getActiveCaipNetwork())==null?void 0:n.caipNetworkId}})},setWcBasic(t){pe.wcBasic=t},setUri(t){pe.wcUri=t,pe.wcPairingExpiry=te.getPairingExpiry()},setWcLinking(t){pe.wcLinking=t},setWcError(t){pe.wcError=t,pe.buffering=!1},setRecentWallet(t){pe.recentWallet=t},setBuffering(t){pe.buffering=t},setStatus(t){pe.status=t},setIsSwitchingConnection(t){pe.isSwitchingConnection=t},async disconnect({id:t,namespace:e,initialDisconnect:r}={}){var s;try{await((s=V._getClient())==null?void 0:s.disconnect({id:t,chainNamespace:e,initialDisconnect:r}))}catch(n){throw new ei("Failed to disconnect","INTERNAL_SDK_ERROR",n)}},setConnections(t,e){const r=new Map(pe.connections);r.set(e,t),pe.connections=r},async handleAuthAccountSwitch({address:t,namespace:e}){var n,i;const r=(i=(n=ee.state.user)==null?void 0:n.accounts)==null?void 0:i.find(o=>o.type==="smartAccount"),s=r&&r.address.toLowerCase()===t.toLowerCase()&&Ri.canSwitchToSmartAccount(e)?"smartAccount":"eoa";await V.setPreferredAccountType(s,e)},async handleActiveConnection({connection:t,namespace:e,address:r}){const s=H.getConnectorById(t.connectorId),n=t.connectorId===B.CONNECTOR_ID.AUTH;if(!s)throw new Error(`No connector found for connection: ${t.connectorId}`);if(n)n&&r&&await V.handleAuthAccountSwitch({address:r,namespace:e});else{const i=await V.connectExternal({id:s.id,type:s.type,provider:s.provider,address:r,chain:e},e);return i==null?void 0:i.address}return r},async handleDisconnectedConnection({connection:t,namespace:e,address:r,closeModalOnConnect:s}){var l,u;const n=H.getConnectorById(t.connectorId),i=(u=(l=t.auth)==null?void 0:l.name)==null?void 0:u.toLowerCase(),o=t.connectorId===B.CONNECTOR_ID.AUTH,a=t.connectorId===B.CONNECTOR_ID.WALLET_CONNECT;if(!n)throw new Error(`No connector found for connection: ${t.connectorId}`);let c;if(o)if(i&&Ri.isSocialProvider(i)){const{address:h}=await Ri.connectSocial({social:i,closeModalOnConnect:s,onOpenFarcaster(){ge.open({view:"ConnectingFarcaster"})},onConnect(){oe.replace("ProfileWallets")}});c=h}else{const{address:h}=await Ri.connectEmail({closeModalOnConnect:s,onOpen(){ge.open({view:"EmailLogin"})},onConnect(){oe.replace("ProfileWallets")}});c=h}else if(a){const{address:h}=await Ri.connectWalletConnect({walletConnect:!0,connector:n,closeModalOnConnect:s,onOpen(d){ge.open({view:d?"AllWallets":"ConnectingWalletConnect"})},onConnect(){oe.replace("ProfileWallets")}});c=h}else{const h=await V.connectExternal({id:n.id,type:n.type,provider:n.provider,chain:e},e);h&&(c=h.address)}return o&&r&&await V.handleAuthAccountSwitch({address:r,namespace:e}),c},async switchConnection({connection:t,address:e,namespace:r,closeModalOnConnect:s,onChange:n}){let i;const o=ee.getCaipAddress(r);if(o){const{address:c}=zt.parseCaipAddress(o);i=c}const a=ac.getConnectionStatus(t,r);switch(a){case"connected":case"active":{const c=await V.handleActiveConnection({connection:t,namespace:r,address:e});if(i&&c){const l=c.toLowerCase()!==i.toLowerCase();n==null||n({address:c,namespace:r,hasSwitchedAccount:l,hasSwitchedWallet:a==="active"})}break}case"disconnected":{const c=await V.handleDisconnectedConnection({connection:t,namespace:r,address:e,closeModalOnConnect:s});c&&(n==null||n({address:c,namespace:r,hasSwitchedAccount:!0,hasSwitchedWallet:!0}));break}default:throw new Error(`Invalid connection status: ${a}`)}}},V=Gt(F8),Mn=ke({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1}),Yr={state:Mn,subscribe(t){return at(Mn,()=>t(Mn))},subscribeOpen(t){return yt(Mn,"open",t)},set(t){Object.assign(Mn,{...Mn,...t})}},j8={async getTokenList(){var s;const t=y.state.activeCaipNetwork,e=await ie.fetchSwapTokens({chainId:t==null?void 0:t.caipNetworkId});return((s=e==null?void 0:e.tokens)==null?void 0:s.map(n=>({...n,eip2612:!1,quantity:{decimals:"0",numeric:"0"},price:0,value:0})))||[]},async fetchGasPrice(){var e;const t=y.state.activeCaipNetwork;if(!t)return null;try{switch(t.chainNamespace){case"solana":const r=(e=await(V==null?void 0:V.estimateGas({chainNamespace:"solana"})))==null?void 0:e.toString();return{standard:r,fast:r,instant:r};case"eip155":default:return await ie.fetchGasPrice({chainId:t.caipNetworkId})}}catch{return null}},async fetchSwapAllowance({tokenAddress:t,userAddress:e,sourceTokenAmount:r,sourceTokenDecimals:s}){const n=await ie.fetchSwapAllowance({tokenAddress:t,userAddress:e});if(n!=null&&n.allowance&&r&&s){const i=V.parseUnits(r,s)||0;return BigInt(n.allowance)>=i}return!1},async getMyTokensWithBalance(t){const e=await bh.getMyTokensWithBalance(t);return ee.setTokenBalance(e,y.state.activeChain),this.mapBalancesToSwapTokens(e)},mapBalancesToSwapTokens(t){return(t==null?void 0:t.map(e=>({...e,address:e!=null&&e.address?e.address:x0(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]}},Ne=ke({tokenBalances:[],loading:!1}),q8={state:Ne,subscribe(t){return at(Ne,()=>t(Ne))},subscribeKey(t,e){return yt(Ne,t,e)},setToken(t){t&&(Ne.token=an(t))},setTokenAmount(t){Ne.sendTokenAmount=t},setReceiverAddress(t){Ne.receiverAddress=t},setReceiverProfileImageUrl(t){Ne.receiverProfileImageUrl=t},setReceiverProfileName(t){Ne.receiverProfileName=t},setNetworkBalanceInUsd(t){Ne.networkBalanceInUSD=t},setLoading(t){Ne.loading=t},async sendToken(){var t;try{switch(Ae.setLoading(!0),(t=y.state.activeCaipNetwork)==null?void 0:t.chainNamespace){case"eip155":await Ae.sendEvmToken();return;case"solana":await Ae.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}finally{Ae.setLoading(!1)}},async sendEvmToken(){var r,s,n;const t=y.state.activeChain;if(!t)throw new Error("SendController:sendEvmToken - activeChainNamespace is required");const e=Br(t);if(!Ae.state.sendTokenAmount||!Ae.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!Ae.state.token)throw new Error("A token is required");(r=Ae.state.token)!=null&&r.address?(Te.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Xs.ACCOUNT_TYPES.SMART_ACCOUNT,token:Ae.state.token.address,amount:Ae.state.sendTokenAmount,network:((s=y.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)||""}}),await Ae.sendERC20Token({receiverAddress:Ae.state.receiverAddress,tokenAddress:Ae.state.token.address,sendTokenAmount:Ae.state.sendTokenAmount,decimals:Ae.state.token.quantity.decimals})):(Te.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Xs.ACCOUNT_TYPES.SMART_ACCOUNT,token:Ae.state.token.symbol||"",amount:Ae.state.sendTokenAmount,network:((n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}}),await Ae.sendNativeToken({receiverAddress:Ae.state.receiverAddress,sendTokenAmount:Ae.state.sendTokenAmount,decimals:Ae.state.token.quantity.decimals}))},async fetchTokenBalance(t){var i,o;Ne.loading=!0;const e=(i=y.state.activeCaipNetwork)==null?void 0:i.caipNetworkId,r=(o=y.state.activeCaipNetwork)==null?void 0:o.chainNamespace,s=y.state.activeCaipAddress,n=s?te.getPlainAddress(s):void 0;if(Ne.lastRetry&&!te.isAllowedRetry(Ne.lastRetry,30*Se.ONE_SEC_MS))return Ne.loading=!1,[];try{if(n&&e&&r){const a=await bh.getMyTokensWithBalance();return Ne.tokenBalances=a,Ne.lastRetry=void 0,a}}catch(a){Ne.lastRetry=Date.now(),t==null||t(a),Pr.showError("Token Balance Unavailable")}finally{Ne.loading=!1}return[]},fetchNetworkBalance(){if(Ne.tokenBalances.length===0)return;const t=j8.mapBalancesToSwapTokens(Ne.tokenBalances);if(!t)return;const e=t.find(r=>r.address===x0());e&&(Ne.networkBalanceInUSD=e?Q$.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(t){var i,o,a;oe.pushTransactionStack({});const e=t.receiverAddress,r=ee.state.address,s=V.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals));await V.sendTransaction({chainNamespace:B.CHAIN.EVM,to:e,address:r,data:"0x",value:s??BigInt(0)}),Te.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Br("eip155")===Xs.ACCOUNT_TYPES.SMART_ACCOUNT,token:((i=Ae.state.token)==null?void 0:i.symbol)||"",amount:t.sendTokenAmount,network:((o=y.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)||""}}),(a=V._getClient())==null||a.updateBalance("eip155"),Ae.resetSend()},async sendERC20Token(t){oe.pushTransactionStack({onSuccess(){oe.replace("Account")}});const e=V.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals));if(ee.state.address&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const r=te.getPlainAddress(t.tokenAddress);if(!r)throw new Error("SendController:sendERC20Token - tokenAddress is required");await V.writeContract({fromAddress:ee.state.address,tokenAddress:r,args:[t.receiverAddress,e??BigInt(0)],method:"transfer",abi:s8.getERC20Abi(r),chainNamespace:B.CHAIN.EVM}),Ae.resetSend()}},async sendSolanaToken(){var t;if(!Ae.state.sendTokenAmount||!Ae.state.receiverAddress)throw new Error("An amount and receiver address are required");oe.pushTransactionStack({onSuccess(){oe.replace("Account")}}),await V.sendTransaction({chainNamespace:"solana",to:Ae.state.receiverAddress,value:Ae.state.sendTokenAmount}),(t=V._getClient())==null||t.updateBalance("solana"),Ae.resetSend()},resetSend(){Ne.token=void 0,Ne.sendTokenAmount=void 0,Ne.receiverAddress=void 0,Ne.receiverProfileImageUrl=void 0,Ne.receiverProfileName=void 0,Ne.loading=!1,Ne.tokenBalances=[]}},Ae=Gt(q8),Cl={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,user:void 0,preferredAccountType:void 0},xa={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},Y=ke({chains:w8(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{networkControllerClient:void 0,connectionControllerClient:void 0},isSwitchingNamespace:!1}),z8={state:Y,subscribe(t){return at(Y,()=>{t(Y)})},subscribeKey(t,e){return yt(Y,t,e)},subscribeChainProp(t,e,r){let s;return at(Y.chains,()=>{var i;const n=r||Y.activeChain;if(n){const o=(i=Y.chains.get(n))==null?void 0:i[t];s!==o&&(s=o,e(o))}})},initialize(t,e,r){const{chainId:s,namespace:n}=q.getActiveNetworkProps(),i=e==null?void 0:e.find(u=>u.id.toString()===(s==null?void 0:s.toString())),a=t.find(u=>(u==null?void 0:u.namespace)===n)||(t==null?void 0:t[0]),c=t.map(u=>u.namespace).filter(u=>u!==void 0),l=U.state.enableEmbedded?new Set([...c]):new Set([...(e==null?void 0:e.map(u=>u.chainNamespace))??[]]);((t==null?void 0:t.length)===0||!a)&&(Y.noAdapters=!0),Y.noAdapters||(Y.activeChain=a==null?void 0:a.namespace,Y.activeCaipNetwork=i,y.setChainNetworkData(a==null?void 0:a.namespace,{caipNetwork:i}),Y.activeChain&&Yr.set({activeChain:a==null?void 0:a.namespace})),l.forEach(u=>{const h=e==null?void 0:e.filter(p=>p.chainNamespace===u),d=q.getPreferredAccountTypes()||{},f={...U.state.defaultAccountTypes,...d};y.state.chains.set(u,{namespace:u,networkState:ke({...xa,caipNetwork:h==null?void 0:h[0]}),accountState:ke({...Cl,preferredAccountType:f[u]}),caipNetworks:h??[],...r}),y.setRequestedCaipNetworks(h??[],u)})},removeAdapter(t){var e,r;if(Y.activeChain===t){const s=Array.from(Y.chains.entries()).find(([n])=>n!==t);if(s){const n=(r=(e=s[1])==null?void 0:e.caipNetworks)==null?void 0:r[0];n&&y.setActiveCaipNetwork(n)}}Y.chains.delete(t)},addAdapter(t,{networkControllerClient:e,connectionControllerClient:r},s){if(!t.namespace)throw new Error("ChainController:addAdapter - adapter must have a namespace");Y.chains.set(t.namespace,{namespace:t.namespace,networkState:{...xa,caipNetwork:s[0]},accountState:Cl,caipNetworks:s,connectionControllerClient:r,networkControllerClient:e}),y.setRequestedCaipNetworks((s==null?void 0:s.filter(n=>n.chainNamespace===t.namespace))??[],t.namespace)},addNetwork(t){var r;const e=Y.chains.get(t.chainNamespace);if(e){const s=[...e.caipNetworks||[]];(r=e.caipNetworks)!=null&&r.find(n=>n.id===t.id)||s.push(t),Y.chains.set(t.chainNamespace,{...e,caipNetworks:s}),y.setRequestedCaipNetworks(s,t.chainNamespace),H.filterByNamespace(t.chainNamespace,!0)}},removeNetwork(t,e){var s,n,i;const r=Y.chains.get(t);if(r){const o=((s=Y.activeCaipNetwork)==null?void 0:s.id)===e,a=[...((n=r.caipNetworks)==null?void 0:n.filter(c=>c.id!==e))||[]];o&&((i=r==null?void 0:r.caipNetworks)!=null&&i[0])&&y.setActiveCaipNetwork(r.caipNetworks[0]),Y.chains.set(t,{...r,caipNetworks:a}),y.setRequestedCaipNetworks(a||[],t),a.length===0&&H.filterByNamespace(t,!1)}},setAdapterNetworkState(t,e){const r=Y.chains.get(t);r&&(r.networkState={...r.networkState||xa,...e},Y.chains.set(t,r))},setChainAccountData(t,e,r=!0){if(!t)throw new Error("Chain is required to update chain account data");const s=Y.chains.get(t);if(s){const n={...s.accountState||Cl,...e};Y.chains.set(t,{...s,accountState:n}),(Y.chains.size===1||Y.activeChain===t)&&(e.caipAddress&&(Y.activeCaipAddress=e.caipAddress),ee.replaceState(n))}},setChainNetworkData(t,e){if(!t)return;const r=Y.chains.get(t);if(r){const s={...r.networkState||xa,...e};Y.chains.set(t,{...r,networkState:s})}},setAccountProp(t,e,r,s=!0){y.setChainAccountData(r,{[t]:e},s)},setActiveNamespace(t){var s,n;Y.activeChain=t;const e=t?Y.chains.get(t):void 0,r=(s=e==null?void 0:e.networkState)==null?void 0:s.caipNetwork;r!=null&&r.id&&t&&(Y.activeCaipAddress=(n=e==null?void 0:e.accountState)==null?void 0:n.caipAddress,Y.activeCaipNetwork=r,y.setChainNetworkData(t,{caipNetwork:r}),q.setActiveCaipNetworkId(r==null?void 0:r.caipNetworkId),Yr.set({activeChain:t,selectedNetworkId:r==null?void 0:r.caipNetworkId}))},setActiveCaipNetwork(t){var s,n,i;if(!t)return;Y.activeChain!==t.chainNamespace&&y.setIsSwitchingNamespace(!0);const e=Y.chains.get(t.chainNamespace);Y.activeChain=t.chainNamespace,Y.activeCaipNetwork=t,y.setChainNetworkData(t.chainNamespace,{caipNetwork:t}),(s=e==null?void 0:e.accountState)!=null&&s.address?Y.activeCaipAddress=`${t.chainNamespace}:${t.id}:${(n=e==null?void 0:e.accountState)==null?void 0:n.address}`:Y.activeCaipAddress=void 0,y.setAccountProp("caipAddress",Y.activeCaipAddress,t.chainNamespace),e&&ee.replaceState(e.accountState),Ae.resetSend(),Yr.set({activeChain:Y.activeChain,selectedNetworkId:(i=Y.activeCaipNetwork)==null?void 0:i.caipNetworkId}),q.setActiveCaipNetworkId(t.caipNetworkId),!y.checkIfSupportedNetwork(t.chainNamespace)&&U.state.enableNetworkSwitch&&!U.state.allowUnsupportedChain&&!V.state.wcBasic&&y.showUnsupportedChainUI()},addCaipNetwork(t){var r;if(!t)return;const e=Y.chains.get(t.chainNamespace);e&&((r=e==null?void 0:e.caipNetworks)==null||r.push(t))},async switchActiveNamespace(t){var n;if(!t)return;const e=t!==y.state.activeChain,r=(n=y.getNetworkData(t))==null?void 0:n.caipNetwork,s=y.getCaipNetworkByNamespace(t,r==null?void 0:r.id);e&&s&&await y.switchActiveNetwork(s)},async switchActiveNetwork(t){var i;const e=y.state.activeChain;if(!e)throw new Error("ChainController:switchActiveNetwork - namespace is required");const r=y.state.chains.get(e),s=!((i=r==null?void 0:r.caipNetworks)!=null&&i.some(o=>{var a;return o.id===((a=Y.activeCaipNetwork)==null?void 0:a.id)})),n=y.getNetworkControllerClient(t.chainNamespace);if(n){try{await n.switchCaipNetwork(t),s&&ge.close()}catch{oe.goBack()}Te.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}})}},getNetworkControllerClient(t){const e=t||Y.activeChain;if(!e)throw new Error("ChainController:getNetworkControllerClient - chain is required");const r=Y.chains.get(e);if(!r)throw new Error("Chain adapter not found");if(!r.networkControllerClient)throw new Error("NetworkController client not set");return r.networkControllerClient},getConnectionControllerClient(t){const e=t||Y.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const r=Y.chains.get(e);if(!(r!=null&&r.connectionControllerClient))throw new Error("ConnectionController client not set");return r.connectionControllerClient},getNetworkProp(t,e){var s;const r=(s=Y.chains.get(e))==null?void 0:s.networkState;if(r)return r[t]},getRequestedCaipNetworks(t){const e=Y.chains.get(t),{approvedCaipNetworkIds:r=[],requestedCaipNetworks:s=[]}=(e==null?void 0:e.networkState)||{};return te.sortRequestedNetworks(r,s).filter(o=>o==null?void 0:o.id)},getAllRequestedCaipNetworks(){const t=[];return Y.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllRequestedCaipNetworks - chainAdapter must have a namespace");const r=y.getRequestedCaipNetworks(e.namespace);t.push(...r)}),t},setRequestedCaipNetworks(t,e){y.setAdapterNetworkState(e,{requestedCaipNetworks:t});const s=y.getAllRequestedCaipNetworks().map(i=>i.chainNamespace),n=Array.from(new Set(s));H.filterByNamespaces(n)},getAllApprovedCaipNetworkIds(){const t=[];return Y.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllApprovedCaipNetworkIds - chainAdapter must have a namespace");const r=y.getApprovedCaipNetworkIds(e.namespace);t.push(...r)}),t},getActiveCaipNetwork(t){var e,r;return t?(r=(e=Y.chains.get(t))==null?void 0:e.networkState)==null?void 0:r.caipNetwork:Y.activeCaipNetwork},getActiveCaipAddress(){return Y.activeCaipAddress},getApprovedCaipNetworkIds(t){var s;const e=Y.chains.get(t);return((s=e==null?void 0:e.networkState)==null?void 0:s.approvedCaipNetworkIds)||[]},async setApprovedCaipNetworksData(t){const e=y.getNetworkControllerClient(),r=await(e==null?void 0:e.getApprovedCaipNetworksData());y.setAdapterNetworkState(t,{approvedCaipNetworkIds:r==null?void 0:r.approvedCaipNetworkIds,supportsAllNetworks:r==null?void 0:r.supportsAllNetworks})},checkIfSupportedNetwork(t,e){var n;const r=e||((n=Y.activeCaipNetwork)==null?void 0:n.caipNetworkId),s=y.getRequestedCaipNetworks(t);return s.length?s==null?void 0:s.some(i=>i.caipNetworkId===r):!0},checkIfSupportedChainId(t){if(!Y.activeChain)return!0;const e=y.getRequestedCaipNetworks(Y.activeChain);return e==null?void 0:e.some(r=>r.id===t)},setSmartAccountEnabledNetworks(t,e){y.setAdapterNetworkState(e,{smartAccountEnabledNetworks:t})},checkIfSmartAccountEnabled(){var s;const t=v0.caipNetworkIdToNumber((s=Y.activeCaipNetwork)==null?void 0:s.caipNetworkId),e=Y.activeChain;if(!e||!t)return!1;const r=y.getNetworkProp("smartAccountEnabledNetworks",e);return!!(r!=null&&r.includes(Number(t)))},showUnsupportedChainUI(){ge.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=Y.activeCaipNetwork;return!!(t!=null&&t.chainNamespace&&Se.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){y.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0})},resetAccount(t){var n,i;const e=t;if(!e)throw new Error("Chain is required to set account prop");const r=(i=(n=y.state.chains.get(e))==null?void 0:n.accountState)==null?void 0:i.preferredAccountType,s=U.state.defaultAccountTypes[e];Y.activeCaipAddress=void 0,y.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountType:s||r,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,user:void 0,status:"disconnected"}),H.removeConnectorId(e)},setIsSwitchingNamespace(t){Y.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){var r,s;const t=[];let e;if(Y.chains.forEach(n=>{B.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(i=>i===n.namespace)&&n.namespace&&t.push(n.namespace)}),t.length>0){const n=t[0];return e=n?(s=(r=Y.chains.get(n))==null?void 0:r.caipNetworks)==null?void 0:s[0]:void 0,e}},getAccountData(t){var r;const e=t||Y.activeChain;if(e)return(r=y.state.chains.get(e))==null?void 0:r.accountState},getNetworkData(t){var r;const e=t||Y.activeChain;if(e)return(r=y.state.chains.get(e))==null?void 0:r.networkState},getCaipNetworkByNamespace(t,e){var n,i,o;if(!t)return;const r=y.state.chains.get(t),s=(n=r==null?void 0:r.caipNetworks)==null?void 0:n.find(a=>a.id===e);return s||((i=r==null?void 0:r.networkState)==null?void 0:i.caipNetwork)||((o=r==null?void 0:r.caipNetworks)==null?void 0:o[0])},getRequestedCaipNetworkIds(){const t=H.state.filterByNamespace;return(t?[Y.chains.get(t)]:Array.from(Y.chains.values())).flatMap(r=>(r==null?void 0:r.caipNetworks)||[]).map(r=>r.caipNetworkId)},getCaipNetworks(t){return t?y.getRequestedCaipNetworks(t):y.getAllRequestedCaipNetworks()},setLastConnectedSIWECaipNetwork(t){Y.lastConnectedSIWECaipNetwork=t},getLastConnectedSIWECaipNetwork(){return Y.lastConnectedSIWECaipNetwork}},y=Gt(z8),W8={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},O0=te.getBlockchainApiUrl(),St=ke({clientId:null,api:new ta({baseUrl:O0,clientId:null}),supportedChains:{http:[],ws:[]}}),ie={state:St,async get(t){const{st:e,sv:r}=ie.getSdkProperties(),s=U.state.projectId,n={...t.params||{},st:e,sv:r,projectId:s};return St.api.get({...t,params:n})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=U.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{St.supportedChains.http.length||await ie.getSupportedNetworks()}catch{return!1}return St.supportedChains.http.includes(t)},async getSupportedNetworks(){try{const t=await ie.get({path:"v1/supported-chains"});return St.supportedChains=t,t}catch{return St.supportedChains}},async fetchIdentity({address:t,caipNetworkId:e}){if(!await ie.isNetworkSupported(e))return{avatar:"",name:""};const s=q.getIdentityFromCacheForAddress(t);if(s)return s;const n=await ie.get({path:`/v1/identity/${t}`,params:{sender:y.state.activeCaipAddress?te.getPlainAddress(y.state.activeCaipAddress):void 0}});return q.updateIdentityCache({address:t,identity:n,timestamp:Date.now()}),n},async fetchTransactions({account:t,cursor:e,signal:r,cache:s,chainId:n}){var c;if(!await ie.isNetworkSupported((c=y.state.activeCaipNetwork)==null?void 0:c.caipNetworkId))return{data:[],next:void 0};const o=q.getTransactionsCacheForAddress({address:t,chainId:n});if(o)return o;const a=await ie.get({path:`/v1/account/${t}/history`,params:{cursor:e,chainId:n},signal:r,cache:s});return q.updateTransactionsCache({address:t,chainId:n,timestamp:Date.now(),transactions:a}),a},async fetchSwapQuote({amount:t,userAddress:e,from:r,to:s,gasPrice:n}){var o;return await ie.isNetworkSupported((o=y.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?ie.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:r,to:s,gasPrice:n}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){var r;return await ie.isNetworkSupported((r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?ie.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async fetchTokenPrice({addresses:t}){var n;if(!await ie.isNetworkSupported((n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId))return{fungibles:[]};const r=q.getTokenPriceCacheForAddresses(t);if(r)return r;const s=await St.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:U.state.projectId},headers:{"Content-Type":"application/json"}});return q.updateTokenPriceCache({addresses:t,timestamp:Date.now(),tokenPrice:s}),s},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){var s;return await ie.isNetworkSupported((s=y.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?ie.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){var n;const{st:e,sv:r}=ie.getSdkProperties();if(!await ie.isNetworkSupported((n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId))throw new Error("Network not supported for Gas Price");return ie.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:e,sv:r}})},async generateSwapCalldata({amount:t,from:e,to:r,userAddress:s,disableEstimate:n}){var o;if(!await ie.isNetworkSupported((o=y.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return St.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:Se.CONVERT_SLIPPAGE_TOLERANCE},projectId:U.state.projectId,from:e,to:r,userAddress:s,disableEstimate:n}})},async generateApproveCalldata({from:t,to:e,userAddress:r}){var o;const{st:s,sv:n}=ie.getSdkProperties();if(!await ie.isNetworkSupported((o=y.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return ie.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:r,from:t,to:e,st:s,sv:n}})},async getBalance(t,e,r){var l;const{st:s,sv:n}=ie.getSdkProperties();if(!await ie.isNetworkSupported((l=y.state.activeCaipNetwork)==null?void 0:l.caipNetworkId))return Pr.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${t}`,a=q.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await ie.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:r,st:s,sv:n}});return q.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(t){var r;return await ie.isNetworkSupported((r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?ie.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){var r;return await ie.isNetworkSupported((r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?ie.get({path:`/v1/profile/reverse/${t}`,params:{sender:ee.state.address,apiVersion:"2"}}):[]},async getEnsNameSuggestions(t){var r;return await ie.isNetworkSupported((r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?ie.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:r,signature:s}){var i;return await ie.isNetworkSupported((i=y.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?St.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:r,signature:s},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:r,purchaseAmount:s,paymentAmount:n}){var a;return await ie.isNetworkSupported((a=y.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)?(await St.api.post({path:"/v1/generators/onrampurl",params:{projectId:U.state.projectId},body:{destinationWallets:t,defaultNetwork:r,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:s,presetFiatAmount:n}})).url:""},async getOnrampOptions(){var e;if(!await ie.isNetworkSupported((e=y.state.activeCaipNetwork)==null?void 0:e.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await ie.get({path:"/v1/onramp/options"})}catch{return W8}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:r,network:s}){var n;try{return await ie.isNetworkSupported((n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?await St.api.post({path:"/v1/onramp/quote",params:{projectId:U.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:r,network:s}}):null}catch{return{networkFee:{amount:r,currency:e.id},paymentSubtotal:{amount:r,currency:e.id},paymentTotal:{amount:r,currency:e.id},purchaseAmount:{amount:r,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){var r;return await ie.isNetworkSupported((r=y.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?ie.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,r){var n;return await ie.isNetworkSupported((n=y.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?St.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:U.state.projectId},body:{pci:e,signature:r}}):{success:!1}},setClientId(t){St.clientId=t,St.api=new ta({baseUrl:O0,clientId:t})}};function H8(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function qp(t){return H8(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const T0="2.46.2";let ki={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${T0}`};class Vt extends Error{constructor(e,r={}){var a;const s=(()=>{var c;return r.cause instanceof Vt?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),n=r.cause instanceof Vt&&r.cause.docsPath||r.docsPath,i=(a=ki.getDocsUrl)==null?void 0:a.call(ki,{...r,docsPath:n}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...s?[`Details: ${s}`]:[],...ki.version?[`Version: ${ki.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=n,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=T0}walk(e){return P0(this,e)}}function P0(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?P0(t.cause,e):e?null:t}class D0 extends Vt{constructor({size:e,targetSize:r,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function wh(t,{dir:e,size:r=32}={}){return typeof t=="string"?K8(t,{dir:e,size:r}):V8(t,{dir:e,size:r})}function K8(t,{dir:e,size:r=32}={}){if(r===null)return t;const s=t.replace("0x","");if(s.length>r*2)throw new D0({size:Math.ceil(s.length/2),targetSize:r,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function V8(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new D0({size:t.length,targetSize:r,type:"bytes"});const s=new Uint8Array(r);for(let n=0;n<r;n++){const i=e==="right";s[i?n:r-n-1]=t[i?n:t.length-n-1]}return s}class G8 extends Vt{constructor({max:e,min:r,signed:s,size:n,value:i}){super(`Number "${i}" is not in safe ${n?`${n*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}class Y8 extends Vt{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function $0(t,{size:e}){if(qp(t)>e)throw new Y8({givenSize:qp(t),maxSize:e})}const J8=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function zp(t,e={}){return typeof t=="number"||typeof t=="bigint"?Z8(t,e):typeof t=="string"?k0(t,e):typeof t=="boolean"?X8(t,e):R0(t,e)}function X8(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?($0(r,{size:e.size}),wh(r,{size:e.size})):r}function R0(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=J8[t[n]];const s=`0x${r}`;return typeof e.size=="number"?($0(s,{size:e.size}),wh(s,{dir:"right",size:e.size})):s}function Z8(t,e={}){const{signed:r,size:s}=e,n=BigInt(t);let i;s?r?i=(1n<<BigInt(s)*8n-1n)-1n:i=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&r?-i-1n:0;if(i&&n>i||n<o){const c=typeof t=="bigint"?"n":"";throw new G8({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:r,size:s,value:`${t}${c}`})}const a=`0x${(r&&n<0?(1n<<BigInt(s*8))+BigInt(n):n).toString(16)}`;return s?wh(a,{size:s}):a}const Q8=new TextEncoder;function k0(t,e={}){const r=Q8.encode(t);return R0(r,e)}class e5 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}}const Zs=(t,e,r)=>JSON.stringify(t,(s,n)=>typeof n=="bigint"?n.toString():n,r);function t5(t,e){let r=t.toString();const s=r.startsWith("-");s&&(r=r.slice(1)),r=r.padStart(e,"0");let[n,i]=[r.slice(0,r.length-e),r.slice(r.length-e)];return i=i.replace(/(0+)$/,""),`${s?"-":""}${n||"0"}${i?`.${i}`:""}`}const mh=t=>t;class Qi extends Vt{constructor({body:e,cause:r,details:s,headers:n,status:i,url:o}){super("HTTP request failed.",{cause:r,details:s,metaMessages:[i&&`Status: ${i}`,`URL: ${mh(o)}`,e&&`Request body: ${Zs(e)}`].filter(Boolean),name:"HttpRequestError"}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.body=e,this.headers=n,this.status=i,this.url=o}}class U0 extends Vt{constructor({body:e,error:r,url:s}){super("RPC Request failed.",{cause:r,details:r.message,metaMessages:[`URL: ${mh(s)}`,`Request body: ${Zs(e)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=r.code,this.data=r.data,this.url=s}}class Wp extends Vt{constructor({body:e,url:r}){super("The request took too long to respond.",{details:"The request timed out.",metaMessages:[`URL: ${mh(r)}`,`Request body: ${Zs(e)}`],name:"TimeoutError"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.url=r}}const r5=-1;class Ut extends Vt{constructor(e,{code:r,docsPath:s,metaMessages:n,name:i,shortMessage:o}){super(o,{cause:e,docsPath:s,metaMessages:n||(e==null?void 0:e.metaMessages),name:i||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=i||e.name,this.code=e instanceof U0?e.code:r??r5}}class Bt extends Ut{constructor(e,r){super(e,r),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=r.data}}class mo extends Ut{constructor(e){super(e,{code:mo.code,name:"ParseRpcError",shortMessage:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."})}}Object.defineProperty(mo,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32700});class yo extends Ut{constructor(e){super(e,{code:yo.code,name:"InvalidRequestRpcError",shortMessage:"JSON is not a valid request object."})}}Object.defineProperty(yo,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32600});class bo extends Ut{constructor(e,{method:r}={}){super(e,{code:bo.code,name:"MethodNotFoundRpcError",shortMessage:`The method${r?` "${r}"`:""} does not exist / is not available.`})}}Object.defineProperty(bo,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32601});class vo extends Ut{constructor(e){super(e,{code:vo.code,name:"InvalidParamsRpcError",shortMessage:["Invalid parameters were provided to the RPC method.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(vo,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class ti extends Ut{constructor(e){super(e,{code:ti.code,name:"InternalRpcError",shortMessage:"An internal error was received."})}}Object.defineProperty(ti,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32603});class Eo extends Ut{constructor(e){super(e,{code:Eo.code,name:"InvalidInputRpcError",shortMessage:["Missing or invalid parameters.","Double check you have provided the correct parameters."].join(`
`)})}}Object.defineProperty(Eo,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32e3});class Co extends Ut{constructor(e){super(e,{code:Co.code,name:"ResourceNotFoundRpcError",shortMessage:"Requested resource not found."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ResourceNotFoundRpcError"})}}Object.defineProperty(Co,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32001});class Ao extends Ut{constructor(e){super(e,{code:Ao.code,name:"ResourceUnavailableRpcError",shortMessage:"Requested resource not available."})}}Object.defineProperty(Ao,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32002});class ri extends Ut{constructor(e){super(e,{code:ri.code,name:"TransactionRejectedRpcError",shortMessage:"Transaction creation failed."})}}Object.defineProperty(ri,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32003});class Ys extends Ut{constructor(e,{method:r}={}){super(e,{code:Ys.code,name:"MethodNotSupportedRpcError",shortMessage:`Method${r?` "${r}"`:""} is not supported.`})}}Object.defineProperty(Ys,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32004});class si extends Ut{constructor(e){super(e,{code:si.code,name:"LimitExceededRpcError",shortMessage:"Request exceeds defined limit."})}}Object.defineProperty(si,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32005});class Io extends Ut{constructor(e){super(e,{code:Io.code,name:"JsonRpcVersionUnsupportedError",shortMessage:"Version of JSON-RPC protocol is not supported."})}}Object.defineProperty(Io,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32006});class Qs extends Bt{constructor(e){super(e,{code:Qs.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(Qs,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class _o extends Bt{constructor(e){super(e,{code:_o.code,name:"UnauthorizedProviderError",shortMessage:"The requested method and/or account has not been authorized by the user."})}}Object.defineProperty(_o,"code",{enumerable:!0,configurable:!0,writable:!0,value:4100});class So extends Bt{constructor(e,{method:r}={}){super(e,{code:So.code,name:"UnsupportedProviderMethodError",shortMessage:`The Provider does not support the requested method${r?` " ${r}"`:""}.`})}}Object.defineProperty(So,"code",{enumerable:!0,configurable:!0,writable:!0,value:4200});class No extends Bt{constructor(e){super(e,{code:No.code,name:"ProviderDisconnectedError",shortMessage:"The Provider is disconnected from all chains."})}}Object.defineProperty(No,"code",{enumerable:!0,configurable:!0,writable:!0,value:4900});class xo extends Bt{constructor(e){super(e,{code:xo.code,name:"ChainDisconnectedError",shortMessage:"The Provider is not connected to the requested chain."})}}Object.defineProperty(xo,"code",{enumerable:!0,configurable:!0,writable:!0,value:4901});class Oo extends Bt{constructor(e){super(e,{code:Oo.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(Oo,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});class To extends Bt{constructor(e){super(e,{code:To.code,name:"UnsupportedNonOptionalCapabilityError",shortMessage:"This Wallet does not support a capability that was not marked as optional."})}}Object.defineProperty(To,"code",{enumerable:!0,configurable:!0,writable:!0,value:5700});class Po extends Bt{constructor(e){super(e,{code:Po.code,name:"UnsupportedChainIdError",shortMessage:"This Wallet does not support the requested chain ID."})}}Object.defineProperty(Po,"code",{enumerable:!0,configurable:!0,writable:!0,value:5710});class Do extends Bt{constructor(e){super(e,{code:Do.code,name:"DuplicateIdError",shortMessage:"There is already a bundle submitted with this ID."})}}Object.defineProperty(Do,"code",{enumerable:!0,configurable:!0,writable:!0,value:5720});class $o extends Bt{constructor(e){super(e,{code:$o.code,name:"UnknownBundleIdError",shortMessage:"This bundle id is unknown / has not been submitted"})}}Object.defineProperty($o,"code",{enumerable:!0,configurable:!0,writable:!0,value:5730});class Ro extends Bt{constructor(e){super(e,{code:Ro.code,name:"BundleTooLargeError",shortMessage:"The call bundle is too large for the Wallet to process."})}}Object.defineProperty(Ro,"code",{enumerable:!0,configurable:!0,writable:!0,value:5740});class ko extends Bt{constructor(e){super(e,{code:ko.code,name:"AtomicReadyWalletRejectedUpgradeError",shortMessage:"The Wallet can support atomicity after an upgrade, but the user rejected the upgrade."})}}Object.defineProperty(ko,"code",{enumerable:!0,configurable:!0,writable:!0,value:5750});class Uo extends Bt{constructor(e){super(e,{code:Uo.code,name:"AtomicityNotSupportedError",shortMessage:"The wallet does not support atomic execution but the request requires it."})}}Object.defineProperty(Uo,"code",{enumerable:!0,configurable:!0,writable:!0,value:5760});class ni extends Bt{constructor(e){super(e,{code:ni.code,name:"WalletConnectSessionSettlementError",shortMessage:"WalletConnect session settlement failed."})}}Object.defineProperty(ni,"code",{enumerable:!0,configurable:!0,writable:!0,value:7e3});class s5 extends Ut{constructor(e){super(e,{name:"UnknownRpcError",shortMessage:"An unknown RPC error occurred."})}}class yh extends Vt{constructor({cause:e,message:r}={}){var n;const s=(n=r==null?void 0:r.replace("execution reverted: ",""))==null?void 0:n.replace("execution reverted","");super(`Execution reverted ${s?`with reason: ${s}`:"for an unknown reason"}.`,{cause:e,name:"ExecutionRevertedError"})}}Object.defineProperty(yh,"code",{enumerable:!0,configurable:!0,writable:!0,value:3});Object.defineProperty(yh,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted|gas required exceeds allowance/});function n5(){let t=()=>{},e=()=>{};return{promise:new Promise((s,n)=>{t=s,e=n}),resolve:t,reject:e}}const Al=new Map;function i5({fn:t,id:e,shouldSplitBatch:r,wait:s=0,sort:n}){const i=async()=>{const u=c();o();const h=u.map(({args:d})=>d);h.length!==0&&t(h).then(d=>{n&&Array.isArray(d)&&d.sort(n);for(let f=0;f<u.length;f++){const{resolve:p}=u[f];p==null||p([d[f],d])}}).catch(d=>{for(let f=0;f<u.length;f++){const{reject:p}=u[f];p==null||p(d)}})},o=()=>Al.delete(e),a=()=>c().map(({args:u})=>u),c=()=>Al.get(e)||[],l=u=>Al.set(e,[...c(),u]);return{flush:o,async schedule(u){const{promise:h,resolve:d,reject:f}=n5();return(r==null?void 0:r([...a(),u]))&&i(),c().length>0?(l({args:u,resolve:d,reject:f}),h):(l({args:u,resolve:d,reject:f}),setTimeout(i,s),h)}}}async function B0(t){return new Promise(e=>setTimeout(e,t))}function o5(t,{delay:e=100,retryCount:r=2,shouldRetry:s=()=>!0}={}){return new Promise((n,i)=>{const o=async({count:a=0}={})=>{const c=async({error:l})=>{const u=typeof e=="function"?e({count:a,error:l}):e;u&&await B0(u),o({count:a+1})};try{const l=await t();n(l)}catch(l){if(a<r&&await s({count:a,error:l}))return c({error:l});i(l)}};o()})}const Nu=256;let Oa=Nu,Ta;function a5(t=11){if(!Ta||Oa+t>Nu*2){Ta="",Oa=0;for(let e=0;e<Nu;e++)Ta+=(256+Math.random()*256|0).toString(16).substring(1)}return Ta.substring(Oa,Oa+++t)}const Pa=new e5(8192);function c5(t,{enabled:e=!0,id:r}){if(!e||!r)return t();if(Pa.get(r))return Pa.get(r);const s=t().finally(()=>Pa.delete(r));return Pa.set(r,s),s}function l5(t,e={}){return async(r,s={})=>{var h;const{dedupe:n=!1,methods:i,retryDelay:o=150,retryCount:a=3,uid:c}={...e,...s},{method:l}=r;if((h=i==null?void 0:i.exclude)!=null&&h.includes(l))throw new Ys(new Error("method not supported"),{method:l});if(i!=null&&i.include&&!i.include.includes(l))throw new Ys(new Error("method not supported"),{method:l});const u=n?k0(`${c}.${Zs(r)}`):void 0;return c5(()=>o5(async()=>{try{return await t(r)}catch(d){const f=d;switch(f.code){case mo.code:throw new mo(f);case yo.code:throw new yo(f);case bo.code:throw new bo(f,{method:r.method});case vo.code:throw new vo(f);case ti.code:throw new ti(f);case Eo.code:throw new Eo(f);case Co.code:throw new Co(f);case Ao.code:throw new Ao(f);case ri.code:throw new ri(f);case Ys.code:throw new Ys(f,{method:r.method});case si.code:throw new si(f);case Io.code:throw new Io(f);case Qs.code:throw new Qs(f);case _o.code:throw new _o(f);case So.code:throw new So(f);case No.code:throw new No(f);case xo.code:throw new xo(f);case Oo.code:throw new Oo(f);case To.code:throw new To(f);case Po.code:throw new Po(f);case Do.code:throw new Do(f);case $o.code:throw new $o(f);case Ro.code:throw new Ro(f);case ko.code:throw new ko(f);case Uo.code:throw new Uo(f);case 5e3:throw new Qs(f);case ni.code:throw new ni(f);default:throw d instanceof Vt?d:new s5(f)}}},{delay:({count:d,error:f})=>{var p;if(f&&f instanceof Qi){const g=(p=f==null?void 0:f.headers)==null?void 0:p.get("Retry-After");if(g!=null&&g.match(/\d/))return Number.parseInt(g,10)*1e3}return~~(1<<d)*o},retryCount:a,shouldRetry:({error:d})=>u5(d)}),{enabled:n,id:u})}}function u5(t){return"code"in t&&typeof t.code=="number"?t.code===-1||t.code===si.code||t.code===ti.code:t instanceof Qi&&t.status?t.status===403||t.status===408||t.status===413||t.status===429||t.status===500||t.status===502||t.status===503||t.status===504:!0}function h5(t,{errorInstance:e=new Error("timed out"),timeout:r,signal:s}){return new Promise((n,i)=>{(async()=>{let o;try{const a=new AbortController;r>0&&(o=setTimeout(()=>{s&&a.abort()},r)),n(await t({signal:(a==null?void 0:a.signal)||null}))}catch(a){(a==null?void 0:a.name)==="AbortError"&&i(e),i(a)}finally{clearTimeout(o)}})()})}function d5(){return{current:0,take(){return this.current++},reset(){this.current=0}}}const Hp=d5();function f5(t,e={}){const{url:r,headers:s}=p5(t);return{async request(n){var p;const{body:i,fetchFn:o=e.fetchFn??fetch,onRequest:a=e.onRequest,onResponse:c=e.onResponse,timeout:l=e.timeout??1e4}=n,u={...e.fetchOptions??{},...n.fetchOptions??{}},{headers:h,method:d,signal:f}=u;try{const g=await h5(async({signal:E})=>{const v={...u,body:Array.isArray(i)?Zs(i.map(k=>({jsonrpc:"2.0",id:k.id??Hp.take(),...k}))):Zs({jsonrpc:"2.0",id:i.id??Hp.take(),...i}),headers:{...s,"Content-Type":"application/json",...h},method:d||"POST",signal:f||(l>0?E:null)},C=new Request(r,v),_=await(a==null?void 0:a(C,v))??{...v,url:r};return await o(_.url??r,_)},{errorInstance:new Wp({body:i,url:r}),timeout:l,signal:!0});c&&await c(g);let w;if((p=g.headers.get("Content-Type"))!=null&&p.startsWith("application/json"))w=await g.json();else{w=await g.text();try{w=JSON.parse(w||"{}")}catch(E){if(g.ok)throw E;w={error:w}}}if(!g.ok)throw new Qi({body:i,details:Zs(w.error)||g.statusText,headers:g.headers,status:g.status,url:r});return w}catch(g){throw g instanceof Qi||g instanceof Wp?g:new Qi({body:i,cause:g,url:r})}}}}function p5(t){try{const e=new URL(t),r=(()=>{if(e.username){const s=`${decodeURIComponent(e.username)}:${decodeURIComponent(e.password)}`;return e.username="",e.password="",{url:e.toString(),headers:{Authorization:`Basic ${btoa(s)}`}}}})();return{url:e.toString(),...r}}catch{return{url:t}}}function L0({key:t,methods:e,name:r,request:s,retryCount:n=3,retryDelay:i=150,timeout:o,type:a},c){const l=a5();return{config:{key:t,methods:e,name:r,request:s,retryCount:n,retryDelay:i,timeout:o,type:a},request:l5(s,{methods:e,retryCount:n,retryDelay:i,uid:l}),value:c}}function Kp(t,e={}){const{key:r="fallback",name:s="Fallback",rank:n=!1,shouldThrow:i=g5,retryCount:o,retryDelay:a}=e;return({chain:c,pollingInterval:l=4e3,timeout:u,...h})=>{let d=t,f=()=>{};const p=L0({key:r,name:s,async request({method:g,params:w}){let E;const v=async(C=0)=>{const _=d[C]({...h,chain:c,retryCount:0,timeout:u});try{const S=await _.request({method:g,params:w});return f({method:g,params:w,response:S,transport:_,status:"success"}),S}catch(S){if(f({error:S,method:g,params:w,transport:_,status:"error"}),i(S)||C===d.length-1||(E??(E=d.slice(C+1).some(k=>{const{include:L,exclude:R}=k({chain:c}).config.methods||{};return L?L.includes(g):R?!R.includes(g):!0})),!E))throw S;return v(C+1)}};return v()},retryCount:o,retryDelay:a,type:"fallback"},{onResponse:g=>f=g,transports:d.map(g=>g({chain:c,retryCount:0}))});if(n){const g=typeof n=="object"?n:{};w5({chain:c,interval:g.interval??l,onTransports:w=>d=w,ping:g.ping,sampleCount:g.sampleCount,timeout:g.timeout,transports:d,weights:g.weights})}return p}}function g5(t){return!!("code"in t&&typeof t.code=="number"&&(t.code===ri.code||t.code===Qs.code||t.code===ni.code||yh.nodeMessage.test(t.message)||t.code===5e3))}function w5({chain:t,interval:e=4e3,onTransports:r,ping:s,sampleCount:n=10,timeout:i=1e3,transports:o,weights:a={}}){const{stability:c=.7,latency:l=.3}=a,u=[],h=async()=>{const d=await Promise.all(o.map(async g=>{const w=g({chain:t,retryCount:0,timeout:i}),E=Date.now();let v,C;try{await(s?s({transport:w}):w.request({method:"net_listening"})),C=1}catch{C=0}finally{v=Date.now()}return{latency:v-E,success:C}}));u.push(d),u.length>n&&u.shift();const f=Math.max(...u.map(g=>Math.max(...g.map(({latency:w})=>w)))),p=o.map((g,w)=>{const E=u.map(k=>k[w].latency),C=1-E.reduce((k,L)=>k+L,0)/E.length/f,_=u.map(k=>k[w].success),S=_.reduce((k,L)=>k+L,0)/_.length;return S===0?[0,w]:[l*C+c*S,w]}).sort((g,w)=>w[0]-g[0]);r(p.map(([,g])=>o[g])),await B0(e),h()};h()}class m5 extends Vt{constructor(){super("No URL was provided to the Transport. Please provide a valid RPC URL to the Transport.",{docsPath:"/docs/clients/intro",name:"UrlRequiredError"})}}function Da(t,e={}){const{batch:r,fetchFn:s,fetchOptions:n,key:i="http",methods:o,name:a="HTTP JSON-RPC",onFetchRequest:c,onFetchResponse:l,retryDelay:u,raw:h}=e;return({chain:d,retryCount:f,timeout:p})=>{const{batchSize:g=1e3,wait:w=0}=typeof r=="object"?r:{},E=e.retryCount??f,v=p??e.timeout??1e4,C=t||(d==null?void 0:d.rpcUrls.default.http[0]);if(!C)throw new m5;const _=f5(C,{fetchFn:s,fetchOptions:n,onRequest:c,onResponse:l,timeout:v});return L0({key:i,methods:o,name:a,async request({method:S,params:k}){const L={method:S,params:k},{schedule:R}=i5({id:C,wait:w,shouldSplitBatch(O){return O.length>g},fn:O=>_.request({body:O}),sort:(O,$)=>O.id-$.id}),A=async O=>r?R(O):[await _.request({body:O})],[{error:D,result:T}]=await A(L);if(h)return{error:D,result:T};if(D)throw new U0({body:L,error:D,url:C});return T},retryCount:E,retryDelay:u,timeout:v,type:"http"},{fetchOptions:n,url:C})}}const Il={createBalance(t,e){const r={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:r.name,symbol:r.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:r.value,price:r.price,quantity:{decimals:r.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:r.decimals})},iconUrl:r.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return t5(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const r=e[1],s=parseInt(r,10);return isNaN(s)?"0x0":`0x${s.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(r=>this.isValidAsset(r)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}},bh={async getMyTokensWithBalance(t){const e=ee.state.address,r=y.state.activeCaipNetwork,s=H.getConnectorId("eip155")===B.CONNECTOR_ID.AUTH;if(!e||!r)return[];const n=`${r.caipNetworkId}:${e}`,i=q.getBalanceCacheForCaipAddress(n);if(i)return i.balances;if(r.chainNamespace===B.CHAIN.EVM&&s){const a=await this.getEIP155Balances(e,r);if(a)return this.filterLowQualityTokens(a)}const o=await ie.getBalance(e,r.caipNetworkId,t);return this.filterLowQualityTokens(o.balances)},async getEIP155Balances(t,e){var r,s;try{const n=Il.getChainIdHexFromCAIP2ChainId(e.caipNetworkId),i=await V.getCapabilities(t);if(!((s=(r=i==null?void 0:i[n])==null?void 0:r.assetDiscovery)!=null&&s.supported))return null;const o=await V.walletGetAssets({account:t,chainFilter:[n]});if(!Il.isWalletGetAssetsResponse(o))return null;const c=(o[n]||[]).map(l=>Il.createBalance(l,e.caipNetworkId));return q.updateBalanceCache({caipAddress:`${e.caipNetworkId}:${t}`,balance:{balances:c},timestamp:Date.now()}),c}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")}},Ar=ke({currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map}),y5={state:Ar,replaceState(t){t&&Object.assign(Ar,an(t))},subscribe(t){return y.subscribeChainProp("accountState",e=>{if(e)return t(e)})},subscribeKey(t,e,r){let s;return y.subscribeChainProp("accountState",n=>{if(n){const i=n[t];s!==i&&(s=i,e(i))}},r)},setStatus(t,e){y.setAccountProp("status",t,e)},getCaipAddress(t){var e,r;if(t)return(r=(e=y.state.chains.get(t))==null?void 0:e.accountState)==null?void 0:r.caipAddress},setCaipAddress(t,e){const r=t?te.getPlainAddress(t):void 0;e===y.state.activeChain&&(y.state.activeCaipAddress=t),y.setAccountProp("caipAddress",t,e),y.setAccountProp("address",r,e)},setBalance(t,e,r){y.setAccountProp("balance",t,r),y.setAccountProp("balanceSymbol",e,r)},setProfileName(t,e){y.setAccountProp("profileName",t,e)},setProfileImage(t,e){y.setAccountProp("profileImage",t,e)},setUser(t,e){y.setAccountProp("user",t,e)},setAddressExplorerUrl(t,e){y.setAccountProp("addressExplorerUrl",t,e)},setSmartAccountDeployed(t,e){y.setAccountProp("smartAccountDeployed",t,e)},setCurrentTab(t){y.setAccountProp("currentTab",t,y.state.activeChain)},setTokenBalance(t,e){t&&y.setAccountProp("tokenBalance",t,e)},setShouldUpdateToAddress(t,e){y.setAccountProp("shouldUpdateToAddress",t,e)},addAddressLabel(t,e,r){var n,i;if(!r)return;const s=((i=(n=y.state.chains.get(r))==null?void 0:n.accountState)==null?void 0:i.addressLabels)||new Map;s.set(t,e),y.setAccountProp("addressLabels",s,r)},removeAddressLabel(t,e){var s,n;if(!e)return;const r=((n=(s=y.state.chains.get(e))==null?void 0:s.accountState)==null?void 0:n.addressLabels)||new Map;r.delete(t),y.setAccountProp("addressLabels",r,e)},setConnectedWalletInfo(t,e){y.setAccountProp("connectedWalletInfo",t,e,!1)},setPreferredAccountType(t,e){y.setAccountProp("preferredAccountType",t,e)},setSocialProvider(t,e){t&&y.setAccountProp("socialProvider",t,e)},setSocialWindow(t,e){y.setAccountProp("socialWindow",t?an(t):void 0,e)},setFarcasterUrl(t,e){y.setAccountProp("farcasterUrl",t,e)},async fetchTokenBalance(t){var i,o;Ar.balanceLoading=!0;const e=(i=y.state.activeCaipNetwork)==null?void 0:i.caipNetworkId,r=(o=y.state.activeCaipNetwork)==null?void 0:o.chainNamespace,s=y.state.activeCaipAddress,n=s?te.getPlainAddress(s):void 0;if(Ar.lastRetry&&!te.isAllowedRetry(Ar.lastRetry,30*Se.ONE_SEC_MS))return Ar.balanceLoading=!1,[];try{if(n&&e&&r){const a=await bh.getMyTokensWithBalance();return ee.setTokenBalance(a,r),Ar.lastRetry=void 0,Ar.balanceLoading=!1,a}}catch(a){Ar.lastRetry=Date.now(),t==null||t(a),Pr.showError("Token Balance Unavailable")}finally{Ar.balanceLoading=!1}return[]},resetAccount(t){y.resetAccount(t)}},ee=Gt(y5),b5={onSwitchNetwork({network:t,ignoreSwitchConfirmation:e=!1}){const r=y.state.activeCaipNetwork,s=oe.state.data;if(t.id===(r==null?void 0:r.id))return;const i=ee.getCaipAddress(y.state.activeChain),o=t.chainNamespace!==y.state.activeChain,a=ee.getCaipAddress(t.chainNamespace),l=H.getConnectorId(y.state.activeChain)===B.CONNECTOR_ID.AUTH,u=B.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(h=>h===t.chainNamespace);e||l&&u?oe.push("SwitchNetwork",{...s,network:t}):i&&o&&!a?oe.push("SwitchActiveChain",{switchToChain:t.chainNamespace,navigateTo:"Connect",navigateWithReplace:!0,network:t}):oe.push("SwitchNetwork",{...s,network:t})}},Nt=ke({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),v5={state:Nt,subscribe(t){return at(Nt,()=>t(Nt))},subscribeKey(t,e){return yt(Nt,t,e)},async open(t){var i,o;const e=t==null?void 0:t.namespace,r=y.state.activeChain,s=e&&e!==r,n=(i=y.getAccountData(t==null?void 0:t.namespace))==null?void 0:i.caipAddress;if(V.state.wcBasic?ne.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1}):await ne.prefetch(),H.setFilterByNamespace(t==null?void 0:t.namespace),ge.setLoading(!0,e),e&&s){const a=((o=y.getNetworkData(e))==null?void 0:o.caipNetwork)||y.getRequestedCaipNetworks(e)[0];a&&b5.onSwitchNetwork({network:a,ignoreSwitchConfirmation:!0})}else{const a=y.state.noAdapters;U.state.manualWCControl||a&&!n?te.isMobile()?oe.reset("AllWallets"):oe.reset("ConnectingWalletConnectBasic"):t!=null&&t.view?oe.reset(t.view,t.data):n?oe.reset("Account"):oe.reset("Connect")}Nt.open=!0,Yr.set({open:!0}),Te.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!n}})},close(){const t=U.state.enableEmbedded,e=!!y.state.activeCaipAddress;Nt.open&&Te.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),Nt.open=!1,oe.reset("Connect"),ge.clearLoading(),t?e?oe.replace("Account"):oe.push("Connect"):Yr.set({open:!1}),V.resetUri()},setLoading(t,e){e&&Nt.loadingNamespaceMap.set(e,t),Nt.loading=t,Yr.set({loading:t})},clearLoading(){Nt.loadingNamespaceMap.clear(),Nt.loading=!1,Yr.set({loading:!1})},shake(){Nt.shake||(Nt.shake=!0,setTimeout(()=>{Nt.shake=!1},500))}},ge=Gt(v5),eo={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},xu={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},E5={providers:_0,selectedProvider:null,error:null,purchaseCurrency:eo,paymentCurrency:xu,purchaseCurrencies:[eo],paymentCurrencies:[],quotesLoading:!1},we=ke(E5),C5={state:we,subscribe(t){return at(we,()=>t(we))},subscribeKey(t,e){return yt(we,t,e)},setSelectedProvider(t){var e,r;if(t&&t.name==="meld"){const s=y.state.activeChain,n=s===B.CHAIN.SOLANA?"SOL":"USDC",i=s?((r=(e=y.state.chains.get(s))==null?void 0:e.accountState)==null?void 0:r.address)??"":"",o=new URL(t.url);o.searchParams.append("publicKey",m8),o.searchParams.append("destinationCurrencyCode",n),o.searchParams.append("walletAddress",i),o.searchParams.append("externalCustomerId",U.state.projectId),we.selectedProvider={...t,url:o.toString()}}else we.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){const e=t,r=_0.filter(s=>e.includes(s.name));we.providers=r}else we.providers=[]},setPurchaseCurrency(t){we.purchaseCurrency=t},setPaymentCurrency(t){we.paymentCurrency=t},setPurchaseAmount(t){Ou.state.purchaseAmount=t},setPaymentAmount(t){Ou.state.paymentAmount=t},async getAvailableCurrencies(){const t=await ie.getOnrampOptions();we.purchaseCurrencies=t.purchaseCurrencies,we.paymentCurrencies=t.paymentCurrencies,we.paymentCurrency=t.paymentCurrencies[0]||xu,we.purchaseCurrency=t.purchaseCurrencies[0]||eo,await ne.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await ne.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){var t,e;we.quotesLoading=!0;try{const r=await ie.getOnrampQuote({purchaseCurrency:we.purchaseCurrency,paymentCurrency:we.paymentCurrency,amount:((t=we.paymentAmount)==null?void 0:t.toString())||"0",network:(e=we.purchaseCurrency)==null?void 0:e.symbol});return we.quotesLoading=!1,we.purchaseAmount=Number(r==null?void 0:r.purchaseAmount.amount),r}catch(r){return we.error=r.message,we.quotesLoading=!1,null}finally{we.quotesLoading=!1}},resetState(){we.selectedProvider=null,we.error=null,we.purchaseCurrency=eo,we.paymentCurrency=xu,we.purchaseCurrencies=[eo],we.paymentCurrencies=[],we.paymentAmount=void 0,we.purchaseAmount=void 0,we.quotesLoading=!1}},Ou=Gt(C5),Vp=2147483648,A5={convertEVMChainIdToCoinType(t){if(t>=Vp)throw new Error("Invalid chainId");return(Vp|t)>>>0}},Xt=ke({suggestions:[],loading:!1}),I5={state:Xt,subscribe(t){return at(Xt,()=>t(Xt))},subscribeKey(t,e){return yt(Xt,t,e)},async resolveName(t){var e,r;try{return await ie.lookupEnsName(t)}catch(s){const n=s;throw new Error(((r=(e=n==null?void 0:n.reasons)==null?void 0:e[0])==null?void 0:r.description)||"Error resolving name")}},async isNameRegistered(t){try{return await ie.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{Xt.loading=!0,Xt.suggestions=[];const e=await ie.getEnsNameSuggestions(t);return Xt.suggestions=e.suggestions.map(r=>({...r,name:r.name}))||[],Xt.suggestions}catch(e){const r=to.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(r)}finally{Xt.loading=!1}},async getNamesForAddress(t){try{if(!y.state.activeCaipNetwork)return[];const r=q.getEnsFromCacheForAddress(t);if(r)return r;const s=await ie.reverseLookupEnsName({address:t});return q.updateEnsCache({address:t,ens:s,timestamp:Date.now()}),s}catch(e){const r=to.parseEnsApiError(e,"Error fetching names for address");throw new Error(r)}},async registerName(t){const e=y.state.activeCaipNetwork,r=ee.state.address,s=H.getAuthConnector();if(!e)throw new Error("Network not found");if(!r||!s)throw new Error("Address or auth connector not found");Xt.loading=!0;try{const n=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});oe.pushTransactionStack({onCancel(){oe.replace("RegisterAccountName")}});const i=await V.signMessage(n);Xt.loading=!1;const o=e.id;if(!o)throw new Error("Network not found");const a=A5.convertEVMChainIdToCoinType(Number(o));await ie.registerEnsName({coinType:a,address:r,signature:i,message:n}),ee.setProfileName(t,e.chainNamespace),oe.replace("RegisterAccountNameSuccess")}catch(n){const i=to.parseEnsApiError(n,`Error registering name ${t}`);throw oe.replace("RegisterAccountName"),new Error(i)}finally{Xt.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){var s,n;const r=t;return((n=(s=r==null?void 0:r.reasons)==null?void 0:s[0])==null?void 0:n.description)||e}},to=Gt(I5);let Us=null;const Tr={getSIWX(){return U.state.siwx},async initializeIfEnabled(t=y.getActiveCaipAddress()){var i,o,a;const e=U.state.siwx;if(!(e&&t))return;const[r,s,n]=t.split(":");if(y.checkIfSupportedNetwork(r,`${r}:${s}`))try{if((i=U.state.remoteFeatures)!=null&&i.emailCapture){const l=(o=y.getAccountData(r))==null?void 0:o.user;await ge.open({view:"DataCapture",data:{email:(l==null?void 0:l.email)??void 0}});return}if(Us&&await Us,(await e.getSessions(`${r}:${s}`,n)).length)return;await ge.open({view:"SIWXSignMessage"})}catch(c){console.error("SIWXUtil:initializeIfEnabled",c),Te.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties()}),await((a=V._getClient())==null?void 0:a.disconnect().catch(console.error)),oe.reset("Connect"),Pr.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){const t=U.state.siwx,e=te.getPlainAddress(y.getActiveCaipAddress()),r=jp(),s=V._getClient();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!r)throw new Error("No ActiveCaipNetwork or client found");if(!s)throw new Error("No ConnectionController client found");try{const n=await t.createMessage({chainId:r.caipNetworkId,accountAddress:e}),i=n.toString();H.getConnectorId(r.chainNamespace)===B.CONNECTOR_ID.AUTH&&oe.pushTransactionStack({});const a=await s.signMessage(i);await t.addSession({data:n,message:i,signature:a}),y.setLastConnectedSIWECaipNetwork(r),ge.close(),Te.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(n){const i=this.getSIWXEventProperties();(!ge.state.open||oe.state.view==="ApproveTransaction")&&await ge.open({view:"SIWXSignMessage"}),Pr.showError("Error signing message"),Te.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:i}),console.error("SWIXUtil:requestSignMessage",n)}},async cancelSignMessage(){var t;try{const e=this.getSIWX();if((t=e==null?void 0:e.getRequired)==null?void 0:t.call(e)){const s=y.getLastConnectedSIWECaipNetwork();if(s){const n=await(e==null?void 0:e.getSessions(s==null?void 0:s.caipNetworkId,te.getPlainAddress(y.getActiveCaipAddress())||""));n&&n.length>0?await y.switchActiveNetwork(s):await V.disconnect()}else await V.disconnect()}else ge.close();ge.close(),Te.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(e){console.error("SIWXUtil:cancelSignMessage",e)}},async getAllSessions(){const t=this.getSIWX(),e=y.getAllRequestedCaipNetworks(),r=[];return await Promise.all(e.map(async s=>{const n=await(t==null?void 0:t.getSessions(s.caipNetworkId,te.getPlainAddress(y.getActiveCaipAddress())||""));n&&r.push(...n)})),r},async getSessions(t){const e=U.state.siwx;let r=t==null?void 0:t.address;if(!r){const n=y.getActiveCaipAddress();r=te.getPlainAddress(n)}let s=t==null?void 0:t.caipNetworkId;if(!s){const n=y.getActiveCaipNetwork();s=n==null?void 0:n.caipNetworkId}return e&&r&&s?e.getSessions(s,r):[]},async isSIWXCloseDisabled(){var e;const t=this.getSIWX();if(t){const r=oe.state.view==="ApproveTransaction",s=oe.state.view==="SIWXSignMessage";if(r||s)return((e=t.getRequired)==null?void 0:e.call(t))&&(await this.getSessions()).length===0}return!1},async authConnectorAuthenticate({authConnector:t,chainId:e,socialUri:r,preferredAccountType:s,chainNamespace:n}){var u;const i=Tr.getSIWX();if(!i||!n.includes(B.CHAIN.EVM)||(u=U.state.remoteFeatures)!=null&&u.emailCapture){const h=await t.connect({chainId:e,socialUri:r,preferredAccountType:s});return{address:h.address,chainId:h.chainId,accounts:h.accounts}}const o=`${n}:${e}`,a=await i.createMessage({chainId:o,accountAddress:"<<AccountAddress>>"}),c={accountAddress:a.accountAddress,chainId:a.chainId,domain:a.domain,uri:a.uri,version:a.version,nonce:a.nonce,notBefore:a.notBefore,statement:a.statement,resources:a.resources,requestId:a.requestId,issuedAt:a.issuedAt,expirationTime:a.expirationTime,serializedMessage:a.toString()},l=await t.connect({chainId:e,socialUri:r,siwxMessage:c,preferredAccountType:s});return c.accountAddress=l.address,c.serializedMessage=l.message||"",l.signature&&l.message&&await Tr.addEmbeddedWalletSession(c,l.message,l.signature),{address:l.address,chainId:l.chainId,accounts:l.accounts}},async addEmbeddedWalletSession(t,e,r){if(Us)return Us;const s=Tr.getSIWX();return s?(Us=s.addSession({data:t,message:e,signature:r}).finally(()=>{Us=null}),Us):Promise.resolve()},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:r}){var a,c,l;const s=Tr.getSIWX(),n=new Set(e.map(u=>u.split(":")[0]));if(!s||n.size!==1||!n.has("eip155"))return!1;const i=await s.createMessage({chainId:((a=jp())==null?void 0:a.caipNetworkId)||"",accountAddress:""}),o=await t.authenticate({nonce:i.nonce,domain:i.domain,uri:i.uri,exp:i.expirationTime,iat:i.issuedAt,nbf:i.notBefore,requestId:i.requestId,version:i.version,resources:i.resources,statement:i.statement,chainId:i.chainId,methods:r,chains:[i.chainId,...e.filter(u=>u!==i.chainId)]});if(Pr.showLoading("Authenticating...",{autoClose:!1}),ee.setConnectedWalletInfo({...o.session.peer.metadata,name:o.session.peer.metadata.name,icon:(c=o.session.peer.metadata.icons)==null?void 0:c[0],type:"WALLET_CONNECT"},Array.from(n)[0]),(l=o==null?void 0:o.auths)!=null&&l.length){const u=o.auths.map(h=>{const d=t.client.formatAuthMessage({request:h.p,iss:h.p.iss});return{data:{...h.p,accountAddress:h.p.iss.split(":").slice(-1).join(""),chainId:h.p.iss.split(":").slice(2,4).join(":"),uri:h.p.aud,version:h.p.version||i.version,expirationTime:h.p.exp,issuedAt:h.p.iat,notBefore:h.p.nbf},message:d,signature:h.s.s,cacao:h}});try{await s.setSessions(u),Te.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:Tr.getSIWXEventProperties()})}catch(h){throw console.error("SIWX:universalProviderAuth - failed to set sessions",h),Te.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:Tr.getSIWXEventProperties()}),await t.disconnect().catch(console.error),h}finally{Pr.hide()}}return!0},getSIWXEventProperties(){var e;const t=y.state.activeChain;if(!t)throw new Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:((e=y.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)||"",isSmartAccount:Br(t)===Xs.ACCOUNT_TYPES.SMART_ACCOUNT}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}},Fs={EIP155:B.CHAIN.EVM,CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED"},Bo={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200"},ConnectorImageIds:{[B.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[B.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[B.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[B.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[B.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[B.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[B.CONNECTOR_ID.INJECTED]:"Browser Wallet",[B.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[B.CONNECTOR_ID.COINBASE]:"Coinbase",[B.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[B.CONNECTOR_ID.LEDGER]:"Ledger",[B.CONNECTOR_ID.SAFE]:"Safe"}},Wt={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([r,s])=>{e[`${Fs.EIP155}:${r}`]=s}),e},isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())},getActiveNamespaceConnectedToAuth(){const t=y.state.activeChain;return B.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(e=>H.getConnectorId(e)===B.CONNECTOR_ID.AUTH&&e===t)},withRetry({conditionFn:t,intervalMs:e,maxRetries:r}){let s=0;return new Promise(n=>{async function i(){return s+=1,await t()?n(!0):s>=r?n(!1):(setTimeout(i,e),null)}i()})}},_5=new AbortController,Zt={EmbeddedWalletAbortController:_5,UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"ORIGIN_NOT_ALLOWED"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{code:"APKT001",displayMessage:"Network Not Found",debugMessage:"The specified network is not recognized. Please ensure it is included in the `networks` array of your `createAppKit` configuration."},ORIGIN_NOT_ALLOWED:{code:"APKT002",displayMessage:"Invalid App Configuration",debugMessage:()=>`The origin ${Vn()?window.origin:"unknown"} is not in your allow list. Please update your allowed domains at https://dashboard.reown.com.`},IFRAME_LOAD_FAILED:{code:"APKT003",displayMessage:"Network Error: Wallet Load Failed",debugMessage:()=>"Failed to load the embedded wallet. This may be due to network issues or server downtime. Please check your network connection and try again shortly. Contact support if the issue persists."},IFRAME_REQUEST_TIMEOUT:{code:"APKT004",displayMessage:"Wallet Request Timeout",debugMessage:()=>"The request to the embedded wallet timed out. Please check your network connection and try again shortly. Contact support if the issue persists."},UNVERIFIED_DOMAIN:{code:"APKT005",displayMessage:"Unverified Domain",debugMessage:()=>"Embedded wallet load failed. Ensure your domain is verified in https://dashboard.reown.com."},JWT_TOKEN_NOT_VALID:{code:"APKT006",displayMessage:"Session Expired",debugMessage:"Your session is invalid or expired. Please check your systems date and time settings, then reconnect."},INVALID_PROJECT_ID:{code:"APKT007",displayMessage:"Invalid Project ID",debugMessage:"The specified project ID is invalid. Please visit https://dashboard.reown.com to obtain a valid project ID."},PROJECT_ID_NOT_CONFIGURED:{code:"APKT008",displayMessage:"Project ID Missing",debugMessage:"No project ID is configured. You can create and configure a project ID at https://dashboard.reown.com."},SERVER_ERROR_APP_CONFIGURATION:{code:"APKT009",displayMessage:"Server Error",debugMessage:t=>`Unable to fetch App Configuration. ${t}. Please check your network connection and try again shortly. Contact support if the issue persists.`},RATE_LIMITED_APP_CONFIGURATION:{code:"APKT010",displayMessage:"Rate Limited",debugMessage:"You have been rate limited while retrieving App Configuration. Please wait a few minutes and try again. Contact support if the issue persists."}},ALERT_WARNINGS:{LOCAL_CONFIGURATION_IGNORED:{debugMessage:t=>`[Reown Config Notice] ${t}`}}},S5={createLogger(t,e="error"){const r=Ho({level:e}),{logger:s}=_g({opts:r});return s.error=(...n)=>{for(const i of n)if(i instanceof Error){t(i,...n);return}t(void 0,...n)},s}},N5="rpc.walletconnect.org";function Gp(t,e){const r=new URL("https://rpc.walletconnect.org/v1/");return r.searchParams.set("chainId",t),r.searchParams.set("projectId",e),r.toString()}const _l=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],zn={extendRpcUrlWithProjectId(t,e){let r=!1;try{r=new URL(t).host===N5}catch{r=!1}if(r){const s=new URL(t);return s.searchParams.has("projectId")||s.searchParams.set("projectId",e),s.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:B.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${B.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,r){var n,i,o;const s=(o=(i=(n=t.rpcUrls)==null?void 0:n.default)==null?void 0:i.http)==null?void 0:o[0];return _l.includes(e)?Gp(e,r):s||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:r,customRpcUrls:s}){var d,f,p,g,w,E,v;const n=this.getChainNamespace(t),i=this.getCaipNetworkId(t),o=(p=(f=(d=t.rpcUrls)==null?void 0:d.default)==null?void 0:f.http)==null?void 0:p[0],a=this.getDefaultRpcUrl(t,i,r),c=((E=(w=(g=t==null?void 0:t.rpcUrls)==null?void 0:g.chainDefault)==null?void 0:w.http)==null?void 0:E[0])||o,l=((v=s==null?void 0:s[i])==null?void 0:v.map(C=>C.url))||[],u=[...l,...a?[a]:[]],h=[...l];return c&&!h.includes(c)&&h.push(c),{...t,chainNamespace:n,caipNetworkId:i,assets:{imageId:Bo.NetworkImageIds[t.id],imageUrl:e==null?void 0:e[t.id]},rpcUrls:{...t.rpcUrls,default:{http:u},chainDefault:{http:h}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:r,customRpcUrls:s}){return t.map(n=>zn.extendCaipNetwork(n,{customNetworkImageUrls:e,customRpcUrls:s,projectId:r}))},getViemTransport(t,e,r){var n,i,o;const s=[];return r==null||r.forEach(a=>{s.push(Da(a.url,a.config))}),_l.includes(t.caipNetworkId)&&s.push(Da(Gp(t.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),(o=(i=(n=t==null?void 0:t.rpcUrls)==null?void 0:n.default)==null?void 0:i.http)==null||o.forEach(a=>{s.push(Da(a))}),Kp(s)},extendWagmiTransports(t,e,r){if(_l.includes(t.caipNetworkId)){const s=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return Kp([r,Da(s)])}return r},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:B.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){var c;const e=q.getActiveCaipNetworkId(),r=y.getAllRequestedCaipNetworks(),s=Array.from(((c=y.state.chains)==null?void 0:c.keys())||[]),n=e==null?void 0:e.split(":")[0],i=n?s.includes(n):!1,o=r==null?void 0:r.find(l=>l.caipNetworkId===e);return i&&!o&&e?this.getUnsupportedNetwork(e):o||t||(r==null?void 0:r[0])}},cc={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0,sui:void 0,stacks:void 0},xt=ke({providers:{...cc},providerIds:{...cc}}),je={state:xt,subscribeKey(t,e){return yt(xt,t,e)},subscribe(t){return at(xt,()=>{t(xt)})},subscribeProviders(t){return at(xt.providers,()=>t(xt.providers))},setProvider(t,e){t&&e&&(xt.providers[t]=an(e))},getProvider(t){if(t)return xt.providers[t]},setProviderId(t,e){e&&(xt.providerIds[t]=e)},getProviderId(t){if(t)return xt.providerIds[t]},reset(){xt.providers={...cc},xt.providerIds={...cc}},resetChain(t){xt.providers[t]=void 0,xt.providerIds[t]=void 0}},x5={VIEW_DIRECTION:{Next:"next",Prev:"prev"},DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"],ANIMATION_DURATIONS:{HeaderText:120,ModalHeight:150,ViewTransition:150}},Tu={filterOutDuplicatesByRDNS(t){const e=U.state.enableEIP6963?H.state.connectors:[],r=q.getRecentWallets(),s=e.map(a=>{var c;return(c=a.info)==null?void 0:c.rdns}).filter(Boolean),n=r.map(a=>a.rdns).filter(Boolean),i=s.concat(n);if(i.includes("io.metamask.mobile")&&te.isMobile()){const a=i.indexOf("io.metamask.mobile");i[a]="io.metamask"}return t.filter(a=>!(a!=null&&a.rdns&&i.includes(String(a.rdns))||!(a!=null&&a.rdns)&&e.some(l=>l.name===a.name)))},filterOutDuplicatesByIds(t){const e=H.state.connectors.filter(a=>a.type==="ANNOUNCED"||a.type==="INJECTED"),r=q.getRecentWallets(),s=e.map(a=>a.explorerId),n=r.map(a=>a.id),i=s.concat(n);return t.filter(a=>!i.includes(a==null?void 0:a.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=H.state,{featuredWalletIds:r}=U.state,s=e.filter(o=>o.type==="ANNOUNCED").reduce((o,a)=>{var c;return(c=a.info)!=null&&c.rdns&&(o[a.info.rdns]=!0),o},{});return t.map(o=>({...o,installed:!!o.rdns&&!!s[o.rdns??""]})).sort((o,a)=>{const c=Number(a.installed)-Number(o.installed);if(c!==0)return c;if(r!=null&&r.length){const l=r.indexOf(o.id),u=r.indexOf(a.id);if(l!==-1&&u!==-1)return l-u;if(l!==-1)return-1;if(u!==-1)return 1}return 0})},getConnectOrderMethod(t,e){var c;const r=(t==null?void 0:t.connectMethodsOrder)||((c=U.state.features)==null?void 0:c.connectMethodsOrder),s=e||H.state.connectors;if(r)return r;const{injected:n,announced:i}=Wa.getConnectorsByType(s,ne.state.recommended,ne.state.featured),o=n.filter(Wa.showConnector),a=i.filter(Wa.showConnector);return o.length||a.length?["wallet","email","social"]:x5.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(t){const e=!!t.rdns&&ne.state.excludedWallets.some(s=>s.rdns===t.rdns),r=!!t.name&&ne.state.excludedWallets.some(s=>Wt.isLowerCaseMatch(s.name,t.name));return e||r},markWalletsWithDisplayIndex(t){return t.map((e,r)=>({...e,display_index:r}))}},Wa={getConnectorsByType(t,e,r){const{customWallets:s}=U.state,n=q.getRecentWallets(),i=Tu.filterOutDuplicateWallets(e),o=Tu.filterOutDuplicateWallets(r),a=t.filter(h=>h.type==="MULTI_CHAIN"),c=t.filter(h=>h.type==="ANNOUNCED"),l=t.filter(h=>h.type==="INJECTED"),u=t.filter(h=>h.type==="EXTERNAL");return{custom:s,recent:n,external:u,multiChain:a,announced:c,injected:l,recommended:i,featured:o}},showConnector(t){var n;const e=(n=t.info)==null?void 0:n.rdns,r=!!e&&ne.state.excludedWallets.some(i=>!!i.rdns&&i.rdns===e),s=!!t.name&&ne.state.excludedWallets.some(i=>Wt.isLowerCaseMatch(i.name,t.name));return!(t.type==="INJECTED"&&(t.name==="Browser Wallet"&&(!te.isMobile()||te.isMobile()&&!e&&!V.checkInstalled())||r||s)||(t.type==="ANNOUNCED"||t.type==="EXTERNAL")&&(r||s))},getIsConnectedWithWC(){return Array.from(y.state.chains.values()).some(r=>H.getConnectorId(r.namespace)===B.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:r,recent:s,announced:n,injected:i,multiChain:o,external:a,overriddenConnectors:c=(l=>(l=U.state.features)==null?void 0:l.connectorTypeOrder)()??[]}){const d=[{type:"walletConnect",isEnabled:U.state.enableWalletConnect},{type:"recent",isEnabled:s.length>0},{type:"injected",isEnabled:[...i,...n,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:r&&r.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:t.length>0}].filter(w=>w.isEnabled),f=new Set(d.map(w=>w.type)),p=c.filter(w=>f.has(w)).map(w=>({type:w,isEnabled:!0})),g=d.filter(({type:w})=>!p.some(({type:v})=>v===w));return Array.from(new Set([...p,...g].map(({type:w})=>w)))},getAuthName({email:t,socialUsername:e,socialProvider:r}){return e?r&&r==="discord"&&e.endsWith("0")?e.slice(0,-1):e:t.length>30?`${t.slice(0,-3)}...`:t},async fetchProviderData(t){var e,r;try{if(t.name==="Browser Wallet"&&!te.isMobile())return{accounts:[],chainId:void 0};if(t.id===B.CONNECTOR_ID.AUTH)return{accounts:[],chainId:void 0};const[s,n]=await Promise.all([(e=t.provider)==null?void 0:e.request({method:"eth_accounts"}),(r=t.provider)==null?void 0:r.request({method:"eth_chainId"}).then(i=>Number(i))]);return{accounts:s,chainId:n}}catch(s){return console.warn(`Failed to fetch provider data for ${t.name}`,s),{accounts:[],chainId:void 0}}}};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ha=globalThis,vh=Ha.ShadowRoot&&(Ha.ShadyCSS===void 0||Ha.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Eh=Symbol(),Yp=new WeakMap;let M0=class{constructor(e,r,s){if(this._$cssResult$=!0,s!==Eh)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=r}get styleSheet(){let e=this.o;const r=this.t;if(vh&&e===void 0){const s=r!==void 0&&r.length===1;s&&(e=Yp.get(r)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&Yp.set(r,e))}return e}toString(){return this.cssText}};const Qt=t=>new M0(typeof t=="string"?t:t+"",void 0,Eh),Jn=(t,...e)=>{const r=t.length===1?t[0]:e.reduce((s,n,i)=>s+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[i+1],t[0]);return new M0(r,t,Eh)},O5=(t,e)=>{if(vh)t.adoptedStyleSheets=e.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet);else for(const r of e){const s=document.createElement("style"),n=Ha.litNonce;n!==void 0&&s.setAttribute("nonce",n),s.textContent=r.cssText,t.appendChild(s)}},Jp=vh?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let r="";for(const s of e.cssRules)r+=s.cssText;return Qt(r)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:T5,defineProperty:P5,getOwnPropertyDescriptor:D5,getOwnPropertyNames:$5,getOwnPropertySymbols:R5,getPrototypeOf:k5}=Object,Is=globalThis,Xp=Is.trustedTypes,U5=Xp?Xp.emptyScript:"",Sl=Is.reactiveElementPolyfillSupport,ro=(t,e)=>t,Pu={toAttribute(t,e){switch(e){case Boolean:t=t?U5:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let r=t;switch(e){case Boolean:r=t!==null;break;case Number:r=t===null?null:Number(t);break;case Object:case Array:try{r=JSON.parse(t)}catch{r=null}}return r}},F0=(t,e)=>!T5(t,e),Zp={attribute:!0,type:String,converter:Pu,reflect:!1,useDefault:!1,hasChanged:F0};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Is.litPropertyMetadata??(Is.litPropertyMetadata=new WeakMap);let Wn=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,r=Zp){if(r.state&&(r.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((r=Object.create(r)).wrapped=!0),this.elementProperties.set(e,r),!r.noAccessor){const s=Symbol(),n=this.getPropertyDescriptor(e,s,r);n!==void 0&&P5(this.prototype,e,n)}}static getPropertyDescriptor(e,r,s){const{get:n,set:i}=D5(this.prototype,e)??{get(){return this[r]},set(o){this[r]=o}};return{get:n,set(o){const a=n==null?void 0:n.call(this);i==null||i.call(this,o),this.requestUpdate(e,a,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??Zp}static _$Ei(){if(this.hasOwnProperty(ro("elementProperties")))return;const e=k5(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(ro("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(ro("properties"))){const r=this.properties,s=[...$5(r),...R5(r)];for(const n of s)this.createProperty(n,r[n])}const e=this[Symbol.metadata];if(e!==null){const r=litPropertyMetadata.get(e);if(r!==void 0)for(const[s,n]of r)this.elementProperties.set(s,n)}this._$Eh=new Map;for(const[r,s]of this.elementProperties){const n=this._$Eu(r,s);n!==void 0&&this._$Eh.set(n,r)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const r=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const n of s)r.unshift(Jp(n))}else e!==void 0&&r.push(Jp(e));return r}static _$Eu(e,r){const s=r.attribute;return s===!1?void 0:typeof s=="string"?s:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(r=>this.enableUpdating=r),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(r=>r(this))}addController(e){var r;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((r=e.hostConnected)==null||r.call(e))}removeController(e){var r;(r=this._$EO)==null||r.delete(e)}_$E_(){const e=new Map,r=this.constructor.elementProperties;for(const s of r.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return O5(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(r=>{var s;return(s=r.hostConnected)==null?void 0:s.call(r)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(r=>{var s;return(s=r.hostDisconnected)==null?void 0:s.call(r)})}attributeChangedCallback(e,r,s){this._$AK(e,s)}_$ET(e,r){var i;const s=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,s);if(n!==void 0&&s.reflect===!0){const o=(((i=s.converter)==null?void 0:i.toAttribute)!==void 0?s.converter:Pu).toAttribute(r,s.type);this._$Em=e,o==null?this.removeAttribute(n):this.setAttribute(n,o),this._$Em=null}}_$AK(e,r){var i,o;const s=this.constructor,n=s._$Eh.get(e);if(n!==void 0&&this._$Em!==n){const a=s.getPropertyOptions(n),c=typeof a.converter=="function"?{fromAttribute:a.converter}:((i=a.converter)==null?void 0:i.fromAttribute)!==void 0?a.converter:Pu;this._$Em=n;const l=c.fromAttribute(r,a.type);this[n]=l??((o=this._$Ej)==null?void 0:o.get(n))??l,this._$Em=null}}requestUpdate(e,r,s,n=!1,i){var o;if(e!==void 0){const a=this.constructor;if(n===!1&&(i=this[e]),s??(s=a.getPropertyOptions(e)),!((s.hasChanged??F0)(i,r)||s.useDefault&&s.reflect&&i===((o=this._$Ej)==null?void 0:o.get(e))&&!this.hasAttribute(a._$Eu(e,s))))return;this.C(e,r,s)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,r,{useDefault:s,reflect:n,wrapped:i},o){s&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,o??r??this[e]),i!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||s||(r=void 0),this._$AL.set(e,r)),n===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(r){Promise.reject(r)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[i,o]of this._$Ep)this[i]=o;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[i,o]of n){const{wrapped:a}=o,c=this[i];a!==!0||this._$AL.has(i)||c===void 0||this.C(i,void 0,o,c)}}let e=!1;const r=this._$AL;try{e=this.shouldUpdate(r),e?(this.willUpdate(r),(s=this._$EO)==null||s.forEach(n=>{var i;return(i=n.hostUpdate)==null?void 0:i.call(n)}),this.update(r)):this._$EM()}catch(n){throw e=!1,this._$EM(),n}e&&this._$AE(r)}willUpdate(e){}_$AE(e){var r;(r=this._$EO)==null||r.forEach(s=>{var n;return(n=s.hostUpdated)==null?void 0:n.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(r=>this._$ET(r,this[r]))),this._$EM()}updated(e){}firstUpdated(e){}};Wn.elementStyles=[],Wn.shadowRootOptions={mode:"open"},Wn[ro("elementProperties")]=new Map,Wn[ro("finalized")]=new Map,Sl==null||Sl({ReactiveElement:Wn}),(Is.reactiveElementVersions??(Is.reactiveElementVersions=[])).push("2.1.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const so=globalThis,Qp=t=>t,lc=so.trustedTypes,eg=lc?lc.createPolicy("lit-html",{createHTML:t=>t}):void 0,j0="$lit$",bs=`lit$${Math.random().toFixed(9).slice(2)}$`,q0="?"+bs,B5=`<${q0}>`,cn=document,Lo=()=>cn.createComment(""),Mo=t=>t===null||typeof t!="object"&&typeof t!="function",Ch=Array.isArray,L5=t=>Ch(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",Nl=`[ 	
\f\r]`,Ui=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,tg=/-->/g,rg=/>/g,Bs=RegExp(`>|${Nl}(?:([^\\s"'>=/]+)(${Nl}*=${Nl}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),sg=/'/g,ng=/"/g,z0=/^(?:script|style|textarea|title)$/i,W0=t=>(e,...r)=>({_$litType$:t,strings:e,values:r}),lk=W0(1),uk=W0(2),ii=Symbol.for("lit-noChange"),Qe=Symbol.for("lit-nothing"),ig=new WeakMap,Js=cn.createTreeWalker(cn,129);function H0(t,e){if(!Ch(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return eg!==void 0?eg.createHTML(e):e}const M5=(t,e)=>{const r=t.length-1,s=[];let n,i=e===2?"<svg>":e===3?"<math>":"",o=Ui;for(let a=0;a<r;a++){const c=t[a];let l,u,h=-1,d=0;for(;d<c.length&&(o.lastIndex=d,u=o.exec(c),u!==null);)d=o.lastIndex,o===Ui?u[1]==="!--"?o=tg:u[1]!==void 0?o=rg:u[2]!==void 0?(z0.test(u[2])&&(n=RegExp("</"+u[2],"g")),o=Bs):u[3]!==void 0&&(o=Bs):o===Bs?u[0]===">"?(o=n??Ui,h=-1):u[1]===void 0?h=-2:(h=o.lastIndex-u[2].length,l=u[1],o=u[3]===void 0?Bs:u[3]==='"'?ng:sg):o===ng||o===sg?o=Bs:o===tg||o===rg?o=Ui:(o=Bs,n=void 0);const f=o===Bs&&t[a+1].startsWith("/>")?" ":"";i+=o===Ui?c+B5:h>=0?(s.push(l),c.slice(0,h)+j0+c.slice(h)+bs+f):c+bs+(h===-2?a:f)}return[H0(t,i+(t[r]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),s]};class Fo{constructor({strings:e,_$litType$:r},s){let n;this.parts=[];let i=0,o=0;const a=e.length-1,c=this.parts,[l,u]=M5(e,r);if(this.el=Fo.createElement(l,s),Js.currentNode=this.el.content,r===2||r===3){const h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(n=Js.nextNode())!==null&&c.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const h of n.getAttributeNames())if(h.endsWith(j0)){const d=u[o++],f=n.getAttribute(h).split(bs),p=/([.?@])?(.*)/.exec(d);c.push({type:1,index:i,name:p[2],strings:f,ctor:p[1]==="."?j5:p[1]==="?"?q5:p[1]==="@"?z5:Dc}),n.removeAttribute(h)}else h.startsWith(bs)&&(c.push({type:6,index:i}),n.removeAttribute(h));if(z0.test(n.tagName)){const h=n.textContent.split(bs),d=h.length-1;if(d>0){n.textContent=lc?lc.emptyScript:"";for(let f=0;f<d;f++)n.append(h[f],Lo()),Js.nextNode(),c.push({type:2,index:++i});n.append(h[d],Lo())}}}else if(n.nodeType===8)if(n.data===q0)c.push({type:2,index:i});else{let h=-1;for(;(h=n.data.indexOf(bs,h+1))!==-1;)c.push({type:7,index:i}),h+=bs.length-1}i++}}static createElement(e,r){const s=cn.createElement("template");return s.innerHTML=e,s}}function oi(t,e,r=t,s){var o,a;if(e===ii)return e;let n=s!==void 0?(o=r._$Co)==null?void 0:o[s]:r._$Cl;const i=Mo(e)?void 0:e._$litDirective$;return(n==null?void 0:n.constructor)!==i&&((a=n==null?void 0:n._$AO)==null||a.call(n,!1),i===void 0?n=void 0:(n=new i(t),n._$AT(t,r,s)),s!==void 0?(r._$Co??(r._$Co=[]))[s]=n:r._$Cl=n),n!==void 0&&(e=oi(t,n._$AS(t,e.values),n,s)),e}class F5{constructor(e,r){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:r},parts:s}=this._$AD,n=((e==null?void 0:e.creationScope)??cn).importNode(r,!0);Js.currentNode=n;let i=Js.nextNode(),o=0,a=0,c=s[0];for(;c!==void 0;){if(o===c.index){let l;c.type===2?l=new ra(i,i.nextSibling,this,e):c.type===1?l=new c.ctor(i,c.name,c.strings,this,e):c.type===6&&(l=new W5(i,this,e)),this._$AV.push(l),c=s[++a]}o!==(c==null?void 0:c.index)&&(i=Js.nextNode(),o++)}return Js.currentNode=cn,n}p(e){let r=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,r),r+=s.strings.length-2):s._$AI(e[r])),r++}}class ra{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,r,s,n){this.type=2,this._$AH=Qe,this._$AN=void 0,this._$AA=e,this._$AB=r,this._$AM=s,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=r.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,r=this){e=oi(this,e,r),Mo(e)?e===Qe||e==null||e===""?(this._$AH!==Qe&&this._$AR(),this._$AH=Qe):e!==this._$AH&&e!==ii&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):L5(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Qe&&Mo(this._$AH)?this._$AA.nextSibling.data=e:this.T(cn.createTextNode(e)),this._$AH=e}$(e){var i;const{values:r,_$litType$:s}=e,n=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=Fo.createElement(H0(s.h,s.h[0]),this.options)),s);if(((i=this._$AH)==null?void 0:i._$AD)===n)this._$AH.p(r);else{const o=new F5(n,this),a=o.u(this.options);o.p(r),this.T(a),this._$AH=o}}_$AC(e){let r=ig.get(e.strings);return r===void 0&&ig.set(e.strings,r=new Fo(e)),r}k(e){Ch(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let s,n=0;for(const i of e)n===r.length?r.push(s=new ra(this.O(Lo()),this.O(Lo()),this,this.options)):s=r[n],s._$AI(i),n++;n<r.length&&(this._$AR(s&&s._$AB.nextSibling,n),r.length=n)}_$AR(e=this._$AA.nextSibling,r){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,r);e!==this._$AB;){const n=Qp(e).nextSibling;Qp(e).remove(),e=n}}setConnected(e){var r;this._$AM===void 0&&(this._$Cv=e,(r=this._$AP)==null||r.call(this,e))}}class Dc{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,r,s,n,i){this.type=1,this._$AH=Qe,this._$AN=void 0,this.element=e,this.name=r,this._$AM=n,this.options=i,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Qe}_$AI(e,r=this,s,n){const i=this.strings;let o=!1;if(i===void 0)e=oi(this,e,r,0),o=!Mo(e)||e!==this._$AH&&e!==ii,o&&(this._$AH=e);else{const a=e;let c,l;for(e=i[0],c=0;c<i.length-1;c++)l=oi(this,a[s+c],r,c),l===ii&&(l=this._$AH[c]),o||(o=!Mo(l)||l!==this._$AH[c]),l===Qe?e=Qe:e!==Qe&&(e+=(l??"")+i[c+1]),this._$AH[c]=l}o&&!n&&this.j(e)}j(e){e===Qe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class j5 extends Dc{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Qe?void 0:e}}class q5 extends Dc{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Qe)}}class z5 extends Dc{constructor(e,r,s,n,i){super(e,r,s,n,i),this.type=5}_$AI(e,r=this){if((e=oi(this,e,r,0)??Qe)===ii)return;const s=this._$AH,n=e===Qe&&s!==Qe||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,i=e!==Qe&&(s===Qe||n);n&&this.element.removeEventListener(this.name,this,s),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var r;typeof this._$AH=="function"?this._$AH.call(((r=this.options)==null?void 0:r.host)??this.element,e):this._$AH.handleEvent(e)}}class W5{constructor(e,r,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=r,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){oi(this,e)}}const xl=so.litHtmlPolyfillSupport;xl==null||xl(Fo,ra),(so.litHtmlVersions??(so.litHtmlVersions=[])).push("3.3.2");const H5=(t,e,r)=>{const s=(r==null?void 0:r.renderBefore)??e;let n=s._$litPart$;if(n===void 0){const i=(r==null?void 0:r.renderBefore)??null;s._$litPart$=n=new ra(e.insertBefore(Lo(),i),i,void 0,r??{})}return n._$AI(t),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const en=globalThis;class Ka extends Wn{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var r;const e=super.createRenderRoot();return(r=this.renderOptions).renderBefore??(r.renderBefore=e.firstChild),e}update(e){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=H5(r,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return ii}}var lg;Ka._$litElement$=!0,Ka.finalized=!0,(lg=en.litElementHydrateSupport)==null||lg.call(en,{LitElement:Ka});const Ol=en.litElementPolyfillSupport;Ol==null||Ol({LitElement:Ka});(en.litElementVersions??(en.litElementVersions=[])).push("4.2.2");let no,_s,Ss;function hk(t,e){no=document.createElement("style"),_s=document.createElement("style"),Ss=document.createElement("style"),no.textContent=Xn(t).core.cssText,_s.textContent=Xn(t).dark.cssText,Ss.textContent=Xn(t).light.cssText,document.head.appendChild(no),document.head.appendChild(_s),document.head.appendChild(Ss),K0(e)}function K0(t){_s&&Ss&&(t==="light"?(_s.removeAttribute("media"),Ss.media="enabled"):(Ss.removeAttribute("media"),_s.media="enabled"))}function K5(t){no&&_s&&Ss&&(no.textContent=Xn(t).core.cssText,_s.textContent=Xn(t).dark.cssText,Ss.textContent=Xn(t).light.cssText)}function Xn(t){return{core:Jn`
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --w3m-modal-width: 360px;
        --w3m-color-mix-strength: ${Qt(t!=null&&t["--w3m-color-mix-strength"]?`${t["--w3m-color-mix-strength"]}%`:"0%")};
        --w3m-font-family: ${Qt((t==null?void 0:t["--w3m-font-family"])||"Inter, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;")};
        --w3m-font-size-master: ${Qt((t==null?void 0:t["--w3m-font-size-master"])||"10px")};
        --w3m-border-radius-master: ${Qt((t==null?void 0:t["--w3m-border-radius-master"])||"4px")};
        --w3m-z-index: ${Qt((t==null?void 0:t["--w3m-z-index"])||999)};

        --wui-font-family: var(--w3m-font-family);

        --wui-font-size-mini: calc(var(--w3m-font-size-master) * 0.8);
        --wui-font-size-micro: var(--w3m-font-size-master);
        --wui-font-size-tiny: calc(var(--w3m-font-size-master) * 1.2);
        --wui-font-size-small: calc(var(--w3m-font-size-master) * 1.4);
        --wui-font-size-paragraph: calc(var(--w3m-font-size-master) * 1.6);
        --wui-font-size-medium: calc(var(--w3m-font-size-master) * 1.8);
        --wui-font-size-large: calc(var(--w3m-font-size-master) * 2);
        --wui-font-size-title-6: calc(var(--w3m-font-size-master) * 2.2);
        --wui-font-size-medium-title: calc(var(--w3m-font-size-master) * 2.4);
        --wui-font-size-2xl: calc(var(--w3m-font-size-master) * 4);

        --wui-border-radius-5xs: var(--w3m-border-radius-master);
        --wui-border-radius-4xs: calc(var(--w3m-border-radius-master) * 1.5);
        --wui-border-radius-3xs: calc(var(--w3m-border-radius-master) * 2);
        --wui-border-radius-xxs: calc(var(--w3m-border-radius-master) * 3);
        --wui-border-radius-xs: calc(var(--w3m-border-radius-master) * 4);
        --wui-border-radius-s: calc(var(--w3m-border-radius-master) * 5);
        --wui-border-radius-m: calc(var(--w3m-border-radius-master) * 7);
        --wui-border-radius-l: calc(var(--w3m-border-radius-master) * 9);
        --wui-border-radius-3xl: calc(var(--w3m-border-radius-master) * 20);

        --wui-font-weight-light: 400;
        --wui-font-weight-regular: 500;
        --wui-font-weight-medium: 600;
        --wui-font-weight-bold: 700;

        --wui-letter-spacing-2xl: -1.6px;
        --wui-letter-spacing-medium-title: -0.96px;
        --wui-letter-spacing-title-6: -0.88px;
        --wui-letter-spacing-large: -0.8px;
        --wui-letter-spacing-medium: -0.72px;
        --wui-letter-spacing-paragraph: -0.64px;
        --wui-letter-spacing-small: -0.56px;
        --wui-letter-spacing-tiny: -0.48px;
        --wui-letter-spacing-micro: -0.2px;
        --wui-letter-spacing-mini: -0.16px;

        --wui-spacing-0: 0px;
        --wui-spacing-4xs: 2px;
        --wui-spacing-3xs: 4px;
        --wui-spacing-xxs: 6px;
        --wui-spacing-2xs: 7px;
        --wui-spacing-xs: 8px;
        --wui-spacing-1xs: 10px;
        --wui-spacing-s: 12px;
        --wui-spacing-m: 14px;
        --wui-spacing-l: 16px;
        --wui-spacing-2l: 18px;
        --wui-spacing-xl: 20px;
        --wui-spacing-xxl: 24px;
        --wui-spacing-2xl: 32px;
        --wui-spacing-3xl: 40px;
        --wui-spacing-4xl: 90px;
        --wui-spacing-5xl: 95px;

        --wui-icon-box-size-xxs: 14px;
        --wui-icon-box-size-xs: 20px;
        --wui-icon-box-size-sm: 24px;
        --wui-icon-box-size-md: 32px;
        --wui-icon-box-size-mdl: 36px;
        --wui-icon-box-size-lg: 40px;
        --wui-icon-box-size-2lg: 48px;
        --wui-icon-box-size-xl: 64px;

        --wui-icon-size-inherit: inherit;
        --wui-icon-size-xxs: 10px;
        --wui-icon-size-xs: 12px;
        --wui-icon-size-sm: 14px;
        --wui-icon-size-md: 16px;
        --wui-icon-size-mdl: 18px;
        --wui-icon-size-lg: 20px;
        --wui-icon-size-xl: 24px;
        --wui-icon-size-xxl: 28px;

        --wui-wallet-image-size-inherit: inherit;
        --wui-wallet-image-size-sm: 40px;
        --wui-wallet-image-size-md: 56px;
        --wui-wallet-image-size-lg: 80px;

        --wui-visual-size-size-inherit: inherit;
        --wui-visual-size-sm: 40px;
        --wui-visual-size-md: 55px;
        --wui-visual-size-lg: 80px;

        --wui-box-size-md: 100px;
        --wui-box-size-lg: 120px;

        --wui-ease-out-power-2: cubic-bezier(0, 0, 0.22, 1);
        --wui-ease-out-power-1: cubic-bezier(0, 0, 0.55, 1);

        --wui-ease-in-power-3: cubic-bezier(0.66, 0, 1, 1);
        --wui-ease-in-power-2: cubic-bezier(0.45, 0, 1, 1);
        --wui-ease-in-power-1: cubic-bezier(0.3, 0, 1, 1);

        --wui-ease-inout-power-1: cubic-bezier(0.45, 0, 0.55, 1);

        --wui-duration-lg: 200ms;
        --wui-duration-md: 125ms;
        --wui-duration-sm: 75ms;

        --wui-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --wui-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --wui-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --wui-width-network-sm: 36px;
        --wui-width-network-md: 48px;
        --wui-width-network-lg: 86px;

        --wui-height-network-sm: 40px;
        --wui-height-network-md: 54px;
        --wui-height-network-lg: 96px;

        --wui-icon-size-network-xs: 12px;
        --wui-icon-size-network-sm: 16px;
        --wui-icon-size-network-md: 24px;
        --wui-icon-size-network-lg: 42px;

        --wui-color-inherit: inherit;

        --wui-color-inverse-100: #fff;
        --wui-color-inverse-000: #000;

        --wui-cover: rgba(20, 20, 20, 0.8);

        --wui-color-modal-bg: var(--wui-color-modal-bg-base);

        --wui-color-accent-100: var(--wui-color-accent-base-100);
        --wui-color-accent-090: var(--wui-color-accent-base-090);
        --wui-color-accent-080: var(--wui-color-accent-base-080);

        --wui-color-success-100: var(--wui-color-success-base-100);
        --wui-color-success-125: var(--wui-color-success-base-125);

        --wui-color-warning-100: var(--wui-color-warning-base-100);

        --wui-color-error-100: var(--wui-color-error-base-100);
        --wui-color-error-125: var(--wui-color-error-base-125);

        --wui-color-blue-100: var(--wui-color-blue-base-100);
        --wui-color-blue-90: var(--wui-color-blue-base-90);

        --wui-icon-box-bg-error-100: var(--wui-icon-box-bg-error-base-100);
        --wui-icon-box-bg-blue-100: var(--wui-icon-box-bg-blue-base-100);
        --wui-icon-box-bg-success-100: var(--wui-icon-box-bg-success-base-100);
        --wui-icon-box-bg-inverse-100: var(--wui-icon-box-bg-inverse-base-100);

        --wui-all-wallets-bg-100: var(--wui-all-wallets-bg-100);

        --wui-avatar-border: var(--wui-avatar-border-base);

        --wui-thumbnail-border: var(--wui-thumbnail-border-base);

        --wui-wallet-button-bg: var(--wui-wallet-button-bg-base);

        --wui-box-shadow-blue: var(--wui-color-accent-glass-020);
      }

      @supports (background: color-mix(in srgb, white 50%, black)) {
        :root {
          --wui-color-modal-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-modal-bg-base)
          );

          --wui-box-shadow-blue: color-mix(in srgb, var(--wui-color-accent-100) 20%, transparent);

          --wui-color-accent-100: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 100%,
            transparent
          );
          --wui-color-accent-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-glass-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-020: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 20%,
            transparent
          );
          --wui-color-accent-glass-015: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 15%,
            transparent
          );
          --wui-color-accent-glass-010: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 10%,
            transparent
          );
          --wui-color-accent-glass-005: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 5%,
            transparent
          );
          --wui-color-accent-002: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 2%,
            transparent
          );

          --wui-color-fg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-100)
          );
          --wui-color-fg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-125)
          );
          --wui-color-fg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-150)
          );
          --wui-color-fg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-175)
          );
          --wui-color-fg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-200)
          );
          --wui-color-fg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-225)
          );
          --wui-color-fg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-250)
          );
          --wui-color-fg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-275)
          );
          --wui-color-fg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-300)
          );
          --wui-color-fg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-325)
          );
          --wui-color-fg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-350)
          );

          --wui-color-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-100)
          );
          --wui-color-bg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-125)
          );
          --wui-color-bg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-150)
          );
          --wui-color-bg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-175)
          );
          --wui-color-bg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-200)
          );
          --wui-color-bg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-225)
          );
          --wui-color-bg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-250)
          );
          --wui-color-bg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-275)
          );
          --wui-color-bg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-300)
          );
          --wui-color-bg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-325)
          );
          --wui-color-bg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-350)
          );

          --wui-color-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-100)
          );
          --wui-color-success-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-125)
          );

          --wui-color-warning-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-warning-base-100)
          );

          --wui-color-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-100)
          );
          --wui-color-blue-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-100)
          );
          --wui-color-blue-90: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-90)
          );
          --wui-color-error-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-125)
          );

          --wui-icon-box-bg-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-error-base-100)
          );
          --wui-icon-box-bg-accent-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-blue-base-100)
          );
          --wui-icon-box-bg-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-success-base-100)
          );
          --wui-icon-box-bg-inverse-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-inverse-base-100)
          );

          --wui-all-wallets-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-all-wallets-bg-100)
          );

          --wui-avatar-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-avatar-border-base)
          );

          --wui-thumbnail-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-thumbnail-border-base)
          );

          --wui-wallet-button-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-wallet-button-bg-base)
          );
        }
      }
    `,light:Jn`
      :root {
        --w3m-color-mix: ${Qt((t==null?void 0:t["--w3m-color-mix"])||"#fff")};
        --w3m-accent: ${Qt(Cs(t,"dark")["--w3m-accent"])};
        --w3m-default: #fff;

        --wui-color-modal-bg-base: ${Qt(Cs(t,"dark")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(230, 100%, 67%, 1);
        --wui-color-blueberry-090: hsla(231, 76%, 61%, 1);
        --wui-color-blueberry-080: hsla(230, 59%, 55%, 1);
        --wui-color-blueberry-050: hsla(231, 100%, 70%, 0.1);

        --wui-color-fg-100: #e4e7e7;
        --wui-color-fg-125: #d0d5d5;
        --wui-color-fg-150: #a8b1b1;
        --wui-color-fg-175: #a8b0b0;
        --wui-color-fg-200: #949e9e;
        --wui-color-fg-225: #868f8f;
        --wui-color-fg-250: #788080;
        --wui-color-fg-275: #788181;
        --wui-color-fg-300: #6e7777;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #363636;

        --wui-color-bg-100: #141414;
        --wui-color-bg-125: #191a1a;
        --wui-color-bg-150: #1e1f1f;
        --wui-color-bg-175: #222525;
        --wui-color-bg-200: #272a2a;
        --wui-color-bg-225: #2c3030;
        --wui-color-bg-250: #313535;
        --wui-color-bg-275: #363b3b;
        --wui-color-bg-300: #3b4040;
        --wui-color-bg-325: #252525;
        --wui-color-bg-350: #ffffff;

        --wui-color-success-base-100: #26d962;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f25a67;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 217, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 217, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 217, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 217, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 217, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 217, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 217, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 217, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 217, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 217, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(242, 90, 103, 0.01);
        --wui-color-error-glass-002: rgba(242, 90, 103, 0.02);
        --wui-color-error-glass-005: rgba(242, 90, 103, 0.05);
        --wui-color-error-glass-010: rgba(242, 90, 103, 0.1);
        --wui-color-error-glass-015: rgba(242, 90, 103, 0.15);
        --wui-color-error-glass-020: rgba(242, 90, 103, 0.2);
        --wui-color-error-glass-025: rgba(242, 90, 103, 0.25);
        --wui-color-error-glass-030: rgba(242, 90, 103, 0.3);
        --wui-color-error-glass-060: rgba(242, 90, 103, 0.6);
        --wui-color-error-glass-080: rgba(242, 90, 103, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-color-gray-glass-001: rgba(255, 255, 255, 0.01);
        --wui-color-gray-glass-002: rgba(255, 255, 255, 0.02);
        --wui-color-gray-glass-005: rgba(255, 255, 255, 0.05);
        --wui-color-gray-glass-010: rgba(255, 255, 255, 0.1);
        --wui-color-gray-glass-015: rgba(255, 255, 255, 0.15);
        --wui-color-gray-glass-020: rgba(255, 255, 255, 0.2);
        --wui-color-gray-glass-025: rgba(255, 255, 255, 0.25);
        --wui-color-gray-glass-030: rgba(255, 255, 255, 0.3);
        --wui-color-gray-glass-060: rgba(255, 255, 255, 0.6);
        --wui-color-gray-glass-080: rgba(255, 255, 255, 0.8);
        --wui-color-gray-glass-090: rgba(255, 255, 255, 0.9);

        --wui-color-dark-glass-100: rgba(42, 42, 42, 1);

        --wui-icon-box-bg-error-base-100: #3c2426;
        --wui-icon-box-bg-blue-base-100: #20303f;
        --wui-icon-box-bg-success-base-100: #1f3a28;
        --wui-icon-box-bg-inverse-base-100: #243240;

        --wui-all-wallets-bg-100: #222b35;

        --wui-avatar-border-base: #252525;

        --wui-thumbnail-border-base: #252525;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --w3m-card-embedded-shadow-color: rgb(17 17 18 / 25%);
      }
    `,dark:Jn`
      :root {
        --w3m-color-mix: ${Qt((t==null?void 0:t["--w3m-color-mix"])||"#000")};
        --w3m-accent: ${Qt(Cs(t,"light")["--w3m-accent"])};
        --w3m-default: #000;

        --wui-color-modal-bg-base: ${Qt(Cs(t,"light")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(231, 100%, 70%, 1);
        --wui-color-blueberry-090: hsla(231, 97%, 72%, 1);
        --wui-color-blueberry-080: hsla(231, 92%, 74%, 1);

        --wui-color-fg-100: #141414;
        --wui-color-fg-125: #2d3131;
        --wui-color-fg-150: #474d4d;
        --wui-color-fg-175: #636d6d;
        --wui-color-fg-200: #798686;
        --wui-color-fg-225: #828f8f;
        --wui-color-fg-250: #8b9797;
        --wui-color-fg-275: #95a0a0;
        --wui-color-fg-300: #9ea9a9;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #d0d0d0;

        --wui-color-bg-100: #ffffff;
        --wui-color-bg-125: #f5fafa;
        --wui-color-bg-150: #f3f8f8;
        --wui-color-bg-175: #eef4f4;
        --wui-color-bg-200: #eaf1f1;
        --wui-color-bg-225: #e5eded;
        --wui-color-bg-250: #e1e9e9;
        --wui-color-bg-275: #dce7e7;
        --wui-color-bg-300: #d8e3e3;
        --wui-color-bg-325: #f3f3f3;
        --wui-color-bg-350: #202020;

        --wui-color-success-base-100: #26b562;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f05142;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 181, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 181, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 181, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 181, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 181, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 181, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 181, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 181, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 181, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 181, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(240, 81, 66, 0.01);
        --wui-color-error-glass-002: rgba(240, 81, 66, 0.02);
        --wui-color-error-glass-005: rgba(240, 81, 66, 0.05);
        --wui-color-error-glass-010: rgba(240, 81, 66, 0.1);
        --wui-color-error-glass-015: rgba(240, 81, 66, 0.15);
        --wui-color-error-glass-020: rgba(240, 81, 66, 0.2);
        --wui-color-error-glass-025: rgba(240, 81, 66, 0.25);
        --wui-color-error-glass-030: rgba(240, 81, 66, 0.3);
        --wui-color-error-glass-060: rgba(240, 81, 66, 0.6);
        --wui-color-error-glass-080: rgba(240, 81, 66, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-icon-box-bg-error-base-100: #f4dfdd;
        --wui-icon-box-bg-blue-base-100: #d9ecfb;
        --wui-icon-box-bg-success-base-100: #daf0e4;
        --wui-icon-box-bg-inverse-base-100: #dcecfc;

        --wui-all-wallets-bg-100: #e8f1fa;

        --wui-avatar-border-base: #f3f4f4;

        --wui-thumbnail-border-base: #eaefef;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --wui-color-gray-glass-001: rgba(0, 0, 0, 0.01);
        --wui-color-gray-glass-002: rgba(0, 0, 0, 0.02);
        --wui-color-gray-glass-005: rgba(0, 0, 0, 0.05);
        --wui-color-gray-glass-010: rgba(0, 0, 0, 0.1);
        --wui-color-gray-glass-015: rgba(0, 0, 0, 0.15);
        --wui-color-gray-glass-020: rgba(0, 0, 0, 0.2);
        --wui-color-gray-glass-025: rgba(0, 0, 0, 0.25);
        --wui-color-gray-glass-030: rgba(0, 0, 0, 0.3);
        --wui-color-gray-glass-060: rgba(0, 0, 0, 0.6);
        --wui-color-gray-glass-080: rgba(0, 0, 0, 0.8);
        --wui-color-gray-glass-090: rgba(0, 0, 0, 0.9);

        --wui-color-dark-glass-100: rgba(233, 233, 233, 1);

        --w3m-card-embedded-shadow-color: rgb(224 225 233 / 25%);
      }
    `}}const dk=Jn`
  *,
  *::after,
  *::before,
  :host {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    font-family: var(--wui-font-family);
    backface-visibility: hidden;
  }
`,fk=Jn`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    transition:
      color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      background-color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1),
      box-shadow var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: background-color, color, border, box-shadow, border-radius;
    outline: none;
    border: none;
    column-gap: var(--wui-spacing-3xs);
    background-color: transparent;
    text-decoration: none;
  }

  wui-flex {
    transition: border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: border-radius;
  }

  button:disabled > wui-wallet-image,
  button:disabled > wui-all-wallets-image,
  button:disabled > wui-network-image,
  button:disabled > wui-image,
  button:disabled > wui-transaction-visual,
  button:disabled > wui-logo {
    filter: grayscale(1);
  }

  @media (hover: hover) and (pointer: fine) {
    button:hover:enabled {
      background-color: var(--wui-color-gray-glass-005);
    }

    button:active:enabled {
      background-color: var(--wui-color-gray-glass-010);
    }
  }

  button:disabled > wui-icon-box {
    opacity: 0.5;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,pk=Jn`
  .wui-color-inherit {
    color: var(--wui-color-inherit);
  }

  .wui-color-accent-100 {
    color: var(--wui-color-accent-100);
  }

  .wui-color-error-100 {
    color: var(--wui-color-error-100);
  }

  .wui-color-blue-100 {
    color: var(--wui-color-blue-100);
  }

  .wui-color-blue-90 {
    color: var(--wui-color-blue-90);
  }

  .wui-color-error-125 {
    color: var(--wui-color-error-125);
  }

  .wui-color-success-100 {
    color: var(--wui-color-success-100);
  }

  .wui-color-success-125 {
    color: var(--wui-color-success-125);
  }

  .wui-color-inverse-100 {
    color: var(--wui-color-inverse-100);
  }

  .wui-color-inverse-000 {
    color: var(--wui-color-inverse-000);
  }

  .wui-color-fg-100 {
    color: var(--wui-color-fg-100);
  }

  .wui-color-fg-200 {
    color: var(--wui-color-fg-200);
  }

  .wui-color-fg-300 {
    color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    color: var(--wui-color-fg-350);
  }

  .wui-bg-color-inherit {
    background-color: var(--wui-color-inherit);
  }

  .wui-bg-color-blue-100 {
    background-color: var(--wui-color-accent-100);
  }

  .wui-bg-color-error-100 {
    background-color: var(--wui-color-error-100);
  }

  .wui-bg-color-error-125 {
    background-color: var(--wui-color-error-125);
  }

  .wui-bg-color-success-100 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-success-125 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-inverse-100 {
    background-color: var(--wui-color-inverse-100);
  }

  .wui-bg-color-inverse-000 {
    background-color: var(--wui-color-inverse-000);
  }

  .wui-bg-color-fg-100 {
    background-color: var(--wui-color-fg-100);
  }

  .wui-bg-color-fg-200 {
    background-color: var(--wui-color-fg-200);
  }

  .wui-bg-color-fg-300 {
    background-color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    background-color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    background-color: var(--wui-color-fg-350);
  }
`,Va={hexStringToNumber(t){const e=t.startsWith("0x")?t.slice(2):t;return parseInt(e,16)},numberToHexString(t){return`0x${t.toString(16)}`},async getUserInfo(t){const[e,r]=await Promise.all([Va.getAddresses(t),Va.getChainId(t)]);return{chainId:r,addresses:e}},async getChainId(t){const e=await t.request({method:"eth_chainId"});return Number(e)},async getAddress(t){const[e]=await t.request({method:"eth_accounts"});return e},async getAddresses(t){return await t.request({method:"eth_accounts"})},async addEthereumChain(t,e){var s,n;const r=((s=e.rpcUrls.chainDefault)==null?void 0:s.http)||[];await t.request({method:"wallet_addEthereumChain",params:[{chainId:Va.numberToHexString(e.id),rpcUrls:[...r],chainName:e.name,nativeCurrency:{name:e.nativeCurrency.name,decimals:e.nativeCurrency.decimals,symbol:e.nativeCurrency.symbol},blockExplorerUrls:[(n=e.blockExplorers)==null?void 0:n.default.url],iconUrls:[Bo.NetworkImageIds[e.id]]}]})}},Fn={ACCOUNT_INDEXES:{PAYMENT:0,ORDINAL:1}};function sa(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}const og=sa({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),ag=sa({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});sa({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});sa({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}});sa({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});const V5={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},Zr={getMethodsByChainNamespace(t){return V5[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const r={...t},s=new Set;if(e.methods&&Object.keys(e.methods).forEach(n=>s.add(n)),e.chains&&Object.keys(e.chains).forEach(n=>s.add(n)),e.events&&Object.keys(e.events).forEach(n=>s.add(n)),e.rpcMap&&Object.keys(e.rpcMap).forEach(n=>{const[i]=n.split(":");i&&s.add(i)}),s.forEach(n=>{r[n]||(r[n]=this.createDefaultNamespace(n))}),e.methods&&Object.entries(e.methods).forEach(([n,i])=>{r[n]&&(r[n].methods=i)}),e.chains&&Object.entries(e.chains).forEach(([n,i])=>{r[n]&&(r[n].chains=i)}),e.events&&Object.entries(e.events).forEach(([n,i])=>{r[n]&&(r[n].events=i)}),e.rpcMap){const n=new Set;Object.entries(e.rpcMap).forEach(([i,o])=>{const[a,c]=i.split(":");!a||!c||!r[a]||(r[a].rpcMap||(r[a].rpcMap={}),n.has(a)||(r[a].rpcMap={},n.add(a)),r[a].rpcMap[c]=o)})}return r},createNamespaces(t,e){const r=t.reduce((s,n)=>{const{id:i,chainNamespace:o,rpcUrls:a}=n,c=a.default.http[0];s[o]||(s[o]=this.createDefaultNamespace(o));const l=`${o}:${i}`,u=s[o];switch(u.chains.push(l),l){case og.caipNetworkId:u.chains.push(og.deprecatedCaipNetworkId);break;case ag.caipNetworkId:u.chains.push(ag.deprecatedCaipNetworkId);break}return u!=null&&u.rpcMap&&c&&(u.rpcMap[i]=c),s},{});return this.applyNamespaceOverrides(r,e)},resolveReownName:async t=>{var s;const e=await to.resolveName(t);return((s=(Object.values(e==null?void 0:e.addresses)||[])[0])==null?void 0:s.address)||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const r=e.chains||[],s=e.accounts.map(n=>{const[i,o]=n.split(":");return`${i}:${o}`});return Array.from(new Set([...r,...s]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isOriginAllowed(t,e,r){for(const s of[...e,...r])if(s.includes("*")){const i=`^${s.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*")}$`;if(new RegExp(i,"u").test(t))return!0}else try{if(new URL(s).origin===t)return!0}catch{if(s===t)return!0}return!1},listenWcProvider({universalProvider:t,namespace:e,onConnect:r,onDisconnect:s,onAccountsChanged:n,onChainChanged:i,onDisplayUri:o}){r&&t.on("connect",()=>{const a=Zr.getWalletConnectAccounts(t,e);r(a)}),s&&t.on("disconnect",()=>{s()}),n&&t.on("session_event",a=>{if(Zr.isSessionEventData(a)){const{name:c,data:l}=a.params.event;if(c==="accountsChanged"&&Array.isArray(l)){const u=l.filter(h=>te.isCaipAddress(h)).map(h=>zt.parseCaipAddress(h)).filter(h=>h.chainNamespace===e);n(u)}}}),i&&t.on("chainChanged",a=>{i(a)}),o&&t.on("display_uri",a=>{o(a)})},getWalletConnectAccounts(t,e){var n,i,o,a;const r=new Set,s=(a=(o=(i=(n=t==null?void 0:t.session)==null?void 0:n.namespaces)==null?void 0:i[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>zt.parseCaipAddress(c)).filter(({address:c})=>r.has(c.toLowerCase())?!1:(r.add(c.toLowerCase()),!0));return s&&s.length>0?s:[]}};class G5{constructor(e){this.namespace=e.namespace}async syncConnections(e){switch(this.namespace){case B.CHAIN.EVM:await this.syncEVMConnections(e);break;case B.CHAIN.SOLANA:await this.syncSolanaConnections(e);break;case B.CHAIN.BITCOIN:await this.syncBitcoinConnections(e);break;default:throw new Error(`Unsupported chain namespace: ${this.namespace}`)}}async syncEVMConnections({connectors:e,caipNetworks:r,universalProvider:s,getConnectionStatusInfo:n,onConnection:i,onListenProvider:o}){await Promise.all(e.filter(a=>{const{hasDisconnected:c,hasConnected:l}=n(a.id);return!c&&l}).map(async a=>{if(a.id===B.CONNECTOR_ID.WALLET_CONNECT){const c=Zr.getWalletConnectAccounts(s,this.namespace),l=r.find(u=>{var h,d;return u.chainNamespace===this.namespace&&u.id.toString()===((d=(h=c[0])==null?void 0:h.chainId)==null?void 0:d.toString())});c.length>0&&i({connectorId:a.id,accounts:c.map(u=>({address:u.address})),caipNetwork:l})}else{const{accounts:c,chainId:l}=await Wa.fetchProviderData(a);if(c.length>0&&l){const u=r.find(h=>h.chainNamespace===this.namespace&&h.id.toString()===l.toString());i({connectorId:a.id,accounts:c.map(h=>({address:h})),caipNetwork:u}),a.provider&&a.id!==B.CONNECTOR_ID.AUTH&&a.id!==B.CONNECTOR_ID.WALLET_CONNECT&&o(a.id,a.provider)}}}))}async syncSolanaConnections({connectors:e,caipNetwork:r,universalProvider:s,getConnectionStatusInfo:n,onConnection:i,onListenProvider:o}){await Promise.all(e.filter(a=>{const{hasDisconnected:c,hasConnected:l}=n(a.id);return!c&&l}).map(async a=>{if(a.id===B.CONNECTOR_ID.WALLET_CONNECT){const c=Zr.getWalletConnectAccounts(s,this.namespace);c.length>0&&i({connectorId:a.id,accounts:c.map(l=>({address:l.address})),caipNetwork:r})}else{const c=await a.connect({chainId:r==null?void 0:r.id});c&&(i({connectorId:a.id,accounts:[{address:c}],caipNetwork:r}),o(a.id,a.provider))}}))}async syncBitcoinConnections({connectors:e,caipNetwork:r,universalProvider:s,getConnectionStatusInfo:n,onConnection:i,onListenProvider:o}){await Promise.all(e.filter(a=>{const{hasDisconnected:c,hasConnected:l}=n(a.id);return!c&&l}).map(async a=>{var d,f,p,g,w,E;if(a.id===B.CONNECTOR_ID.WALLET_CONNECT){const v=Zr.getWalletConnectAccounts(s,this.namespace);v.length>0&&i({connectorId:a.id,accounts:v.map(C=>({address:C.address})),caipNetwork:r});return}const c=await a.connect(),l=await a.getAccountAddresses();let u=l==null?void 0:l.map(v=>te.createAccount(B.CHAIN.BITCOIN,v.address,v.purpose||"payment",v.publicKey,v.path));if(u&&u.length>1&&(u=[{namespace:B.CHAIN.BITCOIN,publicKey:((d=u[Fn.ACCOUNT_INDEXES.PAYMENT])==null?void 0:d.publicKey)??"",path:((f=u[Fn.ACCOUNT_INDEXES.PAYMENT])==null?void 0:f.path)??"",address:((p=u[Fn.ACCOUNT_INDEXES.PAYMENT])==null?void 0:p.address)??"",type:"payment"},{namespace:B.CHAIN.BITCOIN,publicKey:((g=u[Fn.ACCOUNT_INDEXES.ORDINAL])==null?void 0:g.publicKey)??"",path:((w=u[Fn.ACCOUNT_INDEXES.ORDINAL])==null?void 0:w.path)??"",address:((E=u[Fn.ACCOUNT_INDEXES.ORDINAL])==null?void 0:E.address)??"",type:"ordinal"}]),!(a.chains.find(v=>v.id===(r==null?void 0:r.id))||a.chains[0]))throw new Error("The connector does not support any of the requested chains");c&&(o(a.id,a.provider),i({connectorId:a.id,accounts:u.map(v=>({address:v.address,type:v.type})),caipNetwork:r}))}))}getConnection({address:e,connectorId:r,connections:s,connectors:n}){if(r){const o=s.find(l=>Wt.isLowerCaseMatch(l.connectorId,r));if(!o)return null;const a=n.find(l=>Wt.isLowerCaseMatch(l.id,o.connectorId)),c=e?o.accounts.find(l=>Wt.isLowerCaseMatch(l.address,e)):o.accounts[0];return{...o,account:c,connector:a}}const i=s.find(o=>o.accounts.length>0&&n.some(a=>Wt.isLowerCaseMatch(a.id,o.connectorId)));if(i){const[o]=i.accounts,a=n.find(c=>Wt.isLowerCaseMatch(c.id,i.connectorId));return{...i,account:o,connector:a}}return null}}const zi={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://localhost:*","http://127.0.0.1:*","https://127.0.0.1:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"]};class V0{constructor({provider:e,namespace:r}){this.id=B.CONNECTOR_ID.WALLET_CONNECT,this.name=Bo.ConnectorNamesMap[B.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=Bo.ConnectorImageIds[B.CONNECTOR_ID.WALLET_CONNECT],this.getCaipNetworks=y.getCaipNetworks.bind(y),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=r}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const r=this.getCaipNetworks(),s=U.state.universalProviderConfigOverride,n=Zr.createNamespaces(r,s);await this.provider.connect({optionalNamespaces:n})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(r=>r.caipNetworkId);return Tr.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:Y5})}}const Y5=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],J5=[B.CONNECTOR_ID.AUTH,B.CONNECTOR_ID.WALLET_CONNECT];class X5{constructor(e){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=r=>y.getCaipNetworks(r),this.getConnectorId=r=>H.getConnectorId(r),e&&this.construct(e),e!=null&&e.namespace&&(this.connectionManager=new G5({namespace:e.namespace}))}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:e,chainId:r}){const s=this.getCaipNetworks().filter(n=>n.chainNamespace===this.namespace).find(n=>n.id.toString()===(r==null?void 0:r.toString()));e&&s&&this.addConnection({connectorId:B.CONNECTOR_ID.AUTH,accounts:e,caipNetwork:s})}setAuthProvider(e){e.onConnect(this.onAuthConnected.bind(this)),e.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:B.CONNECTOR_ID.AUTH,type:"AUTH",name:B.CONNECTOR_NAMES.AUTH,provider:e,imageId:Bo.ConnectorImageIds[B.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...e){const r=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(s=>r.has(s.id)?!1:(r.add(s.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...e){const r=new Set;this.availableConnections=[...e,...this.availableConnections].filter(s=>r.has(s.connectorId.toLowerCase())?!1:(r.add(s.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(e){this.availableConnections=this.availableConnections.filter(r=>!Wt.isLowerCaseMatch(r.connectorId,e)),this.emit("connections",this.availableConnections)}clearConnections(e=!1){this.availableConnections=[],e&&this.emit("connections",this.availableConnections)}setStatus(e,r){ee.setStatus(e,r)}on(e,r){var s;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(s=this.eventListeners.get(e))==null||s.add(r)}off(e,r){const s=this.eventListeners.get(e);s&&s.delete(r)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,r){const s=this.eventListeners.get(e);s&&s.forEach(n=>n(r))}async connectWalletConnect(e){return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}async switchNetwork(e){const{caipNetwork:r,providerType:s}=e;if(!e.provider)return;const n="provider"in e.provider?e.provider.provider:e.provider;if(s==="WALLET_CONNECT"){n.setDefaultChain(r.caipNetworkId);return}if(n&&s==="AUTH"){const i=n,o=Br(r.chainNamespace);await i.switchNetwork({chainId:r.caipNetworkId});const a=await i.getUser({chainId:r.caipNetworkId,preferredAccountType:o});this.emit("switchNetwork",a)}}getWalletConnectConnector(){const e=this.connectors.find(r=>r instanceof V0);if(!e)throw new Error("WalletConnectConnector not found");return e}onConnect(e,r){if(e.length>0){const{address:s,chainId:n}=te.getAccount(e[0]),i=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===(n==null?void 0:n.toString())),o=this.connectors.find(a=>a.id===r);s&&(this.emit("accountChanged",{address:s,chainId:n,connector:o}),this.addConnection({connectorId:r,accounts:e.map(a=>{const{address:c}=te.getAccount(a);return{address:c}}),caipNetwork:i}))}}onAccountsChanged(e,r,s=!0){var n,i;if(e.length>0){const{address:o}=te.getAccount(e[0]),a=(n=this.connectionManager)==null?void 0:n.getConnection({connectorId:r,connections:this.connections,connectors:this.connectors});o&&Wt.isLowerCaseMatch(this.getConnectorId(B.CHAIN.EVM),r)&&this.emit("accountChanged",{address:o,chainId:(i=a==null?void 0:a.caipNetwork)==null?void 0:i.id,connector:a==null?void 0:a.connector}),this.addConnection({connectorId:r,accounts:e.map(c=>{const{address:l}=te.getAccount(c);return{address:l}}),caipNetwork:a==null?void 0:a.caipNetwork})}else s&&this.onDisconnect(r)}onDisconnect(e){this.removeProviderListeners(e),this.deleteConnection(e),Wt.isLowerCaseMatch(this.getConnectorId(B.CHAIN.EVM),e)&&this.emitFirstAvailableConnection(),this.connections.length===0&&this.emit("disconnect")}onChainChanged(e,r){var o;const s=typeof e=="string"&&e.startsWith("0x")?Va.hexStringToNumber(e).toString():e.toString(),n=(o=this.connectionManager)==null?void 0:o.getConnection({connectorId:r,connections:this.connections,connectors:this.connectors}),i=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===s);n&&this.addConnection({connectorId:r,accounts:n.accounts,caipNetwork:i}),Wt.isLowerCaseMatch(this.getConnectorId(B.CHAIN.EVM),r)&&this.emit("switchNetwork",{chainId:s})}listenProviderEvents(e,r){if(J5.includes(e))return;const s=o=>this.onAccountsChanged(o,e),n=o=>this.onChainChanged(o,e),i=()=>this.onDisconnect(e);this.providerHandlers[e]||(r.on("disconnect",i),r.on("accountsChanged",s),r.on("chainChanged",n),this.providerHandlers[e]={provider:r,disconnect:i,accountsChanged:s,chainChanged:n})}removeProviderListeners(e){if(this.providerHandlers[e]){const{provider:r,disconnect:s,accountsChanged:n,chainChanged:i}=this.providerHandlers[e];r.removeListener("disconnect",s),r.removeListener("accountsChanged",n),r.removeListener("chainChanged",i),this.providerHandlers[e]=null}}emitFirstAvailableConnection(){var r,s;const e=(r=this.connectionManager)==null?void 0:r.getConnection({connections:this.connections,connectors:this.connectors});if(e){const[n]=e.accounts;this.emit("accountChanged",{address:n==null?void 0:n.address,chainId:(s=e.caipNetwork)==null?void 0:s.id,connector:e.connector})}}}class Z5 extends X5{async setUniversalProvider(e){if(!this.namespace)throw new Error("UniversalAdapter:setUniversalProvider - namespace is required");return this.addConnector(new V0({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace})),Promise.resolve()}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect(),this.emit("disconnect")}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}return{connections:[]}}syncConnections(){return Promise.resolve()}async getAccounts({namespace:e}){var n,i,o,a;const r=this.provider,s=((a=(o=(i=(n=r==null?void 0:r.session)==null?void 0:n.namespaces)==null?void 0:i[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>{const[,,l]=c.split(":");return l}).filter((c,l,u)=>u.indexOf(c)===l))||[];return Promise.resolve({accounts:s.map(c=>te.createAccount(e,c,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var i,o,a,c,l;if(!(e.caipNetwork&&Se.BALANCE_SUPPORTED_CHAINS.includes((i=e.caipNetwork)==null?void 0:i.chainNamespace))||(o=e.caipNetwork)!=null&&o.testnet)return{balance:"0.00",symbol:((a=e.caipNetwork)==null?void 0:a.nativeCurrency.symbol)||""};if(ee.state.balanceLoading&&e.chainId===((c=y.state.activeCaipNetwork)==null?void 0:c.id))return{balance:ee.state.balance||"0.00",symbol:ee.state.balanceSymbol||""};const n=(await ee.fetchTokenBalance()).find(u=>{var h,d;return u.chainId===`${(h=e.caipNetwork)==null?void 0:h.chainNamespace}:${e.chainId}`&&u.symbol===((d=e.caipNetwork)==null?void 0:d.nativeCurrency.symbol)});return{balance:(n==null?void 0:n.quantity.numeric)||"0.00",symbol:(n==null?void 0:n.symbol)||((l=e.caipNetwork)==null?void 0:l.nativeCurrency.symbol)||""}}async signMessage(e){var o,a,c;const{provider:r,message:s,address:n}=e;if(!r)throw new Error("UniversalAdapter:signMessage - provider is undefined");let i="";return((o=y.state.activeCaipNetwork)==null?void 0:o.chainNamespace)===B.CHAIN.SOLANA?i=(await r.request({method:"solana_signMessage",params:{message:hi.encode(new TextEncoder().encode(s)),pubkey:n}},(a=y.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)).signature:i=await r.request({method:"personal_sign",params:[s,n]},(c=y.state.activeCaipNetwork)==null?void 0:c.caipNetworkId),{signature:i}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}emitFirstAvailableConnection(){}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var n,i,o,a,c,l;const{caipNetwork:r}=e,s=this.getWalletConnectConnector();if(r.chainNamespace===B.CHAIN.EVM)try{await((n=s.provider)==null?void 0:n.request({method:"wallet_switchEthereumChain",params:[{chainId:zp(r.id)}]}))}catch(u){if(u.code===zi.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||u.code===zi.ERROR_INVALID_CHAIN_ID||u.code===zi.ERROR_CODE_DEFAULT||((o=(i=u==null?void 0:u.data)==null?void 0:i.originalError)==null?void 0:o.code)===zi.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await((l=s.provider)==null?void 0:l.request({method:"wallet_addEthereumChain",params:[{chainId:zp(r.id),rpcUrls:[(a=r==null?void 0:r.rpcUrls.chainDefault)==null?void 0:a.http],chainName:r.name,nativeCurrency:r.nativeCurrency,blockExplorerUrls:[(c=r.blockExplorers)==null?void 0:c.default.url]}]}))}catch{throw new Error("Chain is not supported")}}s.provider.setDefaultChain(r.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(s=>s.type==="WALLET_CONNECT");return e==null?void 0:e.provider}}const Q5=["email","socials","swaps","onramp","activity","reownBranding","multiWallet","emailCapture"],$a={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e.filter(r=>r!=="email"):!1},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?Se.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?Se.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?Se.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.reownBranding:!!t},emailCapture:{apiFeatureName:"email_capture",localFeatureName:"emailCapture",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>t.isEnabled&&(t.config??[]),processFallback:t=>!1},multiWallet:{apiFeatureName:"multi_wallet",localFeatureName:"multiWallet",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>Se.DEFAULT_REMOTE_FEATURES.multiWallet}},eR={localSettingsOverridden:new Set,getApiConfig(t,e){return e==null?void 0:e.find(r=>r.id===t)},addWarning(t,e){if(t!==void 0){const r=$a[e],s=r.isLegacy?`"features.${r.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(s)}},processFeature(t,e,r,s,n){const i=$a[t],o=e[i.localFeatureName];if(n&&!i.isAvailableOnBasic)return!1;if(s){const a=this.getApiConfig(i.apiFeatureName,r);return(a==null?void 0:a.config)===null?this.processFallbackFeature(t,o):a!=null&&a.config?(o!==void 0&&this.addWarning(o,t),this.processApiFeature(t,a)):!1}return this.processFallbackFeature(t,o)},processApiFeature(t,e){return $a[t].processApi(e)},processFallbackFeature(t,e){return $a[t].processFallback(e)},async fetchRemoteFeatures(t){const e=t.basic??!1,r=t.features||{};this.localSettingsOverridden.clear();let s=null,n=!1;try{s=await ne.fetchProjectConfig(),n=s!=null}catch(o){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",o)}const i=n&&!e?Se.DEFAULT_REMOTE_FEATURES:Se.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(const o of Q5){const a=this.processFeature(o,r,s,n,e);Object.assign(i,{[o]:a})}}catch(o){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",o),Se.DEFAULT_REMOTE_FEATURES}if(n&&this.localSettingsOverridden.size>0){const o=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;mt.open({debugMessage:Zt.ALERT_WARNINGS.LOCAL_CONFIGURATION_IGNORED.debugMessage(o)},"warning")}return i}};class tR{constructor(e){this.chainNamespaces=[],this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(r,s)=>{var n,i,o;if(r){const a=(n=y.getCaipNetworks(r))==null?void 0:n.find(u=>u.id===s);if(a)return a;const c=(i=y.getNetworkData(r))==null?void 0:i.caipNetwork;return c||((o=y.getRequestedCaipNetworks(r).filter(u=>u.chainNamespace===r))==null?void 0:o[0])}return y.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const r=this.getCaipNetwork();if(r)return r.id},this.getCaipNetworks=r=>y.getCaipNetworks(r),this.getActiveChainNamespace=()=>y.state.activeChain,this.setRequestedCaipNetworks=(r,s)=>{y.setRequestedCaipNetworks(r,s)},this.getApprovedCaipNetworkIds=()=>y.getAllApprovedCaipNetworkIds(),this.getCaipAddress=r=>{var s,n;return y.state.activeChain===r||!r?y.state.activeCaipAddress:(n=(s=y.state.chains.get(r))==null?void 0:s.accountState)==null?void 0:n.caipAddress},this.setClientId=r=>{ie.setClientId(r)},this.getProvider=r=>je.getProvider(r),this.getProviderType=r=>je.getProviderId(r),this.getPreferredAccountType=r=>Br(r),this.setCaipAddress=(r,s)=>{ee.setCaipAddress(r,s)},this.setBalance=(r,s,n)=>{ee.setBalance(r,s,n)},this.setProfileName=(r,s)=>{ee.setProfileName(r,s)},this.setProfileImage=(r,s)=>{ee.setProfileImage(r,s)},this.setUser=(r,s)=>{ee.setUser(r,s)},this.resetAccount=r=>{ee.resetAccount(r)},this.setCaipNetwork=r=>{y.setActiveCaipNetwork(r)},this.setCaipNetworkOfNamespace=(r,s)=>{y.setChainNetworkData(s,{caipNetwork:r})},this.setStatus=(r,s)=>{ee.setStatus(r,s),H.isConnected()?q.setConnectionStatus("connected"):q.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=r=>{var s,n;return(n=(s=y.state.chains.get(r))==null?void 0:s.accountState)==null?void 0:n.address},this.setConnectors=r=>{const s=[...H.state.allConnectors,...r];H.setConnectors(s)},this.setConnections=(r,s)=>{q.setConnections(r,s),V.setConnections(r,s)},this.fetchIdentity=r=>ie.fetchIdentity(r),this.getReownName=r=>to.getNamesForAddress(r),this.getConnectors=()=>H.getConnectors(),this.getConnectorImage=r=>S0.getConnectorImage(r),this.getConnections=r=>this.remoteFeatures.multiWallet?ac.getConnectionsData(r).connections:(mt.open(B.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.getRecentConnections=r=>this.remoteFeatures.multiWallet?ac.getConnectionsData(r).recentConnections:(mt.open(B.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.switchConnection=async r=>{if(!this.remoteFeatures.multiWallet){mt.open(B.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}await V.switchConnection(r)},this.deleteConnection=r=>{if(!this.remoteFeatures.multiWallet){mt.open(B.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}q.deleteAddressFromConnection(r),V.syncStorageConnections()},this.setConnectedWalletInfo=(r,s)=>{const n=je.getProviderId(s),i=r?{...r,type:n}:void 0;ee.setConnectedWalletInfo(i,s)},this.getIsConnectedState=()=>!!y.state.activeCaipAddress,this.addAddressLabel=(r,s,n)=>{ee.addAddressLabel(r,s,n)},this.removeAddressLabel=(r,s)=>{ee.removeAddressLabel(r,s)},this.getAddress=r=>{var s,n;return y.state.activeChain===r||!r?ee.state.address:(n=(s=y.state.chains.get(r))==null?void 0:s.accountState)==null?void 0:n.address},this.setApprovedCaipNetworksData=r=>y.setApprovedCaipNetworksData(r),this.resetNetwork=r=>{y.resetNetwork(r)},this.addConnector=r=>{H.addConnector(r)},this.resetWcConnection=()=>{V.resetWcConnection()},this.setAddressExplorerUrl=(r,s)=>{ee.setAddressExplorerUrl(r,s)},this.setSmartAccountDeployed=(r,s)=>{ee.setSmartAccountDeployed(r,s)},this.setPreferredAccountType=(r,s)=>{y.setAccountProp("preferredAccountType",r,s)},this.setEIP6963Enabled=r=>{U.setEIP6963Enabled(r)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,r){const s=e==null?void 0:e.map(i=>i.namespace).filter(i=>!!i);if(s!=null&&s.length)return[...new Set(s)];const n=r==null?void 0:r.map(i=>i.chainNamespace);return[...new Set(n)]}async initialize(e){var r,s,n;this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),U.state.enableReconnect?(await this.syncExistingConnection(),await this.syncAdapterConnections()):await this.unSyncExistingConnection(),this.remoteFeatures=await eR.fetchRemoteFeatures(e),U.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&Ou.setOnrampProviders(this.remoteFeatures.onramp),((r=U.state.remoteFeatures)!=null&&r.email||Array.isArray((s=U.state.remoteFeatures)==null?void 0:s.socials)&&((n=U.state.remoteFeatures)==null?void 0:n.socials.length)>0)&&await this.checkAllowedOrigins()}async checkAllowedOrigins(){try{const e=await ne.fetchAllowedOrigins();if(!e||!te.isClient()){mt.open(Zt.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}const r=window.location.origin;Zr.isOriginAllowed(r,e,zi.DEFAULT_ALLOWED_ANCESTORS)||mt.open(Zt.ALERT_ERRORS.ORIGIN_NOT_ALLOWED,"error")}catch(e){if(!(e instanceof Error)){mt.open(Zt.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}switch(e.message){case"RATE_LIMITED":mt.open(Zt.ALERT_ERRORS.RATE_LIMITED_APP_CONFIGURATION,"error");break;case"SERVER_ERROR":{const r=e.cause instanceof Error?e.cause:e;mt.open({displayMessage:Zt.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.displayMessage,debugMessage:Zt.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.debugMessage(r.message)},"error");break}default:mt.open(Zt.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error")}}}sendInitializeEvent(e){var s;const{...r}=e;delete r.adapters,delete r.universalProvider,Te.sendEvent({type:"track",event:"INITIALIZE",properties:{...r,networks:e.networks.map(n=>n.id),siweConfig:{options:((s=e.siweConfig)==null?void 0:s.options)||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&jt.setThemeMode(e.themeMode),e.themeVariables&&jt.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient||!this.networkControllerClient)throw new Error("ConnectionControllerClient and NetworkControllerClient must be set");y.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});const r=this.getDefaultNetwork();r&&y.setActiveCaipNetwork(r)}initializeConnectionController(e){V.initialize(e.adapters??[]),V.setWcBasic(e.basic??!1)}initializeConnectorController(){H.initialize(this.chainNamespaces)}initializeProjectSettings(e){U.setProjectId(e.projectId),U.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){var n;U.setDebug(e.debug!==!1),U.setEnableWalletConnect(e.enableWalletConnect!==!1),U.setEnableWalletGuide(e.enableWalletGuide!==!1),U.setEnableWallets(e.enableWallets!==!1),U.setEIP6963Enabled(e.enableEIP6963!==!1),U.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),U.setEnableReconnect(e.enableReconnect!==!1),U.setEnableAuthLogger(e.enableAuthLogger!==!1),U.setCustomRpcUrls(e.customRpcUrls),U.setEnableEmbedded(e.enableEmbedded),U.setAllWallets(e.allWallets),U.setIncludeWalletIds(e.includeWalletIds),U.setExcludeWalletIds(e.excludeWalletIds),U.setFeaturedWalletIds(e.featuredWalletIds),U.setTokens(e.tokens),U.setTermsConditionsUrl(e.termsConditionsUrl),U.setPrivacyPolicyUrl(e.privacyPolicyUrl),U.setCustomWallets(e.customWallets),U.setFeatures(e.features),U.setAllowUnsupportedChain(e.allowUnsupportedChain),U.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),U.setPreferUniversalLinks(e.experimental_preferUniversalLinks),U.setDefaultAccountTypes(e.defaultAccountTypes);const r=this.getDefaultMetaData();if(!e.metadata&&r&&(e.metadata=r),U.setMetadata(e.metadata),U.setDisableAppend(e.disableAppend),U.setEnableEmbedded(e.enableEmbedded),U.setSIWX(e.siwx),!e.projectId){mt.open(Zt.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(((n=e.adapters)==null?void 0:n.find(i=>i.namespace===B.CHAIN.EVM))&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");U.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){var e,r,s,n;return te.isClient()?{name:((r=(e=document.getElementsByTagName("title"))==null?void 0:e[0])==null?void 0:r.textContent)||"",description:((s=document.querySelector('meta[property="og:description"]'))==null?void 0:s.content)||"",url:window.location.origin,icons:[((n=document.querySelector('link[rel~="icon"]'))==null?void 0:n.href)||""]}:null}setUnsupportedNetwork(e){const r=this.getActiveChainNamespace();if(r){const s=zn.getUnsupportedNetwork(`${r}:${e}`);y.setActiveCaipNetwork(s)}}getDefaultNetwork(){return zn.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,r){return zn.extendCaipNetwork(e,{customNetworkImageUrls:r.chainImages,projectId:r.projectId})}extendCaipNetworks(e){return zn.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const r=e.networks.find(n=>{var i;return n.id===((i=e.defaultNetwork)==null?void 0:i.id)});return r?zn.extendCaipNetwork(r,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectNamespace(e,r){var s,n;try{this.setLoading(!0,e);let i={connections:[]};const o=this.getAdapter(e);return(((n=(s=y.state.chains.get(e))==null?void 0:s.accountState)==null?void 0:n.caipAddress)||!U.state.enableReconnect)&&(o!=null&&o.disconnect)&&(i=await o.disconnect({id:r})),this.setLoading(!1,e),i}catch(i){throw this.setLoading(!1,e),new Error(`Failed to disconnect chains: ${i.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var l;const e=y.state.activeChain,r=this.getAdapter(e),s=(l=this.getCaipNetwork(e))==null?void 0:l.id,n=V.getConnections(e),i=this.remoteFeatures.multiWallet,o=n.length>0;if(!r)throw new Error("Adapter not found");const a=await r.connectWalletConnect(s);(!o||!i)&&this.close(),this.setClientId((a==null?void 0:a.clientId)||null),q.setConnectedNamespaces([...y.state.chains.keys()]),await this.syncWalletConnectAccount(),await Tr.initializeIfEnabled()},connectExternal:async({id:e,address:r,info:s,type:n,provider:i,chain:o,caipNetwork:a,socialUri:c})=>{var p,g,w,E,v,C;const l=y.state.activeChain,u=o||l,h=this.getAdapter(u);if(o&&o!==l&&!a){const _=this.getCaipNetworks().find(S=>S.chainNamespace===o);_&&this.setCaipNetwork(_)}if(!u)throw new Error("connectExternal: namespace not found");if(!h)throw new Error("connectExternal: adapter not found");const d=this.getCaipNetwork(u),f=await h.connect({id:e,address:r,info:s,type:n,provider:i,socialUri:c,chainId:(a==null?void 0:a.id)||(d==null?void 0:d.id),rpcUrl:((w=(g=(p=a==null?void 0:a.rpcUrls)==null?void 0:p.default)==null?void 0:g.http)==null?void 0:w[0])||((C=(v=(E=d==null?void 0:d.rpcUrls)==null?void 0:E.default)==null?void 0:v.http)==null?void 0:C[0])});if(f)return q.addConnectedNamespace(u),this.syncProvider({...f,chainNamespace:u}),this.setStatus("connected",u),this.syncConnectedWalletInfo(u),q.removeDisconnectedConnectorId(e,u),{address:f.address}},reconnectExternal:async({id:e,info:r,type:s,provider:n})=>{var a;const i=y.state.activeChain,o=this.getAdapter(i);if(!i)throw new Error("reconnectExternal: namespace not found");if(!o)throw new Error("reconnectExternal: adapter not found");o!=null&&o.reconnect&&(await(o==null?void 0:o.reconnect({id:e,info:r,type:s,provider:n,chainId:(a=this.getCaipNetwork())==null?void 0:a.id})),q.addConnectedNamespace(i),this.syncConnectedWalletInfo(i))},disconnect:async e=>{var l;const{id:r,chainNamespace:s,initialDisconnect:n}=e||{},i=s||y.state.activeChain,o=H.getConnectorId(i),a=r===B.CONNECTOR_ID.AUTH||o===B.CONNECTOR_ID.AUTH,c=r===B.CONNECTOR_ID.WALLET_CONNECT||o===B.CONNECTOR_ID.WALLET_CONNECT;try{const u=Array.from(y.state.chains.keys());let h=s?[s]:u;(c||a)&&(h=u);const d=h.map(async g=>{const w=H.getConnectorId(g),E=await this.disconnectNamespace(g,r||w);E&&(a&&q.deleteConnectedSocialProvider(),E.connections.forEach(v=>{q.addDisconnectedConnectorId(v.connectorId,g)})),n&&this.onDisconnectNamespace({chainNamespace:g,closeModal:!1})}),f=await Promise.allSettled(d);Ae.resetSend(),V.resetWcConnection(),(l=Tr.getSIWX())!=null&&l.signOutOnDisconnect&&await Tr.clearSessions(),H.setFilterByNamespace(void 0),V.syncStorageConnections();const p=f.filter(g=>g.status==="rejected");if(p.length>0)throw new Error(p.map(g=>g.reason.message).join(", "));Te.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:s||"all"}})}catch(u){throw new Error(`Failed to disconnect chains: ${u.message}`)}},checkInstalled:e=>e?e.some(r=>{var s;return!!((s=window.ethereum)!=null&&s[String(r)])}):!!window.ethereum,signMessage:async e=>{const r=y.state.activeChain,s=this.getAdapter(y.state.activeChain);if(!r)throw new Error("signMessage: namespace not found");if(!s)throw new Error("signMessage: adapter not found");const n=await(s==null?void 0:s.signMessage({message:e,address:ee.state.address,provider:je.getProvider(r)}));return(n==null?void 0:n.signature)||""},sendTransaction:async e=>{const r=e.chainNamespace;if(!r)throw new Error("sendTransaction: namespace not found");if(Se.SEND_SUPPORTED_NAMESPACES.includes(r)){const s=this.getAdapter(r);if(!s)throw new Error("sendTransaction: adapter not found");const n=je.getProvider(r),i=await(s==null?void 0:s.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:n}));return(i==null?void 0:i.hash)||""}return""},estimateGas:async e=>{const r=e.chainNamespace;if(r===B.CHAIN.EVM){const s=this.getAdapter(r);if(!s)throw new Error("estimateGas: adapter is required but got undefined");const n=je.getProvider(r),i=this.getCaipNetwork();if(!i)throw new Error("estimateGas: caipNetwork is required but got undefined");const o=await(s==null?void 0:s.estimateGas({...e,provider:n,caipNetwork:i}));return(o==null?void 0:o.gas)||0n}return 0n},getEnsAvatar:async()=>{var r;const e=y.state.activeChain;if(!e)throw new Error("getEnsAvatar: namespace is required but got undefined");return await this.syncIdentity({address:ee.state.address,chainId:Number((r=this.getCaipNetwork())==null?void 0:r.id),chainNamespace:e}),ee.state.profileImage||!1},getEnsAddress:async e=>await Zr.resolveReownName(e),writeContract:async e=>{const r=y.state.activeChain,s=this.getAdapter(r);if(!r)throw new Error("writeContract: namespace is required but got undefined");if(!s)throw new Error("writeContract: adapter is required but got undefined");const n=this.getCaipNetwork(),i=this.getCaipAddress(),o=je.getProvider(r);if(!n||!i)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");const a=await(s==null?void 0:s.writeContract({...e,caipNetwork:n,provider:o,caipAddress:i}));return a==null?void 0:a.hash},parseUnits:(e,r)=>{const s=this.getAdapter(y.state.activeChain);if(!s)throw new Error("parseUnits: adapter is required but got undefined");return(s==null?void 0:s.parseUnits({value:e,decimals:r}))??0n},formatUnits:(e,r)=>{const s=this.getAdapter(y.state.activeChain);if(!s)throw new Error("formatUnits: adapter is required but got undefined");return(s==null?void 0:s.formatUnits({value:e,decimals:r}))??"0"},getCapabilities:async e=>{const r=this.getAdapter(y.state.activeChain);if(!r)throw new Error("getCapabilities: adapter is required but got undefined");return await(r==null?void 0:r.getCapabilities(e))},grantPermissions:async e=>{const r=this.getAdapter(y.state.activeChain);if(!r)throw new Error("grantPermissions: adapter is required but got undefined");return await(r==null?void 0:r.grantPermissions(e))},revokePermissions:async e=>{const r=this.getAdapter(y.state.activeChain);if(!r)throw new Error("revokePermissions: adapter is required but got undefined");return r!=null&&r.revokePermissions?await r.revokePermissions(e):"0x"},walletGetAssets:async e=>{const r=this.getAdapter(y.state.activeChain);if(!r)throw new Error("walletGetAssets: adapter is required but got undefined");return await(r==null?void 0:r.walletGetAssets(e))??{}},updateBalance:e=>{const r=this.getCaipNetwork(e);!r||!ee.state.address||this.updateNativeBalance(ee.state.address,r==null?void 0:r.id,e)}},this.networkControllerClient={switchCaipNetwork:async e=>await this.switchCaipNetwork(e),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},V.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){var r,s,n,i,o;if(je.getProviderId(y.state.activeChain)===Fs.CONNECTOR_TYPE_WALLET_CONNECT){const a=(s=(r=this.universalProvider)==null?void 0:r.session)==null?void 0:s.namespaces;return{supportsAllNetworks:((o=(i=(n=this.universalProvider)==null?void 0:n.session)==null?void 0:i.peer)==null?void 0:o.metadata.name)==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(a)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){if(!e)return;const r=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const n=je.getProvider(r),i=je.getProviderId(r);if(e.chainNamespace===y.state.activeChain){const o=this.getAdapter(r);await(o==null?void 0:o.switchNetwork({caipNetwork:e,provider:n,providerType:i}))}else if(this.setCaipNetwork(e),i===Fs.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const o=this.getAddressByChainNamespace(r);o&&this.syncAccount({address:o,chainId:e.id,chainNamespace:r})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(r=>{const s=r.chains||[],n=r.accounts.map(i=>{const{chainId:o,chainNamespace:a}=zt.parseCaipAddress(i);return`${a}:${o}`});return Array.from(new Set([...s,...n]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((r,s)=>{var i;const n=e==null?void 0:e.find(o=>o.namespace===s);return n?(n.construct({namespace:s,projectId:(i=this.options)==null?void 0:i.projectId,networks:this.getCaipNetworks()}),r[s]=n):r[s]=new Z5({namespace:s,networks:this.getCaipNetworks()}),r},{})}async initChainAdapter(e){var r;this.onConnectors(e),this.listenAdapter(e),await((r=this.chainAdapters)==null?void 0:r[e].syncConnectors(this.options,this)),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)}))}onConnectors(e){const r=this.getAdapter(e);r==null||r.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const r=this.getAdapter(e);if(!r)return;const s=q.getConnectionStatus();U.state.enableReconnect===!1?this.setStatus("disconnected",e):s==="connected"?this.setStatus("connecting",e):s==="disconnected"?(q.clearAddressCache(),this.setStatus(s,e)):this.setStatus(s,e),r.on("switchNetwork",({address:n,chainId:i})=>{var l,u;const o=this.getCaipNetworks().find(h=>h.id.toString()===i.toString()||h.caipNetworkId.toString()===i.toString()),a=y.state.activeChain===e,c=(u=(l=y.state.chains.get(e))==null?void 0:l.accountState)==null?void 0:u.address;if(o){const h=a&&n?n:c;h&&this.syncAccount({address:h,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(i)}),r.on("disconnect",()=>{const n=this.remoteFeatures.multiWallet,i=Array.from(V.state.connections.values()).flat();this.onDisconnectNamespace({chainNamespace:e,closeModal:!n||i.length===0})}),r.on("connections",n=>{this.setConnections(n,e)}),r.on("pendingTransactions",()=>{const n=ee.state.address,i=y.state.activeCaipNetwork;!n||!(i!=null&&i.id)||this.updateNativeBalance(n,i.id,i.chainNamespace)}),r.on("accountChanged",({address:n,chainId:i,connector:o})=>{var c,l;const a=y.state.activeChain===e;o!=null&&o.provider&&(this.syncProvider({id:o.id,type:o.type,provider:o.provider,chainNamespace:e}),this.syncConnectedWalletInfo(e)),a&&i?this.syncAccount({address:n,chainId:i,chainNamespace:e}):a&&((c=y.state.activeCaipNetwork)!=null&&c.id)?this.syncAccount({address:n,chainId:(l=y.state.activeCaipNetwork)==null?void 0:l.id,chainNamespace:e}):this.syncAccountInfo(n,i,e),q.addConnectedNamespace(e)})}async createUniversalProviderForAdapter(e){var r,s,n;await this.getUniversalProvider(),this.universalProvider&&await((n=(s=(r=this.chainAdapters)==null?void 0:r[e])==null?void 0:s.setUniversalProvider)==null?void 0:n.call(s,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async unSyncExistingConnection(){try{await Promise.allSettled(this.chainNamespaces.map(e=>V.disconnect({namespace:e,initialDisconnect:!0})))}catch(e){console.error("Error disconnecting existing connections:",e)}}async syncNamespaceConnection(e){try{e===B.CHAIN.EVM&&te.isSafeApp()&&H.setConnectorId(B.CONNECTOR_ID.SAFE,e);const r=H.getConnectorId(e);switch(this.setStatus("connecting",e),r){case B.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case B.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(r){console.warn("AppKit couldn't sync existing connection",r),this.setStatus("disconnected",e)}}onDisconnectNamespace(e){const{chainNamespace:r,closeModal:s}=e||{};y.resetAccount(r),y.resetNetwork(r),q.removeConnectedNamespace(r);const n=Array.from(y.state.chains.keys());(r?[r]:n).forEach(o=>q.addDisconnectedConnectorId(H.getConnectorId(o)||"",o)),H.removeConnectorId(r),je.resetChain(r),this.setUser(void 0,r),this.setStatus("disconnected",r),this.setConnectedWalletInfo(void 0,r),s!==!1&&ge.close()}async syncAdapterConnections(){await Promise.allSettled(this.chainNamespaces.map(e=>{var n;const r=this.getCaipAddress(e),s=this.getCaipNetwork(e);return(n=this.chainAdapters)==null?void 0:n[e].syncConnections({connectToFirstConnector:!r,caipNetwork:s,getConnectorStorageInfo(i){const a=q.getConnections()[e]??[];return{hasDisconnected:q.isConnectorDisconnected(i,e),hasConnected:a.some(c=>Wt.isLowerCaseMatch(c.connectorId,i))}}})}))}async syncAdapterConnection(e){var a,c,l;const r=this.getAdapter(e),s=H.getConnectorId(e),n=this.getCaipNetwork(e),o=H.getConnectors(e).find(u=>u.id===s);try{if(!r||!o)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!(n!=null&&n.id))throw new Error("CaipNetwork not found");const u=await(r==null?void 0:r.syncConnection({namespace:e,id:o.id,chainId:n.id,rpcUrl:(l=(c=(a=n==null?void 0:n.rpcUrls)==null?void 0:a.default)==null?void 0:c.http)==null?void 0:l[0]}));u?(this.syncProvider({...u,chainNamespace:e}),await this.syncAccount({...u,chainNamespace:e}),this.setStatus("connected",e)):this.setStatus("disconnected",e)}catch{this.onDisconnectNamespace({chainNamespace:e,closeModal:!1})}}async syncWalletConnectAccount(){var s,n;const e=Object.keys(((n=(s=this.universalProvider)==null?void 0:s.session)==null?void 0:n.namespaces)||{}),r=this.chainNamespaces.map(async i=>{var u,h,d,f,p;const o=this.getAdapter(i);if(!o)return;const a=((f=(d=(h=(u=this.universalProvider)==null?void 0:u.session)==null?void 0:h.namespaces)==null?void 0:d[i])==null?void 0:f.accounts)||[],c=(p=y.state.activeCaipNetwork)==null?void 0:p.id,l=a.find(g=>{const{chainId:w}=zt.parseCaipAddress(g);return w===(c==null?void 0:c.toString())})||a[0];if(l){const g=zt.validateCaipAddress(l),{chainId:w,address:E}=zt.parseCaipAddress(g);if(je.setProviderId(i,Fs.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&y.state.activeCaipNetwork&&o.namespace!==B.CHAIN.EVM){const v=o.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:y.state.activeCaipNetwork});je.setProvider(i,v)}else je.setProvider(i,this.universalProvider);H.setConnectorId(B.CONNECTOR_ID.WALLET_CONNECT,i),q.addConnectedNamespace(i),await this.syncAccount({address:E,chainId:w,chainNamespace:i})}else e.includes(i)&&this.setStatus("disconnected",i);this.syncConnectedWalletInfo(i),await y.setApprovedCaipNetworksData(i)});await Promise.all(r)}syncProvider({type:e,provider:r,id:s,chainNamespace:n}){je.setProviderId(n,e),je.setProvider(n,r),H.setConnectorId(s,n)}async syncAccount(e){var h,d;const r=e.chainNamespace===y.state.activeChain,s=y.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:n,chainId:i,chainNamespace:o}=e,{chainId:a}=q.getActiveNetworkProps(),c=i||a,l=((h=y.state.activeCaipNetwork)==null?void 0:h.name)===B.UNSUPPORTED_NETWORK_NAME,u=y.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!u)&&c){let f=this.getCaipNetworks().find(w=>w.id.toString()===c.toString()),p=this.getCaipNetworks().find(w=>w.chainNamespace===o);if(!u&&!f&&!p){const w=this.getApprovedCaipNetworkIds()||[],E=w.find(C=>{var _;return((_=zt.parseCaipNetworkId(C))==null?void 0:_.chainId)===c.toString()}),v=w.find(C=>{var _;return((_=zt.parseCaipNetworkId(C))==null?void 0:_.chainNamespace)===o});f=this.getCaipNetworks().find(C=>C.caipNetworkId===E),p=this.getCaipNetworks().find(C=>C.caipNetworkId===v||"deprecatedCaipNetworkId"in C&&C.deprecatedCaipNetworkId===v)}const g=f||p;(g==null?void 0:g.chainNamespace)===y.state.activeChain?U.state.enableNetworkSwitch&&!U.state.allowUnsupportedChain&&((d=y.state.activeCaipNetwork)==null?void 0:d.name)===B.UNSUPPORTED_NETWORK_NAME?y.showUnsupportedChainUI():this.setCaipNetwork(g):r||s&&this.setCaipNetworkOfNamespace(s,o),this.syncConnectedWalletInfo(o),Wt.isLowerCaseMatch(n,ee.state.address)||this.syncAccountInfo(n,g==null?void 0:g.id,o),r?await this.syncBalance({address:n,chainId:g==null?void 0:g.id,chainNamespace:o}):await this.syncBalance({address:n,chainId:s==null?void 0:s.id,chainNamespace:o})}}async syncAccountInfo(e,r,s){const n=this.getCaipAddress(s),i=r||(n==null?void 0:n.split(":")[1]);if(!i)return;const o=`${s}:${i}:${e}`;this.setCaipAddress(o,s),await this.syncIdentity({address:e,chainId:i,chainNamespace:s})}async syncReownName(e,r){try{const s=await this.getReownName(e);if(s[0]){const n=s[0];this.setProfileName(n.name,r)}else this.setProfileName(null,r)}catch{this.setProfileName(null,r)}}syncConnectedWalletInfo(e){var n;const r=H.getConnectorId(e),s=je.getProviderId(e);if(s===Fs.CONNECTOR_TYPE_ANNOUNCED||s===Fs.CONNECTOR_TYPE_INJECTED){if(r){const o=this.getConnectors().find(a=>{var h,d;const c=a.id===r,l=((h=a.info)==null?void 0:h.rdns)===r,u=(d=a.connectors)==null?void 0:d.some(f=>{var p;return f.id===r||((p=f.info)==null?void 0:p.rdns)===r});return c||l||!!u});if(o){const{info:a,name:c,imageUrl:l}=o,u=l||this.getConnectorImage(o);this.setConnectedWalletInfo({name:c,icon:u,...a},e)}}}else if(s===Fs.CONNECTOR_TYPE_WALLET_CONNECT){const i=je.getProvider(e);i!=null&&i.session&&this.setConnectedWalletInfo({...i.session.peer.metadata,name:i.session.peer.metadata.name,icon:(n=i.session.peer.metadata.icons)==null?void 0:n[0]},e)}else if(r&&(r===B.CONNECTOR_ID.COINBASE_SDK||r===B.CONNECTOR_ID.COINBASE)){const i=this.getConnectors().find(l=>l.id===r),o=(i==null?void 0:i.name)||"Coinbase Wallet",a=(i==null?void 0:i.imageUrl)||this.getConnectorImage(i),c=i==null?void 0:i.info;this.setConnectedWalletInfo({...c,name:o,icon:a},e)}}async syncBalance(e){!v0.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(s=>{var n;return s.id.toString()===((n=e.chainId)==null?void 0:n.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,r,s){const n=this.getAdapter(s),i=y.getCaipNetworkByNamespace(s,r);if(n){const o=await n.getBalance({address:e,chainId:r,caipNetwork:i,tokens:this.options.tokens});return this.setBalance(o.balance,o.symbol,s),o}}async initializeUniversalAdapter(){var s,n,i,o,a,c,l,u,h,d;const e=S5.createLogger((f,...p)=>{f&&this.handleAlertError(f),console.error(...p)}),r={projectId:(s=this.options)==null?void 0:s.projectId,metadata:{name:(n=this.options)!=null&&n.metadata?(i=this.options)==null?void 0:i.metadata.name:"",description:(o=this.options)!=null&&o.metadata?(a=this.options)==null?void 0:a.metadata.description:"",url:(c=this.options)!=null&&c.metadata?(l=this.options)==null?void 0:l.metadata.url:"",icons:(u=this.options)!=null&&u.metadata?(h=this.options)==null?void 0:h.metadata.icons:[""]},logger:e};U.setManualWCControl(!!((d=this.options)!=null&&d.manualWCControl)),this.universalProvider=this.options.universalProvider??await Tc.init(r),U.state.enableReconnect===!1&&this.universalProvider.session&&await this.universalProvider.disconnect(),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&this.chainNamespaces.forEach(e=>{Zr.listenWcProvider({universalProvider:this.universalProvider,namespace:e,onDisplayUri:r=>{V.setUri(r)},onConnect:()=>{V.finalizeWcConnection()},onDisconnect:()=>{y.state.noAdapters&&this.resetAccount(e),V.resetWcConnection()},onChainChanged:r=>{const s=y.state.activeChain,n=s&&H.state.activeConnectorIds[s]===B.CONNECTOR_ID.WALLET_CONNECT;if(s===e&&(y.state.noAdapters||n)){const i=this.getCaipNetworks().find(a=>a.id.toString()===r.toString()||a.caipNetworkId.toString()===r.toString()),o=this.getCaipNetwork();if(!i){this.setUnsupportedNetwork(r);return}(o==null?void 0:o.id.toString())!==(i==null?void 0:i.id.toString())&&(o==null?void 0:o.chainNamespace)===(i==null?void 0:i.chainNamespace)&&this.setCaipNetwork(i)}},onAccountsChanged:r=>{const s=y.state.activeChain,n=s&&H.state.activeConnectorIds[s]===B.CONNECTOR_ID.WALLET_CONNECT;if(s===e&&(y.state.noAdapters||n)&&r.length>0){const i=r[0];this.syncAccount({address:i.address,chainId:i.chainId,chainNamespace:i.chainNamespace})}}})})}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&te.isClient()&&((e=this.options)!=null&&e.projectId)&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Te.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}handleAlertError(e){const r=Object.entries(Zt.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[s,n]=r??[],{message:i,alertErrorKey:o}=n??{};if(s&&i&&!this.reportedAlertErrors[s]){const a=Zt.ALERT_ERRORS[o];a&&(mt.open(a,"error"),this.reportedAlertErrors[s]=!0)}}getAdapter(e){var r;if(e)return(r=this.chainAdapters)==null?void 0:r[e]}createAdapter(e){var n;if(!e)return;const r=e.namespace;if(!r)return;this.createClients();const s=e;s.namespace=r,s.construct({namespace:r,projectId:(n=this.options)==null?void 0:n.projectId,networks:this.getCaipNetworks()}),this.chainNamespaces.includes(r)||this.chainNamespaces.push(r),this.chainAdapters&&(this.chainAdapters[r]=s)}async open(e){if(await this.injectModalUi(),e!=null&&e.uri&&V.setUri(e.uri),e!=null&&e.arguments)switch(e==null?void 0:e.view){case"Swap":return ge.open({...e,data:{swap:e.arguments}})}return ge.open(e)}async close(){await this.injectModalUi(),ge.close()}setLoading(e,r){ge.setLoading(e,r)}async disconnect(e){await V.disconnect({namespace:e})}getSIWX(){return U.state.siwx}getError(){return""}getChainId(){var e;return(e=y.state.activeCaipNetwork)==null?void 0:e.id}async switchNetwork(e){const r=this.getCaipNetworks().find(s=>s.id===e.id);if(!r){mt.open(Zt.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await y.switchActiveNetwork(r)}getWalletProvider(){return y.state.activeChain?je.state.providers[y.state.activeChain]:null}getWalletProviderType(){return je.getProviderId(y.state.activeChain)}subscribeProviders(e){return je.subscribeProviders(e)}getThemeMode(){return jt.state.themeMode}getThemeVariables(){return jt.state.themeVariables}setThemeMode(e){jt.setThemeMode(e),K0(jt.state.themeMode)}setTermsConditionsUrl(e){U.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){U.setPrivacyPolicyUrl(e)}setThemeVariables(e){jt.setThemeVariables(e),K5(jt.state.themeVariables)}subscribeTheme(e){return jt.subscribe(e)}subscribeConnections(e){return this.remoteFeatures.multiWallet?V.subscribe(e):(mt.open(B.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),()=>{})}getWalletInfo(e){var r,s;return e?(s=(r=y.state.chains.get(e))==null?void 0:r.accountState)==null?void 0:s.connectedWalletInfo:ee.state.connectedWalletInfo}getAccount(e){const r=e||y.state.activeChain,s=H.getAuthConnector(r),n=y.getAccountData(r),i=q.getConnectedConnectorId(y.state.activeChain),o=V.getConnections(r);if(!r)throw new Error("AppKit:getAccount - namespace is required");const a=o.flatMap(c=>c.accounts.map(({address:l,type:u})=>te.createAccount(r,l,u||"eoa")));if(n)return{allAccounts:a,caipAddress:n.caipAddress,address:te.getPlainAddress(n.caipAddress),isConnected:!!n.caipAddress,status:n.status,embeddedWalletInfo:s&&i===B.CONNECTOR_ID.AUTH?{user:n.user?{...n.user,username:q.getConnectedSocialUsername()}:void 0,authProvider:n.socialProvider||"email",accountType:Br(r),isSmartAccountDeployed:!!n.smartAccountDeployed}:void 0}}subscribeAccount(e,r){const s=()=>{const n=this.getAccount(r);n&&e(n)};r?y.subscribeChainProp("accountState",s,r):y.subscribe(s),H.subscribe(s)}subscribeNetwork(e){return y.subscribe(({activeCaipNetwork:r})=>{e({caipNetwork:r,chainId:r==null?void 0:r.id,caipNetworkId:r==null?void 0:r.caipNetworkId})})}subscribeWalletInfo(e,r){return r?ee.subscribeKey("connectedWalletInfo",e,r):ee.subscribeKey("connectedWalletInfo",e)}subscribeShouldUpdateToAddress(e){ee.subscribeKey("shouldUpdateToAddress",e)}subscribeCaipNetworkChange(e){y.subscribeKey("activeCaipNetwork",e)}getState(){return Yr.state}getRemoteFeatures(){return U.state.remoteFeatures}subscribeState(e){return Yr.subscribe(e)}subscribeRemoteFeatures(e){return U.subscribeKey("remoteFeatures",e)}showErrorMessage(e){Pr.showError(e)}showSuccessMessage(e){Pr.showSuccess(e)}getEvent(){return{...Te.state}}subscribeEvents(e){return Te.subscribe(e)}replace(e){oe.replace(e)}redirect(e){oe.push(e)}popTransactionStack(e){oe.popTransactionStack(e)}isOpen(){return ge.state.open}isTransactionStackEmpty(){return oe.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){U.setFeatures(e)}updateRemoteFeatures(e){U.setRemoteFeatures(e)}updateOptions(e){const s={...U.state||{},...e};U.setOptions(s)}setConnectMethodsOrder(e){U.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){U.setWalletFeaturesOrder(e)}setCollapseWallets(e){U.setCollapseWallets(e)}setSocialsOrder(e){U.setSocialsOrder(e)}getConnectMethodsOrder(){return Tu.getConnectOrderMethod(U.state.features,H.getConnectors())}addNetwork(e,r){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const s=this.extendCaipNetwork(r,this.options);this.getCaipNetworks().find(n=>n.id===s.id)||y.addNetwork(s)}removeNetwork(e,r){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(n=>n.id===r)&&y.removeNetwork(e,r)}}let cg=!1;class rR extends tR{async open(e){H.isConnected()||await super.open(e)}async close(){await super.close(),this.options.manualWCControl&&V.finalizeWcConnection()}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!cg&&te.isClient()){if(await Tl(()=>import("./basic-BIioA4TD.js"),__vite__mapDeps([3,4,1,2])),await Tl(()=>import("./w3m-modal-Bs-FceJR.js"),__vite__mapDeps([5,4,1,2])),!document.querySelector("w3m-modal")){const r=document.createElement("w3m-modal");!U.state.disableAppend&&!U.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",r)}cg=!0}}}const sR="1.7.17";function nR(t){return new rR({...t,basic:!0,sdkVersion:`html-core-${sR}`})}class Ah{constructor({appKit:e,provider:r,config:s}){this.appKit=e,this.provider=r,this.config=s}static async init(e){const r=await W$.init({projectId:e.projectId,metadata:e.metadata}),s={networks:e.networks.flatMap(i=>i.chains),projectId:e.projectId,metadata:e.metadata,universalProvider:r,manualWCControl:!0},n=nR(s);return new Ah({appKit:n,provider:r,config:e})}async connect(){var r;const e=(r=this.config)==null?void 0:r.networks.reduce((s,n)=>{var i;return s[n.namespace]={...n||{},methods:(n==null?void 0:n.methods)||[],events:(n==null?void 0:n.events)||[],chains:((i=n==null?void 0:n.chains)==null?void 0:i.map(o=>o.caipNetworkId))||[]},s},{});try{await this.appKit.open();const s=await this.provider.connect({optionalNamespaces:e});if(!s)throw new Error("Error connecting to wallet: No session found");return await this.appKit.close(),{session:s}}catch(s){throw await this.appKit.close(),new Error(`Error connecting to wallet: ${s instanceof Error?s.message:"Unknown error"}`)}}async disconnect(){await this.appKit.disconnect(),await this.provider.disconnect()}async request(e,r){return await this.provider.request(e,r)}}const gk=Object.freeze(Object.defineProperty({__proto__:null,UniversalConnector:Ah},Symbol.toStringTag,{value:"Module"}));export{zR as $,ne as A,hk as B,H as C,F0 as D,Te as E,Pu as F,ii as G,Wt as H,t2 as I,jR as J,Id as K,hw as L,ge as M,lo as N,U as O,zt as P,YC as Q,oe as R,q as S,jt as T,uw as U,r2 as V,Tu as W,qR as X,FR as Y,Za as Z,WR as _,Ka as a,gk as a0,lk as b,te as c,V as d,fk as e,B as f,Wa as g,S0 as h,Jn as i,y as j,gr as k,Pr as l,Se as m,zn as n,Qe as o,pk as p,Gt as q,dk as r,yt as s,at as t,ke as u,Tr as v,uk as w,mt as x,x5 as y,ee as z};
